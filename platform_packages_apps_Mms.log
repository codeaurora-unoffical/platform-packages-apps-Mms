diff --git a/Android.mk b/Android.mk
index 1fb13f7..0d36b29 100644
--- a/Android.mk
+++ b/Android.mk
@@ -17,6 +17,7 @@ LOCAL_PACKAGE_NAME := Mms
 # Builds against the public SDK
 #LOCAL_SDK_VERSION := current
 
+LOCAL_JAVA_LIBRARIES += telephony-common mms-common
 LOCAL_STATIC_JAVA_LIBRARIES += android-common jsr305
 LOCAL_STATIC_JAVA_LIBRARIES += android-common-chips
 
diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index 21a665b..09bcb1d 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -40,6 +40,7 @@
     <uses-permission android:name="android.permission.WAKE_LOCK" />
     <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
     <uses-permission android:name="android.permission.INSTALL_DRM" />
+    <uses-permission android:name="android.permission.WRITE_APN_SETTINGS" />
 
     <application android:name="MmsApp"
             android:label="@string/app_label"
@@ -48,10 +49,10 @@
             android:allowTaskReparenting="true">
 
         <service android:name=".transaction.TransactionService"
-                 android:exported="true" />
+                 android:exported="false" />
 
         <service android:name=".transaction.SmsReceiverService"
-                 android:exported="true" />
+                 android:exported="false" />
 
         <activity android:name=".ui.ConversationList"
                   android:label="@string/app_label"
@@ -79,7 +80,7 @@
 
         <activity android:name=".ui.ComposeMessageActivity"
                   android:configChanges="orientation|screenSize|keyboardHidden"
-                  android:windowSoftInputMode="stateHidden"
+                  android:windowSoftInputMode="stateHidden|adjustResize"
                   android:theme="@style/MmsHoloTheme"
                   android:parentActivityName=".ui.ConversationList"
                   android:launchMode="singleTop" >
@@ -156,6 +157,10 @@
             android:theme="@style/MmsHoloTheme"
             android:label="@string/edit_slideshow_activity" />
 
+        <activity android:name=".ui.RecipientListActivity"
+            android:theme="@style/MmsHoloTheme"
+            android:label="@string/recipient_list_activity" />
+
         <activity android:name=".ui.SlideEditorActivity"
             android:windowSoftInputMode="adjustResize"
             android:theme="@style/MmsHoloTheme"
@@ -192,6 +197,9 @@
                 <action android:name="android.intent.action.CONTENT_CHANGED" />
             </intent-filter>
             <intent-filter>
+                <action android:name="android.net.conn.CONNECTIVITY_CHANGE" />
+            </intent-filter>
+            <intent-filter>
                 <action android:name="android.intent.action.BOOT_COMPLETED" />
             </intent-filter>
         </receiver>
@@ -274,6 +282,7 @@
 
         <!-- Search Suggestions Provider -->
         <provider android:name="SuggestionsProvider"
+            android:exported="true"
             android:readPermission="android.permission.READ_SMS"
             android:authorities="com.android.mms.SuggestionsProvider" >
             <path-permission
@@ -285,10 +294,10 @@
         </provider>
 
         <service android:name=".ui.NoConfirmationSendService"
-                 android:permission="android.permission.SEND_SMS_NO_CONFIRMATION"
+                 android:permission="android.permission.SEND_RESPOND_VIA_MESSAGE"
                  android:exported="true" >
             <intent-filter>
-                <action android:name="com.android.mms.intent.action.SENDTO_NO_CONFIRMATION" />
+                <action android:name="android.intent.action.RESPOND_VIA_MESSAGE" />
                 <category android:name="android.intent.category.DEFAULT" />
                 <data android:scheme="sms" />
                 <data android:scheme="smsto" />
@@ -296,6 +305,7 @@
         </service>
 
         <provider android:name="TempFileProvider"
+                  android:exported="true"
                   android:authorities="mms_temp_file"
                   android:multiprocess="true" />
 
diff --git a/apptests/AndroidManifest.xml b/apptests/AndroidManifest.xml
index f38330a..41966db 100644
--- a/apptests/AndroidManifest.xml
+++ b/apptests/AndroidManifest.xml
@@ -22,6 +22,7 @@
         that the new SendIntent works because the app will crash because no service
         to handle the intent (without SEND_SMS permission) can be found. -->
     <uses-permission android:name="android.permission.SEND_SMS_NO_CONFIRMATION" />
+    <uses-permission android:name="android.permission.READ_PHONE_STATE" />
 
     <!-- We add an application tag here just so that we can indicate that
          this package needs to link against the android.test library,
diff --git a/apptests/src/com/android/mms/tests/SmsSendIntentTestActivity.java b/apptests/src/com/android/mms/tests/SmsSendIntentTestActivity.java
index 5902646..8af9bf8 100644
--- a/apptests/src/com/android/mms/tests/SmsSendIntentTestActivity.java
+++ b/apptests/src/com/android/mms/tests/SmsSendIntentTestActivity.java
@@ -17,9 +17,11 @@
 package com.android.mms.apptests;
 
 import android.app.Activity;
+import android.content.Context;
 import android.content.Intent;
 import android.net.Uri;
 import android.os.Bundle;
+import android.telephony.TelephonyManager;
 import android.text.TextUtils;
 import android.view.Menu;
 import android.view.MenuItem;
@@ -56,7 +58,9 @@ public class SmsSendIntentTestActivity extends Activity {
         mRecipient = (EditText)findViewById(R.id.sms_recipient);
         mMessage = (EditText)findViewById(R.id.sms_content);
 
-        mRecipient.setText("650-933-0884"); // use this to prime a number
+        String line1Number = ((TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE))
+                .getLine1Number();
+        mRecipient.setText(line1Number); // use this to prime a number
 
         Button sendButton = (Button) findViewById(R.id.sms_send_message);
         sendButton.setOnClickListener(new OnClickListener() {
diff --git a/res/drawable-hdpi/emo_im_angel.png b/res/drawable-hdpi/emo_im_angel.png
index 8d5ce58..6fd041e 100644
Binary files a/res/drawable-hdpi/emo_im_angel.png and b/res/drawable-hdpi/emo_im_angel.png differ
diff --git a/res/drawable-hdpi/emo_im_cool.png b/res/drawable-hdpi/emo_im_cool.png
index 8d2b01f..1534590 100644
Binary files a/res/drawable-hdpi/emo_im_cool.png and b/res/drawable-hdpi/emo_im_cool.png differ
diff --git a/res/drawable-hdpi/emo_im_crying.png b/res/drawable-hdpi/emo_im_crying.png
index 2824241..cd62e28 100644
Binary files a/res/drawable-hdpi/emo_im_crying.png and b/res/drawable-hdpi/emo_im_crying.png differ
diff --git a/res/drawable-hdpi/emo_im_embarrassed.png b/res/drawable-hdpi/emo_im_embarrassed.png
index 6bb34ed..6b02059 100644
Binary files a/res/drawable-hdpi/emo_im_embarrassed.png and b/res/drawable-hdpi/emo_im_embarrassed.png differ
diff --git a/res/drawable-hdpi/emo_im_foot_in_mouth.png b/res/drawable-hdpi/emo_im_foot_in_mouth.png
index d9f4457..023ded3 100644
Binary files a/res/drawable-hdpi/emo_im_foot_in_mouth.png and b/res/drawable-hdpi/emo_im_foot_in_mouth.png differ
diff --git a/res/drawable-hdpi/emo_im_happy.png b/res/drawable-hdpi/emo_im_happy.png
index f0750b6..50fab9a 100644
Binary files a/res/drawable-hdpi/emo_im_happy.png and b/res/drawable-hdpi/emo_im_happy.png differ
diff --git a/res/drawable-hdpi/emo_im_heart.png b/res/drawable-hdpi/emo_im_heart.png
index c63fbee..cc630ae 100644
Binary files a/res/drawable-hdpi/emo_im_heart.png and b/res/drawable-hdpi/emo_im_heart.png differ
diff --git a/res/drawable-hdpi/emo_im_kissing.png b/res/drawable-hdpi/emo_im_kissing.png
index 5a06981..9ee6a83 100644
Binary files a/res/drawable-hdpi/emo_im_kissing.png and b/res/drawable-hdpi/emo_im_kissing.png differ
diff --git a/res/drawable-hdpi/emo_im_laughing.png b/res/drawable-hdpi/emo_im_laughing.png
index fd5a584..eb55848 100644
Binary files a/res/drawable-hdpi/emo_im_laughing.png and b/res/drawable-hdpi/emo_im_laughing.png differ
diff --git a/res/drawable-hdpi/emo_im_lips_are_sealed.png b/res/drawable-hdpi/emo_im_lips_are_sealed.png
index 8dfd64d..2fd718c 100644
Binary files a/res/drawable-hdpi/emo_im_lips_are_sealed.png and b/res/drawable-hdpi/emo_im_lips_are_sealed.png differ
diff --git a/res/drawable-hdpi/emo_im_mad.png b/res/drawable-hdpi/emo_im_mad.png
index 449b696..3a3d513 100644
Binary files a/res/drawable-hdpi/emo_im_mad.png and b/res/drawable-hdpi/emo_im_mad.png differ
diff --git a/res/drawable-hdpi/emo_im_money_mouth.png b/res/drawable-hdpi/emo_im_money_mouth.png
index 87f44b7..0f64d79 100644
Binary files a/res/drawable-hdpi/emo_im_money_mouth.png and b/res/drawable-hdpi/emo_im_money_mouth.png differ
diff --git a/res/drawable-hdpi/emo_im_pokerface.png b/res/drawable-hdpi/emo_im_pokerface.png
index a78fbc1..af7a930 100644
Binary files a/res/drawable-hdpi/emo_im_pokerface.png and b/res/drawable-hdpi/emo_im_pokerface.png differ
diff --git a/res/drawable-hdpi/emo_im_sad.png b/res/drawable-hdpi/emo_im_sad.png
index 06a2650..5e92be4 100644
Binary files a/res/drawable-hdpi/emo_im_sad.png and b/res/drawable-hdpi/emo_im_sad.png differ
diff --git a/res/drawable-hdpi/emo_im_smirk.png b/res/drawable-hdpi/emo_im_smirk.png
index a46ce19..d7bf9ec 100644
Binary files a/res/drawable-hdpi/emo_im_smirk.png and b/res/drawable-hdpi/emo_im_smirk.png differ
diff --git a/res/drawable-hdpi/emo_im_surprised.png b/res/drawable-hdpi/emo_im_surprised.png
index 824e54f..27db06f 100644
Binary files a/res/drawable-hdpi/emo_im_surprised.png and b/res/drawable-hdpi/emo_im_surprised.png differ
diff --git a/res/drawable-hdpi/emo_im_tongue_sticking_out.png b/res/drawable-hdpi/emo_im_tongue_sticking_out.png
index 17bbad3..97e0c95 100644
Binary files a/res/drawable-hdpi/emo_im_tongue_sticking_out.png and b/res/drawable-hdpi/emo_im_tongue_sticking_out.png differ
diff --git a/res/drawable-hdpi/emo_im_undecided.png b/res/drawable-hdpi/emo_im_undecided.png
index b3bd285..4593bea 100644
Binary files a/res/drawable-hdpi/emo_im_undecided.png and b/res/drawable-hdpi/emo_im_undecided.png differ
diff --git a/res/drawable-hdpi/emo_im_winking.png b/res/drawable-hdpi/emo_im_winking.png
index 7d45fbf..e0a0d32 100644
Binary files a/res/drawable-hdpi/emo_im_winking.png and b/res/drawable-hdpi/emo_im_winking.png differ
diff --git a/res/drawable-hdpi/emo_im_wtf.png b/res/drawable-hdpi/emo_im_wtf.png
index 4481a3a..ce914ea 100644
Binary files a/res/drawable-hdpi/emo_im_wtf.png and b/res/drawable-hdpi/emo_im_wtf.png differ
diff --git a/res/drawable-hdpi/emo_im_yelling.png b/res/drawable-hdpi/emo_im_yelling.png
index 25a59b3..508d660 100644
Binary files a/res/drawable-hdpi/emo_im_yelling.png and b/res/drawable-hdpi/emo_im_yelling.png differ
diff --git a/res/drawable-hdpi/ic_attach_audio_holo_light.png b/res/drawable-hdpi/ic_attach_audio_holo_light.png
index a7838f2..67e6b6e 100644
Binary files a/res/drawable-hdpi/ic_attach_audio_holo_light.png and b/res/drawable-hdpi/ic_attach_audio_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_capture_audio_holo_light.png b/res/drawable-hdpi/ic_attach_capture_audio_holo_light.png
index 202c59b..cff86f1 100644
Binary files a/res/drawable-hdpi/ic_attach_capture_audio_holo_light.png and b/res/drawable-hdpi/ic_attach_capture_audio_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_capture_picture_holo_light.png b/res/drawable-hdpi/ic_attach_capture_picture_holo_light.png
index 5171af3..5a86428 100644
Binary files a/res/drawable-hdpi/ic_attach_capture_picture_holo_light.png and b/res/drawable-hdpi/ic_attach_capture_picture_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_capture_video_holo_light.png b/res/drawable-hdpi/ic_attach_capture_video_holo_light.png
index 3058dc7..9f40a1b 100644
Binary files a/res/drawable-hdpi/ic_attach_capture_video_holo_light.png and b/res/drawable-hdpi/ic_attach_capture_video_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_picture_holo_light.png b/res/drawable-hdpi/ic_attach_picture_holo_light.png
index 43e8744..eb567ee 100644
Binary files a/res/drawable-hdpi/ic_attach_picture_holo_light.png and b/res/drawable-hdpi/ic_attach_picture_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_slideshow_holo_light.png b/res/drawable-hdpi/ic_attach_slideshow_holo_light.png
index e214058..9368345 100644
Binary files a/res/drawable-hdpi/ic_attach_slideshow_holo_light.png and b/res/drawable-hdpi/ic_attach_slideshow_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_attach_video_holo_light.png b/res/drawable-hdpi/ic_attach_video_holo_light.png
index fe31fe4..6161533 100644
Binary files a/res/drawable-hdpi/ic_attach_video_holo_light.png and b/res/drawable-hdpi/ic_attach_video_holo_light.png differ
diff --git a/res/drawable-hdpi/ic_launcher_contacts.png b/res/drawable-hdpi/ic_launcher_contacts.png
deleted file mode 100644
index 1862abe..0000000
Binary files a/res/drawable-hdpi/ic_launcher_contacts.png and /dev/null differ
diff --git a/res/drawable-hdpi/ic_launcher_smsmms.png b/res/drawable-hdpi/ic_launcher_smsmms.png
deleted file mode 100644
index 94bea9a..0000000
Binary files a/res/drawable-hdpi/ic_launcher_smsmms.png and /dev/null differ
diff --git a/res/drawable-hdpi/ic_send_disabled_holo_light.png b/res/drawable-hdpi/ic_send_disabled_holo_light.png
index b416726..81bd9a1 100644
Binary files a/res/drawable-hdpi/ic_send_disabled_holo_light.png and b/res/drawable-hdpi/ic_send_disabled_holo_light.png differ
diff --git a/res/drawable-mdpi/emo_im_angel.png b/res/drawable-mdpi/emo_im_angel.png
index f9c6da0..e3555e5 100644
Binary files a/res/drawable-mdpi/emo_im_angel.png and b/res/drawable-mdpi/emo_im_angel.png differ
diff --git a/res/drawable-mdpi/emo_im_cool.png b/res/drawable-mdpi/emo_im_cool.png
index 0eee818..83b3e58 100644
Binary files a/res/drawable-mdpi/emo_im_cool.png and b/res/drawable-mdpi/emo_im_cool.png differ
diff --git a/res/drawable-mdpi/emo_im_crying.png b/res/drawable-mdpi/emo_im_crying.png
index f47cb68..f5215af 100644
Binary files a/res/drawable-mdpi/emo_im_crying.png and b/res/drawable-mdpi/emo_im_crying.png differ
diff --git a/res/drawable-mdpi/emo_im_embarrassed.png b/res/drawable-mdpi/emo_im_embarrassed.png
index 789e3dc..3f7292f 100644
Binary files a/res/drawable-mdpi/emo_im_embarrassed.png and b/res/drawable-mdpi/emo_im_embarrassed.png differ
diff --git a/res/drawable-mdpi/emo_im_foot_in_mouth.png b/res/drawable-mdpi/emo_im_foot_in_mouth.png
index bd6ff42..c520922 100644
Binary files a/res/drawable-mdpi/emo_im_foot_in_mouth.png and b/res/drawable-mdpi/emo_im_foot_in_mouth.png differ
diff --git a/res/drawable-mdpi/emo_im_happy.png b/res/drawable-mdpi/emo_im_happy.png
index ec74ca1..48e45d8 100644
Binary files a/res/drawable-mdpi/emo_im_happy.png and b/res/drawable-mdpi/emo_im_happy.png differ
diff --git a/res/drawable-mdpi/emo_im_heart.png b/res/drawable-mdpi/emo_im_heart.png
index 5ee3c79..834c349 100644
Binary files a/res/drawable-mdpi/emo_im_heart.png and b/res/drawable-mdpi/emo_im_heart.png differ
diff --git a/res/drawable-mdpi/emo_im_kissing.png b/res/drawable-mdpi/emo_im_kissing.png
index 075a597..6aebf0b 100644
Binary files a/res/drawable-mdpi/emo_im_kissing.png and b/res/drawable-mdpi/emo_im_kissing.png differ
diff --git a/res/drawable-mdpi/emo_im_laughing.png b/res/drawable-mdpi/emo_im_laughing.png
index 16d1a8f..3897993 100644
Binary files a/res/drawable-mdpi/emo_im_laughing.png and b/res/drawable-mdpi/emo_im_laughing.png differ
diff --git a/res/drawable-mdpi/emo_im_lips_are_sealed.png b/res/drawable-mdpi/emo_im_lips_are_sealed.png
index 3d7f74b..c42517f 100644
Binary files a/res/drawable-mdpi/emo_im_lips_are_sealed.png and b/res/drawable-mdpi/emo_im_lips_are_sealed.png differ
diff --git a/res/drawable-mdpi/emo_im_mad.png b/res/drawable-mdpi/emo_im_mad.png
index eec6624..2b8def0 100644
Binary files a/res/drawable-mdpi/emo_im_mad.png and b/res/drawable-mdpi/emo_im_mad.png differ
diff --git a/res/drawable-mdpi/emo_im_money_mouth.png b/res/drawable-mdpi/emo_im_money_mouth.png
index c3b37c4..34274d2 100644
Binary files a/res/drawable-mdpi/emo_im_money_mouth.png and b/res/drawable-mdpi/emo_im_money_mouth.png differ
diff --git a/res/drawable-mdpi/emo_im_pokerface.png b/res/drawable-mdpi/emo_im_pokerface.png
index 56e5861..1182f5a 100644
Binary files a/res/drawable-mdpi/emo_im_pokerface.png and b/res/drawable-mdpi/emo_im_pokerface.png differ
diff --git a/res/drawable-mdpi/emo_im_sad.png b/res/drawable-mdpi/emo_im_sad.png
index dddffbc..4bbf06c 100644
Binary files a/res/drawable-mdpi/emo_im_sad.png and b/res/drawable-mdpi/emo_im_sad.png differ
diff --git a/res/drawable-mdpi/emo_im_smirk.png b/res/drawable-mdpi/emo_im_smirk.png
index c6d1707..07fb331 100644
Binary files a/res/drawable-mdpi/emo_im_smirk.png and b/res/drawable-mdpi/emo_im_smirk.png differ
diff --git a/res/drawable-mdpi/emo_im_surprised.png b/res/drawable-mdpi/emo_im_surprised.png
index 96b43f2..b232fab 100644
Binary files a/res/drawable-mdpi/emo_im_surprised.png and b/res/drawable-mdpi/emo_im_surprised.png differ
diff --git a/res/drawable-mdpi/emo_im_tongue_sticking_out.png b/res/drawable-mdpi/emo_im_tongue_sticking_out.png
index 7025a07..5718f86 100644
Binary files a/res/drawable-mdpi/emo_im_tongue_sticking_out.png and b/res/drawable-mdpi/emo_im_tongue_sticking_out.png differ
diff --git a/res/drawable-mdpi/emo_im_undecided.png b/res/drawable-mdpi/emo_im_undecided.png
index 8421b1c..c755385 100644
Binary files a/res/drawable-mdpi/emo_im_undecided.png and b/res/drawable-mdpi/emo_im_undecided.png differ
diff --git a/res/drawable-mdpi/emo_im_winking.png b/res/drawable-mdpi/emo_im_winking.png
index 9158c58..de9dc28 100644
Binary files a/res/drawable-mdpi/emo_im_winking.png and b/res/drawable-mdpi/emo_im_winking.png differ
diff --git a/res/drawable-mdpi/emo_im_wtf.png b/res/drawable-mdpi/emo_im_wtf.png
index 0f57cd4..67331a5 100644
Binary files a/res/drawable-mdpi/emo_im_wtf.png and b/res/drawable-mdpi/emo_im_wtf.png differ
diff --git a/res/drawable-mdpi/emo_im_yelling.png b/res/drawable-mdpi/emo_im_yelling.png
index 176f778..5ae77ce 100644
Binary files a/res/drawable-mdpi/emo_im_yelling.png and b/res/drawable-mdpi/emo_im_yelling.png differ
diff --git a/res/drawable-mdpi/ic_attach_audio_holo_light.png b/res/drawable-mdpi/ic_attach_audio_holo_light.png
index 90178f1..b8826e8 100644
Binary files a/res/drawable-mdpi/ic_attach_audio_holo_light.png and b/res/drawable-mdpi/ic_attach_audio_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_capture_audio_holo_light.png b/res/drawable-mdpi/ic_attach_capture_audio_holo_light.png
index d83f2a5..7d16bca 100644
Binary files a/res/drawable-mdpi/ic_attach_capture_audio_holo_light.png and b/res/drawable-mdpi/ic_attach_capture_audio_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_capture_picture_holo_light.png b/res/drawable-mdpi/ic_attach_capture_picture_holo_light.png
index 7e5d257..8429c7b 100644
Binary files a/res/drawable-mdpi/ic_attach_capture_picture_holo_light.png and b/res/drawable-mdpi/ic_attach_capture_picture_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_capture_video_holo_light.png b/res/drawable-mdpi/ic_attach_capture_video_holo_light.png
index 72732f9..386dc56 100644
Binary files a/res/drawable-mdpi/ic_attach_capture_video_holo_light.png and b/res/drawable-mdpi/ic_attach_capture_video_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_picture_holo_light.png b/res/drawable-mdpi/ic_attach_picture_holo_light.png
index e66e04a..76d23dc 100644
Binary files a/res/drawable-mdpi/ic_attach_picture_holo_light.png and b/res/drawable-mdpi/ic_attach_picture_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_slideshow_holo_light.png b/res/drawable-mdpi/ic_attach_slideshow_holo_light.png
index b325565..08828be 100644
Binary files a/res/drawable-mdpi/ic_attach_slideshow_holo_light.png and b/res/drawable-mdpi/ic_attach_slideshow_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_attach_video_holo_light.png b/res/drawable-mdpi/ic_attach_video_holo_light.png
index e2f96b0..d6f11a5 100644
Binary files a/res/drawable-mdpi/ic_attach_video_holo_light.png and b/res/drawable-mdpi/ic_attach_video_holo_light.png differ
diff --git a/res/drawable-mdpi/ic_launcher_contacts.png b/res/drawable-mdpi/ic_launcher_contacts.png
deleted file mode 100644
index be81940..0000000
Binary files a/res/drawable-mdpi/ic_launcher_contacts.png and /dev/null differ
diff --git a/res/drawable-mdpi/ic_launcher_smsmms.png b/res/drawable-mdpi/ic_launcher_smsmms.png
deleted file mode 100644
index 8022a25..0000000
Binary files a/res/drawable-mdpi/ic_launcher_smsmms.png and /dev/null differ
diff --git a/res/drawable-mdpi/ic_send_disabled_holo_light.png b/res/drawable-mdpi/ic_send_disabled_holo_light.png
index f689cea..994ec51 100644
Binary files a/res/drawable-mdpi/ic_send_disabled_holo_light.png and b/res/drawable-mdpi/ic_send_disabled_holo_light.png differ
diff --git a/res/drawable-xhdpi/emo_im_angel.png b/res/drawable-xhdpi/emo_im_angel.png
index 982ce24..6d83c06 100644
Binary files a/res/drawable-xhdpi/emo_im_angel.png and b/res/drawable-xhdpi/emo_im_angel.png differ
diff --git a/res/drawable-xhdpi/emo_im_cool.png b/res/drawable-xhdpi/emo_im_cool.png
index a1f3692..b136df7 100644
Binary files a/res/drawable-xhdpi/emo_im_cool.png and b/res/drawable-xhdpi/emo_im_cool.png differ
diff --git a/res/drawable-xhdpi/emo_im_crying.png b/res/drawable-xhdpi/emo_im_crying.png
index 101dc47..878ca93 100644
Binary files a/res/drawable-xhdpi/emo_im_crying.png and b/res/drawable-xhdpi/emo_im_crying.png differ
diff --git a/res/drawable-xhdpi/emo_im_embarrassed.png b/res/drawable-xhdpi/emo_im_embarrassed.png
index 7fcf1ee..218a310 100644
Binary files a/res/drawable-xhdpi/emo_im_embarrassed.png and b/res/drawable-xhdpi/emo_im_embarrassed.png differ
diff --git a/res/drawable-xhdpi/emo_im_foot_in_mouth.png b/res/drawable-xhdpi/emo_im_foot_in_mouth.png
index c72cd1e..a453d55 100644
Binary files a/res/drawable-xhdpi/emo_im_foot_in_mouth.png and b/res/drawable-xhdpi/emo_im_foot_in_mouth.png differ
diff --git a/res/drawable-xhdpi/emo_im_happy.png b/res/drawable-xhdpi/emo_im_happy.png
index 617e81c..fb49a0e 100644
Binary files a/res/drawable-xhdpi/emo_im_happy.png and b/res/drawable-xhdpi/emo_im_happy.png differ
diff --git a/res/drawable-xhdpi/emo_im_heart.png b/res/drawable-xhdpi/emo_im_heart.png
index 0ae9588..eca86ca 100644
Binary files a/res/drawable-xhdpi/emo_im_heart.png and b/res/drawable-xhdpi/emo_im_heart.png differ
diff --git a/res/drawable-xhdpi/emo_im_kissing.png b/res/drawable-xhdpi/emo_im_kissing.png
index 6d2d122..f12aef6 100644
Binary files a/res/drawable-xhdpi/emo_im_kissing.png and b/res/drawable-xhdpi/emo_im_kissing.png differ
diff --git a/res/drawable-xhdpi/emo_im_laughing.png b/res/drawable-xhdpi/emo_im_laughing.png
index ef8ca88..4ad221e 100644
Binary files a/res/drawable-xhdpi/emo_im_laughing.png and b/res/drawable-xhdpi/emo_im_laughing.png differ
diff --git a/res/drawable-xhdpi/emo_im_lips_are_sealed.png b/res/drawable-xhdpi/emo_im_lips_are_sealed.png
index bc9e4ac..4e26f7f 100644
Binary files a/res/drawable-xhdpi/emo_im_lips_are_sealed.png and b/res/drawable-xhdpi/emo_im_lips_are_sealed.png differ
diff --git a/res/drawable-xhdpi/emo_im_mad.png b/res/drawable-xhdpi/emo_im_mad.png
index ee4d2a4..5ea0ffc 100644
Binary files a/res/drawable-xhdpi/emo_im_mad.png and b/res/drawable-xhdpi/emo_im_mad.png differ
diff --git a/res/drawable-xhdpi/emo_im_money_mouth.png b/res/drawable-xhdpi/emo_im_money_mouth.png
index a066800..36623c2 100644
Binary files a/res/drawable-xhdpi/emo_im_money_mouth.png and b/res/drawable-xhdpi/emo_im_money_mouth.png differ
diff --git a/res/drawable-xhdpi/emo_im_pokerface.png b/res/drawable-xhdpi/emo_im_pokerface.png
index bae1658..e2986f7 100644
Binary files a/res/drawable-xhdpi/emo_im_pokerface.png and b/res/drawable-xhdpi/emo_im_pokerface.png differ
diff --git a/res/drawable-xhdpi/emo_im_sad.png b/res/drawable-xhdpi/emo_im_sad.png
index 6deeaf1..29493ac 100644
Binary files a/res/drawable-xhdpi/emo_im_sad.png and b/res/drawable-xhdpi/emo_im_sad.png differ
diff --git a/res/drawable-xhdpi/emo_im_smirk.png b/res/drawable-xhdpi/emo_im_smirk.png
index a2afb30..6933e43 100644
Binary files a/res/drawable-xhdpi/emo_im_smirk.png and b/res/drawable-xhdpi/emo_im_smirk.png differ
diff --git a/res/drawable-xhdpi/emo_im_surprised.png b/res/drawable-xhdpi/emo_im_surprised.png
index f6f1768..21e0623 100644
Binary files a/res/drawable-xhdpi/emo_im_surprised.png and b/res/drawable-xhdpi/emo_im_surprised.png differ
diff --git a/res/drawable-xhdpi/emo_im_tongue_sticking_out.png b/res/drawable-xhdpi/emo_im_tongue_sticking_out.png
index a67b8e4..289ba80 100644
Binary files a/res/drawable-xhdpi/emo_im_tongue_sticking_out.png and b/res/drawable-xhdpi/emo_im_tongue_sticking_out.png differ
diff --git a/res/drawable-xhdpi/emo_im_undecided.png b/res/drawable-xhdpi/emo_im_undecided.png
index ce1cd8e..8a9e7fc 100644
Binary files a/res/drawable-xhdpi/emo_im_undecided.png and b/res/drawable-xhdpi/emo_im_undecided.png differ
diff --git a/res/drawable-xhdpi/emo_im_winking.png b/res/drawable-xhdpi/emo_im_winking.png
index 26291a7..7569346 100644
Binary files a/res/drawable-xhdpi/emo_im_winking.png and b/res/drawable-xhdpi/emo_im_winking.png differ
diff --git a/res/drawable-xhdpi/emo_im_wtf.png b/res/drawable-xhdpi/emo_im_wtf.png
index 509bf3b..549d273 100644
Binary files a/res/drawable-xhdpi/emo_im_wtf.png and b/res/drawable-xhdpi/emo_im_wtf.png differ
diff --git a/res/drawable-xhdpi/emo_im_yelling.png b/res/drawable-xhdpi/emo_im_yelling.png
index 68879e7..abc06b2 100644
Binary files a/res/drawable-xhdpi/emo_im_yelling.png and b/res/drawable-xhdpi/emo_im_yelling.png differ
diff --git a/res/drawable-xhdpi/ic_attach_audio_holo_light.png b/res/drawable-xhdpi/ic_attach_audio_holo_light.png
index 7f0951b..324f447 100644
Binary files a/res/drawable-xhdpi/ic_attach_audio_holo_light.png and b/res/drawable-xhdpi/ic_attach_audio_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_capture_audio_holo_light.png b/res/drawable-xhdpi/ic_attach_capture_audio_holo_light.png
index 05f724b..1332e06 100644
Binary files a/res/drawable-xhdpi/ic_attach_capture_audio_holo_light.png and b/res/drawable-xhdpi/ic_attach_capture_audio_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_capture_picture_holo_light.png b/res/drawable-xhdpi/ic_attach_capture_picture_holo_light.png
index cfb7402..b3b6d8e 100644
Binary files a/res/drawable-xhdpi/ic_attach_capture_picture_holo_light.png and b/res/drawable-xhdpi/ic_attach_capture_picture_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_capture_video_holo_light.png b/res/drawable-xhdpi/ic_attach_capture_video_holo_light.png
index a455120..4e1b374 100644
Binary files a/res/drawable-xhdpi/ic_attach_capture_video_holo_light.png and b/res/drawable-xhdpi/ic_attach_capture_video_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_picture_holo_light.png b/res/drawable-xhdpi/ic_attach_picture_holo_light.png
index 88118a8..d605bca 100644
Binary files a/res/drawable-xhdpi/ic_attach_picture_holo_light.png and b/res/drawable-xhdpi/ic_attach_picture_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_slideshow_holo_light.png b/res/drawable-xhdpi/ic_attach_slideshow_holo_light.png
index 5124c8e..2bcd1a4 100644
Binary files a/res/drawable-xhdpi/ic_attach_slideshow_holo_light.png and b/res/drawable-xhdpi/ic_attach_slideshow_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_attach_video_holo_light.png b/res/drawable-xhdpi/ic_attach_video_holo_light.png
index 9f70c46..a905b36 100644
Binary files a/res/drawable-xhdpi/ic_attach_video_holo_light.png and b/res/drawable-xhdpi/ic_attach_video_holo_light.png differ
diff --git a/res/drawable-xhdpi/ic_launcher_contacts.png b/res/drawable-xhdpi/ic_launcher_contacts.png
deleted file mode 100644
index 2ccd8ba..0000000
Binary files a/res/drawable-xhdpi/ic_launcher_contacts.png and /dev/null differ
diff --git a/res/drawable-xhdpi/ic_launcher_smsmms.png b/res/drawable-xhdpi/ic_launcher_smsmms.png
deleted file mode 100644
index 861806d..0000000
Binary files a/res/drawable-xhdpi/ic_launcher_smsmms.png and /dev/null differ
diff --git a/res/drawable-xhdpi/ic_send_disabled_holo_light.png b/res/drawable-xhdpi/ic_send_disabled_holo_light.png
index 2a2a114..8c8aa65 100644
Binary files a/res/drawable-xhdpi/ic_send_disabled_holo_light.png and b/res/drawable-xhdpi/ic_send_disabled_holo_light.png differ
diff --git a/res/layout/compose_message_activity.xml b/res/layout/compose_message_activity.xml
index c0e094e..2c653f8 100644
--- a/res/layout/compose_message_activity.xml
+++ b/res/layout/compose_message_activity.xml
@@ -181,7 +181,7 @@
                         android:layout_marginLeft="4dip"
                         android:editable="false"
                         android:text="@string/mms"
-                        android:contentDescription="@string/send"
+                        android:contentDescription="@string/send_mms"
                         android:nextFocusLeft="@+id/embedded_text_editor" />
 
                     <ImageButton
diff --git a/res/layout/recipient_list_item.xml b/res/layout/recipient_list_item.xml
new file mode 100644
index 0000000..e7eee78
--- /dev/null
+++ b/res/layout/recipient_list_item.xml
@@ -0,0 +1,66 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+ * Copyright (C) 2012 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:layout_weight="1"
+    android:orientation="vertical" >
+
+    <RelativeLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <view class="android.widget.QuickContactBadge"
+            android:id="@+id/avatar"
+            android:layout_alignParentLeft="true"
+            android:layout_width="@dimen/avatar_width_height"
+            android:layout_height="@dimen/avatar_width_height" />
+
+        <LinearLayout
+            android:id="@+id/message_block"
+            android:minHeight="@dimen/avatar_width_height"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_toRightOf="@id/avatar"
+            android:layout_alignParentRight="true"
+            android:background="@drawable/hairline_left"
+            android:orientation="vertical" >
+
+            <TextView android:id="@+id/name"
+                android:paddingLeft="@dimen/message_item_text_padding_left_right"
+                android:paddingRight="@dimen/message_item_text_padding_left_right"
+                android:paddingTop="@dimen/message_item_text_padding_top"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:textAppearance="?android:attr/textAppearanceSmall"
+                android:textColor="@drawable/list_item_font_primary"
+                android:textSize="16sp" />
+
+            <TextView android:id="@+id/number"
+                android:background="@drawable/listitem_background"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:paddingLeft="@dimen/message_item_text_padding_left_right"
+                android:textAppearance="?android:attr/textAppearanceSmall"
+                android:textColor="@drawable/list_item_font_secondary" />
+        </LinearLayout>
+    </RelativeLayout>
+</LinearLayout>
diff --git a/res/layout/recipients_editor.xml b/res/layout/recipients_editor.xml
index 45e0664..ae7bc7a 100644
--- a/res/layout/recipients_editor.xml
+++ b/res/layout/recipients_editor.xml
@@ -34,7 +34,7 @@
     />
 
     <ImageButton android:id="@+id/recipients_picker"
-        android:src="@drawable/ic_launcher_contacts"
+        android:src="@mipmap/ic_launcher_contacts"
         android:layout_marginLeft="5dip"
         android:layout_width="50dip"
         android:layout_height="fill_parent"
diff --git a/res/layout/widget.xml b/res/layout/widget.xml
index d364192..57de4a0 100644
--- a/res/layout/widget.xml
+++ b/res/layout/widget.xml
@@ -64,6 +64,7 @@
             android:layout_height="wrap_content"
             android:src="@drawable/ic_menu_msg_compose_holo_dark"
             android:background="?android:attr/selectableItemBackground"
+            android:contentDescription="@string/new_message"
             android:paddingLeft="4dip"
             android:paddingBottom="4dip" />
     </LinearLayout>
diff --git a/res/menu/recipient_list_menu.xml b/res/menu/recipient_list_menu.xml
new file mode 100644
index 0000000..0f5b035
--- /dev/null
+++ b/res/menu/recipient_list_menu.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2012 Google Inc.
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<menu xmlns:android="http://schemas.android.com/apk/res/android">
+    <item android:id="@+id/action_settings"
+        android:title="@string/menu_preferences"
+        android:icon="@android:drawable/ic_menu_preferences" />
+</menu>
diff --git a/res/mipmap-hdpi/ic_launcher_contacts.png b/res/mipmap-hdpi/ic_launcher_contacts.png
new file mode 100644
index 0000000..8c2f859
Binary files /dev/null and b/res/mipmap-hdpi/ic_launcher_contacts.png differ
diff --git a/res/mipmap-hdpi/ic_launcher_smsmms.png b/res/mipmap-hdpi/ic_launcher_smsmms.png
index 90b826c..2c52f06 100644
Binary files a/res/mipmap-hdpi/ic_launcher_smsmms.png and b/res/mipmap-hdpi/ic_launcher_smsmms.png differ
diff --git a/res/mipmap-mdpi/ic_launcher_contacts.png b/res/mipmap-mdpi/ic_launcher_contacts.png
new file mode 100644
index 0000000..c1139bf
Binary files /dev/null and b/res/mipmap-mdpi/ic_launcher_contacts.png differ
diff --git a/res/mipmap-mdpi/ic_launcher_smsmms.png b/res/mipmap-mdpi/ic_launcher_smsmms.png
index f61ce31..a6d2f55 100644
Binary files a/res/mipmap-mdpi/ic_launcher_smsmms.png and b/res/mipmap-mdpi/ic_launcher_smsmms.png differ
diff --git a/res/mipmap-xhdpi/ic_launcher_contacts.png b/res/mipmap-xhdpi/ic_launcher_contacts.png
new file mode 100644
index 0000000..8ed21bc
Binary files /dev/null and b/res/mipmap-xhdpi/ic_launcher_contacts.png differ
diff --git a/res/mipmap-xhdpi/ic_launcher_smsmms.png b/res/mipmap-xhdpi/ic_launcher_smsmms.png
index c2f5405..3c82a06 100644
Binary files a/res/mipmap-xhdpi/ic_launcher_smsmms.png and b/res/mipmap-xhdpi/ic_launcher_smsmms.png differ
diff --git a/res/mipmap-xxhdpi/ic_launcher_contacts.png b/res/mipmap-xxhdpi/ic_launcher_contacts.png
new file mode 100644
index 0000000..99b403b
Binary files /dev/null and b/res/mipmap-xxhdpi/ic_launcher_contacts.png differ
diff --git a/res/mipmap-xxhdpi/ic_launcher_smsmms.png b/res/mipmap-xxhdpi/ic_launcher_smsmms.png
new file mode 100644
index 0000000..f7145a3
Binary files /dev/null and b/res/mipmap-xxhdpi/ic_launcher_smsmms.png differ
diff --git a/res/values-af/arrays.xml b/res/values-af/arrays.xml
index 34252e7..21d7f4c 100644
--- a/res/values-af/arrays.xml
+++ b/res/values-af/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Grynslag"</item>
     <item msgid="638612939305162424">"Niksseggende blik"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"geen onderwerp nie"</item>
+  </string-array>
 </resources>
diff --git a/res/values-af/strings.xml b/res/values-af/strings.xml
index 9f291b8..0334093 100644
--- a/res/values-af/strings.xml
+++ b/res/values-af/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Onvoldoende DRM-regte bespeur."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopieer teks"</string>
     <string name="message_options" msgid="6838806653341967550">"Boodskapopsies"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Skyfievertoningopsies"</string>
     <string name="done" msgid="7479926268660505871">"Klaar"</string>
     <string name="move_up" msgid="7307578107431739359">"Beweeg op"</string>
     <string name="move_down" msgid="6356509518429479053">"Skuif ondertoe"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Verwyder"</string>
     <string name="send" msgid="4589898724889248486">"Stuur"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Stuur MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Alle drade"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Skryf boodskap"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Open sleutelbord om boodskap in te voer"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Jou boodskap het geen geldige ontvangers nie."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Die DRM-voorwerp wat by hierdie boodskap ingesluit is, kan nie aangestuur word nie."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Omskep tans na multimediaboodskap..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Omskep tans in teksboodskap..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Kan nie meer skyfies byvoeg nie."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Kan nie video en prent by een skyfie voeg nie."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Kan nie boodskap stoor nie."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Versoek \'n afleweringsverslag vir elke boodskap wat jy stuur"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Vee ou boodskappe uit namate limiete bereik word"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> boodskappe per gesprek"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Gebruik MMS om \'n enkele boodskap te stuur wanneer daar meerdere ontvangers is"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Bestuur SIM-kaartboodskappe"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Afleweringsverslae"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Groepboodskappe"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Leesverslae"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Afleweringsverslae"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Vee ou boodskappe uit"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Teksboodskap-limiet"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimediaboodskap-limiet"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Kennisgewings"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Vertoon boodskapkennisgewings in statusbalk"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibreer"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibreer ook ter kennisgewing"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Kies luitoon"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Klank"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Stel aantal boodskappe om te stoor"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Altyd"</item>
-    <item msgid="6069709696037750627">"Net wanneer stil"</item>
-    <item msgid="7486145357487111435">"Nooit"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibreer"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Stil"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Herwin outomaties"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Gaan haal boodskappe outomaties"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Outoherwinning wanneer swerf"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Luitoon gestoor."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Kon nie luitoon stoor nie."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Voeg glimlaggie by"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Groepdeelnemers"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Kies \'n aksie"</string>
     <string name="slide_number" msgid="1923958526266726635">"Skyfie <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Bergingslimiete"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Verander tydsduur"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Redigeer skyfievertoning"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Groepdeelnemers"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Redigeer skyfie"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Skyfievertoning"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Klas 0-boodskap"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Prent"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-am/arrays.xml b/res/values-am/arrays.xml
index a04f1f8..fdd86ce 100644
--- a/res/values-am/arrays.xml
+++ b/res/values-am/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"መገልፈጥ"</item>
     <item msgid="638612939305162424">"ስሜት አልባ ፊት"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"ርዕስ የሌለው"</item>
+  </string-array>
 </resources>
diff --git a/res/values-am/strings.xml b/res/values-am/strings.xml
index 50759dd..dc1e03a 100644
--- a/res/values-am/strings.xml
+++ b/res/values-am/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"በቂ ያልሆነ የDRM መብት ተገኝቷል።"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"ጽሁፍ ቅዳ"</string>
     <string name="message_options" msgid="6838806653341967550">"የመልዕክትአማራጮች"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"የተንሸራታች ትዕይንት አማራጮች"</string>
     <string name="done" msgid="7479926268660505871">"ተከናውኗል"</string>
     <string name="move_up" msgid="7307578107431739359">"ወደ ላይ ተንቀሳቀስ"</string>
     <string name="move_down" msgid="6356509518429479053">"ወደ ታች ውረድ"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"አስወግድ"</string>
     <string name="send" msgid="4589898724889248486">" ላክ"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"ኤም ኤም ኤስ ላክ"</string>
     <string name="all_threads" msgid="2663426830306307194">"ሁሉም ክሮች"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"መልዕክት ተይብ"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"መልዕክት ለመተየብ የሰሌዳ ቁልፍ ክፈት"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"መልዕክቶ ትክክለኛ ተቀባይ የለውም።"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"በመልዕክት ውስጥ የታከለው የDRM ነገር መተላለፍ አይችልም።"</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"ወደ ማህደረ ብዙ መረጃመልዕክት በመገልበጥ ላይ...."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"ወደ ፅሁፍ መልዕክት በመገልበጥ ላይ...."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"ተጨማሪ ስላይዶች ማከል አልተቻለም።"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"ቪዲዮ እና ምስል አንድ ስላይድ ላይ ማከል አይቻልም።"</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"መልዕክት ማስቀመጥ አልተቻለም"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"ለሚልኩት እያንዳንዱ መልዕክት የደርሷል ሪፖርት ጠይቅ"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"መጠን  ላይ እንደደረሰ የድሮ መልዕክቶችን ሰርዝ"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> መልዕክቶች በየንግግሩ"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"ብዙ ተቀባዮች ሲኖሩ አንዲት መልዕክት ለመላክ ኤም ኤም ኤስ ይጠቀሙ"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"የSIM ካርድ መልዕክቶች አደራጅ"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"ደርሷል"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"የቡድን መልዕክት መላላኪያ"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"ሪፖርቶች አንብብ"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"ደርሷል"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"የድሮ መልዕክቶች ሰርዝ"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"የፅሁፍ መልዕክትወሰን"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"ማህደረ ብዙ መረጃ መልዕክት ወሰን"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"ማሳወቂያዎች"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"በሁኔታ አሞሌ ላይ የመልዕክት ማሳወቂያዎችን አሳይ"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"ንዘር"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"ስታሳውቅ ንዘር"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"የደወል ቅላጼ ምረጥ"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"ድምፅ"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"ለማስቀመጥ የመልዕክቶች ቁጥር አዘጋጅ"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"ዘወትር"</item>
-    <item msgid="6069709696037750627">"ፀጥታ ሲሆን ብቻ"</item>
-    <item msgid="7486145357487111435">"በፍፁም"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"ንዘር"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"ፀጥታ"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"በራስ- ሰርስረህ አውጣ"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"በራስ ሰር መልዕክቶች ሰርስረህ አውጣ"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"በእንቅስቃሴ ላይ በራስ- ሰርስረህ አውጣ"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"የደውል ቅላጼ ተቀምጧል"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"የደውል ቅላጼ ማስቀመጥ አልተቻለም"</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"ፈገግታ ጨምር"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"የቡድን ተሳታፊዎች"</string>
     <string name="select_link_title" msgid="3371818607625768447">"እርምጃ ምረጥ"</string>
     <string name="slide_number" msgid="1923958526266726635">"ስላይድ<xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"የማከማቻ ወሰኖች"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"የጊዜ ርዝመት ለውጥ"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"ስላይድ ትዕይንት አርትዕ"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"የቡድን ተሳታፊዎች"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"ስላይድ አርትዕ"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"ስላይድ ትዕይንት"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"የክፍል 0 መልዕክት"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"ስዕል"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"፣ "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ar/arrays.xml b/res/values-ar/arrays.xml
index 5104dfe..3eeabe1 100644
--- a/res/values-ar/arrays.xml
+++ b/res/values-ar/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"مبتسم بتكلف"</item>
     <item msgid="638612939305162424">"وجه جامد"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"بدون موضوع"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ar/strings.xml b/res/values-ar/strings.xml
index 329434e..d642172 100644
--- a/res/values-ar/strings.xml
+++ b/res/values-ar/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"تم اكتشاف حقوق DRM غير كافية."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"نسخ النص"</string>
     <string name="message_options" msgid="6838806653341967550">"خيارات الرسائل"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"خيارات عرض الشرائح"</string>
     <string name="done" msgid="7479926268660505871">"تم"</string>
     <string name="move_up" msgid="7307578107431739359">"نقل لأعلى"</string>
     <string name="move_down" msgid="6356509518429479053">"نقل لأسفل"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"إزالة"</string>
     <string name="send" msgid="4589898724889248486">"إرسال"</string>
     <string name="mms" msgid="1587631213714914559">"رسالة وسائط متعددة"</string>
+    <string name="send_mms" msgid="2933162044872550662">"إرسال رسالة وسائط متعددة"</string>
     <string name="all_threads" msgid="2663426830306307194">"كل السلاسل"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"اكتب رسالة"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"فتح لوحة المفاتيح لكتابة رسالة"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"لا تشتمل رسالتك على مستلمين صالحين."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"لا يمكن إعادة توجيه كائن DRM المضمن في الرسالة."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"جارٍ التحويل إلى رسالة وسائط متعددة…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"جارٍ التحويل إلى رسالة نصية…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"لا يمكن إضافة مزيد من الشرائح."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"لا يمكن إضافة فيديو وصورة إلى شريحة واحدة."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"لا يمكن حفظ الرسالة."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"طلب تقرير تسليم لكل رسالة ترسلها"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"حذف الرسائل القديمة عند بلوغ الحدود"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> من الرسائل في كل محادثة"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"يمكنك استخدام رسائل الوسائط المتعددة لإرسال رسالة واحدة عندما يكون هناك عدة مستلمين"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"إدارة رسائل بطاقة SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"تقارير التسليم"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"المراسلة الجماعية"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"قراءة التقارير"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"تقارير التسليم"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"حذف الرسائل القديمة"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"حد الرسالة النصية"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"حد رسالة الوسائط المتعددة"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"التنبيهات"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"عرض تنبيهات الرسائل في شريط الحالة"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"اهتزاز"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"الاهتزاز عند إعلامي أيضًا"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"اختيار نغمة الرنين"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"الصوت"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"تعيين عدد الرسائل التي سيتم حفظها"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"دومًا"</item>
-    <item msgid="6069709696037750627">"فقط عندما يكون صامتًا"</item>
-    <item msgid="7486145357487111435">"مطلقًا"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"اهتزاز"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"صامت"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"استرداد تلقائي"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"استرداد الرسائل تلقائيًا"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"استرداد تلقائي للتجوال"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"تم حفظ نغمة الرنين."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"تعذر حفظ نغمة الرنين."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"إدخال وجه مبتسم"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"مشتركو المجموعة"</string>
     <string name="select_link_title" msgid="3371818607625768447">"اختيار إجراء"</string>
     <string name="slide_number" msgid="1923958526266726635">"الشريحة رقم <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"حدود التخزين"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"تغيير المدة"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"تعديل عرض الشرائح"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"مشتركو المجموعة"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"تعديل الشريحة"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"عرض الشرائح"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"رسالة من الفئة 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"صورة"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"، "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-be/arrays.xml b/res/values-be/arrays.xml
index 2583ccc..a33d2c7 100644
--- a/res/values-be/arrays.xml
+++ b/res/values-be/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Ухмылка"</item>
     <item msgid="638612939305162424">"Абыякавы твар"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"без тэмы"</item>
+  </string-array>
 </resources>
diff --git a/res/values-be/strings.xml b/res/values-be/strings.xml
index 0d85695..d6cb814 100644
--- a/res/values-be/strings.xml
+++ b/res/values-be/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Недастаткова правоў DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Капіяваць тэкст"</string>
     <string name="message_options" msgid="6838806653341967550">"Параметры паведамлення"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Параметры слайд-шоу"</string>
     <string name="done" msgid="7479926268660505871">"Зроблена"</string>
     <string name="move_up" msgid="7307578107431739359">"Перанесці уверх"</string>
     <string name="move_down" msgid="6356509518429479053">"Перанесці ўніз"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Выдаліць"</string>
     <string name="send" msgid="4589898724889248486">"Адправіць"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Адправіць MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Усе галіны"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Увесці паведамленне"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Адкрыць клавіятуру, каб увесці паведамленне"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"У вашага паведамлення няма сапраўдных атрымальнікаў."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Нельга перанакiраваць аб\'ект DRM з паведамлення."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Пераўтварэнне ў мультымедыйнае паведамленне..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Пераўтварэнне ў тэкставае паведамленне..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Не атрымліваецца дадаць слайды."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Немагчыма дадаць відэа і фатаграфію ў адзін слайд."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Немагчыма захаваць паведамленне."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Запытаць справаздачу аб дастаўцы для кожнага паведамлення, адпраўленага вамі"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Выдаляць старыя паведамленні пасля дасягнення абмежавання"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Паведамленняў у размове: <xliff:g id="COUNT">%1$s</xliff:g>"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Выкарыстоўвайце MMS для адпраўкі аднаго паведамлення пры наяўнасці некалькіх атрымальнікаў"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Кiраванне паведамленнямі на SIM-карце"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Справаздачы аб дастаўцы"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Групавыя паведамленні"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Справаздачы аб прачытанні"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Справаздачы аб дастаўцы"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Выдаліць старыя паведамленні"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Абмежаванне тэкставых паведамленняў"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Абмежаванне мультымедыйных паведамленняў"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Апавяшчэнні"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Паказваць апавяшчэнні аб паведамленнях ў радку стану"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Вібраваць"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Таксама вібраваць, калі атрымана апавяшчэнне"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Выбраць рынгтон"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Гук"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Усталяваць колькасць паведамленняў для захавання"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Заўсёды"</item>
-    <item msgid="6069709696037750627">"Толькі ў рэжыме без гуку"</item>
-    <item msgid="7486145357487111435">"Ніколі"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Вібрацыя"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Ціхі рэжым"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Атрымліваць аўтаматычна"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Аўтаматычна атрымліваць паведамленні"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Аўтаматычна атрымліваць у роўмінгу"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Рынгтон захаваны."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Немагчыма захаваць мелодыю."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Уставіць смайлік"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Удзельнікi групы"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Выберыце дзеянне"</string>
     <string name="slide_number" msgid="1923958526266726635">"Слайд <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Абмежаваннi сховішча"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Змяніць працягласць"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Рэдагаваць слайд-шоу"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Удзельнікi групы"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Рэдагаваць слайд"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Слайд-шоу"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Паведамленне класа 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Выява"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g>—<xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-bg/arrays.xml b/res/values-bg/arrays.xml
index f0c2279..b6e4521 100644
--- a/res/values-bg/arrays.xml
+++ b/res/values-bg/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Самодоволство"</item>
     <item msgid="638612939305162424">"Каменно лице"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"без тема"</item>
+  </string-array>
 </resources>
diff --git a/res/values-bg/strings.xml b/res/values-bg/strings.xml
index ae896bb..e09c2b2 100644
--- a/res/values-bg/strings.xml
+++ b/res/values-bg/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Няма достатъчни права за DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Копиране на текста"</string>
     <string name="message_options" msgid="6838806653341967550">"Опции на съобщението"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Опции за слайдшоуто"</string>
     <string name="done" msgid="7479926268660505871">"Готово"</string>
     <string name="move_up" msgid="7307578107431739359">"Преместване нагоре"</string>
     <string name="move_down" msgid="6356509518429479053">"Преместване надолу"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Премахване"</string>
     <string name="send" msgid="4589898724889248486">"Изпращане"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Изпращане на MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Всички нишки"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Въведете съобщение"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Отворете клавиатурата, за да въведете съобщение"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Съобщението ви няма валидни получатели."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Включеният в съобщението DRM обект не може да се препрати."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Преобразува се в мултимедийно съобщение..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Преобразува се в текстово съобщение..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Не могат да се добавят още слайдове."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Към един слайд не могат да се добавят видеоклип и снимка."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Съобщението не може да бъде запазено."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Заявка за подаване на отчет за всяко изпратено от вас съобщение"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Изтриване достигнато е ограничението за стари съобщения"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> съобщения за разговор"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Използвайте MMS, за да изпратите едно съобщение, когато има няколко получатели"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Управление на съобщенията на SIM картата"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Отчети за доставка"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Групови съобщения"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Отчети за четене"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Отчети за доставка"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Изтриване на стари съобщения"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Ограничение за текстови съобщения"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Ограничение за мултимедийни съобщения"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Известия"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Да се показват известия за съобщения в лентата на състоянието"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Вибриране"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Да вибрира и при известяване"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Избор на мелодия"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Звук"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Задайте броя съобщения за запазване"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Винаги"</item>
-    <item msgid="6069709696037750627">"Само при тих режим"</item>
-    <item msgid="7486145357487111435">"Никога"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Вибриране"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Тих режим"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Автоматично извличане"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Автоматично извличане на съобщения"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Автоматично извличане при роуминг"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Мелодията е запазена."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Мелодията не можа да бъде запазена."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Вмъкване на емотикон"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Участници в групата"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Избор на действие"</string>
     <string name="slide_number" msgid="1923958526266726635">"Слайд <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Ограничения на хранилището"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Промяна на продължителността"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Редактиране на слайдшоу"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Участници в групата"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Редактиране на слайд"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Слайдшоу"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Съобщения от клас 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Снимка"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ca/arrays.xml b/res/values-ca/arrays.xml
index edfe740..54d4e6a 100644
--- a/res/values-ca/arrays.xml
+++ b/res/values-ca/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Somriure irònic"</item>
     <item msgid="638612939305162424">"Cara de sorpresa"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"sense assumpte"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ca/strings.xml b/res/values-ca/strings.xml
index 2531c3f..609cafd 100644
--- a/res/values-ca/strings.xml
+++ b/res/values-ca/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"S\'han detectat drets de DRM insuficients."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copia el text"</string>
     <string name="message_options" msgid="6838806653341967550">"Opcions de missatge"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opcions de presentació de diapositives"</string>
     <string name="done" msgid="7479926268660505871">"Fet"</string>
     <string name="move_up" msgid="7307578107431739359">"Puja"</string>
     <string name="move_down" msgid="6356509518429479053">"Baixa"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Elimina"</string>
     <string name="send" msgid="4589898724889248486">"Envia"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Envia un MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Tots els fils"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Escriu el missatge"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Obre el teclat per escriure el missatge"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"El missatge no té cap destinatari vàlid."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"L\'objecte DRM inclòs al missatge no es pot reenviar."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"S\'està convertint en un missatge multimèdia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"S\'està convertint en un missatge de text..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"No es poden afegir més diapositives."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"No es pot afegir un vídeo i una imatge a una diapositiva."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"No es pot desar el missatge."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Sol·licita un informe de lliurament per a cada missatge que envieu"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Suprimeix els missatges antics a mesura que s\'arribi als límits"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> missatges per conversa"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utilitza MMS per enviar un sol missatge quan hi ha diversos destinataris"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gestiona els missatges de la targeta SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Informes de lliurament"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Missatgeria en grup"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Informes de lectura"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Informes de lliurament"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Suprimeix els missatges antics"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Límit de missatges de text"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Límit de missatges multimèdia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificacions"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Mostra les notificacions de missatges a la barra d\'estat"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibra"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibra també en rebre una notificació"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Tria un to"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"So"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Definiu el nombre de missatges que voleu desar"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Sempre"</item>
-    <item msgid="6069709696037750627">"Només quan està en silenci"</item>
-    <item msgid="7486145357487111435">"Mai"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibra"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silenci"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Recuperació automàtica"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Recupera automàticament els missatges"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Recuperació automàtica en itinerància"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"To desat"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"No s\'ha pogut desar el to."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Insereix una emoticona"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Participants del grup"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Selecciona l\'acció"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositiva <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Límits d\'emmagatzematge"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Canvia la durada"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Edita la presentació de diapositives"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Participants del grup"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Edita la diapositiva"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Presentació de diapositives"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Missatge de classe 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imatge"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-cs/arrays.xml b/res/values-cs/arrays.xml
index 8eeb55e..2abc604 100644
--- a/res/values-cs/arrays.xml
+++ b/res/values-cs/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Úšklebek"</item>
     <item msgid="638612939305162424">"Kamenná tvář"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"bez předmětu"</item>
+  </string-array>
 </resources>
diff --git a/res/values-cs/strings.xml b/res/values-cs/strings.xml
index 1c92271..b3a8ba1 100644
--- a/res/values-cs/strings.xml
+++ b/res/values-cs/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Nemáte dostatečná práva DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopírovat text"</string>
     <string name="message_options" msgid="6838806653341967550">"Možnosti zprávy"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Možnosti prezentace"</string>
     <string name="done" msgid="7479926268660505871">"Hotovo"</string>
     <string name="move_up" msgid="7307578107431739359">"Přesunout nahoru"</string>
     <string name="move_down" msgid="6356509518429479053">"Přesunout dolů"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Odstranit"</string>
     <string name="send" msgid="4589898724889248486">"Odeslat"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Odeslat MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Všechny konverzace"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Napište zprávu"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Otevřete klávesnici a napište zprávu"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Zpráva nemá žádné platné příjemce."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Objekt DRM obsažený ve zprávě nelze přeposlat."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Převádění na multimediální zprávu..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Převádění na textovou zprávu..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Další snímky nelze přidat."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Na jeden snímek nelze přidat video a obrázek."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Zprávu nelze uložit."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"U každé odeslané zprávy požadovat potvrzení o doručení"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Při dosažení limitu smazat staré zprávy"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Počet zpráv v konverzaci: <xliff:g id="COUNT">%1$s</xliff:g>"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Použít MMS k odeslání jedné zprávy, pokud má několik příjemců"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Správa zpráv na SIM kartě"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Potvrzení o doručení"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Skupinové zprávy"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Potvrzení o přečtení"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Potvrzení o doručení"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Smazat staré zprávy"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limit textových zpráv"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limit multimediálních zpráv"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Oznámení"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Zobrazovat oznámení o zprávě na stavovém řádku"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrace"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Při oznámení také vibrovat"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Zvolit vyzvánění"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Zvuk"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Nastavit počet ukládaných zpráv"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Vždy"</item>
-    <item msgid="6069709696037750627">"Pouze v tichém režimu"</item>
-    <item msgid="7486145357487111435">"Nikdy"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrace"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Tichý"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatické načítání"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automaticky načítat zprávy"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Autonačítání za roamingu"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Vyzváněcí tón byl uložen."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Vyzváněcí tón se nepodařilo uložit."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Vložit smajlík"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Účastníci skupiny"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Zvolit akci"</string>
     <string name="slide_number" msgid="1923958526266726635">"Snímek <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Omezení úložiště"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Změnit trvání"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Upravit prezentaci"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Účastníci skupiny"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Upravit snímek"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Prezentace"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Zpráva třídy 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Obrázek"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-da/arrays.xml b/res/values-da/arrays.xml
index 1408e71..266beab 100644
--- a/res/values-da/arrays.xml
+++ b/res/values-da/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Smørret grin"</item>
     <item msgid="638612939305162424">"Pokerfjæs"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"intet emne"</item>
+  </string-array>
 </resources>
diff --git a/res/values-da/strings.xml b/res/values-da/strings.xml
index ab225c9..5539932 100644
--- a/res/values-da/strings.xml
+++ b/res/values-da/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Der er ikke fundet tilstrækkelige DRM-rettigheder."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopier tekst"</string>
     <string name="message_options" msgid="6838806653341967550">"Indstillinger for beskeder"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Valgmuligheder for diasshow"</string>
     <string name="done" msgid="7479926268660505871">"Færdig"</string>
     <string name="move_up" msgid="7307578107431739359">"Flyt op"</string>
     <string name="move_down" msgid="6356509518429479053">"Flyt ned"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Fjern"</string>
     <string name="send" msgid="4589898724889248486">"Send"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Send MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Alle tråde"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Indtast meddelelse"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Åbn tastaturet for at indtaste en meddelelse"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Din besked har ingen gyldige modtagere."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"DRM-objektet i beskeden kan ikke videresendes."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konverterer til mms ..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konverterer til sms-besked ..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Der kan ikke tilføjes flere dias."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Video og billede kan ikke føjes til ét dias."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Beskeden kan ikke gemmes."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Anmod om en leveringsrapport for alle de beskeder, du sender"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Slet gamle beskeder, når grænserne er nået"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> beskeder pr. samtale"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Brug MMS til at sende en enkelt besked, når der er flere modtagere"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Adm. SIM-kortbeskeder"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Leveringsrapporter"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Gruppemeddelelser"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Læsningsrapporter"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Leveringsrapporter"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Slet gamle beskeder"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Sms-begrænsning"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Mms-begrænsning"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Underretninger"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Vis underretninger vedr. beskeder på statusbjælken"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibration"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibration ved meddelelse"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Vælg ringetone"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Lyd"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Angiv det antal beskeder, der skal gemmes"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Altid"</item>
-    <item msgid="6069709696037750627">"Kun ved lydløs"</item>
-    <item msgid="7486145357487111435">"Aldrig"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibration"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Lydløs"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatisk hentning"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Hent automatisk beskeder"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Aut. hent. under roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ringetonen er gemt."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Ringetonen kunne ikke gemmes."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Indsæt smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Deltagere i gruppen"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Vælg handling"</string>
     <string name="slide_number" msgid="1923958526266726635">"Dias <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Lagergrænser"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Skift varighed"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Rediger diasshow"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Deltagere i gruppen"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Rediger dias"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diasshow"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Klasse 0-besked"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Billede"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-de/arrays.xml b/res/values-de/arrays.xml
index c757768..eebafed 100644
--- a/res/values-de/arrays.xml
+++ b/res/values-de/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Grinsen"</item>
     <item msgid="638612939305162424">"Pokergesicht"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"kein Betreff"</item>
+  </string-array>
 </resources>
diff --git a/res/values-de/strings.xml b/res/values-de/strings.xml
index 949247f..4d34b46 100644
--- a/res/values-de/strings.xml
+++ b/res/values-de/strings.xml
@@ -50,12 +50,13 @@
     <string name="delete_thread" msgid="757258847736632791">"Konversation löschen"</string>
     <string name="menu_forward" msgid="9026858380050046756">"Weiterleiten"</string>
     <string name="download" msgid="4488877642230207631">"Herunterladen"</string>
-    <string name="downloading" msgid="1779557575565350637">"Ladevorgang wird ausgeführt"</string>
+    <string name="downloading" msgid="1779557575565350637">"Wird geladen..."</string>
     <string name="inline_subject" msgid="4057621785274119260">"&lt;Betreff: <xliff:g id="SUBJECT">%s</xliff:g>&gt;"</string>
     <string name="drm_protected_text" msgid="1396394157870730742">"* DRM-geschützter Text *"</string>
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Nicht ausreichende DRM-Rechte ermittelt."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Text kopieren"</string>
     <string name="message_options" msgid="6838806653341967550">"Nachrichtenoptionen"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Optionen für die Diashow"</string>
     <string name="done" msgid="7479926268660505871">"Fertig"</string>
     <string name="move_up" msgid="7307578107431739359">"Nach oben verschieben"</string>
     <string name="move_down" msgid="6356509518429479053">"Nach unten verschieben"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Entfernen"</string>
     <string name="send" msgid="4589898724889248486">"Senden"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Senden Sie eine MMS."</string>
     <string name="all_threads" msgid="2663426830306307194">"Alle Threads"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Nachricht schreiben"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Tastatur öffnen, um Nachricht einzugeben"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Für die Nachricht sind keine gültigen Empfänger vorhanden."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Das in der Nachricht enthaltene DRM-Objekt kann nicht weitergeleitet werden."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konvertierung in Multimedia-Nachricht wird ausgeführt..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Umwandlung in SMS wird ausgeführt..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Es können keine weiteren Dias hinzugefügt werden."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"In eine Folie können nicht gleichzeitig ein Bild und ein Video eingefügt werden."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Nachricht kann nicht gespeichert werden."</string>
@@ -152,7 +153,7 @@
     <string name="preferences_title" msgid="6650089610332670157">"Einstellungen"</string>
     <string name="restore_default" msgid="7165341506551155053">"Zurück auf Standardeinstellungen"</string>
     <string name="pref_notification_settings_title" msgid="6420782563630369776">"Benachrichtigungen"</string>
-    <string name="pref_mms_settings_title" msgid="55618772118264355">"Multimedianachrichten (MMS)"</string>
+    <string name="pref_mms_settings_title" msgid="55618772118264355">"MMS"</string>
     <string name="pref_sms_settings_title" msgid="5173078369851066881">"SMS"</string>
     <string name="pref_sms_storage_title" msgid="9001233319190616445">"Speicher"</string>
     <string name="pref_summary_manage_sim_messages" msgid="4141349892597640864">"Auf der SIM-Karte gespeicherte Nachrichten verwalten"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Zustellbestätigung für jede gesendete Nachricht anfordern"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Alte Nachrichten beim Erreichen der Grenzwerte löschen"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> Nachrichten pro Konversation"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Verwenden Sie MMS, um eine einzelne Nachricht an mehrere Empfänger zu versenden."</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Nachrichten auf SIM-Karte"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Zustellberichte"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"SMS/MMS an Gruppe senden"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Leseberichte"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Zustellberichte"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Alte Nachrichten löschen"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Höchstzahl an SMS"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Höchstzahl an MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Benachrichtigungen"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Bei Nachrichteneingang Benachrichtigung in Statuszeile anzeigen"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibration"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Bei Benachrichtigung vibrieren"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Klingelton auswählen"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Töne"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Anzahl der zu speichernden Nachrichten festlegen"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Immer"</item>
-    <item msgid="6069709696037750627">"Nur im Lautlos-Modus"</item>
-    <item msgid="7486145357487111435">"Nie"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibration"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Lautlos"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatisch abrufen"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Nachrichten automatisch empfangen"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Autom. Roaming-Abruf"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Klingelton gespeichert"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Klingelton konnte nicht gespeichert werden."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Smiley hinzufügen"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Gruppenteilnehmer"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Aktion wählen"</string>
     <string name="slide_number" msgid="1923958526266726635">"Dia <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,11 +294,12 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Speichergrenzwerte"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Dauer ändern"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Diashow bearbeiten"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Gruppenteilnehmer"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Dia bearbeiten"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diashow"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Nachricht Klasse 0"</string>
     <string name="search_label" msgid="6042598929386174964">"SMS/MMS"</string>
-    <string name="search_hint" msgid="7273727663577472044">"SMS/MMS durchsuchen"</string>
+    <string name="search_hint" msgid="7273727663577472044">"In SMS/MMS suchen"</string>
     <string name="search" msgid="7560238620274735199">"SMS/MMS"</string>
     <string name="search_setting_description" msgid="4104004595086437572">"Text in meinen Nachrichten"</string>
     <string name="search_empty" msgid="2109551478056039278">"Keine Übereinstimmungen"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Bild"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-el/arrays.xml b/res/values-el/arrays.xml
index 0b159b2..4663cd1 100644
--- a/res/values-el/arrays.xml
+++ b/res/values-el/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Υπεροπτικό χαμόγελο"</item>
     <item msgid="638612939305162424">"Είμαι ανέκφραστος"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"χωρίς θέμα"</item>
+  </string-array>
 </resources>
diff --git a/res/values-el/strings.xml b/res/values-el/strings.xml
index 5690f3d..cb1b469 100644
--- a/res/values-el/strings.xml
+++ b/res/values-el/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Ανιχνεύτηκαν ανεπαρκή δικαιώματα DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Αντιγραφή κειμένου"</string>
     <string name="message_options" msgid="6838806653341967550">"Επιλογές μηνύματος"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Επιλογές προβολής διαφανειών"</string>
     <string name="done" msgid="7479926268660505871">"Τέλος"</string>
     <string name="move_up" msgid="7307578107431739359">"Μετακίνηση προς τα επάνω"</string>
     <string name="move_down" msgid="6356509518429479053">"Μετακίνηση προς τα κάτω"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Κατάργηση"</string>
     <string name="send" msgid="4589898724889248486">"Αποστολή"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Αποστολή MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Όλα τα νήματα"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Πληκτρολογήστε το μήνυμά σας"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Ανοίξτε το πληκτρολόγιο για να πληκτρολογήσετε το μήνυμα"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Το μήνυμά σας δεν έχει έγκυρους παραλήπτες."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Δεν είναι δυνατή η προώθηση του αντικειμένου DRM που περιλαμβάνεται στο μήνυμα."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Μετατροπή σε μήνυμα πολυμέσων..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Μετατροπή σε μήνυμα κειμένου..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Δεν είναι δυνατή η προσθήκη περισσότερων διαφανειών."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Δεν είναι δυνατή η προσθήκη βίντεο και εικόνας σε μια διαφάνεια."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Δεν είναι δυνατή η αποθήκευση του μηνύματος."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Αίτηση αναφοράς παράδοσης για κάθε μήνυμα που στέλνετε"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Διαγραφή παλαιών μηνυμάτων όσο συμπληρώνονται τα όρια"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> μηνύματα ανά συνομιλία"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Χρησιμοποιήστε το MMS για να στείλετε ένα μήνυμα σε πολλούς παραλήπτες"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Διαχείριση μηνυμάτων της κάρτας SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Αναφορές παράδοσης"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Ομαδική ανταλλαγή μηνυμάτων"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Αναφορές ανάγνωσης"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Αναφορές παράδοσης"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Διαγραφή παλαιών μηνυμάτων"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Όριο μηνύματος κειμένου"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Όριο μηνύματος πολυμέσων"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Ειδοποιήσεις"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Προβολή ειδοποιήσεων μηνύματος στη γραμμή κατάστασης"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Δόνηση"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Δόνηση κατά την ειδοποίηση"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Επιλέξτε ήχο κλήσης"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Ήχος"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Ορισμός αριθμού μηνυμάτων για αποθήκευση"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Πάντα"</item>
-    <item msgid="6069709696037750627">"Μόνο στο αθόρυβο"</item>
-    <item msgid="7486145357487111435">"Ποτέ"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Δόνηση"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Σίγαση"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Αυτόματη ανάκτηση"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Αυτόματη ανάκτηση μηνυμάτων"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Αυτόματη ανάκτηση περιαγωγής"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ο ήχος κλήσης αποθηκεύτηκε."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Δεν ήταν δυνατή η αποθήκευση του ήχου κλήσης."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Εισαγ.εικον.smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Συμμετέχοντες ομάδας"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Επιλογή ενέργειας"</string>
     <string name="slide_number" msgid="1923958526266726635">"Διαφάνεια <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Όρια αποθηκευτικού χώρου"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Αλλαγή διάρκειας"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Επεξεργασία προβολής διαφανειών (slideshow)"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Συμμετέχοντες ομάδας"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Επεξεργασία διαφάνειας"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Προβολή διαφανειών (slideshow)"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Μήνυμα κλάσης 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Εικόνα"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-en-rGB/arrays.xml b/res/values-en-rGB/arrays.xml
index d7a40d3..738ce87 100644
--- a/res/values-en-rGB/arrays.xml
+++ b/res/values-en-rGB/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Smirk"</item>
     <item msgid="638612939305162424">"Poker face"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"no subject"</item>
+  </string-array>
 </resources>
diff --git a/res/values-en-rGB/strings.xml b/res/values-en-rGB/strings.xml
index e101dca..b71aa4c 100644
--- a/res/values-en-rGB/strings.xml
+++ b/res/values-en-rGB/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Insufficient DRM rights detected."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copy text"</string>
     <string name="message_options" msgid="6838806653341967550">"Message options"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Slideshow options"</string>
     <string name="done" msgid="7479926268660505871">"Done"</string>
     <string name="move_up" msgid="7307578107431739359">"Move up"</string>
     <string name="move_down" msgid="6356509518429479053">"Move down"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Remove"</string>
     <string name="send" msgid="4589898724889248486">"Send"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Send MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"All threads"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Type message"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Open keyboard to type message"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Your message has no valid recipients."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"The DRM object included in the message can\'t be forwarded."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Converting to multimedia message…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Converting to text message…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Can\'t add more slides."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Can\'t add video and picture to one slide."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Can\'t save message."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Request a delivery report for each message that you send"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Delete old messages as limits are reached"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> messages per conversation"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Use MMS to send a single message when there are multiple recipients"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Manage SIM card messages"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Delivery reports"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Group messaging"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Read reports"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Delivery reports"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Delete old messages"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Text-message limit"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimedia message limit"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notifications"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Display message notifications in status bar"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrate"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Also vibrate when notified"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Choose ringtone"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sound"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Set number of messages to save"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Always"</item>
-    <item msgid="6069709696037750627">"Only when silent"</item>
-    <item msgid="7486145357487111435">"Never"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrate"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silent"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Auto-retrieve"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automatically retrieve messages"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Roaming auto-retrieve"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ringtone saved."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Couldn\'t save ringtone."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Insert smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Group participants"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Choose action"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slide <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Storage limits"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Change duration"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Edit slide show"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Group participants"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Edit slide"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slide show"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Class 0 message"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Picture"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-es-rUS/arrays.xml b/res/values-es-rUS/arrays.xml
index 658a00e..b144069 100644
--- a/res/values-es-rUS/arrays.xml
+++ b/res/values-es-rUS/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Sonrisita"</item>
     <item msgid="638612939305162424">"Cara de póquer"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"sin asunto"</item>
+  </string-array>
 </resources>
diff --git a/res/values-es-rUS/strings.xml b/res/values-es-rUS/strings.xml
index e67aa3e..0f9700b 100644
--- a/res/values-es-rUS/strings.xml
+++ b/res/values-es-rUS/strings.xml
@@ -34,7 +34,7 @@
     <string name="menu_view" msgid="7448852683948080108">"Ver conversación"</string>
     <string name="menu_debug_dump" msgid="6855869130206549643">"Volcado de depuración"</string>
     <string name="refreshing" msgid="987335057871404222">"Actualizando..."</string>
-    <string name="menu_cell_broadcasts" msgid="5646161375983084660">"Difusiones por teléf. celular"</string>
+    <string name="menu_cell_broadcasts" msgid="5646161375983084660">"Emisiones móviles"</string>
     <string name="has_draft" msgid="2487465595514636160">"Borrador"</string>
     <string name="no_subject_view" msgid="7795086723069563537">"(Sin asunto)"</string>
     <string name="messagelist_sender_self" msgid="3579016854116401602">"Yo"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Se detectaron derechos de DRM insuficientes."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copiar el texto"</string>
     <string name="message_options" msgid="6838806653341967550">"Opciones de mensaje"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opciones de la presentación de diapositivas"</string>
     <string name="done" msgid="7479926268660505871">"Finalizado"</string>
     <string name="move_up" msgid="7307578107431739359">"Mover arriba"</string>
     <string name="move_down" msgid="6356509518429479053">"Mover abajo"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Eliminar"</string>
     <string name="send" msgid="4589898724889248486">"Enviar"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Enviar MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Todos los artículos"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Escribir mensaje"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Abrir el teclado para escribir el mensaje"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Tu mensaje no tiene destinatarios válidos."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"El objeto DRM incluido en el mensaje no se puede reenviar."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Convirtiendo a mensaje multimedia…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Convirtiendo a mensaje de texto…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"No se pueden agregar más diapositivas."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"No se puede agregar el video y la imagen a una diapositiva."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"No se puede guardar el mensaje."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Solicita un informe de entrega para cada mensaje que envías"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Eliminar los mensajes antiguos al alcanzar la cantidad máxima"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> mensajes por conversación"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utiliza MMS para enviar un mismo mensaje a varios destinatarios."</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Admin. mensajes de tarj. SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Informes de entrega"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Mensajes de grupo"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Informes leídos"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Informes de entrega"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Eliminar mensajes antiguos"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Límite de mensajes de texto"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Límite de mensaje multimedia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificaciones"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Mostrar notificaciones de mensaje en la barra de estado"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrar cuando se reciba una notificación"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Elegir un tono"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sonido"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Establecer el número de mensajes que se deben guardar"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Siempre"</item>
-    <item msgid="6069709696037750627">"Sólo cuando esté en silencio"</item>
-    <item msgid="7486145357487111435">"Nunca"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrar"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silencioso"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Recuperación automática"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Recuperar mensajes automáticamente"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Recuperación automática en roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Tono guardado"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"No se pudo guardar el tono."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Insertar emoticón"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Participantes del grupo"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Elegir acción"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositiva <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Límites de almacenamiento"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Cambiar duración"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Editar presentación de diapositivas"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Participantes del grupo"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Editar diapositiva"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Presentación de diapositivas"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mensaje clase 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imagen"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-es/arrays.xml b/res/values-es/arrays.xml
index a67e65d..9f13262 100644
--- a/res/values-es/arrays.xml
+++ b/res/values-es/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"No mola"</item>
     <item msgid="638612939305162424">"Cara de póquer"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"sin asunto"</item>
+  </string-array>
 </resources>
diff --git a/res/values-es/strings.xml b/res/values-es/strings.xml
index bec5418..12aa922 100644
--- a/res/values-es/strings.xml
+++ b/res/values-es/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Derechos DRM insuficientes"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copiar texto"</string>
     <string name="message_options" msgid="6838806653341967550">"Opciones del mensaje"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opciones de presentación"</string>
     <string name="done" msgid="7479926268660505871">"Listo"</string>
     <string name="move_up" msgid="7307578107431739359">"Mover arriba"</string>
     <string name="move_down" msgid="6356509518429479053">"Mover abajo"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Eliminar"</string>
     <string name="send" msgid="4589898724889248486">"Enviar"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Enviar MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Todas las conversaciones"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Escribir mensaje"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Abrir teclado para escribir mensaje"</string>
@@ -92,7 +94,7 @@
     <string name="failed_to_add_media" msgid="7207464170168708485">"No puedes añadir <xliff:g id="NAME">%1$s</xliff:g> al mensaje."</string>
     <string name="failed_to_resize_image" msgid="5608354151631833669">"No se ha podido ajustar el tamaño de la imagen."</string>
     <string name="resize_image_error_information" msgid="3783200130776554475">"Esta imagen es demasiado grande para enviarla aunque se ajuste su tamaño."</string>
-    <string name="forward_prefix" msgid="276280492803486464">"Fwd: "</string>
+    <string name="forward_prefix" msgid="276280492803486464">"Rv: "</string>
     <string name="discard_message_reason" msgid="2667664943003796133">"El mensaje se descartará porque los destinatarios no son válidos."</string>
     <string name="has_invalid_recipient" msgid="1485388396900997383">"Destinatarios no válidos: &lt;<xliff:g id="NAME">%1$s</xliff:g>&gt;"</string>
     <string name="invalid_destination" msgid="4573835601024786416">"Dirección de destino no válida"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Los destinatarios del mensaje no son válidos."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"No se puede reenviar el objeto DRM incluido en el mensaje."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Convirtiendo en mensaje multimedia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Convirtiendo en mensaje de texto..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"No puedes añadir más diapositivas."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"No puedes añadir vídeos a una diapositiva que ya tenga imágenes o viceversa."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"No se puede guardar el mensaje."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Solicitar un informe de entrega cada vez que se envíe un mensaje"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Eliminar mensajes antiguos al superar el límite de mensajes"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> mensajes por conversación"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utiliza MMS para enviar un único mensaje a varios destinatarios."</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Administrar mensajes de SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Informes de entrega"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Mensaje de grupo"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Informes de leídos"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Informes de entrega"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Borrar mensajes antiguos"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Límite de mensajes de texto"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Límite de mensajes multimedia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificaciones"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Mostrar notificación de mensajes en la barra de estado"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibración"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrar también al notificar"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Seleccionar tono"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sonido"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Elige el número de mensajes que quieres guardar"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Siempre"</item>
-    <item msgid="6069709696037750627">"Solo en modo silencio"</item>
-    <item msgid="7486145357487111435">"Nunca"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibración"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silencio"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Recuperar automáticamente"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Recuperar mensajes automáticamente"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"En itinerancia"</string>
@@ -209,7 +205,7 @@
     <string name="multimedia_notification" msgid="4124031788554972308">"Notificación de mensaje multimedia"</string>
     <string name="from_label" msgid="2055117571548171397">"De: "</string>
     <string name="to_address_label" msgid="5837363600471845801">"Para: "</string>
-    <string name="bcc_label" msgid="530867161453958774">"CCO: "</string>
+    <string name="bcc_label" msgid="530867161453958774">"Cco: "</string>
     <string name="sent_label" msgid="2722190650145251584">"Enviado: "</string>
     <string name="received_label" msgid="8618029024731693906">"Recibido: "</string>
     <string name="saved_label" msgid="4183160415593488207">"Guardado "</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Tono guardado"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"No se ha podido guardar el tono."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Insertar emoticono"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Participantes del grupo"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Seleccionar acción"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositiva <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Límites de almacenamiento"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Cambiar duración"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Editar diapositiva"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Participantes del grupo"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Editar diapositiva"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Presentación"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mensaje de clase 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imagen"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-et/arrays.xml b/res/values-et/arrays.xml
index cbc48ba..0463547 100644
--- a/res/values-et/arrays.xml
+++ b/res/values-et/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Muie"</item>
     <item msgid="638612939305162424">"Ükskõikne nägu"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"teemat ei ole"</item>
+  </string-array>
 </resources>
diff --git a/res/values-et/strings.xml b/res/values-et/strings.xml
index fe51fd9..5eea627 100644
--- a/res/values-et/strings.xml
+++ b/res/values-et/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Tuvastati ebapiisavad DRM-õigused."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopeeri tekst"</string>
     <string name="message_options" msgid="6838806653341967550">"Sõnumi valikud"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Slaidiseansi valikud"</string>
     <string name="done" msgid="7479926268660505871">"Valmis"</string>
     <string name="move_up" msgid="7307578107431739359">"Liiguta üles"</string>
     <string name="move_down" msgid="6356509518429479053">"Liiguta alla"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Eemalda"</string>
     <string name="send" msgid="4589898724889248486">"Saada"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS-i saatmine"</string>
     <string name="all_threads" msgid="2663426830306307194">"Kõik lõimed"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Tippige sõnum"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Sõnumi tippimiseks avage klaviatuur"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Teie sõnumil pole kehtivaid saajaid."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Sõnumisse lisatud DRM-objekti ei saa edastada."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Multimeediumsõnumiks teisendamine…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Tekstsõnumiks teisendamine…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Rohkem slaide ei saa lisada."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Videot ja pilti ei saa ühele slaidile lisada."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Sõnumit ei saa salvestada."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Küsi kohaletoimetuskinnitust iga saadetud sõnumi kohta"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Kustuta vanad sõnumid limiidini jõudmisel"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> sõnumit vestluse kohta"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"MMS-i kasutamine, kui mitmele kontaktile tuleb saata üks sõnum"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Halda SIM-kaardi sõnumeid"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Kohaletoimetamisaruanded"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Grupi sõnumiside"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Loe aruandeid"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Kohaletoimetamisaruanded"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Kustuta vanad sõnumid"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Tekstsõnumi piirang"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimeediumsõnumi limiit"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Teadistused"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Kuva sõnumiteatisi olekuribal."</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibreering"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibreeri ka teavitamise ajal"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Helina valimine"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Heli"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Määrake sõnumite arv salvestamiseks"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Alati"</item>
-    <item msgid="6069709696037750627">"Ainult hääletus režiimis"</item>
-    <item msgid="7486145357487111435">"Mitte kunagi"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibreering"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Hääletu"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Võta automaatselt vastu"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Võta sõnumid automaatselt vastu"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automaatne vastuvõtmine rändlusel"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Helin on salvestatud."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Helinat ei saanud salvestada."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Sisesta emotikon"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Rühma osalejad"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Toimingu valimine"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slaid <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Mäluruumi limiidid"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Muuda kestust"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Muuda slaidiseanssi"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Rühma osalejad"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Muuda slaidi"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slaidiseanss"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"0-klassi sõnum"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Pilt"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-fa/arrays.xml b/res/values-fa/arrays.xml
index bbebe16..3dd38e0 100644
--- a/res/values-fa/arrays.xml
+++ b/res/values-fa/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"پوزخند"</item>
     <item msgid="638612939305162424">"چهره پوکر"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"بدون عنوان"</item>
+  </string-array>
 </resources>
diff --git a/res/values-fa/strings.xml b/res/values-fa/strings.xml
index e9a7b9c..895d0fd 100644
--- a/res/values-fa/strings.xml
+++ b/res/values-fa/strings.xml
@@ -39,7 +39,7 @@
     <string name="no_subject_view" msgid="7795086723069563537">"(بدون موضوع)"</string>
     <string name="messagelist_sender_self" msgid="3579016854116401602">"من"</string>
     <string name="view_slideshow" msgid="4990460971211388453">"مشاهده نمایش اسلاید"</string>
-    <string name="view_message_details" msgid="7613457646645796831">"مشاهده جزئیات"</string>
+    <string name="view_message_details" msgid="7613457646645796831">"مشاهدهٔ جزئیات"</string>
     <string name="view_delivery_report" msgid="8219095994071575215">"مشاهده گزارش"</string>
     <string name="delete_message" msgid="6442394955910357234">"حذف"</string>
     <string name="expire_on" msgid="4436268382742593921">"تاریخ انقضا: <xliff:g id="DATE">%s</xliff:g>"</string>
@@ -55,7 +55,8 @@
     <string name="drm_protected_text" msgid="1396394157870730742">"* متن محافظت شده با DRM *"</string>
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"حقوق DRM ناکافی شناسایی شد."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"کپی متن"</string>
-    <string name="message_options" msgid="6838806653341967550">"گزینه های پیام"</string>
+    <string name="message_options" msgid="6838806653341967550">"گزینه‌های پیام"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"گزینه‌های نمایش اسلاید"</string>
     <string name="done" msgid="7479926268660505871">"انجام شد"</string>
     <string name="move_up" msgid="7307578107431739359">"انتقال به بالا"</string>
     <string name="move_down" msgid="6356509518429479053">"انتقال به پایین"</string>
@@ -69,8 +70,8 @@
     <string name="remove_picture" msgid="6378701749074289096">"حذف تصویر"</string>
     <string name="add_music" msgid="3827442822987116233">"افزودن موسیقی"</string>
     <string name="remove_music" msgid="858889733416015223">"حذف موسیقی"</string>
-    <string name="add_video" msgid="7816866867806595144">"افزودن ویدیو"</string>
-    <string name="remove_video" msgid="5258603891528497799">"حذف ویدیو"</string>
+    <string name="add_video" msgid="7816866867806595144">"افزودن ویدئو"</string>
+    <string name="remove_video" msgid="5258603891528497799">"حذف ویدئو"</string>
     <string name="to_hint" msgid="224029549150332986">"گیرنده"</string>
     <string name="subject_hint" msgid="4296714962311604126">"موضوع"</string>
     <string name="add_attachment" msgid="7103751293360532684">"پیوست"</string>
@@ -81,42 +82,42 @@
     <string name="remove" msgid="4625444913256213175">"حذف"</string>
     <string name="send" msgid="4589898724889248486">"ارسال"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"ارسال پیامک"</string>
     <string name="all_threads" msgid="2663426830306307194">"همه رشته ها"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"تایپ پیام"</string>
-    <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"برای تایپ پیام صفحه کلید را باز کنید"</string>
+    <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"برای تایپ پیام صفحه‌کلید را باز کنید"</string>
     <string name="compressing" msgid="1961357529661045180">"تصویر خیلی بزرگ است. در حال فشرده سازی..."</string>
     <string name="unsupported_media_format" msgid="1350489690977363764">"قالب <xliff:g id="NAME">%1$s</xliff:g> پشتیبانی نشده."</string>
     <string name="select_different_media" msgid="6241623357299382183">"یک <xliff:g id="NAME">%1$s</xliff:g> متفاوت را انتخاب کنید."</string>
     <string name="exceed_message_size_limitation" msgid="6027753647094742437">"از حداکثر اندازه پیام بیشتر شد."</string>
-    <string name="message_too_big_for_video" msgid="2639367545165352543">"پیام خیلی بزرگ است و به ویدیو پیوست نمی شود."</string>
+    <string name="message_too_big_for_video" msgid="2639367545165352543">"پیام خیلی بزرگ است و به ویدئو پیوست نمی‌شود."</string>
     <string name="failed_to_add_media" msgid="7207464170168708485">"نمی‌توانید این <xliff:g id="NAME">%1$s</xliff:g> را به پیام خود اضافه کنید."</string>
     <string name="failed_to_resize_image" msgid="5608354151631833669">"اندازه عکس تغییر نکرد."</string>
     <string name="resize_image_error_information" msgid="3783200130776554475">"این عکس حتی پس از تغییر اندازه خیلی بزرگ است و ارسال نمی‌شود."</string>
     <string name="forward_prefix" msgid="276280492803486464">"هدایت: "</string>
-    <string name="discard_message_reason" msgid="2667664943003796133">"از پیام شما به علت نداشتن گیرندگان معتبر صرفنظر می شود."</string>
+    <string name="discard_message_reason" msgid="2667664943003796133">"از پیام شما به علت نداشتن گیرندگان معتبر صرفنظر می‌شود."</string>
     <string name="has_invalid_recipient" msgid="1485388396900997383">"گیرنده (گیرندگان) نامعتبر : &lt;<xliff:g id="NAME">%1$s</xliff:g>&gt;"</string>
     <string name="invalid_destination" msgid="4573835601024786416">"آدرس مقصد نامعتبر است."</string>
     <string name="service_not_activated" msgid="9178218144019626176">"سرویس در شبکه فعال نشده است."</string>
     <string name="service_message_not_found" msgid="1908877102600048515">"پیام منقضی شده یا در دسترس نیست."</string>
     <string name="service_network_problem" msgid="4583269174855943025">"به علت مشکل شبکه ارسال نشد."</string>
-    <string name="invalid_recipient_message" msgid="6465343105010999068">"گیرنده (گیرندگان) را تصحیح کنید در غیر این صورت آنها پیام را دریافت نمی‌کنند."</string>
+    <string name="invalid_recipient_message" msgid="6465343105010999068">"گیرنده (گیرندگان) را تصحیح کنید در غیر این صورت آن‌ها پیام را دریافت نمی‌کنند."</string>
     <string name="cannot_send_message" msgid="3414307479833622644">"ارسال پیام امکان‌پذیر نیست"</string>
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"پیام شما هیچ گیرنده معتبری ندارد."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"شیء DRM موجود در پیام باز ارسال نمی‌شود."</string>
-    <string name="converting_to_picture_message" msgid="2980023239017588627">"در حال تبدیل به پیام چند رسانه ای..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"در حال تبدیل به پیام متنی..."</string>
+    <string name="converting_to_picture_message" msgid="2980023239017588627">"در حال تبدیل به پیام چند رسانه‌ای..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"افزودن اسلایدهای بیشتر امکان‌پذیر نیست."</string>
-    <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"افزودن ویدیو و عکس به یک اسلاید امکان‌پذیر نیست."</string>
+    <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"افزودن ویدئو و عکس به یک اسلاید امکان‌پذیر نیست."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"ذخیره پیام امکان‌پذیر نیست."</string>
-    <string name="message_saved_as_draft" msgid="2503018972659880692">"پیام به عنوان پیش نویس ذخیره شد."</string>
+    <string name="message_saved_as_draft" msgid="2503018972659880692">"پیام به‌عنوان پیش نویس ذخیره شد."</string>
     <string name="too_many_recipients" msgid="7003415094007176931">"این پیام دارای گیرندگان بسیار زیادی است (<xliff:g id="CURRENTCOUNT">%1$s</xliff:g>). محدودیت <xliff:g id="MAXLIMIT">%2$s</xliff:g> گیرنده وجود دارد."</string>
-    <string name="too_many_attachments" msgid="3774037894899750070">"محدودیت <xliff:g id="MAXLIMIT">%1$s</xliff:g> پیوست وجود دارد. فقط اولین <xliff:g id="CURRENTCOUNT">%2$s</xliff:g> اضافه می شود."</string>
-    <string name="adding_attachments_title" msgid="2034535554212405529">"افزودن پیوست ها"</string>
+    <string name="too_many_attachments" msgid="3774037894899750070">"محدودیت <xliff:g id="MAXLIMIT">%1$s</xliff:g> پیوست وجود دارد. فقط اولین <xliff:g id="CURRENTCOUNT">%2$s</xliff:g> اضافه می‌شود."</string>
+    <string name="adding_attachments_title" msgid="2034535554212405529">"افزودن پیوست‌ها"</string>
     <string name="adding_attachments" msgid="5871373105122355632">"لطفاً صبر کنید تا موارد به نمایش اسلاید اضافه شوند."</string>
     <string name="building_slideshow_title" msgid="1232338692400726385">"ایجاد نمایش اسلاید"</string>
     <string name="cannot_play_audio" msgid="253920977253666735">"پخش صدا امکان‌پذیر نیست."</string>
-    <string name="preview" msgid="5438149136136446756">"پیش نمایش"</string>
-    <string name="preview_slideshow" msgid="6824095909448728427">"پیش نمایش"</string>
+    <string name="preview" msgid="5438149136136446756">"پیش‌نمایش"</string>
+    <string name="preview_slideshow" msgid="6824095909448728427">"پیش‌نمایش"</string>
     <string name="replace_image" msgid="3171240952601443619">"جایگزینی تصویر"</string>
     <string name="duration_sec" msgid="6617032324007824096">"طول مدت (<xliff:g id="DURATION">%s</xliff:g> ثانیه)"</string>
     <string name="duration_selector_title" msgid="5981097971537625852">"طول مدت اسلاید "</string>
@@ -128,16 +129,16 @@
     <string name="duration_zero" msgid="3549377790195185977">"طول مدت باید بیشتر از صفر ثانیه باشد."</string>
     <string name="secs" msgid="6886003523109967972">"ثانیه"</string>
   <string-array name="select_dialog_items">
-    <item msgid="4840183714016984112">"1 ثانیه"</item>
-    <item msgid="3734955613666864447">"2 ثانیه"</item>
-    <item msgid="6032232473048379828">"3 ثانیه"</item>
-    <item msgid="5978471781525927827">"4 ثانیه"</item>
-    <item msgid="4888440297621208402">"5 ثانیه"</item>
-    <item msgid="6047246213264166841">"6 ثانیه"</item>
-    <item msgid="2327501250056533797">"7 ثانیه"</item>
-    <item msgid="3400770414689795703">"8 ثانیه"</item>
-    <item msgid="4358760614161107970">"9 ثانیه"</item>
-    <item msgid="2618179407176906471">"10 ثانیه"</item>
+    <item msgid="4840183714016984112">"۱ ثانیه"</item>
+    <item msgid="3734955613666864447">"۲ ثانیه"</item>
+    <item msgid="6032232473048379828">"۳ ثانیه"</item>
+    <item msgid="5978471781525927827">"۴ ثانیه"</item>
+    <item msgid="4888440297621208402">"۵ ثانیه"</item>
+    <item msgid="6047246213264166841">"۶ ثانیه"</item>
+    <item msgid="2327501250056533797">"۷ ثانیه"</item>
+    <item msgid="3400770414689795703">"۸ ثانیه"</item>
+    <item msgid="4358760614161107970">"۹ ثانیه"</item>
+    <item msgid="2618179407176906471">"۱۰ ثانیه"</item>
     <item msgid="7786079681602275449">"موارد دیگر"</item>
   </string-array>
     <string name="menu_view_contact" msgid="1414670584423909451">"مشاهده مخاطب"</string>
@@ -150,38 +151,33 @@
     <string name="edit" msgid="5912118407791492696">"ویرایش"</string>
     <string name="try_to_send" msgid="1996751738286080976">"دوباره ارسال کنید"</string>
     <string name="preferences_title" msgid="6650089610332670157">"تنظیمات"</string>
-    <string name="restore_default" msgid="7165341506551155053">"بازیابی تنظیمات پیش فرض"</string>
+    <string name="restore_default" msgid="7165341506551155053">"بازیابی تنظیمات پیش‌فرض"</string>
     <string name="pref_notification_settings_title" msgid="6420782563630369776">"اعلان‌ها"</string>
-    <string name="pref_mms_settings_title" msgid="55618772118264355">"پیامهای چند رسانه‌ای (MMS)"</string>
-    <string name="pref_sms_settings_title" msgid="5173078369851066881">"پیامهای نوشتاری (پیامک)"</string>
+    <string name="pref_mms_settings_title" msgid="55618772118264355">"پیام‌های چند رسانه‌ای (MMS)"</string>
+    <string name="pref_sms_settings_title" msgid="5173078369851066881">"پیام‌های نوشتاری (پیامک)"</string>
     <string name="pref_sms_storage_title" msgid="9001233319190616445">"محل ذخیره"</string>
-    <string name="pref_summary_manage_sim_messages" msgid="4141349892597640864">"مدیریت پیام های ذخیره شده در سیم کارت شما"</string>
-    <string name="pref_summary_mms_delivery_reports" msgid="4874657984217756112">"درخواست یک گزارش تحویل برای هر پیامی که ارسال می کنید"</string>
-    <string name="pref_summary_mms_read_reports" msgid="2748323864008907440">"درخواست یک گزارش خواندن برای هر پیامی که ارسال می کنید"</string>
-    <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"درخواست یک گزارش تحویل برای هر پیامی که ارسال می کنید"</string>
-    <string name="pref_summary_auto_delete" msgid="7719538116486177613">"حذف پیام های قدیمی به دلیل بیشتر شدن از حداکثر مجاز"</string>
+    <string name="pref_summary_manage_sim_messages" msgid="4141349892597640864">"مدیریت پیام‌های ذخیره شده در سیم کارت شما"</string>
+    <string name="pref_summary_mms_delivery_reports" msgid="4874657984217756112">"درخواست یک گزارش تحویل برای هر پیامی که ارسال می‌کنید"</string>
+    <string name="pref_summary_mms_read_reports" msgid="2748323864008907440">"درخواست یک گزارش خواندن برای هر پیامی که ارسال می‌کنید"</string>
+    <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"درخواست یک گزارش تحویل برای هر پیامی که ارسال می‌کنید"</string>
+    <string name="pref_summary_auto_delete" msgid="7719538116486177613">"حذف پیام‌های قدیمی به دلیل بیشتر شدن از حداکثر مجاز"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> پیام در هر گفتگو"</string>
-    <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"مدیریت پیام های سیم کارت"</string>
-    <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"گزارش های تحویل"</string>
-    <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"گزارش های خواندن"</string>
-    <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"گزارش های تحویل"</string>
-    <string name="pref_title_auto_delete" msgid="7227835692631701134">"حذف پیام های قدیمی"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"در صورت وجود چند گیرنده، برای ارسال یک پیام، از MMS استفاده کنید"</string>
+    <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"مدیریت پیام‌های سیم کارت"</string>
+    <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"گزارش‌های تحویل"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"پیام‌رسانی گروهی"</string>
+    <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"گزارش‌های خواندن"</string>
+    <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"گزارش‌های تحویل"</string>
+    <string name="pref_title_auto_delete" msgid="7227835692631701134">"حذف پیام‌های قدیمی"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"محدودیت پیام متنی"</string>
-    <string name="pref_title_mms_delete" msgid="7265878070847351664">"محدودیت پیام چند رسانه ای"</string>
-    <string name="pref_title_notification_enabled" msgid="9118792213953729414">"اعلان ها"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"نمایش اعلان های پیام در نوار وضعیت"</string>
+    <string name="pref_title_mms_delete" msgid="7265878070847351664">"محدودیت پیام چند رسانه‌ای"</string>
+    <string name="pref_title_notification_enabled" msgid="9118792213953729414">"اعلان‌ها"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"لرزش"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"همچنین لرزش هنگام اعلان"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"انتخاب آهنگ زنگ"</string>
-    <string name="pref_messages_to_save" msgid="3202539743892934926">"تنظیم تعداد پیام ها برای ذخیره"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"همیشه"</item>
-    <item msgid="6069709696037750627">"فقط هنگام ساکت بودن"</item>
-    <item msgid="7486145357487111435">"هرگز"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"لرزش"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"صدا"</string>
+    <string name="pref_messages_to_save" msgid="3202539743892934926">"تنظیم تعداد پیام‌ها برای ذخیره"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"بیصدا"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"بازیابی خودکار"</string>
-    <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"بازیابی خودکار پیام ها"</string>
+    <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"بازیابی خودکار پیام‌ها"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"بازیابی خودکار در طول رومینگ"</string>
     <string name="pref_summary_mms_retrieval_during_roaming" msgid="2427892806582531020">"بازیابی خودکار پیام در حین رومینگ"</string>
     <string name="confirm_dialog_title" msgid="2187213750475782725">"حذف شود؟"</string>
@@ -190,13 +186,13 @@
     <item quantity="one" msgid="7509396981963472833">"یک مکالمه حذف خواهد شد."</item>
     <item quantity="other" msgid="4076915774012081811">"<xliff:g id="NUMBER">%1$s</xliff:g> مکالمه حذف خواهد شد."</item>
   </plurals>
-    <string name="confirm_delete_conversation" msgid="6115966687389279855">"کل رشته حذف می شود."</string>
-    <string name="confirm_delete_all_conversations" msgid="9036166685235092757">"همه رشته ها حذف می شوند."</string>
-    <string name="confirm_delete_message" msgid="9121480656609809591">"پیام حذف می شود."</string>
+    <string name="confirm_delete_conversation" msgid="6115966687389279855">"کل رشته حذف می‌شود."</string>
+    <string name="confirm_delete_all_conversations" msgid="9036166685235092757">"همه رشته ها حذف می‌شوند."</string>
+    <string name="confirm_delete_message" msgid="9121480656609809591">"پیام حذف می‌شود."</string>
     <string name="confirm_delete_locked_message" msgid="7203411948190100955">"این پیام قفل شده حذف شود؟"</string>
-    <string name="confirm_delete_all_SIM_messages" msgid="8693652297557966665">"تمامی پیامها در سیم کارت حذف خواهد شد."</string>
+    <string name="confirm_delete_all_SIM_messages" msgid="8693652297557966665">"تمامی پیام‌ها در سیم کارت حذف خواهد شد."</string>
     <string name="confirm_delete_SIM_message" msgid="8535128079045452425">"این پیام بر روی سیم کارت حذف خواهد شد."</string>
-    <string name="delete_unlocked" msgid="7545321606698162261">"حذف پیام های قفل شده"</string>
+    <string name="delete_unlocked" msgid="7545321606698162261">"حذف پیام‌های قفل شده"</string>
     <string name="delete" msgid="1409973060081564612">"حذف"</string>
     <string name="select_conversations" msgid="7816517565640002844">"انتخاب مکالمات"</string>
     <string name="no_conversations" msgid="6773767655149258445">"مکالمه‌ای موجود نیست."</string>
@@ -205,11 +201,11 @@
     <string name="message_details_title" msgid="9223295113731634528">"جزئیات پیام"</string>
     <string name="message_type_label" msgid="7975373966795945566">"نوع: "</string>
     <string name="text_message" msgid="8196464345251877972">"پیام متنی"</string>
-    <string name="multimedia_message" msgid="1512644521083533071">"پیام چند رسانه ای"</string>
-    <string name="multimedia_notification" msgid="4124031788554972308">"اعلان های پیام چند رسانه ای"</string>
+    <string name="multimedia_message" msgid="1512644521083533071">"پیام چند رسانه‌ای"</string>
+    <string name="multimedia_notification" msgid="4124031788554972308">"اعلان‌های پیام چند رسانه‌ای"</string>
     <string name="from_label" msgid="2055117571548171397">"فرستنده: "</string>
     <string name="to_address_label" msgid="5837363600471845801">"گیرنده: "</string>
-    <string name="bcc_label" msgid="530867161453958774">"گیرنده کپی مخفی: "</string>
+    <string name="bcc_label" msgid="530867161453958774">"گیرندهٔ کپی مخفی: "</string>
     <string name="sent_label" msgid="2722190650145251584">"ارسال شد: "</string>
     <string name="received_label" msgid="8618029024731693906">"دریافت شد: "</string>
     <string name="saved_label" msgid="4183160415593488207">"ذخیره شد: "</string>
@@ -222,13 +218,13 @@
     <string name="message_class_label" msgid="5115748690481550562">"طبقه بندی پیام: "</string>
     <string name="error_code_label" msgid="5810068247647058769">"کد خطا: "</string>
     <string name="menu_edit" msgid="3056513240155967777">"ویرایش"</string>
-    <string name="menu_delete_messages" msgid="2610286783513247420">"حذف پیام ها"</string>
+    <string name="menu_delete_messages" msgid="2610286783513247420">"حذف پیام‌ها"</string>
     <string name="menu_lock" msgid="7603793126077557472">"قفل"</string>
     <string name="menu_unlock" msgid="6662865558677424039">"بازگشایی قفل"</string>
-    <string name="sim_copy_to_phone_memory" product="tablet" msgid="3721000641648594602">"کپی در حافظه رایانه لوحی"</string>
+    <string name="sim_copy_to_phone_memory" product="tablet" msgid="3721000641648594602">"کپی در حافظه رایانهٔ لوحی"</string>
     <string name="sim_copy_to_phone_memory" product="default" msgid="5895767417844881971">"کپی در حافظه تلفن"</string>
     <string name="sim_delete" msgid="610790510655316922">"حذف"</string>
-    <string name="sim_manage_messages_title" msgid="3989147182100584333">"پیام های متنی در سیم کارت"</string>
+    <string name="sim_manage_messages_title" msgid="3989147182100584333">"پیام‌های متنی در سیم کارت"</string>
     <string name="sim_view" msgid="1997173541766393706">"مشاهده"</string>
     <string name="sim_empty" msgid="2356766833071636297">"پیامی در سیم کارت موجود نیست."</string>
     <string name="delivery_header_title" msgid="5361719578869045764">"گزارش"</string>
@@ -244,7 +240,7 @@
     <string name="delivered_label" msgid="3514011729156932928">"تاریخ تحویل: "</string>
     <string name="attach_image" msgid="6439985727687107742">"تصاویر"</string>
     <string name="attach_take_photo" msgid="4280601313184373837">"عکسبرداری"</string>
-    <string name="attach_video" msgid="4264272693501538294">"ویدیوها"</string>
+    <string name="attach_video" msgid="4264272693501538294">"ویدئوها"</string>
     <string name="attach_record_video" msgid="3099814114743078615">"فیلم برداری"</string>
     <string name="attach_sound" msgid="3149325985970669609">"صوتی"</string>
     <string name="attach_record_sound" msgid="6011431304469858929">"ضبط صدا"</string>
@@ -255,27 +251,27 @@
     <!-- no translation found for delivery_toast_body (5960519861835727013) -->
     <skip />
     <string name="notification_multiple" msgid="7684007285202109490">"<xliff:g id="COUNT">%s</xliff:g> پیام خوانده نشده."</string>
-    <string name="notification_multiple_title" msgid="332602028959557541">"پیام های جدید"</string>
+    <string name="notification_multiple_title" msgid="332602028959557541">"پیام‌های جدید"</string>
     <string name="notification_failed_multiple" msgid="6192531993698497229">"<xliff:g id="COUNT">%s</xliff:g> پیام ارسال نشد"</string>
-    <string name="notification_failed_multiple_title" msgid="1112032024904397126">"پیام ها ارسال نشدند"</string>
+    <string name="notification_failed_multiple_title" msgid="1112032024904397126">"پیام‌ها ارسال نشدند"</string>
     <string name="sim_full_title" msgid="1809829051697702810">"سیم کارت پر است"</string>
-    <string name="sim_full_body" msgid="6241664980790322925">"برای آزاد کردن حافظه، برخی از پیام ها را حذف کنید."</string>
+    <string name="sim_full_body" msgid="6241664980790322925">"برای آزاد کردن حافظه، برخی از پیام‌ها را حذف کنید."</string>
     <string name="sms_full_title" msgid="6041287140125011854">"حافظه پیام متنی پر است"</string>
-    <string name="sms_full_body" msgid="4885861852397651868">"یک پیام ورودی به دلیل پر بودن حافظه رد شد. لطفاً برخی از پیامهای قدیمی را حذف کنید."</string>
+    <string name="sms_full_body" msgid="4885861852397651868">"یک پیام ورودی به دلیل پر بودن حافظه رد شد. لطفاً برخی از پیام‌های قدیمی را حذف کنید."</string>
     <string name="sms_rejected_title" msgid="8548394922491529811">"پیام متنی رد شد"</string>
     <string name="sms_rejected_body" msgid="7813671133968158562">"یک پیام ورودی به دلیل نامشخص رد شد."</string>
     <string name="type_audio" msgid="3842064092332309756">"صوتی"</string>
     <string name="type_picture" msgid="4091928975383609443">"تصویر"</string>
-    <string name="type_video" msgid="8521556159545168441">"ویدیو"</string>
+    <string name="type_video" msgid="8521556159545168441">"ویدئو"</string>
     <string name="confirm" msgid="3155110885840591914">"تأیید"</string>
-    <string name="message_send_read_report" msgid="6997117678914261250">"یک گزارش خواندن ارسال می شود."</string>
-    <string name="message_queued" msgid="7975945623873194737">"در حال حاضر ارسال پیام شما امکان‌پذیر نمی‌باشد. به محض دسترسی به سرویس، پیام شما ارسال می‌شود."</string>
-    <string name="fdn_check_failure" msgid="7880740763778173551">"فقط می توانید به شماره های شماره گیری ثابت خود پیام ارسال کنید."</string>
+    <string name="message_send_read_report" msgid="6997117678914261250">"یک گزارش خواندن ارسال می‌شود."</string>
+    <string name="message_queued" msgid="7975945623873194737">"در حال حاضر ارسال پیام شما امکان‌پذیر نیست. به محض دسترسی به سرویس، پیام شما ارسال می‌شود."</string>
+    <string name="fdn_check_failure" msgid="7880740763778173551">"فقط می‌توانید به شماره‌های شماره گیری ثابت خود پیام ارسال کنید."</string>
     <string name="no_subject" msgid="4168963736134552285">"(بدون موضوع)"</string>
     <string name="unknown_sender" msgid="4929330613278853635">"فرستنده ناشناس"</string>
     <string name="dl_failure_notification" msgid="8097699679464396537">"پیام <xliff:g id="SUBJECT">%1$s</xliff:g> از <xliff:g id="FROM">%2$s</xliff:g> دانلود نشد."</string>
     <string name="rate_limit_surpassed" msgid="1347801608211628177">"تأیید"</string>
-    <string name="confirm_rate_limit" msgid="234228299751243067">"تعداد زیادی از پیام های چند رسانه ای در حال ارسال هستند. این را تأیید می کنید؟"</string>
+    <string name="confirm_rate_limit" msgid="234228299751243067">"تعداد زیادی از پیام‌های چند رسانه‌ای در حال ارسال هستند. این را تأیید می‌کنید؟"</string>
     <string name="message_download_failed_title" msgid="5722226064394767921">"پیام دانلود نشد"</string>
     <string name="message_send_failed_title" msgid="3469894907399046372">"پیام ارسال نشد"</string>
     <string name="message_failed_body" msgid="3421296112073915245">"برای مرور پیام لمس کنید و دوباره سعی کنید."</string>
@@ -284,10 +280,11 @@
     <string name="copy_to_sdcard" msgid="757028609638184856">"ذخیره پیوست"</string>
     <string name="copy_to_sdcard_success" msgid="7948625615155992014">"پیوست ذخیره شد."</string>
     <string name="copy_to_sdcard_fail" msgid="4944606369631916737">"پیوست ذخیره نشد."</string>
-    <string name="save_ringtone" msgid="2310157075045201051">"ذخیره بعنوان آهنگ زنگ"</string>
+    <string name="save_ringtone" msgid="2310157075045201051">"ذخیره به‌عنوان آهنگ زنگ"</string>
     <string name="saved_ringtone" msgid="3847363932276708626">"آهنگ زنگ ذخیره شد."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"آهنگ زنگ ذخیره نشد."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"درج لبخندک"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"شرکت‌کنندگان گروهی"</string>
     <string name="select_link_title" msgid="3371818607625768447">"انتخاب عملکرد"</string>
     <string name="slide_number" msgid="1923958526266726635">"اسلاید <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -296,16 +293,17 @@
     <item quantity="other" msgid="3736425355579939863">"<xliff:g id="NUMBER">%s</xliff:g> ثانیه"</item>
   </plurals>
     <string name="delivery_report_activity" msgid="2957463094232916364">"گزارش تحویل"</string>
-    <string name="storage_limits_activity" msgid="8810530813311077716">"محدودیت های ذخیره"</string>
+    <string name="storage_limits_activity" msgid="8810530813311077716">"محدودیت‌های ذخیره"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"تغییر مدت زمان"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"ویرایش نمایش اسلاید"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"شرکت‌کنندگان گروهی"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"ویرایش اسلاید"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"نمایش اسلاید"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"طبقه‌بندی 0 پیام"</string>
     <string name="search_label" msgid="6042598929386174964">"پیام رسانی"</string>
     <string name="search_hint" msgid="7273727663577472044">"جستجوی پیام‌رسانی"</string>
     <string name="search" msgid="7560238620274735199">"پیام رسانی"</string>
-    <string name="search_setting_description" msgid="4104004595086437572">"ارسال متن در پیام های شما"</string>
+    <string name="search_setting_description" msgid="4104004595086437572">"ارسال متن در پیام‌های شما"</string>
     <string name="search_empty" msgid="2109551478056039278">"مورد منطبقی وجود ندارد."</string>
   <plurals name="search_results_title">
     <item quantity="one" msgid="4657073733087431350">"<xliff:g id="NUMBER">%1$s</xliff:g> نتیجه برای \"<xliff:g id="SEARCH">%2$s</xliff:g>\""</item>
@@ -313,15 +311,15 @@
   </plurals>
     <string name="search_history" msgid="4127805495662693154">"<xliff:g id="COUNT">%1$s</xliff:g> نتیجه برای \"<xliff:g id="SEARCH">%2$s</xliff:g>\""</string>
     <string name="confirm_clear_search_title" msgid="8510295993632032904">"پاک کردن"</string>
-    <string name="confirm_clear_search_text" msgid="8731877031837077478">"سابقه جستجو پاک می شود."</string>
+    <string name="confirm_clear_search_text" msgid="8731877031837077478">"سابقه جستجو پاک می‌شود."</string>
     <string name="pref_mms_clear_search_history_title" msgid="6159758850628148164">"پاک کردن سابقه جستجو"</string>
-    <string name="pref_mms_clear_search_history_summary" msgid="7960005384066460035">"پاک کردن جستجوهای پیام رسانی قبلی و جلوگیری از نمایش آنها در کادر جستجو"</string>
+    <string name="pref_mms_clear_search_history_summary" msgid="7960005384066460035">"پاک کردن جستجوهای پیام رسانی قبلی و جلوگیری از نمایش آن‌ها در کادر جستجو"</string>
     <string name="save" msgid="6847069284991531310">"ذخیره"</string>
-    <string name="storage_limits_title" msgid="7074684882530693016">"محدودیت پیام ها"</string>
-    <string name="storage_limits_message" msgid="2010501485394745696">"تعداد پیامهایی را که در هر مکالمه ذخیره می‌کنید، محدود شود؟"</string>
+    <string name="storage_limits_title" msgid="7074684882530693016">"محدودیت پیام‌ها"</string>
+    <string name="storage_limits_message" msgid="2010501485394745696">"تعداد پیام‌هایی را که در هر مکالمه ذخیره می‌کنید، محدود شود؟"</string>
     <string name="storage_limits_setting" msgid="4952781049308537373">"تنظیم محدودیت ها"</string>
     <string name="storage_limits_setting_dismiss" msgid="1433841310158458034">"بدون محدودیت"</string>
-    <string name="too_many_unsent_mms" msgid="4436493698891224126">"اکنون ارسال پیام امکان‌پذیر نیست. تعداد زیادی پیامهای چند رسانه‌ای ارسال نشده وجود دارد."</string>
+    <string name="too_many_unsent_mms" msgid="4436493698891224126">"اکنون ارسال پیام امکان‌پذیر نیست. تعداد زیادی پیام‌های چند رسانه‌ای ارسال نشده وجود دارد."</string>
     <string name="sending_message" msgid="2054406576361149715">"در حال ارسال..."</string>
     <string name="pick_too_many_recipients" msgid="650087588867628044">"تعداد زیادی گیرنده وجود دارد"</string>
     <string name="adding_recipients" msgid="2962810172527532357">"افزودن گیرندگان..."</string>
@@ -341,8 +339,9 @@
     <string name="view_more_conversations" msgid="7275920132410734671">"مشاهده مکالمات بیشتر"</string>
     <string name="attachment_audio" msgid="2867960243300539143">"صوتی"</string>
     <string name="attachment_slideshow" msgid="5867689101881763318">"نمایش اسلاید"</string>
-    <string name="attachment_video" msgid="4252062022156694591">"ویدیو"</string>
+    <string name="attachment_video" msgid="4252062022156694591">"ویدئو"</string>
     <string name="attachment_picture" msgid="3709286281567284296">"تصویر"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"، "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-fi/arrays.xml b/res/values-fi/arrays.xml
index 96e1556..a719578 100644
--- a/res/values-fi/arrays.xml
+++ b/res/values-fi/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Virnistys"</item>
     <item msgid="638612939305162424">"Ilmeetön"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"ei aihetta"</item>
+  </string-array>
 </resources>
diff --git a/res/values-fi/strings.xml b/res/values-fi/strings.xml
index d5243ed..594cc52 100644
--- a/res/values-fi/strings.xml
+++ b/res/values-fi/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Riittämättömät DRM-oikeudet."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopioi teksti"</string>
     <string name="message_options" msgid="6838806653341967550">"Viestiasetukset"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Diaesityksen asetukset"</string>
     <string name="done" msgid="7479926268660505871">"Valmis"</string>
     <string name="move_up" msgid="7307578107431739359">"Siirrä ylöspäin"</string>
     <string name="move_down" msgid="6356509518429479053">"Siirrä alaspäin"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Poista"</string>
     <string name="send" msgid="4589898724889248486">"Lähetä"</string>
     <string name="mms" msgid="1587631213714914559">"Multimediaviesti"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Lähetä multimediaviesti"</string>
     <string name="all_threads" msgid="2663426830306307194">"Kaikki viestiketjut"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Kirjoita viesti"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Avaa näppäimistö ja kirjoita viesti"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Viestillä ei ole kelvollisia vastaanottajia."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Viestissä olevaa DRM-kohdetta ei voi lähettää eteenpäin."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Muunnetaan multimediaviestiksi…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Muunnetaan tekstiviestiksi…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Useampia dioja ei voi lisätä."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Samaan diaan ei voi lisätä sekä videota että kuvaa."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Viestiä ei voi tallentaa."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Pyydä lähetystiedot kaikista lähettämistäsi viesteistä"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Poista vanhat viestit, kun rajoitukset tulevat vastaan"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> viestiä keskustelussa"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Lähetä yksi viesti useille vastaanottajille käyttämällä multimediaviestiä"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Hallinnoi SIM-kortilla olevia viestejä"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Lähetystiedot"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Ryhmäviestit"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Luetut raportit"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Lähetystiedot"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Poista vanhat viestit"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Tekstiviestirajoitus"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimediaviestirajoitus"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Ilmoitukset"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Näytä viesti-ilmoitukset tilapalkissa"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Värinä"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Käytä värinää ilmoituksien yhteydessä"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Valitse soittoääni"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Ääni"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Aseta tallennettavien viestien lukumäärä"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Aina"</item>
-    <item msgid="6069709696037750627">"Vain puhelimen ollessa äänetön"</item>
-    <item msgid="7486145357487111435">"Ei koskaan"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Värinä"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Äänetön"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automaattilataus"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Lataa viestit automaattisesti"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automaattilataus roaming-tilassa"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Soittoääni tallennettu."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Soittoäänen tallentaminen epäonnistui."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Lisää hymiö"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Ryhmän jäsenet"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Valitse toiminto"</string>
     <string name="slide_number" msgid="1923958526266726635">"Dia <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Tallennusrajoitukset"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Vaihda kestoa"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Muokkaa diaesitystä"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Ryhmän jäsenet"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Muokkaa diaa"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diaesitys"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Luokan 0 viesti"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Kuva"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-fr/arrays.xml b/res/values-fr/arrays.xml
index 452b3cd..eec8d4c 100644
--- a/res/values-fr/arrays.xml
+++ b/res/values-fr/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Sourire en coin"</item>
     <item msgid="638612939305162424">"Impassible"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"aucun objet"</item>
+  </string-array>
 </resources>
diff --git a/res/values-fr/strings.xml b/res/values-fr/strings.xml
index 5c6124a..ce02238 100644
--- a/res/values-fr/strings.xml
+++ b/res/values-fr/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Privilèges GDN insuffisants détectés."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copier le texte"</string>
     <string name="message_options" msgid="6838806653341967550">"Options du message"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Options du diaporama"</string>
     <string name="done" msgid="7479926268660505871">"OK"</string>
     <string name="move_up" msgid="7307578107431739359">"Déplacer vers le haut"</string>
     <string name="move_down" msgid="6356509518429479053">"Déplacer vers le bas"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Supprimer"</string>
     <string name="send" msgid="4589898724889248486">"Envoyer"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Envoyez le MMS."</string>
     <string name="all_threads" msgid="2663426830306307194">"Tous les fils"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Saisissez un message"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Ouvrez le clavier pour saisir un message"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Aucun destinataire valide n\'a été spécifié pour votre message."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Impossible de transférer l\'objet GDN inclus dans le message."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Conversion en message multimédia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Conversion en message SMS…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Impossible d\'ajouter d\'autres diapositives."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Impossible d\'ajouter une vidéo et une image sur une même diapositive."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Impossible d\'enregistrer le message."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Demander un accusé de réception pour chaque message envoyé"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Supprimer lorsque les limites suivantes sont atteintes"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> messages par conversation"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utiliser un MMS pour envoyer un message unique à plusieurs destinataires"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gestion messages carte SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Accusé de réception"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Messagerie de groupe"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Confirmation de lecture"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Accusé de réception"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Anciens messages"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limite pour les SMS"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limite pour les MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notifications"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Afficher les notifications de message dans la barre d\'état"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibreur"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrer également à la réception d\'une notification"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Sélectionner une sonnerie"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sonnerie"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Définir le nombre de messages à enregistrer"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Toujours"</item>
-    <item msgid="6069709696037750627">"En mode silencieux"</item>
-    <item msgid="7486145357487111435">"Jamais"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibreur"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Mode silencieux"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Récupération auto"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Récupérer automatiquement les messages"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Itinérance"</string>
@@ -200,7 +196,7 @@
     <string name="delete" msgid="1409973060081564612">"Supprimer"</string>
     <string name="select_conversations" msgid="7816517565640002844">"Sélectionner des conversations"</string>
     <string name="no_conversations" msgid="6773767655149258445">"Aucune conversation"</string>
-    <string name="loading_conversations" msgid="5510430408235967094">"Chargement des conversations en cours…"</string>
+    <string name="loading_conversations" msgid="5510430408235967094">"Chargement des conversations…"</string>
     <string name="cannot_get_details" msgid="850292987983026806">"Impossible de récupérer les détails."</string>
     <string name="message_details_title" msgid="9223295113731634528">"Détails du message"</string>
     <string name="message_type_label" msgid="7975373966795945566">"Type : "</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Sonnerie enregistrée."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Impossible d\'enregistrer la sonnerie."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Insérer une émoticône"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Membres du groupe"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Sélectionner une action"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositive <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limites de stockage"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Changer la durée"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Modifier le diaporama"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Membres du groupe"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Modifier la diapositive"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diaporama"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Message de catégorie 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Image"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-hi/arrays.xml b/res/values-hi/arrays.xml
index 7e7f38e..c31bc08 100644
--- a/res/values-hi/arrays.xml
+++ b/res/values-hi/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"बनावटी हंसी"</item>
     <item msgid="638612939305162424">"पोकर चेहरा"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"कोई विषय नहीं"</item>
+  </string-array>
 </resources>
diff --git a/res/values-hi/strings.xml b/res/values-hi/strings.xml
index a58eea3..fe5810b 100644
--- a/res/values-hi/strings.xml
+++ b/res/values-hi/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"अपर्याप्त DRM अधिकारों का पता लगा."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"पाठ की प्रतिलिपि बनाएं"</string>
     <string name="message_options" msgid="6838806653341967550">"संदेश विकल्‍प"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"स्लाइड शो के विकल्प"</string>
     <string name="done" msgid="7479926268660505871">"पूर्ण"</string>
     <string name="move_up" msgid="7307578107431739359">"ऊपर जाएं"</string>
     <string name="move_down" msgid="6356509518429479053">"नीचे जाएं"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"निकालें"</string>
     <string name="send" msgid="4589898724889248486">"भेजें"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS भेजें"</string>
     <string name="all_threads" msgid="2663426830306307194">"सभी थ्रेड"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"संदेश लि‍खें"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"संदेश लि‍खने के लि‍ए कीबोर्ड खोलें"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"आपके संदेश में कोई मान्य प्राप्तकर्ता नहीं हैं."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"संदेश में शामिल DRM ऑब्जेक्ट अग्रेषित नहीं किया जा सकता."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"मल्टीमीडिया संदेश में कनवर्ट कर रहा है..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"पाठ संदेश में कनवर्ट कर रहा है..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"अधिक स्लाइड नहीं जोड़ सकता."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"एक स्लाइड में वीडियो और चित्र नहीं जोड़ सकता."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"संदेश नहीं सहेज सकता."</string>
@@ -161,29 +162,24 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"आपके द्वारा भेजे गए प्रत्येक संदेश की वितरण रिपोर्ट का अनुरोध करें"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"पुराने संदेश हटाएं क्योंकि सीमा तक पहुंच चुके हैं"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"प्रति वा्र्तालाप <xliff:g id="COUNT">%1$s</xliff:g> संदेश"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"एक से अधिक प्राप्तकर्ता होने पर एकल संदेश भेजने के लिए MMS का उपयोग करें"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"सिम कार्ड संदेश प्रबंधित करें"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"वितरण रिपोर्ट"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"समूह संदेश सेवा"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"पढ़े जाने की रिपोर्ट"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"वितरण रिपोर्ट"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"पुराने संदेश हटाएं"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"पाठ संदेश सीमा"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"मल्टीमीडिया संदेश सीमा"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"सूचनाएं"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"स्थिति बार में संदेश सूचनाएं प्रदर्शित करें"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"कंपन"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"सूचित किए जाने पर भी कंपन करें"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"रिंगटोन चुनें"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"ध्वनि"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"सहेजने के लिए संदेशों की संख्या सेट करें"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"हमेशा"</item>
-    <item msgid="6069709696037750627">"केवल मौन होने पर"</item>
-    <item msgid="7486145357487111435">"कभी नहीं"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"कंपन"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"मौन"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"स्वतः पुनर्प्राप्ति"</string>
-    <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"संदेशों को स्वचालित रूप से पुनर्प्राप्त करें"</string>
+    <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"संदेशों को अपने आप पुनर्प्राप्त करें"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"रोमिंग स्वतः पुनर्प्राप्ति"</string>
-    <string name="pref_summary_mms_retrieval_during_roaming" msgid="2427892806582531020">"रोमिंग के दौरान संदेश स्वचालित रूप से पुनर्प्राप्त करें"</string>
+    <string name="pref_summary_mms_retrieval_during_roaming" msgid="2427892806582531020">"रोमिंग के दौरान संदेश अपने आप पुनर्प्राप्त करें"</string>
     <string name="confirm_dialog_title" msgid="2187213750475782725">"हटाएं?"</string>
     <string name="confirm_dialog_locked_title" msgid="8179085718150932242">"लॉक किया गया संदेश हटाएं?"</string>
   <plurals name="confirm_delete_conversation">
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"रिंगटोन सहेजी गई."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"रिंगटोन नहीं सहेज सका."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"स्‍माइली सम्मिलित करें"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"समूह के प्रतिभागी"</string>
     <string name="select_link_title" msgid="3371818607625768447">"कार्यवाही चुनें"</string>
     <string name="slide_number" msgid="1923958526266726635">"स्लाइड <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"संग्रहण सीमाएं"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"अवधि बदलें"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"स्लाइडशो संपादित करें"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"समूह के प्रतिभागी"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"स्लाइड संपादित करें"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"स्लाइडशो"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"वर्ग 0 संदेश"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"चित्र"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-hr/arrays.xml b/res/values-hr/arrays.xml
index 7e51d44..6377216 100644
--- a/res/values-hr/arrays.xml
+++ b/res/values-hr/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Samozadovoljni podsmjeh"</item>
     <item msgid="638612939305162424">"Pokeraš"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"nema predmeta"</item>
+  </string-array>
 </resources>
diff --git a/res/values-hr/strings.xml b/res/values-hr/strings.xml
index 67076b6..a086934 100644
--- a/res/values-hr/strings.xml
+++ b/res/values-hr/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Otkrivena su nedostatna DRM prava."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopiraj tekst"</string>
     <string name="message_options" msgid="6838806653341967550">"Opcije poruke"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opcije prezentacije"</string>
     <string name="done" msgid="7479926268660505871">"Gotovo"</string>
     <string name="move_up" msgid="7307578107431739359">"Pomakni prema gore"</string>
     <string name="move_down" msgid="6356509518429479053">"Pomakni prema dolje"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Ukloni"</string>
     <string name="send" msgid="4589898724889248486">"Pošalji"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Pošalji MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Sve niti"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Unesite poruku"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Otvorite tipkovnicu za upis nove poruke"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Poruka nema važećeg primatelja."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"DRM objekt koji se nalazi u poruci nije moguće proslijediti."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konvertiranje u multimedijsku poruku..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konvertiranje u tekstualnu poruku..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Nije moguće dodati više slajdova."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Na jedan slajd nije moguće dodati videozapis i sliku."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Poruku nije moguće spremiti."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Zahtijevajte izvješće o isporuci za svaku poslanu poruku"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Izbriši stare poruke kada se dosegne ograničenje"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Broj poruka po razgovoru: <xliff:g id="COUNT">%1$s</xliff:g>."</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Pomoću MMS-a pošaljite jednu poruku za više primatelja"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Upravljanje porukama na SIM kartici."</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Izvješća o isporuci"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Grupne poruke"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Izvješća o čitanju"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Izvješća o isporuci"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Izbriši stare poruke"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Ograničenja za tekstualne poruke"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Ograničenje za multimedijske poruke"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Obavijesti"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Prikaz obavijesti o porukama u traci statusa"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibracija"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Po obavijesti također vibriraj"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Odaberi melodiju zvona"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Zvuk"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Postavi broj poruka za spremanje"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Uvijek"</item>
-    <item msgid="6069709696037750627">"Samo ako je bešumno"</item>
-    <item msgid="7486145357487111435">"Nikad"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibracija"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Bešumno"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatski dohvat"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automatski dohvaćaj poruke"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automatski dohvat u roamingu"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Melodija zvona spremljena je"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Melodiju zvona nije moguće spremiti."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Umetni smajlić"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grupiši sudionike"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Odabir radnje"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slajd <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Ograničenja za pohranjivanje"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Promjena trajanja"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Uređivanje dijaprojekcije"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grupiranje sudionika"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Uređivanje slajda"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Dijaprojekcija"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Poruka klase 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Slika"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-hu/arrays.xml b/res/values-hu/arrays.xml
index 0446262..61e9fe1 100644
--- a/res/values-hu/arrays.xml
+++ b/res/values-hu/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Kacsintás"</item>
     <item msgid="638612939305162424">"Pókerarc"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"nincs tárgy"</item>
+  </string-array>
 </resources>
diff --git a/res/values-hu/strings.xml b/res/values-hu/strings.xml
index f40558a..afbdd6a 100644
--- a/res/values-hu/strings.xml
+++ b/res/values-hu/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Elégtelen DRM-jogosultság."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Szöveg másolása"</string>
     <string name="message_options" msgid="6838806653341967550">"Üzenetbeállítások"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Diavetítés beállításai"</string>
     <string name="done" msgid="7479926268660505871">"Kész"</string>
     <string name="move_up" msgid="7307578107431739359">"Fel"</string>
     <string name="move_down" msgid="6356509518429479053">"Le"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Törlés"</string>
     <string name="send" msgid="4589898724889248486">"Küldés"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS küldése"</string>
     <string name="all_threads" msgid="2663426830306307194">"Az összes szál"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Írja be az üzenetet"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Billentyűzet megnyitása üzenet begépeléséhez"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Az üzenetnek nincsenek érvényes címzettjei."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Az üzenetben található DRM-objektum nem továbbítható."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konvertálás multimédiás üzenetté..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konvertálás szöveges üzenetté..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Nem lehet további diákat hozzáadni."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Nem lehet ugyanahhoz a diához videót és képet is hozzáadni."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Nem lehet menteni az üzenetet."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Kézbesítési jelentés kérése minden elküldött üzenetről"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Régi üzenetek törlése a korlát elérésekor"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> üzenet beszélgetésenként"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Küldjön MMS-t, amikor több címzettnek szeretne üzenetet küldeni."</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"SIM-kártyán tárolt üzenetek kezelése"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Kézbesítési jelentések"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Csoportos üzenetküldés"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Olvasási visszaigazolások"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Kézbesítési jelentések"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Régi üzenetek törlése"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Szöveges üzenetek korlátja"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimédiás üzenetek korlátja"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Értesítések"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Üzenetekkel kapcsolatos értesítések megjelenítése az állapotsoron"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Rezgés"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Rezgés értesítések esetén is"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Válasszon csengőhangot"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Hang"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"A menteni kívánt üzenetek számának beállítása"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Mindig"</item>
-    <item msgid="6069709696037750627">"Csak néma üzemmódban"</item>
-    <item msgid="7486145357487111435">"Soha"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Rezgés"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Néma"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatikus letöltés"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Üzenetek automatikus letöltése"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automatikus letöltés barangolás során"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"A csengőhang mentve."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Nem sikerült menteni a csengőhangot."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Hangulatjel beszúrása"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Résztvevők csoportosítása"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Művelet kiválasztása"</string>
     <string name="slide_number" msgid="1923958526266726635">"<xliff:g id="NUMBER">%s</xliff:g>. dia"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Tárhelykorlátok"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Időtartam módosítása"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Diavetítés szerkesztése"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Résztvevők csoportosítása"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Dia szerkesztése"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diavetítés"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"0. osztályú üzenet"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Kép"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-in/arrays.xml b/res/values-in/arrays.xml
index 6a24b9d..24118e6 100644
--- a/res/values-in/arrays.xml
+++ b/res/values-in/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Menyeringai"</item>
     <item msgid="638612939305162424">"Wajah poker"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"tanpa subjek"</item>
+  </string-array>
 </resources>
diff --git a/res/values-in/strings.xml b/res/values-in/strings.xml
index 5c3dbbd..67b8486 100644
--- a/res/values-in/strings.xml
+++ b/res/values-in/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Hak DRM tidak memadai terdeteksi."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Salin teks"</string>
     <string name="message_options" msgid="6838806653341967550">"Opsi pesan"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opsi tayangan slide"</string>
     <string name="done" msgid="7479926268660505871">"Selesai"</string>
     <string name="move_up" msgid="7307578107431739359">"Naikkan"</string>
     <string name="move_down" msgid="6356509518429479053">"Turunkan"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Hapus"</string>
     <string name="send" msgid="4589898724889248486">"Kirimkan"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Kirim MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Semua utas"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Ketik pesan"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Buka keyboard untuk mengetik pesan"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Pesan Anda tidak memiliki penerima yang valid."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Objek DRM yang disertakan dalam pesan tidak dapat diteruskan."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Mengonversi ke pesan multimedia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Mengonversi ke pesan teks..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Tidak dapat menambahkan slide lainnya."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Tidak dapat menambahkan video dan gambar ke satu slide."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Tidak dapat menyimpan pesan."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Minta laporan pengiriman dari setiap pesan yang Anda kirimkan"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Hapus pesan lama ketika mencapai batas"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> pesan per percakapan"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Gunakan MMS untuk mengirimkan pesan tunggal saat ada beberapa penerima"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Kelola pesan kartu SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Laporan pengiriman"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Perpesanan grup"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Baca laporan"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Laporan pengiriman"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Hapus pesan lama"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Batasan pesan teks"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Batasan pesan multimedia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Pemberitahuan"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Tampilkan pemberitahuan pesan pada bilah status"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Getar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Juga bergetar ketika diberi tahu"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Pilih nada dering"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Suara"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Setel jumlah pesan yang akan disimpan"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Selalu"</item>
-    <item msgid="6069709696037750627">"Hanya saat senyap"</item>
-    <item msgid="7486145357487111435">"Tidak pernah"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Getar"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Senyap"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Pungut otomatis"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Pungut pesan secara otomatis"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Pungut otomatis roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Nada dering disimpan."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Tidak dapat menyimpan nada dering."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Masukkan smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Peserta grup"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Pilih tindakan"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slide <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Batas penyimpanan"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Ubah durasi"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Edit rangkai slide"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Peserta grup"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Edit slide"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Rangkai slide"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Pesan Kelas 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Gambar"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-it/arrays.xml b/res/values-it/arrays.xml
index cc66408..86f1e7e 100644
--- a/res/values-it/arrays.xml
+++ b/res/values-it/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Ghigno"</item>
     <item msgid="638612939305162424">"Impassibile"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"nessun oggetto"</item>
+  </string-array>
 </resources>
diff --git a/res/values-it/strings.xml b/res/values-it/strings.xml
index fd4f26d..e9011b6 100644
--- a/res/values-it/strings.xml
+++ b/res/values-it/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Diritti DRM insufficienti."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copia testo"</string>
     <string name="message_options" msgid="6838806653341967550">"Opzioni messaggio"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opzioni slideshow"</string>
     <string name="done" msgid="7479926268660505871">"Fine"</string>
     <string name="move_up" msgid="7307578107431739359">"Sposta su"</string>
     <string name="move_down" msgid="6356509518429479053">"Sposta giù"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Rimuovi"</string>
     <string name="send" msgid="4589898724889248486">"Invia"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Invia MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Tutti i thread"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Scrivi messaggio"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Apri la tastiera per digitare il messaggio"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Il messaggio non ha destinatari validi."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Impossibile inoltrare l\'oggetto DRM incluso nel messaggio."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Conversione in messaggio multimediale..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Conversione in messaggio di testo..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Impossibile aggiungere altre diapositive."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Impossibile aggiungere video e immagine a una diapositiva."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Impossibile salvare il messaggio."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Richiedi conferma di recapito per ogni messaggio inviato"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Elimina vecchi messaggi al raggiungimento dei limiti"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> messaggi per conversazione"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utilizza gli MMS per inviare un unico messaggio a più destinatari"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gestisci messaggi della SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Conferme di recapito"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Messaggi di gruppo"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Conferme di lettura"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Conferme di recapito"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Elimina vecchi messaggi"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limite SMS"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limite MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notifiche"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Visualizza notifiche messaggi nella barra di stato"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrazione"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Attiva anche vibrazione alla notifica"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Scegli suoneria"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Suono"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Imposta numero di messaggi da salvare"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Sempre"</item>
-    <item msgid="6069709696037750627">"Solo in modalità silenziosa"</item>
-    <item msgid="7486145357487111435">"Mai"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrazione"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silenzioso"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Recupero automatico"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Recupera messaggi automaticamente"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Recupero in roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Suoneria salvata."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Salvataggio suoneria non riuscito."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Inserisci emoticon"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Partecipanti al gruppo"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Scegli azione"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositiva <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limiti di archiviazione"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Modifica durata"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Modifica slideshow"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Partecipanti al gruppo"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Modifica diapositiva"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slideshow"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Messaggio classe 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Immagine"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-iw/arrays.xml b/res/values-iw/arrays.xml
index 50ff385..7be31c5 100644
--- a/res/values-iw/arrays.xml
+++ b/res/values-iw/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"חיוך משוויץ"</item>
     <item msgid="638612939305162424">"פני פוקר"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"ללא נושא"</item>
+  </string-array>
 </resources>
diff --git a/res/values-iw/strings.xml b/res/values-iw/strings.xml
index cc48f95..67f9061 100644
--- a/res/values-iw/strings.xml
+++ b/res/values-iw/strings.xml
@@ -56,12 +56,13 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"לא אותרו מספיק זכויות DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"העתק טקסט"</string>
     <string name="message_options" msgid="6838806653341967550">"אפשרויות הודעה"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"אפשרויות מצגת"</string>
     <string name="done" msgid="7479926268660505871">"סיום"</string>
     <string name="move_up" msgid="7307578107431739359">"העבר למעלה"</string>
     <string name="move_down" msgid="6356509518429479053">"העבר למטה"</string>
-    <string name="remove_slide" msgid="2225604354024914900">"הסר שקופית"</string>
-    <string name="add_slide" msgid="9140721399423564187">"הוסף שקופית"</string>
-    <string name="add_slide_hint" msgid="7351356961076244584">"גע כדי ליצור שקופית חדשה."</string>
+    <string name="remove_slide" msgid="2225604354024914900">"הסר שקף"</string>
+    <string name="add_slide" msgid="9140721399423564187">"הוסף שקף"</string>
+    <string name="add_slide_hint" msgid="7351356961076244584">"גע כדי ליצור שקף חדש."</string>
     <string name="discard_slideshow" msgid="5054239124146413609">"מחק מצגת"</string>
     <string name="slide_show_part" msgid="5077675385448696846">"חלק <xliff:g id="PART">%1$s</xliff:g>/<xliff:g id="TOTAL">%2$s</xliff:g>"</string>
     <string name="remove_text" msgid="2164068850029476539">"הסר טקסט"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"הסר"</string>
     <string name="send" msgid="4589898724889248486">"שלח"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"שלח MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"כל השרשורים"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"הקלד הודעה"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"פתח מקלדת להקלדת הודעה"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"להודעה אין נמענים חוקיים."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"לא ניתן להעביר הלאה את אובייקט ה-DRM שכלול בהודעה."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"ממיר להודעת מולטימדיה..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"ממיר להודעת טקסט..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"אין אפשרות להוסיף שקופיות נוספות."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"אין אפשרות להוסיף סרטון ותמונה לשקופית אחת."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"אין אפשרות לשמור את ההודעה."</string>
@@ -119,7 +120,7 @@
     <string name="preview_slideshow" msgid="6824095909448728427">"תצוגה מקדימה"</string>
     <string name="replace_image" msgid="3171240952601443619">"החלף תמונה"</string>
     <string name="duration_sec" msgid="6617032324007824096">"תדירות (<xliff:g id="DURATION">%s</xliff:g> שניות)"</string>
-    <string name="duration_selector_title" msgid="5981097971537625852">"משך זמן של שקופית "</string>
+    <string name="duration_selector_title" msgid="5981097971537625852">"משך זמן של שקף "</string>
     <string name="layout_selector_title" msgid="7344600117972450771">"פריסת מצגת "</string>
     <string name="layout_top" msgid="6811021650398972346">"פריסה (למעלה)"</string>
     <string name="layout_bottom" msgid="5822765871095491843">"פריסה (בתחתית)"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"בקש דוח מסירה לכל הודעה שאתה שולח"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"מחק הודעות ישנות עם הגעה למגבלה"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> הודעות בכל שיחה"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"השתמש ב-MMS לשליחת הודעה אחת לנמענים מרובים"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"נהל הודעות בכרטיס SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"דוחות מסירה"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"העברת הודעות לקבוצה"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"דוחות קריאה"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"דוחות מסירה"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"מחק הודעות ישנות"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"מגבלה של הודעת טקסט"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"מגבלת הודעות מולטימדיה"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"התראות"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"הצג התראות הודעה בשורת המצב"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"רטט"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"רטט גם בעת קבלת התראה"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"בחר רינגטון"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"צליל"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"הגדר מספר הודעות לשמירה"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"תמיד"</item>
-    <item msgid="6069709696037750627">"במצב שקט בלבד"</item>
-    <item msgid="7486145357487111435">"אף פעם"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"רטט"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"שקט"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"אחזור אוטומטי"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"אחזר הודעות באופן אוטומטי"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"אחזור אוטומטי בנדידה"</string>
@@ -286,8 +282,9 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"הרינגטון נשמר."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"לא ניתן היה לשמור את הצלצול."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"הוסף סמיילי"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"משתתפי קבוצה"</string>
     <string name="select_link_title" msgid="3371818607625768447">"בחר פעולה"</string>
-    <string name="slide_number" msgid="1923958526266726635">"שקופית <xliff:g id="NUMBER">%s</xliff:g>"</string>
+    <string name="slide_number" msgid="1923958526266726635">"שקף <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
     <item quantity="one" msgid="1654101988340583935">"שנייה <xliff:g id="NUMBER">%s</xliff:g>"</item>
     <item quantity="few" msgid="7887190171856293871">"<xliff:g id="NUMBER">%s</xliff:g> שניות"</item>
@@ -297,7 +294,8 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"מגבלות אחסון"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"שנה את משך הזמן"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"ערוך מצגת"</string>
-    <string name="edit_slide_activity" msgid="8752829671778696983">"ערוך שקופית"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"משתתפי קבוצה"</string>
+    <string name="edit_slide_activity" msgid="8752829671778696983">"ערוך שקף"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"מצגת"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"הודעה ברמה 0"</string>
     <string name="search_label" msgid="6042598929386174964">"סמס"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"תמונה"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ja/arrays.xml b/res/values-ja/arrays.xml
index 80272c7..8efe02d 100644
--- a/res/values-ja/arrays.xml
+++ b/res/values-ja/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"ニヤニヤ"</item>
     <item msgid="638612939305162424">"ポーカーフェイス"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"件名なし"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ja/strings.xml b/res/values-ja/strings.xml
index 2930ee3..b8c713f 100644
--- a/res/values-ja/strings.xml
+++ b/res/values-ja/strings.xml
@@ -34,7 +34,7 @@
     <string name="menu_view" msgid="7448852683948080108">"スレッド一覧表示"</string>
     <string name="menu_debug_dump" msgid="6855869130206549643">"ダンプをデバッグ"</string>
     <string name="refreshing" msgid="987335057871404222">"更新中..."</string>
-    <string name="menu_cell_broadcasts" msgid="5646161375983084660">"エリアメール"</string>
+    <string name="menu_cell_broadcasts" msgid="5646161375983084660">"緊急警報"</string>
     <string name="has_draft" msgid="2487465595514636160">"下書き"</string>
     <string name="no_subject_view" msgid="7795086723069563537">"(件名なし)"</string>
     <string name="messagelist_sender_self" msgid="3579016854116401602">"自分"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"DRM権限が十分ではありません。"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"テキストをコピー"</string>
     <string name="message_options" msgid="6838806653341967550">"メッセージオプション"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"スライドショーのオプション"</string>
     <string name="done" msgid="7479926268660505871">"完了"</string>
     <string name="move_up" msgid="7307578107431739359">"上に移動"</string>
     <string name="move_down" msgid="6356509518429479053">"下に移動"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"削除"</string>
     <string name="send" msgid="4589898724889248486">"送信"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMSを送信"</string>
     <string name="all_threads" msgid="2663426830306307194">"スレッド一覧"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"メッセージを入力"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"キーボードを表示してメッセージを入力"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"メッセージに有効な宛先が指定されていません。"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"メッセージ内のDRMオブジェクトは転送できません。"</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"マルチメディアメッセージに変換中..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"テキストメッセージに変換中..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"スライドを追加できません。"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"1つのスライドに動画と画像を追加することはできません。"</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"メッセージを保存できません。"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"送信するメッセージの受取確認を毎回要求する"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"上限に達したら古いメッセージを削除する"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"スレッドごとに<xliff:g id="COUNT">%1$s</xliff:g>件のメッセージ"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"宛先が複数ある場合にMMSを使用して1通のメッセージとして送信する"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"SIMカードのメッセージ"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"受取確認通知"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"グループメッセージング"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"開封確認レポート"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"受取確認通知"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"古いメッセージを削除"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"テキストメッセージの制限件数"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"マルチメディアメッセージの制限件数"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"通知"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"メッセージ受信: ステータスバーで通知"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"バイブレーション"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"メッセージ受信の通知: バイブレーションON"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"着信音を選択"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"着信音"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"保存するメッセージ件数を設定"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"常に使用"</item>
-    <item msgid="6069709696037750627">"マナーモード時のみ"</item>
-    <item msgid="7486145357487111435">"使用しない"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"バイブレーション"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"マナーモード"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"自動で取得"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"メッセージを自動的に取得する"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"ローミング時に自動取得"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"着信音を保存しました。"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"着信音を保存できませんでした。"</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"絵文字を挿入"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"参加者をグループ化"</string>
     <string name="select_link_title" msgid="3371818607625768447">"操作の選択"</string>
     <string name="slide_number" msgid="1923958526266726635">"スライド<xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"ストレージ制限"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"表示時間を変更"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"スライドショーを編集"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"参加者のグループ化"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"スライドを編集"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"スライドショー"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"クラス0メッセージ"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"画像"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"、 "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ko/arrays.xml b/res/values-ko/arrays.xml
index 71018ec..f7b1a07 100644
--- a/res/values-ko/arrays.xml
+++ b/res/values-ko/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"능글맞은 웃음"</item>
     <item msgid="638612939305162424">"무표정한 얼굴"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"제목 없음"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ko/strings.xml b/res/values-ko/strings.xml
index be67101..8a0993f 100644
--- a/res/values-ko/strings.xml
+++ b/res/values-ko/strings.xml
@@ -26,7 +26,7 @@
     <string name="menu_send_email" msgid="671366308915241664">"<xliff:g id="NAME">%s</xliff:g>에게 이메일 보내기"</string>
     <string name="menu_compose_new" msgid="3763437973691046238">"새 메시지"</string>
     <string name="menu_preferences" msgid="4693148116114749414">"설정"</string>
-    <string name="menu_add_address_to_contacts" msgid="4491980950419914944">"피플에 <xliff:g id="CONTACTEMAILORNUMBER">%s</xliff:g> 추가"</string>
+    <string name="menu_add_address_to_contacts" msgid="4491980950419914944">"주소록에 <xliff:g id="CONTACTEMAILORNUMBER">%s</xliff:g> 추가"</string>
     <string name="menu_call" msgid="5877123227307074690">"전화걸기"</string>
     <string name="menu_search" msgid="2289469305728821360">"검색"</string>
     <string name="menu_delete_all" msgid="808729454898114735">"전체 대화목록 삭제"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"DRM 권한이 충분하지 않습니다."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"텍스트 복사"</string>
     <string name="message_options" msgid="6838806653341967550">"메시지 옵션"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"슬라이드쇼 옵션"</string>
     <string name="done" msgid="7479926268660505871">"완료"</string>
     <string name="move_up" msgid="7307578107431739359">"위로 이동"</string>
     <string name="move_down" msgid="6356509518429479053">"아래로 이동"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"삭제"</string>
     <string name="send" msgid="4589898724889248486">"전송"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS 전송"</string>
     <string name="all_threads" msgid="2663426830306307194">"전체 대화목록"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"메시지 입력"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"키보드를 사용하여 메시지 입력"</string>
@@ -89,7 +91,7 @@
     <string name="select_different_media" msgid="6241623357299382183">"다른 <xliff:g id="NAME">%1$s</xliff:g>을(를) 선택하세요."</string>
     <string name="exceed_message_size_limitation" msgid="6027753647094742437">"메시지 크기 한도에 도달했습니다."</string>
     <string name="message_too_big_for_video" msgid="2639367545165352543">"메시지가 너무 커서 동영상을 첨부할 수 없습니다."</string>
-    <string name="failed_to_add_media" msgid="7207464170168708485">"<xliff:g id="NAME">%1$s</xliff:g>님을 메시지에 추가할 수 없습니다."</string>
+    <string name="failed_to_add_media" msgid="7207464170168708485">"<xliff:g id="NAME">%1$s</xliff:g>을 메시지에 추가할 수 없습니다."</string>
     <string name="failed_to_resize_image" msgid="5608354151631833669">"사진 크기가 조정되지 않았습니다."</string>
     <string name="resize_image_error_information" msgid="3783200130776554475">"사진의 크기를 조정했지만 사진이 너무 커 아직도 전송할 수 없습니다."</string>
     <string name="forward_prefix" msgid="276280492803486464">"Fwd: "</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"메시지의 유효한 수신자가 없습니다."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"메시지에 포함된 DRM 개체를 전달할 수 없습니다."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"멀티미디어 메시지로 변환 중..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"문자 메시지로 변환 중..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"슬라이드를 더 이상 추가할 수 없습니다."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"동영상과 사진을 한 슬라이드에 추가할 수 없습니다."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"메시지를 저장할 수 없습니다."</string>
@@ -141,7 +142,7 @@
     <item msgid="7786079681602275449">"기타"</item>
   </string-array>
     <string name="menu_view_contact" msgid="1414670584423909451">"연락처 보기"</string>
-    <string name="menu_add_to_contacts" msgid="1258127580972228970">"피플에 추가"</string>
+    <string name="menu_add_to_contacts" msgid="1258127580972228970">"주소록에 추가"</string>
     <string name="hidden_sender_address" msgid="2776075636669924968">"숨은 발신자 주소"</string>
     <string name="yes" msgid="3246158147503160811">"확인"</string>
     <string name="no" msgid="4289742508556913860">"취소"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"메시지 전송 시 발신 알림 받기"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"한도에 도달하면 이전 메시지 삭제"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"대화당 메시지 <xliff:g id="COUNT">%1$s</xliff:g>개"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"수신자가 여러 명일 때 MMS를 사용하여 한 개의 메시지를 전송합니다."</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"SIM 카드 메시지 관리"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"발신 알림"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"그룹 메시지"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"읽음 여부 보고"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"발신 알림"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"이전 메시지 삭제"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"문자 메시지 한도"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"멀티미디어 메시지 한도"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"알림"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"상태 표시줄에 메시지 알림 표시"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"진동"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"알림 시 진동도 함께 울림"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"벨소리 선택"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"소리"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"저장할 메시지 개수 설정"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"항상"</item>
-    <item msgid="6069709696037750627">"무음 시에만"</item>
-    <item msgid="7486145357487111435">"안함"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"진동"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"무음"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"자동 수신"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"메시지를 자동으로 수신"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"로밍 중 자동 수신"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"벨소리를 저장했습니다."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"벨소리를 저장하지 못했습니다."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"이모티콘 삽입"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"그룹 참가자"</string>
     <string name="select_link_title" msgid="3371818607625768447">"작업 선택"</string>
     <string name="slide_number" msgid="1923958526266726635">"<xliff:g id="NUMBER">%s</xliff:g>번 슬라이드"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"저장용량 한도"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"표시 기간 변경"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"슬라이드쇼 편집"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"그룹 참가자"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"슬라이드 편집"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"슬라이드쇼"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"클래스 0 메시지"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"사진"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-lt/arrays.xml b/res/values-lt/arrays.xml
index 82e00b0..aa5db0e 100644
--- a/res/values-lt/arrays.xml
+++ b/res/values-lt/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Smirk"</item>
     <item msgid="638612939305162424">"Nieko nesakantis veidas"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"jokios temos"</item>
+  </string-array>
 </resources>
diff --git a/res/values-lt/strings.xml b/res/values-lt/strings.xml
index e5e1551..147608a 100644
--- a/res/values-lt/strings.xml
+++ b/res/values-lt/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Nustatyta, kad DRM teisės nepakankamos."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopijuoti tekstą"</string>
     <string name="message_options" msgid="6838806653341967550">"Pranešimo parinktys"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Skaidrių demonstracijos parinktys"</string>
     <string name="done" msgid="7479926268660505871">"Atlikta"</string>
     <string name="move_up" msgid="7307578107431739359">"Perkelti aukštyn"</string>
     <string name="move_down" msgid="6356509518429479053">"Perkelti žemyn"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Pašalinti"</string>
     <string name="send" msgid="4589898724889248486">"Siųsti"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Siųsti MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Visos gijos"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Įveskite pranešimą"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Jei norite įvesti pranešimą, atidarykite klaviatūrą"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Nėra teisingų pranešimo gavėjų."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Negalima persiųsti DRM objekto, įtraukto į pranešimą."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konvertuojama į multimedijos pranešimą..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konvertuojama į teksto pranešimą..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Negalima pridėti daugiau skaidrių."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Vienoje skaidrėje negalima pridėti ir vaizdo įrašo, ir paveikslėlio."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Negalima išsaugoti pranešimo."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Pateikti užklausą kiekvieno išsiųsto pranešimo pristatymo ataskaitai"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Ištrinti senus pranešimus, kai pasiekiami apribojimai"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> pranešimai (-ų) viename pokalbyje"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Naudokite MMS, kad siųstumėte vieną pranešimą, kai yra keli gavėjai"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Valdyti SIM kortelės pranešimus"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Pristatymo ataskaitos"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Pranešimų siuntimas grupėms"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Skaityti ataskaitas"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Pristatymo ataskaitos"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Ištrinti senus pranešimus"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Teksto pranešimo apribojimas"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Daugialypės terpės pranešimo apribojimas"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Įspėjimai"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Pateikti įspėjimus apie pranešimus būsenos juostoje"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibruoti"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Taip pat vibruoti, kai įspėjama"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Pasirinkti skambėjimo toną"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Garsas"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Nustatyti išsaugomų pranešimų skaičių"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Visada"</item>
-    <item msgid="6069709696037750627">"Tik kai veikia tyliai"</item>
-    <item msgid="7486145357487111435">"Niekada"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibruoti"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Begarsis"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatiškai nuskaityti"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automatiškai nuskaityti pranešimus"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automatinis tarptinklinio ryšio nuskaitymas"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Skambėjimo tonas išsaugotas."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Nepavyko išsaugoti skambėjimo tono."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Įterpti šypsenėlę"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grupės dalyviai"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Pasirinkti veiksmą"</string>
     <string name="slide_number" msgid="1923958526266726635">"<xliff:g id="NUMBER">%s</xliff:g> skaidrė"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Saugyklos apribojimai"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Keisti trukmę"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Redaguoti skaidrių demonstraciją"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grupės dalyviai"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Redaguoti skaidrę"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Skaidrių demonstracija"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"0 pranešimų klasė"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Nuotrauka"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g>–<xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-lv/arrays.xml b/res/values-lv/arrays.xml
index 9745082..f750fd4 100644
--- a/res/values-lv/arrays.xml
+++ b/res/values-lv/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Smīns"</item>
     <item msgid="638612939305162424">"Poker face"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"bez temata"</item>
+  </string-array>
 </resources>
diff --git a/res/values-lv/strings.xml b/res/values-lv/strings.xml
index 212a2e2..f53224d 100644
--- a/res/values-lv/strings.xml
+++ b/res/values-lv/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Konstatēts, ka nav pietiekamu tiesību saskaņā ar cipariska satura tiesību pārvaldību."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopēt tekstu"</string>
     <string name="message_options" msgid="6838806653341967550">"Ziņojuma opcijas"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Slaidrādes opcijas"</string>
     <string name="done" msgid="7479926268660505871">"Gatavs"</string>
     <string name="move_up" msgid="7307578107431739359">"Pārvietot uz augšu"</string>
     <string name="move_down" msgid="6356509518429479053">"Pārvietot uz leju"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Noņemt"</string>
     <string name="send" msgid="4589898724889248486">"Sūtīt"</string>
     <string name="mms" msgid="1587631213714914559">"Multiziņa"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Sūtīt multiziņu"</string>
     <string name="all_threads" msgid="2663426830306307194">"Visi pavedieni"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Rakstiet ziņojumu."</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Atveriet tastatūru, lai rakstītu ziņojumu."</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Ziņojumam nav neviena derīga adresāta."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Ziņojumā ietverto objektu, kas aizsargāts saskaņā ar digitālā satura tiesību pārvaldību, nevar pārsūtīt."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Notiek pārveidošana par multiziņu…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Notiek pārveidošana par īsziņu…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Nevar pievienot vairāk slaidu."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Vienam slaidam nevar pievienot videoklipu un attēlu."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Nevar saglabāt ziņojumu."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Pieprasīt pārskatu par katra sūtītā ziņojuma piegādi"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Dzēst vecos ziņojumus, kad tiek sasniegti ierobežojumi"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> ziņojumi vienā sarunā"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Izmantojiet multiziņu, lai vairākiem adresātiem nosūtītu vienu ziņu"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Pārvaldīt SIM kartē esošos ziņojumus"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Pārskati par piegādi"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Grupas ziņojumapmaiņa"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Lasīt pārskatus"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Pārskati par piegādi"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Dzēst vecos ziņojumus"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Īsziņu ierobežojums"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multiziņu ierobežojums"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Paziņojumi"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Attēlot statusa joslā paziņojumu par ziņojumu"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrēt"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrēt, arī saņemot paziņojumu"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Zvana signāla izvēle"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Signāls"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Iestatīt saglabājamo ziņojumu skaitu"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Vienmēr"</item>
-    <item msgid="6069709696037750627">"Tikai klusuma režīmā"</item>
-    <item msgid="7486145357487111435">"Nekad"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrēt"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Klusums"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automātiski izgūt"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automātiski izgūt ziņojumus"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Viesabonēšanas automātiska izgūšana"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Zvana signāls ir saglabāts."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Nevarēja saglabāt zvana signālu."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Ievietot smaidiņu"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grupas dalībnieki"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Darbības izvēle"</string>
     <string name="slide_number" msgid="1923958526266726635">"<xliff:g id="NUMBER">%s</xliff:g>. slaids"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Krātuves ierobežojumi"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Mainīt ilgumu"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Rediģēt slaidrādi"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grupas dalībnieki"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Rediģēt slaidu"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slaidrāde"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"0. klases ziņojums"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Attēls"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> — <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ms/arrays.xml b/res/values-ms/arrays.xml
index 1b1d6de..d6bb2d6 100644
--- a/res/values-ms/arrays.xml
+++ b/res/values-ms/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Senyuman sinis"</item>
     <item msgid="638612939305162424">"Muka selamba"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"tiada subjek"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ms/strings.xml b/res/values-ms/strings.xml
index ceb5c71..0ec3916 100644
--- a/res/values-ms/strings.xml
+++ b/res/values-ms/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Hak DRM yang tidak mencukupi dikesan."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Salin teks"</string>
     <string name="message_options" msgid="6838806653341967550">"Pilihan mesej"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Pilihan tayangan slaid"</string>
     <string name="done" msgid="7479926268660505871">"Selesai"</string>
     <string name="move_up" msgid="7307578107431739359">"Beralih ke atas"</string>
     <string name="move_down" msgid="6356509518429479053">"Beralih ke bawah"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Alih keluar"</string>
     <string name="send" msgid="4589898724889248486">"Hantar"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Hantar MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Semua urutan"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Taip mesej"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Buka papan kekunci untuk menaip mesej"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Mesej anda tiada penerima yang sah."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Objek DRM yang disertakan dalam mesej tidak boleh dikirim semula."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Menukarkan kepada mesej multimedia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Menukarkan kepada mesej teks..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Tidak boleh menambah lagi slaid."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Tidak boleh menambahkan video dan gambar pada satu slaid."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Tidak boleh menyimpan mesej."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Meminta laporan penghantaran untuk setiap mesej yang anda hantar"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Padamkan mesej lama apabila had dicapai"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> mesej setiap perbualan"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Gunakan MMS untuk menghantar mesej tunggal apabila terdapat berbilang penerima"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Urus mesej kad SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Laporan penghantaran"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Pemesejan kumpulan"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Laporan baca"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Laporan penghantaran"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Padamkan mesej lama"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Had mesej teks"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Had mesej multimedia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Pemberitahuan"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Memaparkan mesej pemberitahuan dalam bar status"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Getar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Juga bergetar apabila diberitahu"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Pilih nada dering"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Bunyi"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Tetapkan bilangan mesej untuk disimpan"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Sentiasa"</item>
-    <item msgid="6069709696037750627">"Apabila senyap sahaja"</item>
-    <item msgid="7486145357487111435">"Jangan sekali-kali"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Getar"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Senyap"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Auto dapat kembali"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Dapatkan semula mesej secara automatik"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Auto dapat kembali perayauan"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Nada dering disimpan."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Tidak dapat menyimpan nada dering."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Masukkan smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Peserta kumpulan"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Pilih tindakan"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slaid <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Had storan"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Tukar tempoh"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Edit tayangan slaid"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Peserta kumpulan"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Edit slaid"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Tayangan slaid"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mesej kelas 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Gambar"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-nb/arrays.xml b/res/values-nb/arrays.xml
index 7c56c20..5178217 100644
--- a/res/values-nb/arrays.xml
+++ b/res/values-nb/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Glis"</item>
     <item msgid="638612939305162424">"Pokerfjes"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"emne mangler"</item>
+  </string-array>
 </resources>
diff --git a/res/values-nb/strings.xml b/res/values-nb/strings.xml
index fbd3084..3dfe479 100644
--- a/res/values-nb/strings.xml
+++ b/res/values-nb/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Oppdaget utilstrekkelige DRM-rettigheter."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopier tekst"</string>
     <string name="message_options" msgid="6838806653341967550">"Innstillinger for melding"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Alternativer for lysbildefremvisning"</string>
     <string name="done" msgid="7479926268660505871">"Utført"</string>
     <string name="move_up" msgid="7307578107431739359">"Flytt opp"</string>
     <string name="move_down" msgid="6356509518429479053">"Flytt ned"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Fjern"</string>
     <string name="send" msgid="4589898724889248486">"Send"</string>
     <string name="mms" msgid="1587631213714914559">"bildemelding"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Send MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Alle tråder"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Tast inn melding"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Åpne tastaturet for å taste inn melding"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Meldingen har ingen gyldige mottakere."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"DRM-objektet i meldingen kan ikke videresendes."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konverterer til MMS…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konverterer til SMS…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Kan ikke legge til flere lysbilder."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Kan ikke legge til både bilder og video på samme lysbilde."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Kan ikke lagre melding."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Spør om leveringsrapport for hver melding som sendes"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Slett gamle meldinger når grensene nås"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> meldinger per samtale"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Bruk MMS for å sende én melding med flere mottakere"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"SIM-kort-meldinger"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Leveringsrapporter"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Gruppemeldinger"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Leserapporter"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Leveringsrapporter"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Slett gamle meldinger"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"SMS-meldingsgrense"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"MMS-meldingsgrense"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Varslinger"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Vis meldingsvarslinger i statusfeltet"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrering"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrer også ved varslinger"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Velg ringetone"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Lyd"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Angi antall meldinger som skal lagres"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Alltid"</item>
-    <item msgid="6069709696037750627">"Kun ved stille modus"</item>
-    <item msgid="7486145357487111435">"Aldri"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrering"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Stille"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Autohent"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Hent meldinger automatisk"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automatisk henting ved bruk i utlandet"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ringetonen er lagret."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Kunne ikke lagre ringetonen."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Sett inn smilefjes"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Gruppedeltakere"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Velg handling"</string>
     <string name="slide_number" msgid="1923958526266726635">"Lysbilde <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Lagringsgrenser"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Velg lengde"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Rediger lysbildevisning"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Gruppedeltakere"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Rediger lysbilde"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Lysbildevisning"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Klasse 0-melding"</string>
@@ -341,4 +339,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Bilde"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-nl/arrays.xml b/res/values-nl/arrays.xml
index 7d7c865..735f2a6 100644
--- a/res/values-nl/arrays.xml
+++ b/res/values-nl/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Grijns"</item>
     <item msgid="638612939305162424">"Pokergezicht"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"geen onderwerp"</item>
+  </string-array>
 </resources>
diff --git a/res/values-nl/strings.xml b/res/values-nl/strings.xml
index dc31b70..c9cb43f 100644
--- a/res/values-nl/strings.xml
+++ b/res/values-nl/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Onvoldoende DRM-rechten gedetecteerd."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Tekst kopiëren"</string>
     <string name="message_options" msgid="6838806653341967550">"Berichtopties"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opties voor diavoorstelling"</string>
     <string name="done" msgid="7479926268660505871">"Gereed"</string>
     <string name="move_up" msgid="7307578107431739359">"Naar boven"</string>
     <string name="move_down" msgid="6356509518429479053">"Naar beneden"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Verwijderen"</string>
     <string name="send" msgid="4589898724889248486">"Verzenden"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS verzenden"</string>
     <string name="all_threads" msgid="2663426830306307194">"Alle threads"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Typ een bericht"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Open het toetsenbord om een bericht te typen"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Uw bericht heeft geen geldige ontvangers."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Het DRM-object in het bericht kan niet worden doorgestuurd."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Converteren naar MMS-bericht..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Converteren naar sms..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Kan niet meer dia\'s toevoegen."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Kan video en afbeelding niet toevoegen aan één dia."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Kan bericht niet opslaan."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Ontvangstbevestiging voor elk verzonden bericht aanvragen"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Oude berichten verwijderen wanneer limiet wordt bereikt"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> berichten per conversatie"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"MMS gebruiken om één bericht te verzenden wanneer er meerdere ontvangers zijn"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Berichten op SIM-kaart beheren"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Ontvangstbevestigingen"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Groepsberichten"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Leesbevestigingen"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Ontvangstbevestigingen"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Oude berich. verwijderen"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limiet voor sms"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limiet voor MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Meldingen"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Berichtmeldingen in statusbalk weergeven"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Trillen"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Ook trillen bij melding"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Beltoon kiezen"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Geluid"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Aantal berichten instellen voor opslaan"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Altijd"</item>
-    <item msgid="6069709696037750627">"Alleen indien stil"</item>
-    <item msgid="7486145357487111435">"Nooit"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Trillen"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Stil"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatisch ophalen"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Berichten automatisch ophalen"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Ophalen tijdens roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Beltoon opgeslagen."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Kan beltoon niet opslaan."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Smiley invoegen"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Groepsdeelnemers"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Actie selecteren"</string>
     <string name="slide_number" msgid="1923958526266726635">"Dia <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Opslaglimieten"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Duur wijzigen"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Diavoorstelling bewerken"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Groepsdeelnemers"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Dia bewerken"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diavoorstelling"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Berichtklasse 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Afbeelding"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-pl/arrays.xml b/res/values-pl/arrays.xml
index 2d6527b..073a15f 100644
--- a/res/values-pl/arrays.xml
+++ b/res/values-pl/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Uśmieszek"</item>
     <item msgid="638612939305162424">"Twarz pokerzysty"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"brak tematu"</item>
+  </string-array>
 </resources>
diff --git a/res/values-pl/strings.xml b/res/values-pl/strings.xml
index 432edfc..88772bb 100644
--- a/res/values-pl/strings.xml
+++ b/res/values-pl/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Wykryto niewystarczające uprawnienia DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopiuj tekst"</string>
     <string name="message_options" msgid="6838806653341967550">"Opcje wiadomości"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opcje pokazu slajdów"</string>
     <string name="done" msgid="7479926268660505871">"Gotowe"</string>
     <string name="move_up" msgid="7307578107431739359">"Przesuń w górę"</string>
     <string name="move_down" msgid="6356509518429479053">"Przesuń w dół"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Usuń"</string>
     <string name="send" msgid="4589898724889248486">"Wyślij"</string>
     <string name="mms" msgid="1587631213714914559">"Wiadomość MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Wyślij MMS-a"</string>
     <string name="all_threads" msgid="2663426830306307194">"Wszystkie wątki"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Wpisz wiadomość"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Otwórz klawiaturę, aby wpisać wiadomość"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Wiadomość nie zawiera poprawnych odbiorców."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Nie można przekazać obiektu DRM umieszczonego w wiadomości."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Trwa konwertowanie na wiadomość multimedialną..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Trwa konwertowanie na wiadomość tekstową..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Nie można dodać więcej slajdów."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Nie można dodać filmu i zdjęcia do jednego slajdu."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Nie można zapisać wiadomości."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Potwierdzaj dostarczenie każdej wysłanej wiadomości"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Usuń stare wiadomości po osiągnięciu limitu"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> wiadomości w wątku"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Użyj MMS-ów, by wysłać jedną wiadomość do wielu odbiorców"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Wiadomości na karcie SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Raporty dostarczenia"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Wiadomości grupowe"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Raporty przeczytania"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Raporty dostarczenia"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Usuń stare wiadomości"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limit wiadomości tekstowych"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limit wiadomości MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Powiadomienia"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Wyświetlaj powiadomienie o wiadomości na pasku stanu"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Wibracje"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Wibracje również przy powiadomieniu"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Wybierz dzwonek"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Dźwięk"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Ustaw liczbę zapisywanych wiadomości"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Zawsze"</item>
-    <item msgid="6069709696037750627">"Tylko po wyciszeniu"</item>
-    <item msgid="7486145357487111435">"Nigdy"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Wibracje"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Wyciszony"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Autoodbieranie"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Odbierz wiadomości automatycznie"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"W roamingu"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Dzwonek został zapisany."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Nie można zapisać dzwonka."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Wstaw emotikon"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grupuj uczestników"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Wybierz czynność"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slajd nr <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limity pamięci"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Zmień czas trwania"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Edytuj pokaz slajdów"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grupowanie uczestników"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Edytuj slajd"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Pokaz slajdów"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Wiadomość klasy 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Obraz"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-pt-rPT/arrays.xml b/res/values-pt-rPT/arrays.xml
index 164cd26..833917f 100644
--- a/res/values-pt-rPT/arrays.xml
+++ b/res/values-pt-rPT/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Sorriso pretensioso"</item>
     <item msgid="638612939305162424">"Inexpressivo"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"sem assunto"</item>
+  </string-array>
 </resources>
diff --git a/res/values-pt-rPT/strings.xml b/res/values-pt-rPT/strings.xml
index 58d3996..b4e872c 100644
--- a/res/values-pt-rPT/strings.xml
+++ b/res/values-pt-rPT/strings.xml
@@ -20,7 +20,7 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="app_label" msgid="1503967887341230795">"Mensag."</string>
+    <string name="app_label" msgid="1503967887341230795">"Mensagens"</string>
     <string name="new_message" msgid="1530369762346003973">"Nova mensagem"</string>
     <string name="menu_call_back" msgid="7538482331117914146">"Ligar a <xliff:g id="NAME">%s</xliff:g>"</string>
     <string name="menu_send_email" msgid="671366308915241664">"Enviar e-mail a <xliff:g id="NAME">%s</xliff:g>"</string>
@@ -33,7 +33,7 @@
     <string name="menu_delete" msgid="1851666911396479006">"Eliminar tópico"</string>
     <string name="menu_view" msgid="7448852683948080108">"Ver tópico"</string>
     <string name="menu_debug_dump" msgid="6855869130206549643">"DEBUG DUMP"</string>
-    <string name="refreshing" msgid="987335057871404222">"A actualizar..."</string>
+    <string name="refreshing" msgid="987335057871404222">"A atualizar..."</string>
     <string name="menu_cell_broadcasts" msgid="5646161375983084660">"Transmissões celulares"</string>
     <string name="has_draft" msgid="2487465595514636160">"Rascunho"</string>
     <string name="no_subject_view" msgid="7795086723069563537">"(Sem assunto)"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Foram detectados direitos de DRM insuficientes."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copiar texto"</string>
     <string name="message_options" msgid="6838806653341967550">"Opções de mensagem"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opções de apresentação de diapositivos"</string>
     <string name="done" msgid="7479926268660505871">"Concluído"</string>
     <string name="move_up" msgid="7307578107431739359">"Mover para cima"</string>
     <string name="move_down" msgid="6356509518429479053">"Mover para baixo"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Remover"</string>
     <string name="send" msgid="4589898724889248486">"Enviar"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Enviar MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Todos os tópicos"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Escrever mensagem"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Abrir teclado para escrever mensagem"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"A mensagem não tem destinatários válidos."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Não é possível encaminhar o objeto de DRM incluído na mensagem."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"A converter para mensagem multimédia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"A converter para mensagem de texto..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Não é possível adicionar mais diapositivos."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Não é possível adicionar vídeo e imagem a um diapositivo."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Não é possível guardar a mensagem."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Pedir um relatório de entrega para cada mensagem enviada"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Eliminar mensagens antigas quando os limites são atingidos"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> mensagens por conversa"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utilizar MMS para enviar uma única mensagem quando houver vários destinatários"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gerir as mensagens do cartão SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Relatórios de entrega"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Mensagens de grupo"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Relatórios de leitura"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Relatórios de entrega"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Eliminar mens. antigas"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limite de mensagens de texto"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limite mens. multimédia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificações"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Apresentar notificações de mensagem na barra de estado"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrar também quando notificado"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Escolher toque"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Som"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Definir o número de mensagens a guardar"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Sempre"</item>
-    <item msgid="6069709696037750627">"Apenas quando está em silêncio"</item>
-    <item msgid="7486145357487111435">"Nunca"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrar"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silencioso"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Retoma automática"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Retomar mensagens automaticamente"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Recuper. em roaming"</string>
@@ -210,7 +206,7 @@
     <string name="from_label" msgid="2055117571548171397">"De: "</string>
     <string name="to_address_label" msgid="5837363600471845801">"Para: "</string>
     <string name="bcc_label" msgid="530867161453958774">"Bcc: "</string>
-    <string name="sent_label" msgid="2722190650145251584">"Enviada: "</string>
+    <string name="sent_label" msgid="2722190650145251584">"Enviadas: "</string>
     <string name="received_label" msgid="8618029024731693906">"Recebida: "</string>
     <string name="saved_label" msgid="4183160415593488207">"Guardada: "</string>
     <string name="subject_label" msgid="8721241914144101631">"Assunto: "</string>
@@ -288,6 +284,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Toque guardado."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Não foi possível guardar o toque."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Inserir sorriso"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Participantes do grupo"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Escolher ação"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapositivo <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -299,6 +296,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limites de armazenamento"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Alterar a duração"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Editar apresentação de diapositivos"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Participantes do grupo"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Editar diapositivo"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Apresentação de diapositivos"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mensagem de classe 0"</string>
@@ -345,4 +343,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imagem"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-pt/arrays.xml b/res/values-pt/arrays.xml
index ac391ca..86ab377 100644
--- a/res/values-pt/arrays.xml
+++ b/res/values-pt/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Sorriso forçado"</item>
     <item msgid="638612939305162424">"Indiferente"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"sem assunto"</item>
+  </string-array>
 </resources>
diff --git a/res/values-pt/strings.xml b/res/values-pt/strings.xml
index 3ed01e6..28c8242 100644
--- a/res/values-pt/strings.xml
+++ b/res/values-pt/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Direitos DRM insuficientes detectados."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copiar texto"</string>
     <string name="message_options" msgid="6838806653341967550">"Opções de mensagem"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opções de apresentação de slides"</string>
     <string name="done" msgid="7479926268660505871">"Concluído"</string>
     <string name="move_up" msgid="7307578107431739359">"Mover para cima"</string>
     <string name="move_down" msgid="6356509518429479053">"Mover para baixo"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Remover"</string>
     <string name="send" msgid="4589898724889248486">"Enviar"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Enviar MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Todas as conversas"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Digite a mensagem"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Abra o teclado para digitar a mensagem"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"A sua mensagem não tem destinatários válidos."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"O objeto DRM incluído na mensagem não pode ser encaminhado."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Convertendo em mensagem multimídia…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Convertendo em mensagem de texto…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Não é possível adicionar mais slides."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Não é possível adicionar vídeo e foto a um slide."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Não é possível salvar a mensagem."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Solicita um relatório de entrega para cada mensagem enviada"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Excluir antigas à medida que os limites forem atingidos"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> mensagens por conversa"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Usar MMS para enviar uma única mensagem para vários destinatários"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gerenciar mensagens SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Relatórios de entrega"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Mensagens em grupo"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Relatórios de leitura"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Relatórios de entrega"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Excluir antigas"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limite de mensagens de texto"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limite de mens. multimídia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificações"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Exibe notificações de mensagem na barra de status"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Também vibra quando notificado"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Escolher toque"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Som"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Definir número de mensagens a serem salvas"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Sempre"</item>
-    <item msgid="6069709696037750627">"Apenas quando estiver no silencioso"</item>
-    <item msgid="7486145357487111435">"Nunca"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrar"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silencioso"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Recuperação automática"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Recupera mensagens automaticamente"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Recuper. em roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Toque salvo"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Não foi possível salvar o toque."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Inserir smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Participantes do grupo"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Selecionar ação"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slide <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limites de armazenamento"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Alterar duração"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Editar apresentação de slides"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Participantes do grupo"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Editar slide"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Apresentação de slides"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mensagem classe 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imagem"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-rm/strings.xml b/res/values-rm/strings.xml
index bc72401..b59ee8d 100644
--- a/res/values-rm/strings.xml
+++ b/res/values-rm/strings.xml
@@ -65,6 +65,8 @@
     <!-- no translation found for copy_message_text (4296252229544252834) -->
     <skip />
     <string name="message_options" msgid="6838806653341967550">"Opziuns dal messadi"</string>
+    <!-- no translation found for slideshow_options (3501759384739796431) -->
+    <skip />
     <string name="done" msgid="7479926268660505871">"Finì"</string>
     <string name="move_up" msgid="7307578107431739359">"Spustar ensi"</string>
     <string name="move_down" msgid="6356509518429479053">"Spustar engiu"</string>
@@ -91,6 +93,8 @@
     <string name="remove" msgid="4625444913256213175">"Allontanar"</string>
     <string name="send" msgid="4589898724889248486">"Trametter"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <!-- no translation found for send_mms (2933162044872550662) -->
+    <skip />
     <string name="all_threads" msgid="2663426830306307194">"Tut ils fils da discussiun"</string>
     <!-- no translation found for type_to_compose_text_enter_to_send (3539985471008581265) -->
     <skip />
@@ -127,7 +131,6 @@
     <!-- no translation found for cannot_forward_drm_obj (5047623751430559077) -->
     <skip />
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Conversiun en messadi multimedia…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Conversiun en in messadi SMS en process…"</string>
     <!-- no translation found for cannot_add_slide_anymore (4631404749618820994) -->
     <skip />
     <!-- no translation found for cannot_add_picture_and_video (4954353772391381447) -->
@@ -187,26 +190,24 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Dumandar ina conferma da retschavida per mintga messadi tramess"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Stizzar il messadis vegls sche las suandantas limitas èn cuntanschidas"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> messadis per conversaziun"</string>
+    <!-- no translation found for pref_summary_mms_group_mms (2266928687440696745) -->
+    <skip />
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Administrar ils messadis sin la carta SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Confermas da retschavida"</string>
+    <!-- no translation found for pref_title_mms_group_mms (1251698526583908432) -->
+    <skip />
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Confermas da lectura"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Rapports da spediziun"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Stizzar messadis vegls"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limita dad SMS"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limita per ils MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Avis"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Mussar in avis en la trav da status en cas da l\'entrada da novs messadis"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrar"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Era vibrar cun ils avis"</string>
-    <!-- no translation found for pref_title_notification_ringtone (5467265237106229952) -->
+    <!-- no translation found for pref_title_notification_ringtone (8667533917574559659) -->
     <skip />
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Definir il dumber da messadis per memorisar"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Adina"</item>
-    <item msgid="6069709696037750627">"Mo sche silenzius"</item>
-    <item msgid="7486145357487111435">"Mai"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrar"</string>
+    <!-- no translation found for silent_ringtone (7981237991326592780) -->
+    <skip />
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Retschaiver automaticamain"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Retschaiver automaticamain ils messadis"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Retschaiver autom. cun roaming"</string>
@@ -338,6 +339,8 @@
     <!-- no translation found for saved_ringtone_fail (4778500070919251116) -->
     <skip />
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Inserir in emoticon"</string>
+    <!-- no translation found for menu_group_participants (4288356090262299071) -->
+    <skip />
     <!-- no translation found for select_link_title (3371818607625768447) -->
     <skip />
     <string name="slide_number" msgid="1923958526266726635">"Dia <xliff:g id="NUMBER">%s</xliff:g>"</string>
@@ -350,6 +353,8 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limitas da memorisaziun"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Midar la durada"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Modifitgar la preschentaziun da dia"</string>
+    <!-- no translation found for recipient_list_activity (1254938236543727019) -->
+    <skip />
     <string name="edit_slide_activity" msgid="8752829671778696983">"Modifitgar il dia"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Preschentaziun da dia"</string>
     <!-- no translation found for class_0_message_activity (6631339964159861048) -->
@@ -411,4 +416,6 @@
     <skip />
     <!-- no translation found for enumeration_comma (213598026698964628) -->
     <skip />
+    <!-- no translation found for message_timestamp_format (4188999027493614617) -->
+    <skip />
 </resources>
diff --git a/res/values-ro/arrays.xml b/res/values-ro/arrays.xml
index c0a53a4..e85b079 100644
--- a/res/values-ro/arrays.xml
+++ b/res/values-ro/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Rânjet"</item>
     <item msgid="638612939305162424">"Faţă de poker"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"fără subiect"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ro/strings.xml b/res/values-ro/strings.xml
index 1ec0d65..c4e8a81 100644
--- a/res/values-ro/strings.xml
+++ b/res/values-ro/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Drepturile DRM detectate sunt insuficiente."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Copiaţi textul"</string>
     <string name="message_options" msgid="6838806653341967550">"Opţiuni mesaj"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Opţiuni slideshow"</string>
     <string name="done" msgid="7479926268660505871">"Terminat"</string>
     <string name="move_up" msgid="7307578107431739359">"Mutaţi în sus"</string>
     <string name="move_down" msgid="6356509518429479053">"Mutaţi în jos"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Eliminaţi"</string>
     <string name="send" msgid="4589898724889248486">"Trimiteţi"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Trimiteţi un MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Toate firele de conversaţie"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Introduceţi mesajul"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Deschideţi tastatura pentru a introduce mesajul"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Mesajul dvs. nu are un destinatar valid."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Obiectul DRM inclus în mesaj nu poate fi redirecţionat."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Se face conversia la mesaj multimedia..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Se face conversia la mesaj text..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Nu se pot adăuga mai multe slide-uri."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Videoclipul şi fotografia nu pot fi adăugate pe acelaşi slide."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Mesajul nu poate fi salvat."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Solicitaţi un raport de expediere pentru fiecare mesaj trimis"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Ştergeţi mesajele vechi când se atinge limita"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> (de) mesaje pe conversaţie"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Utilizaţi serviciul MMS pentru a trimite un singur mesaj, atunci când există mai mulţi destinatari"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Gestionaţi mesajele de pe cardul SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Rapoarte de expediere"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Mesagerie de grup"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Citiţi rapoartele"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Rapoarte de expediere"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Ştergeţi mesajele vechi"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limita mesajului text"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limita pentru mesajele multimedia"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Notificări"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Afişaţi notificări de mesaje în bara de stare"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrare"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrare şi la notificări"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Alegeţi un ton de sonerie"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sunet"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Setaţi numărul de mesaje pentru salvare"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Întotdeauna"</item>
-    <item msgid="6069709696037750627">"Numai când profilul este Silenţios"</item>
-    <item msgid="7486145357487111435">"Niciodată"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrare"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Silențios"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Preluare automată"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Primiţi automat mesajele"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Preluare automată a mesajelor când este activat serviciul de roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ton de apel salvat."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Tonul de sonerie nu a putut fi salvat."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Inseraţi un emoticon"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grupaţi participanţii"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Alegeţi o acţiune"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapozitiv <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Limite de stocare"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Modificaţi durata"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Modificaţi prezentarea"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grupaţi participanţii"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Modificaţi diapozitivul"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Prezentare"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Mesaje clasa 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Imagine"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-ru/arrays.xml b/res/values-ru/arrays.xml
index f87cc03..183ecc5 100644
--- a/res/values-ru/arrays.xml
+++ b/res/values-ru/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Ухмылка"</item>
     <item msgid="638612939305162424">"Невозмутимость"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"без темы"</item>
+  </string-array>
 </resources>
diff --git a/res/values-ru/strings.xml b/res/values-ru/strings.xml
index d230622..f79f514 100644
--- a/res/values-ru/strings.xml
+++ b/res/values-ru/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Обнаруженных прав DRM недостаточно."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Скопировать текст"</string>
     <string name="message_options" msgid="6838806653341967550">"Параметры сообщения"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Настройки слайд-шоу"</string>
     <string name="done" msgid="7479926268660505871">"Готово"</string>
     <string name="move_up" msgid="7307578107431739359">"Переместить вверх"</string>
     <string name="move_down" msgid="6356509518429479053">"Переместить вниз"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Удалить"</string>
     <string name="send" msgid="4589898724889248486">"Отправить"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Отправить MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Все цепочки"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Введите сообщение"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Откройте клавиатуру, чтобы ввести сообщение"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Не указано ни одного реального получателя."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Нельзя переслать DRM-объект из этого сообщения."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Преобразование в сообщение MMS..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Преобразование в сообщение SMS..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Добавлено максимальное число слайдов."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Нельзя добавить на слайд и картинку, и видео."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Не удалось сохранить сообщение."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Запрашивать отчет о доставке для всех отправляемых сообщений"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Удалять старые сообщения по достижении макс. количества"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Сообщений в цепочке: <xliff:g id="COUNT">%1$s</xliff:g>"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Для отправки одного сообщения нескольким получателям используйте MMS"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Сообщения на SIM-карте"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Отчеты о доставке"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Групповые сообщения"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Отчеты о прочтении"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Отчеты о доставке"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Удалять старые"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Макс. количество SMS"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Макс. количество MMS"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Уведомления"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Отображать уведомления о сообщениях в строке состояния"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Вибросигнал"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Вибросигнал при получении уведомления"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Выбрать рингтон"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Рингтон"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Установить макс. кол-во сообщений в цепочке для хранения"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Всегда"</item>
-    <item msgid="6069709696037750627">"Только в режиме без звука"</item>
-    <item msgid="7486145357487111435">"Никогда"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Вибросигнал"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Без звука"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Автозагрузка"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Автоматически загружать MMS-сообщения"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Автозагрузка в роуминге"</string>
@@ -228,7 +224,7 @@
     <string name="sim_copy_to_phone_memory" product="tablet" msgid="3721000641648594602">"Копировать в память планшетного ПК"</string>
     <string name="sim_copy_to_phone_memory" product="default" msgid="5895767417844881971">"Копировать в память телефона"</string>
     <string name="sim_delete" msgid="610790510655316922">"Удалить"</string>
-    <string name="sim_manage_messages_title" msgid="3989147182100584333">"Текстовые сообщения на SIM-карте"</string>
+    <string name="sim_manage_messages_title" msgid="3989147182100584333">"SMS на SIM-карте"</string>
     <string name="sim_view" msgid="1997173541766393706">"Просмотр"</string>
     <string name="sim_empty" msgid="2356766833071636297">"На SIM-карте нет сообщений."</string>
     <string name="delivery_header_title" msgid="5361719578869045764">"Отчет"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Рингтон сохранен."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Рингтон не сохранен."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Вставить смайлик"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Группировать"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Выбор действия"</string>
     <string name="slide_number" msgid="1923958526266726635">"Слайд <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,10 +294,11 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Пределы хранилища"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Изменить продолжительность"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Изменить слайд-шоу"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Группы получателей"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Изменить слайд"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Слайд-шоу"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Сообщение класса 0"</string>
-    <string name="search_label" msgid="6042598929386174964">"Сообщения"</string>
+    <string name="search_label" msgid="6042598929386174964">"SMS/MMS"</string>
     <string name="search_hint" msgid="7273727663577472044">"Поиск сообщений"</string>
     <string name="search" msgid="7560238620274735199">"SMS/MMS"</string>
     <string name="search_setting_description" msgid="4104004595086437572">"Текст в сообщениях"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Картинка"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-sk/arrays.xml b/res/values-sk/arrays.xml
index 41a218d..39e7f1d 100644
--- a/res/values-sk/arrays.xml
+++ b/res/values-sk/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Úškľabok"</item>
     <item msgid="638612939305162424">"Kamenná tvár"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"bez predmetu"</item>
+  </string-array>
 </resources>
diff --git a/res/values-sk/strings.xml b/res/values-sk/strings.xml
index 490dfab..b9c8fca 100644
--- a/res/values-sk/strings.xml
+++ b/res/values-sk/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Nemáte dostatočné práva DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopírovať text"</string>
     <string name="message_options" msgid="6838806653341967550">"Možnosti správy"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Možnosti prezentácie"</string>
     <string name="done" msgid="7479926268660505871">"Hotovo"</string>
     <string name="move_up" msgid="7307578107431739359">"Posunúť nahor"</string>
     <string name="move_down" msgid="6356509518429479053">"Posunúť nadol"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Odstrániť"</string>
     <string name="send" msgid="4589898724889248486">"Odoslať"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Odoslať MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Všetky konverzácie"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Napíšte správu"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Ak chcete napísať správu, otvorte klávesnicu"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Správa nemá žiadnych platných príjemcov."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Objekt DRM obsiahnutý v správe nie je možné poslať ďalej."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Prebieha prevádzanie na multimediálnu správu..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Prebieha prevádzanie na textovú správu..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Ďalšie snímky nie je možné pridať."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Na jednu snímku nie je možné pridať video aj obrázok."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Správu nie je možné uložiť."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Pri každej odoslanej správe požadovať potvrdenie o doručení"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Pri dosiahnutí limitu odstrániť staré správy"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Počet správ v konverzácii: <xliff:g id="COUNT">%1$s</xliff:g>"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Použiť MMS na odoslanie jednej správy, ak má niekoľko príjemcov"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Správa správ na karte SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Potvrdenia o doručení"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Skupinové správy"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Potvrdenia o prečítaní"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Potvrdenia o doručení"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Odstrániť staré správy"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limit textových správ"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limit multimediálnych správ"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Upozornenia"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Zobraziť oznámenia o správe v stavovom riadku"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrovať"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Pri oznámení tiež vibrovať"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Zvoliť tón zvonenia"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Zvuk"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Nastaviť počet ukladaných správ"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Vždy"</item>
-    <item msgid="6069709696037750627">"Iba v tichom režime"</item>
-    <item msgid="7486145357487111435">"Nikdy"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrovať"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Tichý"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Automatické načítanie"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Automaticky načítať správy"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Automatické načítanie pri roamingu"</string>
@@ -282,10 +278,11 @@
     <string name="copy_to_sdcard" msgid="757028609638184856">"Uložiť prílohu"</string>
     <string name="copy_to_sdcard_success" msgid="7948625615155992014">"Príloha bola uložená."</string>
     <string name="copy_to_sdcard_fail" msgid="4944606369631916737">"Prílohu sa nepodarilo uložiť."</string>
-    <string name="save_ringtone" msgid="2310157075045201051">"Uložiť ako vyzváňací tón"</string>
+    <string name="save_ringtone" msgid="2310157075045201051">"Uložiť ako tón zvonenia"</string>
     <string name="saved_ringtone" msgid="3847363932276708626">"Tón zvonenia bol uložený."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Tón zvonenia sa nepodarilo uložiť."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Vložiť smajlík"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Účastníci skupiny"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Vybrať akciu"</string>
     <string name="slide_number" msgid="1923958526266726635">"Snímka <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Obmedzenia ukladacieho priestoru"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Zmeniť trvanie"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Upraviť prezentáciu"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Účastníci skupiny"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Upraviť snímku"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Prezentácia"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Správa triedy 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Obrázok"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-sl/arrays.xml b/res/values-sl/arrays.xml
index 277e857..646994a 100644
--- a/res/values-sl/arrays.xml
+++ b/res/values-sl/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Domišljav nasmeh"</item>
     <item msgid="638612939305162424">"Brezizrazen obraz"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"brez zadeve"</item>
+  </string-array>
 </resources>
diff --git a/res/values-sl/strings.xml b/res/values-sl/strings.xml
index 70bd9a1..d99b9fa 100644
--- a/res/values-sl/strings.xml
+++ b/res/values-sl/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Zaznane nezadostne pravice za upravljanje digitalnih pravic."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopiraj besedilo"</string>
     <string name="message_options" msgid="6838806653341967550">"Možnosti sporočila"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Možnosti diaprojekcije"</string>
     <string name="done" msgid="7479926268660505871">"Dokončano"</string>
     <string name="move_up" msgid="7307578107431739359">"Premakni navzgor"</string>
     <string name="move_down" msgid="6356509518429479053">"Premakni navzdol"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Odstrani"</string>
     <string name="send" msgid="4589898724889248486">"Pošlji"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Pošlji MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Vse niti"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Vnesite sporočilo"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Odprite tipkovnico za vnos sporočila"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Sporočilo nima veljavnih prejemnikov."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Predmeta DRM, vključenega v sporočilo, ni mogoče posredovati."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Pretvarjanje v večpredstavno sporočilo ..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Pretvarjanje v besedilno sporočilo ..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Ni mogoče dodati več diapozitivov."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Videoposnetka in slike ni mogoče dodati v en diapozitiv."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Sporočila ni mogoče shraniti."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Zahtevaj poročilo o dostavi za vsako poslano sporočilo"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Izbriši stara sporočila, ko so dosežene omejitve"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> sporočil na pogovor"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Če želite eno sporočilo poslati več prejemnikom, uporabite MMS"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Upravljanje sporočil na kartici SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Poročila o dostavi"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Skupinsko pošiljanje sporočil"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Preberi poročila"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Poročila o dostavi"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Izbriši stara sporočila"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Omejitev besedilnega sporočila"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Omejitev večpredstavnega sporočila"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Obvestila"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Prikaži obvestila o sporočilih v vrstici stanja"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibriranje"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibriraj tudi pri obvestilu"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Izberite melodijo zvonjenja"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Zvok"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Nastavi število sporočil za shranjevanje"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Vedno"</item>
-    <item msgid="6069709696037750627">"Samo v tihem načinu"</item>
-    <item msgid="7486145357487111435">"Nikoli"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibriranje"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Tiho"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Samodejni prenos"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Samodejni prenos sporočil"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Samodejna pridobitev med gostovanjem"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Melodija zvonjenja je shranjena."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Melodije zvonjenja ni mogoče shraniti."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Vstavi čustveni simbol"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Udeleženci skupine"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Izberite dejanje"</string>
     <string name="slide_number" msgid="1923958526266726635">"Diapozitiv <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Omejitve prostora za shranjevanje"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Spremeni trajanje"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Uredi diaprojekcijo"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Udeleženci skupine"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Uredi diapozitiv"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Diaprojekcija"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Sporočilo razreda 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Slika"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-sr/arrays.xml b/res/values-sr/arrays.xml
index 0a9f7e8..7f1543c 100644
--- a/res/values-sr/arrays.xml
+++ b/res/values-sr/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Усиљен осмех"</item>
     <item msgid="638612939305162424">"Покерашко лице"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"без наслова"</item>
+  </string-array>
 </resources>
diff --git a/res/values-sr/strings.xml b/res/values-sr/strings.xml
index aff3f87..711ceab 100644
--- a/res/values-sr/strings.xml
+++ b/res/values-sr/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Открили смо да немате довољна DRM права."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Копирај текст"</string>
     <string name="message_options" msgid="6838806653341967550">"Опције поруке"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Опције пројекције слајдова"</string>
     <string name="done" msgid="7479926268660505871">"Готово"</string>
     <string name="move_up" msgid="7307578107431739359">"Премести нагоре"</string>
     <string name="move_down" msgid="6356509518429479053">"Премести надоле"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Уклони"</string>
     <string name="send" msgid="4589898724889248486">"Пошаљи"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Пошаљи MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Све преписке"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Откуцајте поруку"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Активирајте тастатуру да бисте откуцали поруку"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Порука нема важеће примаоце."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Није могуће проследити DRM објекат увршћен у поруку."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Конвертовање у мултимедијалну поруку…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Конвертовање у текстуалну поруку…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Није могуће додати још слајдова."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Није могуће додати видео и слику на исти слајд."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Није могуће сачувати поруку."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Захтевај извештај о испоруци за сваку послату поруку"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Избриши старе поруке када се достигне ограничење"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> поруке(а) по преписци"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Користите MMS за слање једне поруке када постоји више прималаца"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Управљање порукама на SIM картици"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Извештаји о испоруци"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Групна размена порука"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Читање извештаја"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Извештаји о испоруци"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Избриши старе поруке"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Ограничење за текстуалну поруку"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Ограничење за мултимедијалну поруку"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Обавештења"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Прикажи обавештења о порукама у статусној траци"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Вибрација"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Такође укључи вибрацију када добијем обавештење"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Изабери мелодију звона"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Звук"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Подеси број порука за чување"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Увек"</item>
-    <item msgid="6069709696037750627">"Само у нечујном режиму"</item>
-    <item msgid="7486145357487111435">"Никад"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Вибрација"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Нечујно"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Аутоматско преузимање"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Аутоматско преузимање порука"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Аутоматско преузимање у ромингу"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Мелодија звона је сачувана."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Није могуће сачувати мелодију звона."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Уметни смајли"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Групиши учеснике"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Избор радње"</string>
     <string name="slide_number" msgid="1923958526266726635">"Слајд <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Ограничење за складиштење"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Промена трајања"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Измена пројекције слајдова"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Груписање учесника"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Измена слајда"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Пројекција слајдова"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Порука класе 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Слика"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-sv/arrays.xml b/res/values-sv/arrays.xml
index 20fbc6e..e01371a 100644
--- a/res/values-sv/arrays.xml
+++ b/res/values-sv/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Flinar"</item>
     <item msgid="638612939305162424">"Pokeransikte"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"inget ämne"</item>
+  </string-array>
 </resources>
diff --git a/res/values-sv/strings.xml b/res/values-sv/strings.xml
index d704a40..e974e99 100644
--- a/res/values-sv/strings.xml
+++ b/res/values-sv/strings.xml
@@ -20,7 +20,7 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="app_label" msgid="1503967887341230795">"Medd."</string>
+    <string name="app_label" msgid="1503967887341230795">"Meddelanden"</string>
     <string name="new_message" msgid="1530369762346003973">"Nytt meddelande"</string>
     <string name="menu_call_back" msgid="7538482331117914146">"Ring <xliff:g id="NAME">%s</xliff:g>"</string>
     <string name="menu_send_email" msgid="671366308915241664">"Skicka e-post till <xliff:g id="NAME">%s</xliff:g>"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Otillräckliga DRM-rättigheter upptäcktes."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopiera text"</string>
     <string name="message_options" msgid="6838806653341967550">"Meddelandealternativ"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Alternativ för bildspel"</string>
     <string name="done" msgid="7479926268660505871">"Färdig"</string>
     <string name="move_up" msgid="7307578107431739359">"Flytta upp"</string>
     <string name="move_down" msgid="6356509518429479053">"Flytta ned"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Ta bort"</string>
     <string name="send" msgid="4589898724889248486">"Skicka"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Skicka MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Alla trådar"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Skriv ett meddelande"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Öppna tangentbordet och skriv ett meddelande"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Du har inte angett några giltiga mottagare för meddelandet."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Det går inte att vidarebefordra DRM-objektet som ingår i meddelandet."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Konverterar till MMS …"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Konverterar till SMS …"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Det går inte att lägga till fler bilder."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Det går inte att lägga till video och foto på samma bild."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Det går inte att spara meddelandet."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Begär en leveransrapport för varje meddelande du skickar"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Ta bort gamla meddelanden när gränsen uppnås"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> meddelanden per konversation"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Använd MMS för att skicka ett meddelande när det finns flera mottagare"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Hantera medd. på SIM-kortet"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Leveransrapporter"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Gruppmeddelanden"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Läsrapporter"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Leveransrapporter"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Ta bort gamla meddelanden"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"SMS-begränsning"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"MMS-begränsning"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Aviseringar"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Visa meddelandeaviseringar i statusfältet"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Vibrera"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Vibrera även vid aviseringar"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Välj ringsignal"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Ljud"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Ange hur många meddelanden som ska sparas"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Alltid"</item>
-    <item msgid="6069709696037750627">"Bara vid tyst"</item>
-    <item msgid="7486145357487111435">"Aldrig"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Vibrera"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Tyst"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Autohämtning"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Hämta meddelanden automatiskt"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Autohämtning vid roaming"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Ringsignalen sparades."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Det gick inte att spara ringsignalen."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Infoga känsloikon"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Gruppdeltagare"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Välj åtgärd"</string>
     <string name="slide_number" msgid="1923958526266726635">"Bild <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Lagringsgränser"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Ändra varaktighet"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Redigera bildspel"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Gruppdeltagare"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Redigera bild"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Bildspel"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Meddelande, klass 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Bild"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-sw/arrays.xml b/res/values-sw/arrays.xml
index a595bd3..0b0145e 100644
--- a/res/values-sw/arrays.xml
+++ b/res/values-sw/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Tabasamu"</item>
     <item msgid="638612939305162424">"Uso-kamari"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"hakuna kichwa"</item>
+  </string-array>
 </resources>
diff --git a/res/values-sw/strings.xml b/res/values-sw/strings.xml
index d111e04..aa8005e 100644
--- a/res/values-sw/strings.xml
+++ b/res/values-sw/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Haki za DRM zizizotosha zimegunduliwa."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Nakili maandishi"</string>
     <string name="message_options" msgid="6838806653341967550">"Chaguo za ujumbe"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Chaguo za onyesho la slaidi"</string>
     <string name="done" msgid="7479926268660505871">"Kwisha"</string>
     <string name="move_up" msgid="7307578107431739359">"Sogea juu"</string>
     <string name="move_down" msgid="6356509518429479053">"Sogeza chini"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Ondoa"</string>
     <string name="send" msgid="4589898724889248486">"Tuma"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Tuma MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Hesi zote za parafujo"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Andika ujumbe"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Fungua kibodi ili kucharaza ujumbe"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Ujumbe wako hauna wapokezi halali"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Kipengee cha DRM kilichojumuishwa katika ujumbe hakiwezi kusambazwa."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Inageuza kwa ujumbe wa media anuwai..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Inageuza kwa ujumbe wa maandishi..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Haiwezi kuongeza slaidi zaidi"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Haiwezi kuongeza video na picha kwenye slaidi moja."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Haiwezi kuhifadhi ujumbe."</string>
@@ -152,8 +153,8 @@
     <string name="preferences_title" msgid="6650089610332670157">"Mipangilio"</string>
     <string name="restore_default" msgid="7165341506551155053">"Rejesha mipangilio ya chaguo-msingi"</string>
     <string name="pref_notification_settings_title" msgid="6420782563630369776">"Arifa"</string>
-    <string name="pref_mms_settings_title" msgid="55618772118264355">"Jumbe za midia-anuai (MMS)"</string>
-    <string name="pref_sms_settings_title" msgid="5173078369851066881">"Jumbe fupi (SMS)"</string>
+    <string name="pref_mms_settings_title" msgid="55618772118264355">"MMS"</string>
+    <string name="pref_sms_settings_title" msgid="5173078369851066881">"SMS"</string>
     <string name="pref_sms_storage_title" msgid="9001233319190616445">"Hifadhi"</string>
     <string name="pref_summary_manage_sim_messages" msgid="4141349892597640864">"Dhibiti ujumbe uliohifadhiwa kwenye kadi yako ya SIM"</string>
     <string name="pref_summary_mms_delivery_reports" msgid="4874657984217756112">"Omba ripoti ya kutuma kwa kila ujumbe unaotuma"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Omba ripoti ya kutuma kwa kila ujumbe unaotuma"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Futa ujumbe wa zamani kwa kuwa mipaka imefikiwa"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Ujumbe <xliff:g id="COUNT">%1$s</xliff:g> kwa kila gumzo"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Tumia MMS kutuma ujumbe mmoja wakati kuna wapokeaji anuwai"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Dhibiti ujumbe wa SIM kadi"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Ripoti za kupeleka"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Utumaji ujumbe kwa kikundi"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Soma ripoti"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Ripoti za kupeleka"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Futa ujumbe wa zamani"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Mpaka wa ujumbe wa maandishi"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Kikomo cha ujumbe wa media"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Arifa"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Onyesha arifa za ujumbe kwenye mwambaa hali"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Tetema"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Pia tikisa unapoarifiwa"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Chagua mlio wa simu"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Sauti"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Weka nambari ya ujumbe wa kuhifadhi"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Kila wakati"</item>
-    <item msgid="6069709696037750627">"Kukiwa kimya tu"</item>
-    <item msgid="7486145357487111435">"Katu"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Tetema"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Kimya"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Epua kiotomatiki"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Epua kiotomatiki ujumbe"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Kurejesha kiotomatiki urandaji"</string>
@@ -194,7 +190,7 @@
     <string name="confirm_delete_all_conversations" msgid="9036166685235092757">"Tungo zote zitafutwa."</string>
     <string name="confirm_delete_message" msgid="9121480656609809591">"Video itafutwa."</string>
     <string name="confirm_delete_locked_message" msgid="7203411948190100955">"Futa ujumbe huu uliofungwa?"</string>
-    <string name="confirm_delete_all_SIM_messages" msgid="8693652297557966665">"Jumbe zote kwenye sim kadi zitafutwa."</string>
+    <string name="confirm_delete_all_SIM_messages" msgid="8693652297557966665">"Ujumbe wowote ulio kwenye SIM kadi utafutwa."</string>
     <string name="confirm_delete_SIM_message" msgid="8535128079045452425">"Ujumbe ulio kwenye SIM kadi utafutwa."</string>
     <string name="delete_unlocked" msgid="7545321606698162261">"Futa ujumbe uliofungwa"</string>
     <string name="delete" msgid="1409973060081564612">"Futa"</string>
@@ -230,7 +226,7 @@
     <string name="sim_delete" msgid="610790510655316922">"Futa"</string>
     <string name="sim_manage_messages_title" msgid="3989147182100584333">"Ujumbe wa maandishi kwenye SIM kadi"</string>
     <string name="sim_view" msgid="1997173541766393706">"Ona"</string>
-    <string name="sim_empty" msgid="2356766833071636297">"Hakuna  jumbe kwenye \'SIM kadi\'."</string>
+    <string name="sim_empty" msgid="2356766833071636297">"Hakuna ujumbe wowote kwenye SIM kadi."</string>
     <string name="delivery_header_title" msgid="5361719578869045764">"Ripoti"</string>
     <string name="status_none" msgid="8253075950774894961">"(Hamna)"</string>
     <string name="status_pending" msgid="2739860824607984892">"Inasubiri"</string>
@@ -256,7 +252,7 @@
     <skip />
     <string name="notification_multiple" msgid="7684007285202109490">"Ujumbe <xliff:g id="COUNT">%s</xliff:g>usiosomwa"</string>
     <string name="notification_multiple_title" msgid="332602028959557541">"Ujumbe mpya wa"</string>
-    <string name="notification_failed_multiple" msgid="6192531993698497229">"Jumbe <xliff:g id="COUNT">%s</xliff:g>  hazikutumwa"</string>
+    <string name="notification_failed_multiple" msgid="6192531993698497229">"MMS <xliff:g id="COUNT">%s</xliff:g> hazikutumwa"</string>
     <string name="notification_failed_multiple_title" msgid="1112032024904397126">"Ujumbe haujatumwa"</string>
     <string name="sim_full_title" msgid="1809829051697702810">"Kadi ya SIM imejaa"</string>
     <string name="sim_full_body" msgid="6241664980790322925">"Futa ujumbe mwingine ili kuweka nafasi ya zaidi."</string>
@@ -288,6 +284,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Mlio wa simu umehifadhiwa."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Haikuweza kuhifadhi mlio wa simu."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Ingiza kicheshi"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Washiriki wa kikundi"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Chagua kitendo"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slaidi <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -299,6 +296,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Mipaka ya hifadhi"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Badilisha muda"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Hariri onyesho la slaidi"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Washiriki wa kikundi"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Hariri slaidi"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Onyesho la slaidi"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Ujumbe wa tabaka 0"</string>
@@ -318,19 +316,19 @@
     <string name="pref_mms_clear_search_history_summary" msgid="7960005384066460035">"Futa utafutaji wa awali wa ujumbe ili usionekane katika kisanduku cha Kutafuta"</string>
     <string name="save" msgid="6847069284991531310">"Hifadhi"</string>
     <string name="storage_limits_title" msgid="7074684882530693016">"Dhibiti ujumbe"</string>
-    <string name="storage_limits_message" msgid="2010501485394745696">"Weka kikomo kwa idadi ya jumbe unazohifadhi kwa kila mazungumzo?"</string>
+    <string name="storage_limits_message" msgid="2010501485394745696">"Weka kikomo cha idadi ya mazungumzo unayohifadhi kwa kila mazungumzo?"</string>
     <string name="storage_limits_setting" msgid="4952781049308537373">"Weka vikomo"</string>
     <string name="storage_limits_setting_dismiss" msgid="1433841310158458034">"Hakuna vikomo"</string>
-    <string name="too_many_unsent_mms" msgid="4436493698891224126">"Haiwezi kutuma ujumbe sasa hivi. Jumbe nyingi za midia-anuai hazijatumwa."</string>
+    <string name="too_many_unsent_mms" msgid="4436493698891224126">"Haiwezi kutuma ujumbe sasa hivi. MMS nyingi ambazo hazijatumwa."</string>
     <string name="sending_message" msgid="2054406576361149715">"INATUMA..."</string>
     <string name="pick_too_many_recipients" msgid="650087588867628044">"Wapokeaji wengi mno"</string>
     <string name="adding_recipients" msgid="2962810172527532357">"Inaongeza wapokeaji..."</string>
     <string name="draft_separator" msgid="5402575086540243019">", "</string>
     <string name="message_count_format" msgid="4434763220590778012">" <xliff:g id="NUMBER">%1$s</xliff:g>"</string>
-    <string name="message_count_notification" msgid="3629968600032690007">"Jumbe <xliff:g id="NUMBER">%1$s</xliff:g> mpya"</string>
+    <string name="message_count_notification" msgid="3629968600032690007">"Mawasiliano <xliff:g id="NUMBER">%1$s</xliff:g> mapya"</string>
   <plurals name="message_count_notification_overflow">
     <item quantity="one" msgid="3340591167508150806">"+<xliff:g id="NUMBER">%1$s</xliff:g> ujumbe mwingine"</item>
-    <item quantity="other" msgid="1393002799298501480">"+<xliff:g id="NUMBER">%1$s</xliff:g> jumbe zingine"</item>
+    <item quantity="other" msgid="1393002799298501480">"+ mawasiliano mengine <xliff:g id="NUMBER">%1$s</xliff:g>"</item>
   </plurals>
     <string name="error_state" msgid="5177386717626893507">"Hali isiyofanana"</string>
     <string name="error_state_text" msgid="7918866106335387710">"Hali ya nyuzi na wapokeaji haiendani. Tafadhali chukua ripoti kuondoa hitilfu na iripoti kupitia http://go/droidanizer"</string>
@@ -340,9 +338,10 @@
     <string name="disable_notifications_dialog_message" msgid="7644011234972074096">"Komesha arifa  zilizorudufishwa za ujumbe wa maandishi kutoka kwa programu msingi ya Ujumbe?"</string>
     <string name="view_more_conversations" msgid="7275920132410734671">"Ona mazungumzo zaidi"</string>
     <string name="attachment_audio" msgid="2867960243300539143">"Sauti"</string>
-    <string name="attachment_slideshow" msgid="5867689101881763318">"Onyeshoslaidi"</string>
+    <string name="attachment_slideshow" msgid="5867689101881763318">"Onyesho la slaidi"</string>
     <string name="attachment_video" msgid="4252062022156694591">"Video"</string>
     <string name="attachment_picture" msgid="3709286281567284296">"Picha"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-th/arrays.xml b/res/values-th/arrays.xml
index 62e8d23..7fc1900 100644
--- a/res/values-th/arrays.xml
+++ b/res/values-th/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"แสยะยิ้ม"</item>
     <item msgid="638612939305162424">"หน้าโป๊กเกอร์"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"ไม่มีหัวเรื่อง"</item>
+  </string-array>
 </resources>
diff --git a/res/values-th/strings.xml b/res/values-th/strings.xml
index 055b599..314c12e 100644
--- a/res/values-th/strings.xml
+++ b/res/values-th/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"ตรวจพบว่ามีสิทธิ์ DRM ไม่เพียงพอ"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"คัดลอกข้อความ"</string>
     <string name="message_options" msgid="6838806653341967550">"ตัวเลือกข้อความ"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"ตัวเลือกภาพสไลด์"</string>
     <string name="done" msgid="7479926268660505871">"เสร็จสิ้น"</string>
     <string name="move_up" msgid="7307578107431739359">"ย้ายขึ้น"</string>
     <string name="move_down" msgid="6356509518429479053">"ย้ายลง"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"ลบ"</string>
     <string name="send" msgid="4589898724889248486">"ส่ง"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"ส่ง MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"ชุดข้อความทั้งหมด"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"พิมพ์ข้อความ"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"เปิดแป้นพิมพ์เพื่อพิมพ์ข้อความ"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"ข้อความของคุณไม่มีผู้รับที่ถูกต้อง"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"รายการ DRM ที่รวมไว้ในข้อความนี้ส่งต่อไม่ได้"</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"กำลังแปลงเป็นข้อความมัลติมีเดีย…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"กำลังแปลงเป็นข้อความตัวอักษร..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"เพิ่มภาพนิ่งอีกไม่ได้"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"ไม่สามารถเพิ่มวิดีโอและรูปภาพลงในภาพนิ่งเดียว"</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"บันทึกข้อความไม่ได้"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"ขอรายงานการส่งสำหรับแต่ละข้อความที่ส่ง"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"ลบข้อความเก่าเนื่องจากถึงจำนวนสูงสุดแล้ว"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> ข้อความต่อการสนทนา"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"ใช้ MMS ส่งข้อความเดียวเมื่อมีผู้รับหลายราย"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"จัดการข้อความบนซิมการ์ด"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"รายงานการส่ง"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"ส่งข้อความแบบกลุ่ม"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"รายงานการอ่าน"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"รายงานการส่ง"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"ลบข้อความเก่า"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"ข้อความตัวอักษรสูงสุด"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"ข้อความมัลติมีเดียสูงสุด"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"การแจ้งเตือน"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"แสดงการแจ้งเตือนข้อความบนแถบสถานะ"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"สั่น"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"สั่นด้วยเมื่อมีการแจ้งเตือน"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"เลือกเสียงเรียกเข้า"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"เสียง"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"ตั้งค่าจำนวนข้อความที่จะบันทึก"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"ทุกครั้ง"</item>
-    <item msgid="6069709696037750627">"เฉพาะเมื่อปิดเสียง"</item>
-    <item msgid="7486145357487111435">"ไม่ต้องเลย"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"สั่น"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"ปิดเสียง"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"เรียกอัตโนมัติ"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"เรียกดูข้อความอัตโนมัติ"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"เรียกอัตโนมัติขณะโรมมิ่ง"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"บันทึกเสียงเรียกเข้าแล้ว"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"ไม่สามารถบันทึกเสียงเรียกเข้า"</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"ใส่รูปหน้ายิ้ม"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"ผู้เข้าร่วมของกลุ่ม"</string>
     <string name="select_link_title" msgid="3371818607625768447">"เลือกการทำงาน"</string>
     <string name="slide_number" msgid="1923958526266726635">"ภาพนิ่ง <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"จำนวนสูงสุดในการเก็บข้อมูล"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"เปลี่ยนระยะเวลา"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"แก้ไขภาพนิ่ง"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"ผู้เข้าร่วมของกลุ่ม"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"แก้ไขภาพนิ่ง"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"การนำเสนอภาพนิ่ง"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"ข้อความคลาส 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"รูปภาพ"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-tl/arrays.xml b/res/values-tl/arrays.xml
index e7b5b95..c7bf0ff 100644
--- a/res/values-tl/arrays.xml
+++ b/res/values-tl/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Smirk"</item>
     <item msgid="638612939305162424">"Poker face"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"walang paksa"</item>
+  </string-array>
 </resources>
diff --git a/res/values-tl/strings.xml b/res/values-tl/strings.xml
index df7ddfc..0d9dede 100644
--- a/res/values-tl/strings.xml
+++ b/res/values-tl/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Natuklasan ang hindi sapat na mga karapatang DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopyahin ang teksto"</string>
     <string name="message_options" msgid="6838806653341967550">"Mga pagpipilian sa mensahe"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Mga pagpipilian sa slideshow"</string>
     <string name="done" msgid="7479926268660505871">"Tapos na"</string>
     <string name="move_up" msgid="7307578107431739359">"Lumipat pataas"</string>
     <string name="move_down" msgid="6356509518429479053">"Ilipat pababa"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Alisin"</string>
     <string name="send" msgid="4589898724889248486">"Ipadala"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Magpadala ng MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Lahat ng mga thread"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"I-type ang mensahe"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Buksan ang keyboard upang mag-type ng mensahe"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Walang mga wastong recipient ang iyong mensahe."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Hindi maipapasa ang DRM na bagay na kasama sa mensahe."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Nagko-convert patungo sa mga multimedia na mensahe..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Nagko-convert sa text message..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Hindi makapagdagdag ng higit pang mga slide."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Hindi maidagdag ang video at larawan sa isang slide."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Hindi ma-save ang mensahe."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Humiling ng ulat ng paghahatid para sa bawat mensahe na iyong ipinapadala"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Tanggalin ang mga lumang mensahe dahil naabot na ang mga limitasyon"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> (na) mensahe bawat pag-uusap"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Gamitin ang MMS upang magpadala ng iisang mensahe kapag maraming recipient"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Pamahalaan ang mga mensahe sa SIM card"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Mga ulat sa paghahatid"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Panggrupong pagpapadala ng mensahe"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Basahin ang mga ulat"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Mga ulat sa paghahatid"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Tanggalin ang mga lumang mensahe"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Limitasyon ng text message"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Limitasyon ng multimedia na mensahe"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Mga Notification"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Ipakita ang mga notification ng mensahe sa bar ng katayuan"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"I-vibrate"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Mag-vibrate din kapag na-notify"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Pumili ng ringtone"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Tunog"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Itakda ang bilang ng mga mensaheng ise-save"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Palagi"</item>
-    <item msgid="6069709696037750627">"Kapag tahimik lang"</item>
-    <item msgid="7486145357487111435">"Hindi kailanman"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"I-vibrate"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Tahimik"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"I-auto-retrieve"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Awtomatikong bawiin ang mga mensahe"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Niro-roam ang auto-retrieve"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Na-save ang ringtone."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Hindi ma-save ang ringtone."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Magpasok ng smiley"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Mga kalahok ng pangkat"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Pumili ng pagkilos"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slide <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Mga limitasyon sa imbakan"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Palitan ang tagal"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"I-edit ang slideshow"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Mga kalahok ng pangkat"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"I-edit ang slide"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slideshow"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Class 0 na mensahe"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Larawan"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-tr/arrays.xml b/res/values-tr/arrays.xml
index fb6abae..01b9f0d 100644
--- a/res/values-tr/arrays.xml
+++ b/res/values-tr/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Sırıtma"</item>
     <item msgid="638612939305162424">"Poker surat"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"konu yok"</item>
+  </string-array>
 </resources>
diff --git a/res/values-tr/strings.xml b/res/values-tr/strings.xml
index c7a3997..3f95d99 100644
--- a/res/values-tr/strings.xml
+++ b/res/values-tr/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Yetersiz DRM hakları tespit edildi."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Metni kopyala"</string>
     <string name="message_options" msgid="6838806653341967550">"İleti seçenekleri"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Slayt gösterisi seçenekleri"</string>
     <string name="done" msgid="7479926268660505871">"Bitti"</string>
     <string name="move_up" msgid="7307578107431739359">"Yukarı taşı"</string>
     <string name="move_down" msgid="6356509518429479053">"Aşağı taşı"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Kaldır"</string>
     <string name="send" msgid="4589898724889248486">"Gönder"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"MMS gönder"</string>
     <string name="all_threads" msgid="2663426830306307194">"Tüm ileti dizileri"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Mesaj yazın"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Mesajı yazmak için klavyeyi açın"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"İletinizin geçerli alıcısı yok."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Mesajdaki DRM nesnesi yönlendirilemiyor."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Multimedya iletisine dönüştürülüyor..."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Kısa mesaja dönüştürülüyor..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Daha fazla slayt eklenemiyor."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Bir slayta video ve resim eklenemiyor."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Mesaj kaydedilemiyor."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Gönderdiğiniz her ileti için bir iletim raporu iste"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Sınıra ulaşıldığında eski iletileri silin"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"Her bir ileti dizisi için <xliff:g id="COUNT">%1$s</xliff:g> ileti"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Birden fazla alıcı olduğunda tek bir mesajı göndermek için MMS kullan"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"SIM kart iletilerini yönet"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"İletim raporları"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Grup mesajlaşma"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Okundu raporları"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"İletim raporları"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Eski iletileri sil"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Kısa mesaj sınırı"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Multimedya iletisi sınırı"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Bildirimler"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Durum çubuğunda ileti bildirimleri görüntüle"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Titreşim"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Bildirildiğinde aynı zamanda titret"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Zil sesi seç"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Ses"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Kaydedilecek iletilerin sayısını ayarla"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Her zaman"</item>
-    <item msgid="6069709696037750627">"Yalnızca sessizken"</item>
-    <item msgid="7486145357487111435">"Hiçbir zaman"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Titreşim"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Sessiz"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Otomatik al"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"İletileri otomatik olarak al"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Dolaşımda otomatik al"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Zil sesi kaydedildi."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Zil sesi kaydedilemedi."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"İfade ekle"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Grup katılımcıları"</string>
     <string name="select_link_title" msgid="3371818607625768447">"İşlem seçin"</string>
     <string name="slide_number" msgid="1923958526266726635">"Slayt <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Depolama sınırları"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Süreyi değiştir"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Slayt gösterisini düzenle"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Grup katılımcıları"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Slaydı düzenle"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Slayt Gösterisi"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Sınıf 0 mesajı"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Resim"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-uk/arrays.xml b/res/values-uk/arrays.xml
index f400912..876bbe8 100644
--- a/res/values-uk/arrays.xml
+++ b/res/values-uk/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Самовдоволена посмішка"</item>
     <item msgid="638612939305162424">"Байдужий вираз"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"без теми"</item>
+  </string-array>
 </resources>
diff --git a/res/values-uk/strings.xml b/res/values-uk/strings.xml
index 3d174a2..c4687d6 100644
--- a/res/values-uk/strings.xml
+++ b/res/values-uk/strings.xml
@@ -25,7 +25,7 @@
     <string name="menu_call_back" msgid="7538482331117914146">"Набрати <xliff:g id="NAME">%s</xliff:g>"</string>
     <string name="menu_send_email" msgid="671366308915241664">"Надісл. ел. лист <xliff:g id="NAME">%s</xliff:g>"</string>
     <string name="menu_compose_new" msgid="3763437973691046238">"Написати"</string>
-    <string name="menu_preferences" msgid="4693148116114749414">"Налаштув-ня"</string>
+    <string name="menu_preferences" msgid="4693148116114749414">"Налаштування"</string>
     <string name="menu_add_address_to_contacts" msgid="4491980950419914944">"Додати <xliff:g id="CONTACTEMAILORNUMBER">%s</xliff:g> в програму \"Люди\""</string>
     <string name="menu_call" msgid="5877123227307074690">"Набрати"</string>
     <string name="menu_search" msgid="2289469305728821360">"Пошук"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Виявлено недостатньо прав DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Копіювати текст"</string>
     <string name="message_options" msgid="6838806653341967550">"Параметри повідомл."</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Параметри слайд-шоу"</string>
     <string name="done" msgid="7479926268660505871">"Готово"</string>
     <string name="move_up" msgid="7307578107431739359">"Підняти"</string>
     <string name="move_down" msgid="6356509518429479053">"Опустити"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Видалити"</string>
     <string name="send" msgid="4589898724889248486">"Надісл."</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Надіслати MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Усі ланцюжки"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Введіть повідомлення"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Відкрийте клавіатуру, щоб ввести повідомлення"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Повідомл. немає дійсних отримувачів."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Включений у повідомлення DRM-об’єкт неможливо переслати."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Конвертація у мультимедійне повідомл."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Конвертація у текст. повідомл."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Неможливо додати більше слайдів."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Неможливо додати відео й зображення в один слайд."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Неможливо зберегти повідомлення."</string>
@@ -149,7 +150,7 @@
     <string name="play" msgid="1888432400937785115">"Відтвор."</string>
     <string name="edit" msgid="5912118407791492696">"Редаг."</string>
     <string name="try_to_send" msgid="1996751738286080976">"Спроб. надісл."</string>
-    <string name="preferences_title" msgid="6650089610332670157">"Налаш-ня"</string>
+    <string name="preferences_title" msgid="6650089610332670157">"Налаштування"</string>
     <string name="restore_default" msgid="7165341506551155053">"Відновити налашт. за умовч."</string>
     <string name="pref_notification_settings_title" msgid="6420782563630369776">"Сповіщення"</string>
     <string name="pref_mms_settings_title" msgid="55618772118264355">"Мультимедійні (MMS) повідомлення"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Запит. доставку звіту для кожного надісланого повідомл."</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Видал. попер. повідомл., бо досягнуто ліміти"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> повідомлень у бесіді"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Використовуйте опцію MMS, щоб надсилати одне повідомлення декільком отримувачам"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Керув. повідомл. SIM-карти"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Звіти про доставку"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Групові повідомлення"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Звіти про прочит."</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Звіти про доставку"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Видал. попер. повідомл."</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Ліміт текст. повідомл."</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Ліміт мультимед. повідомл."</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Сповіщення"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Відображ. сповіщення повідомл. в рядку стану"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Вібросигнал"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Також вібр. при отрим. сповіщ."</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Вибрати сигнал дзвінка"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Звук"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Установ. к-сть повід. для зберіг."</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Завжди"</item>
-    <item msgid="6069709696037750627">"Лише в беззвуч. реж."</item>
-    <item msgid="7486145357487111435">"Ніколи"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Вібросигнал"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Без звуку"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Авто. отримання"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Автомат. отрим. повідомлення"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Автомат. отрим. роумінгу"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Сигнал дзвінка збережено."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Не вдалося зберегти сигнал дзвінка."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Вставити смайлик"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Учасники групи"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Вибрати дію"</string>
     <string name="slide_number" msgid="1923958526266726635">"Слайд <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Обмеж. зберіг."</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Змінити тривалість"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Редаг. слайд-шоу"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Учасники групи"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Редаг. слайд"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Слайд-шоу"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Повідомлення класу 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Зображення"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> – <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-vi/arrays.xml b/res/values-vi/arrays.xml
index 7d89e62..f2f35ad 100644
--- a/res/values-vi/arrays.xml
+++ b/res/values-vi/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"Cười điệu"</item>
     <item msgid="638612939305162424">"Mặt phớt tỉnh"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"không có chủ đề"</item>
+  </string-array>
 </resources>
diff --git a/res/values-vi/strings.xml b/res/values-vi/strings.xml
index e003640..b3e2057 100644
--- a/res/values-vi/strings.xml
+++ b/res/values-vi/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Đã phát hiện không đủ quyền DRM."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Sao chép văn bản"</string>
     <string name="message_options" msgid="6838806653341967550">"Tùy chọn tin nhắn"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Tùy chọn trình chiếu"</string>
     <string name="done" msgid="7479926268660505871">"Xong"</string>
     <string name="move_up" msgid="7307578107431739359">"Chuyển lên"</string>
     <string name="move_down" msgid="6356509518429479053">"Chuyển xuống"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Xóa"</string>
     <string name="send" msgid="4589898724889248486">"Gửi"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Gửi MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Tất cả chuỗi thư"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Nhập tin nhắn"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Mở bàn phím để nhập tin nhắn"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Tin nhắn của bạn có người nhận không hợp lệ."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Không thể chuyển tiếp đối tượng DRM được đưa vào tin nhắn."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Đang chuyển đổi sang tin nhắn đa phương tiện…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Đang chuyển đổi sang tin nhắn văn bản…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Không thể thêm trang trình bày khác."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Không thể thêm video và ảnh vào một trang trình bày."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Không thể lưu tin nhắn."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Yêu cầu thông báo gửi cho mỗi tin nhắn bạn gửi"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Xóa tin nhắn cũ khi đạt đến giới hạn"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> tin nhắn mỗi cuộc hội thoại"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Sử dụng MMS để gửi một thông báo duy nhất khi có nhiều người nhận"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Quản lý tin nhắn trên thẻ SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Thông báo gửi"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Nhắn tin theo nhóm"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Báo cáo đọc"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Thông báo gửi"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Xóa tin nhắn cũ"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Giới hạn tin nhắn văn bản"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Giới hạn tin nhắn đa phương tiện"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Thông báo"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Hiển thị thông báo tin nhắn trên thanh trạng thái"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Rung"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Cũng rung khi được thông báo"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Chọn nhạc chuông"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Âm thanh"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Đặt số tin nhắn sẽ lưu"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Luôn luôn"</item>
-    <item msgid="6069709696037750627">"Chỉ khi ở chế độ im lặng"</item>
-    <item msgid="7486145357487111435">"Chưa bao giờ"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Rung"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Im lặng"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Tự động truy xuất"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Tự động truy xuất tin nhắn"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Tự động truy xuất khi chuyển vùng"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Đã lưu nhạc chuông."</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Không thể lưu nhạc chuông."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Chèn mặt cười"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Nhóm người tham gia"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Chọn tác vụ"</string>
     <string name="slide_number" msgid="1923958526266726635">"Trang trình bày <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Giới hạn dung lượng"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Thay đổi thời lượng"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Chỉnh sửa trình chiếu"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Nhóm người tham gia"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Chỉnh sửa trang trình bày"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Trình chiếu"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Thông báo Lớp 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Hình ảnh"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-zh-rCN/arrays.xml b/res/values-zh-rCN/arrays.xml
index 36e96cb..c84682a 100644
--- a/res/values-zh-rCN/arrays.xml
+++ b/res/values-zh-rCN/arrays.xml
@@ -36,9 +36,12 @@
     <item msgid="850324578089267455">"保密"</item>
     <item msgid="6334637439528489607">"大笑"</item>
     <item msgid="7602915122893958066">"困惑"</item>
-    <item msgid="3939233701582771068">"Heart"</item>
-    <item msgid="1414759480575851587">"Mad"</item>
-    <item msgid="8479809115158836070">"Smirk"</item>
+    <item msgid="3939233701582771068">"爱之心"</item>
+    <item msgid="1414759480575851587">"生气"</item>
+    <item msgid="8479809115158836070">"傻笑"</item>
     <item msgid="638612939305162424">"一本正经"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"无主题"</item>
+  </string-array>
 </resources>
diff --git a/res/values-zh-rCN/strings.xml b/res/values-zh-rCN/strings.xml
index 39ac605..cd6cf0c 100644
--- a/res/values-zh-rCN/strings.xml
+++ b/res/values-zh-rCN/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"检测到 DRM 权限不足。"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"复制文字"</string>
     <string name="message_options" msgid="6838806653341967550">"信息选项"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"幻灯片选项"</string>
     <string name="done" msgid="7479926268660505871">"完成"</string>
     <string name="move_up" msgid="7307578107431739359">"上移"</string>
     <string name="move_down" msgid="6356509518429479053">"下移"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"删除"</string>
     <string name="send" msgid="4589898724889248486">"发送"</string>
     <string name="mms" msgid="1587631213714914559">"彩信"</string>
+    <string name="send_mms" msgid="2933162044872550662">"发送彩信"</string>
     <string name="all_threads" msgid="2663426830306307194">"所有会话"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"键入信息"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"打开键盘键入信息"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"您的信息没有有效的接收者。"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"无法转发该短信中包含的 DRM 对象。"</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"正在转换为彩信…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"正在转换为短信…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"无法再添加幻灯片。"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"无法将视频和图片添加到同一张幻灯片。"</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"无法保存短信。"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"要求每次发送信息后都返回发送报告"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"达到数量上限时删除旧信息"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"每个会话限存储 <xliff:g id="COUNT">%1$s</xliff:g> 条信息"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"使用彩信将单条信息发送给多个收件人"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"管理 SIM 卡中的信息"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"发送报告"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"群发信息"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"已读报告"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"发送报告"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"删除旧信息"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"短信限制"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"彩信限制"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"通知"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"在状态栏中显示信息通知"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"振动"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"收到通知时还振动提醒"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"选择铃声"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"提示音"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"设置要保存的信息数量"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"始终"</item>
-    <item msgid="6069709696037750627">"仅在静音时"</item>
-    <item msgid="7486145357487111435">"永不"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"振动"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"静音"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"自动检索"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"自动检索信息"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"漫游时自动检索"</string>
@@ -255,7 +251,7 @@
     <string name="notification_multiple" msgid="7684007285202109490">"<xliff:g id="COUNT">%s</xliff:g> 条未读信息。"</string>
     <string name="notification_multiple_title" msgid="332602028959557541">"新信息"</string>
     <string name="notification_failed_multiple" msgid="6192531993698497229">"<xliff:g id="COUNT">%s</xliff:g> 条短信无法发送"</string>
-    <string name="notification_failed_multiple_title" msgid="1112032024904397126">"信息未发送"</string>
+    <string name="notification_failed_multiple_title" msgid="1112032024904397126">"短信未发送"</string>
     <string name="sim_full_title" msgid="1809829051697702810">"SIM 卡已满"</string>
     <string name="sim_full_body" msgid="6241664980790322925">"删除部分信息以腾出更多空间。"</string>
     <string name="sms_full_title" msgid="6041287140125011854">"短信内存已满"</string>
@@ -275,7 +271,7 @@
     <string name="rate_limit_surpassed" msgid="1347801608211628177">"确认"</string>
     <string name="confirm_rate_limit" msgid="234228299751243067">"即将发送多条彩信。确定要这样做吗？"</string>
     <string name="message_download_failed_title" msgid="5722226064394767921">"信息未下载"</string>
-    <string name="message_send_failed_title" msgid="3469894907399046372">"信息未发送"</string>
+    <string name="message_send_failed_title" msgid="3469894907399046372">"短信未发送"</string>
     <string name="message_failed_body" msgid="3421296112073915245">"触摸可查看短信并重试。"</string>
     <string name="download_later" msgid="5531365714424360903">"目前无法下载。请稍后再试。"</string>
     <string name="select_audio" msgid="3528161449756771832">"选择音频"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"已保存铃声。"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"无法保存铃声。"</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"插入表情符号"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"群组参与者"</string>
     <string name="select_link_title" msgid="3371818607625768447">"选择操作"</string>
     <string name="slide_number" msgid="1923958526266726635">"幻灯片 <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,11 +294,12 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"存储限制"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"更改持续时间"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"编辑幻灯片"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"群组参与者"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"编辑幻灯片"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"播放幻灯片"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"0 类短信"</string>
     <string name="search_label" msgid="6042598929386174964">"短信"</string>
-    <string name="search_hint" msgid="7273727663577472044">"搜索“短信”"</string>
+    <string name="search_hint" msgid="7273727663577472044">"搜索短信"</string>
     <string name="search" msgid="7560238620274735199">"短信"</string>
     <string name="search_setting_description" msgid="4104004595086437572">"消息中的文字"</string>
     <string name="search_empty" msgid="2109551478056039278">"没有匹配项。"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"图片"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"、 "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-zh-rTW/arrays.xml b/res/values-zh-rTW/arrays.xml
index 0294694..6400d42 100644
--- a/res/values-zh-rTW/arrays.xml
+++ b/res/values-zh-rTW/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"傻笑"</item>
     <item msgid="638612939305162424">"撲克臉"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"無主旨"</item>
+  </string-array>
 </resources>
diff --git a/res/values-zh-rTW/strings.xml b/res/values-zh-rTW/strings.xml
index 9077f8b..61b8602 100644
--- a/res/values-zh-rTW/strings.xml
+++ b/res/values-zh-rTW/strings.xml
@@ -33,7 +33,7 @@
     <string name="menu_delete" msgid="1851666911396479006">"刪除會話串"</string>
     <string name="menu_view" msgid="7448852683948080108">"檢視串連"</string>
     <string name="menu_debug_dump" msgid="6855869130206549643">"DEBUG DUMP"</string>
-    <string name="refreshing" msgid="987335057871404222">"重新整理中..."</string>
+    <string name="refreshing" msgid="987335057871404222">"重新整理中…"</string>
     <string name="menu_cell_broadcasts" msgid="5646161375983084660">"區域廣播"</string>
     <string name="has_draft" msgid="2487465595514636160">"草稿"</string>
     <string name="no_subject_view" msgid="7795086723069563537">"(沒有主旨)"</string>
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"DRM 授權權限不足。"</string>
     <string name="copy_message_text" msgid="4296252229544252834">"複製文字"</string>
     <string name="message_options" msgid="6838806653341967550">"簡訊選項"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"投影播放選項"</string>
     <string name="done" msgid="7479926268660505871">"完成"</string>
     <string name="move_up" msgid="7307578107431739359">"往上移動"</string>
     <string name="move_down" msgid="6356509518429479053">"往下移動"</string>
@@ -81,10 +82,11 @@
     <string name="remove" msgid="4625444913256213175">"移除"</string>
     <string name="send" msgid="4589898724889248486">"傳送"</string>
     <string name="mms" msgid="1587631213714914559">"MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"傳送 MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"所有會話群組"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"輸入訊息"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"開啟鍵盤即可輸入訊息"</string>
-    <string name="compressing" msgid="1961357529661045180">"相片太大，壓縮中..."</string>
+    <string name="compressing" msgid="1961357529661045180">"相片太大，壓縮中…"</string>
     <string name="unsupported_media_format" msgid="1350489690977363764">"不支援的<xliff:g id="NAME">%1$s</xliff:g>格式。"</string>
     <string name="select_different_media" msgid="6241623357299382183">"請選擇其他<xliff:g id="NAME">%1$s</xliff:g>。"</string>
     <string name="exceed_message_size_limitation" msgid="6027753647094742437">"已達最大簡訊長度。"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"您的簡訊沒有正確的收件者。"</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"無法轉寄訊息中的 DRM 物件。"</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"正在轉換成多媒體訊息…"</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"正在轉換成簡訊…"</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"無法新增更多投影片。"</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"無法在一張投影片中同時加入影片和圖片。"</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"無法儲存訊息。"</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"傳送簡訊後要求傳送回條"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"達到數量上限時刪除舊訊息"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"每個會話群組包含 <xliff:g id="COUNT">%1$s</xliff:g> 則訊息"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"寄給多位收件者時使用 MMS 傳送一則訊息"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"管理 SIM 卡上的簡訊"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"傳送回條"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"群組簡訊"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"讀取回條"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"傳送回條"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"刪除舊訊息"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"簡訊限制"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"多媒體訊息限制"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"通知"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"在狀態列顯示簡訊通知"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"震動"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"收到通知時震動提醒"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"選擇鈴聲"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"音效"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"設定儲存的訊息數量"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"一律"</item>
-    <item msgid="6069709696037750627">"靜音時才啟用"</item>
-    <item msgid="7486145357487111435">"永遠不要"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"震動"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"靜音"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"自動擷取"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"自動擷取簡訊"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"漫遊時自動擷取"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"已儲存鈴聲。"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"無法儲存鈴聲。"</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"插入表情符號"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"群組參與者"</string>
     <string name="select_link_title" msgid="3371818607625768447">"選擇動作"</string>
     <string name="slide_number" msgid="1923958526266726635">"投影片 <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"儲存空間上限"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"變更長度"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"編輯投影播放"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"群組參與者"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"編輯投影片"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"投影播放"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"等級 0 訊息"</string>
@@ -320,9 +318,9 @@
     <string name="storage_limits_setting" msgid="4952781049308537373">"設定上限"</string>
     <string name="storage_limits_setting_dismiss" msgid="1433841310158458034">"不設定上限"</string>
     <string name="too_many_unsent_mms" msgid="4436493698891224126">"尚未傳送的多媒體訊息過多，因此目前無法傳送訊息。"</string>
-    <string name="sending_message" msgid="2054406576361149715">"傳送中..."</string>
+    <string name="sending_message" msgid="2054406576361149715">"傳送中…"</string>
     <string name="pick_too_many_recipients" msgid="650087588867628044">"收件者過多"</string>
-    <string name="adding_recipients" msgid="2962810172527532357">"正在新增收件者..."</string>
+    <string name="adding_recipients" msgid="2962810172527532357">"正在新增收件者…"</string>
     <string name="draft_separator" msgid="5402575086540243019">"， "</string>
     <string name="message_count_format" msgid="4434763220590778012">" <xliff:g id="NUMBER">%1$s</xliff:g>"</string>
     <string name="message_count_notification" msgid="3629968600032690007">"<xliff:g id="NUMBER">%1$s</xliff:g> 則新訊息"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"圖片"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">"、 "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values-zu/arrays.xml b/res/values-zu/arrays.xml
index 7858029..9cb8132 100644
--- a/res/values-zu/arrays.xml
+++ b/res/values-zu/arrays.xml
@@ -41,4 +41,7 @@
     <item msgid="8479809115158836070">"I-Smirk"</item>
     <item msgid="638612939305162424">"Ubuso bephokha"</item>
   </string-array>
+  <string-array name="empty_subject_strings">
+    <item msgid="7691141505407124426">"asikho isihloko"</item>
+  </string-array>
 </resources>
diff --git a/res/values-zu/strings.xml b/res/values-zu/strings.xml
index aa25b77..2e828d6 100644
--- a/res/values-zu/strings.xml
+++ b/res/values-zu/strings.xml
@@ -56,6 +56,7 @@
     <string name="insufficient_drm_rights" msgid="6989074725969164383">"Amalungelo e-DRM anganele atholiwe."</string>
     <string name="copy_message_text" msgid="4296252229544252834">"Kopisha okubhaliwe"</string>
     <string name="message_options" msgid="6838806653341967550">"Okukhethwa kukho komyalezo"</string>
+    <string name="slideshow_options" msgid="3501759384739796431">"Ongakukhetha kwemibukiso yesilayidi"</string>
     <string name="done" msgid="7479926268660505871">"Kwenziwe"</string>
     <string name="move_up" msgid="7307578107431739359">"Iya phezulu"</string>
     <string name="move_down" msgid="6356509518429479053">"Iya phansi"</string>
@@ -81,6 +82,7 @@
     <string name="remove" msgid="4625444913256213175">"Susa"</string>
     <string name="send" msgid="4589898724889248486">"Thumela"</string>
     <string name="mms" msgid="1587631213714914559">"i-MMS"</string>
+    <string name="send_mms" msgid="2933162044872550662">"Thumela i-MMS"</string>
     <string name="all_threads" msgid="2663426830306307194">"Zonke izindikimba"</string>
     <string name="type_to_compose_text_enter_to_send" msgid="3539985471008581265">"Thayipha umlayezo"</string>
     <string name="open_keyboard_to_compose_message" msgid="7860109685511253191">"Vula i-keyboard ukuze uthayiphe umlayezo"</string>
@@ -104,7 +106,6 @@
     <string name="cannot_send_message_reason" msgid="8745080126044054343">"Umlayezo wakho awunabo abamukeli abalungile."</string>
     <string name="cannot_forward_drm_obj" msgid="5047623751430559077">"Into ye-DRM ehlanganiswe emyalezweni ngeke idluliswe."</string>
     <string name="converting_to_picture_message" msgid="2980023239017588627">"Iguqulela kumyalezo woxhumano oluxubile.,.."</string>
-    <string name="converting_to_text_message" msgid="6374423235426015422">"Iguqulela kumyalezo wombhalo..."</string>
     <string name="cannot_add_slide_anymore" msgid="4631404749618820994">"Ayikwazi ukwengeza amanye amaslyadi."</string>
     <string name="cannot_add_picture_and_video" msgid="4954353772391381447">"Ayikwazi ukufaka ividiyo nesithombe esilayidini esisodwa."</string>
     <string name="cannot_save_message" msgid="3375907366965264446">"Ayikwazi ukulondoloza umlayezo."</string>
@@ -161,25 +162,20 @@
     <string name="pref_summary_sms_delivery_reports" msgid="5852207702358546129">"Cela umbiko wokuthumela womyalezo ngamunye owuthumelayo"</string>
     <string name="pref_summary_auto_delete" msgid="7719538116486177613">"Susa imiyalezo yakudala njengoba umkhawulo usufinyelelwe"</string>
     <string name="pref_summary_delete_limit" msgid="597128041393045216">"<xliff:g id="COUNT">%1$s</xliff:g> imiyalezo yengxoxo ngayinye"</string>
+    <string name="pref_summary_mms_group_mms" msgid="2266928687440696745">"Sebenzisa i-MMS ukuthumela umlayezo owodwa uma kunabamukeli abaningi"</string>
     <string name="pref_title_manage_sim_messages" msgid="7820895261757881177">"Phatha imiyalezo yekhadi le-SIM"</string>
     <string name="pref_title_mms_delivery_reports" msgid="6666857926679451910">"Imibiko yokuthumela"</string>
+    <string name="pref_title_mms_group_mms" msgid="1251698526583908432">"Imilayezo yeqembu"</string>
     <string name="pref_title_mms_read_reports" msgid="4882179829495828541">"Funda imibiko"</string>
     <string name="pref_title_sms_delivery_reports" msgid="876064208254451038">"Imibiko yokuthumela"</string>
     <string name="pref_title_auto_delete" msgid="7227835692631701134">"Susa imiyalezo endala"</string>
     <string name="pref_title_sms_delete" msgid="6890538316799296878">"Umkhawulo womyalezo wombhalo"</string>
     <string name="pref_title_mms_delete" msgid="7265878070847351664">"Umkhawulo womyalezo wokuxhumana okuxubile"</string>
     <string name="pref_title_notification_enabled" msgid="9118792213953729414">"Izaziso"</string>
-    <string name="pref_summary_notification_enabled" msgid="619729096820999905">"Bonisa izaziso zomlayezo kwibha yomumo"</string>
     <string name="pref_title_notification_vibrateWhen" msgid="4251208067092761057">"Dlidliza"</string>
-    <string name="pref_summary_notification_vibrateWhen" msgid="669655090822561447">"Iyadlidliza futhi uma yazisiwe"</string>
-    <string name="pref_title_notification_ringtone" msgid="5467265237106229952">"Khetha ithoni yokukhala"</string>
+    <string name="pref_title_notification_ringtone" msgid="8667533917574559659">"Umsindo"</string>
     <string name="pref_messages_to_save" msgid="3202539743892934926">"Hlela inani lemiyalezo ozoyigcina"</string>
-  <string-array name="prefEntries_vibrateWhen">
-    <item msgid="2520871831815631409">"Njao"</item>
-    <item msgid="6069709696037750627">"Kuphela uma ithulile"</item>
-    <item msgid="7486145357487111435">"Akusoze"</item>
-  </string-array>
-    <string name="prefDialogTitle_vibrateWhen" msgid="6419655771690242118">"Dlidliza"</string>
+    <string name="silent_ringtone" msgid="7981237991326592780">"Thulile"</string>
     <string name="pref_title_mms_auto_retrieval" msgid="4021878285474431355">"Thola ngokuzenzakalekayo"</string>
     <string name="pref_summary_mms_auto_retrieval" msgid="925163257363757048">"Ngokuzenzakalekayo ithola imiyalezo"</string>
     <string name="pref_title_mms_retrieval_during_roaming" msgid="6016227402731817804">"Izulazula ukuthola okuzenzakalekayo"</string>
@@ -286,6 +282,7 @@
     <string name="saved_ringtone" msgid="3847363932276708626">"Iringithoni igciniwe"</string>
     <string name="saved_ringtone_fail" msgid="4778500070919251116">"Ayikwazanga ukugcina iringithoni."</string>
     <string name="menu_insert_smiley" msgid="4964504393061025071">"Faka ismayili"</string>
+    <string name="menu_group_participants" msgid="4288356090262299071">"Qoqa abahlanganyeli"</string>
     <string name="select_link_title" msgid="3371818607625768447">"Khetha isenzo"</string>
     <string name="slide_number" msgid="1923958526266726635">"Islayidi <xliff:g id="NUMBER">%s</xliff:g>"</string>
   <plurals name="slide_duration">
@@ -297,6 +294,7 @@
     <string name="storage_limits_activity" msgid="8810530813311077716">"Imikhawulo yesitoreji"</string>
     <string name="change_duration_activity" msgid="7048606979485031693">"Shintsha ubude"</string>
     <string name="edit_slideshow_activity" msgid="8751493388760050529">"Hlela umbukiso weslayidi"</string>
+    <string name="recipient_list_activity" msgid="1254938236543727019">"Qoqa abahlanganyeli"</string>
     <string name="edit_slide_activity" msgid="8752829671778696983">"Hlela islayidi"</string>
     <string name="slideshow_activity" msgid="5658249461317434432">"Umbukiso weslaydi"</string>
     <string name="class_0_message_activity" msgid="6631339964159861048">"Umlayezo wesigaba 0"</string>
@@ -343,4 +341,5 @@
     <string name="attachment_picture" msgid="3709286281567284296">"Isithombe"</string>
     <string name="notification_separator" msgid="2334673105226536422">"  "</string>
     <string name="enumeration_comma" msgid="213598026698964628">", "</string>
+    <string name="message_timestamp_format" msgid="4188999027493614617">"<xliff:g id="STRING_0">%1$s</xliff:g> - <xliff:g id="STRING_1">%2$s</xliff:g>"</string>
 </resources>
diff --git a/res/values/arrays.xml b/res/values/arrays.xml
index 243d351..d8357e5 100644
--- a/res/values/arrays.xml
+++ b/res/values/arrays.xml
@@ -69,4 +69,11 @@
         <item>Smirk</item>                   <!-- 19: :-/ -->
         <item>Poker face</item>              <!-- 20: :-I -->
     </string-array>
+
+    <!-- String to match as no subject and filter out as a subject. For example, if the
+         subject string is "no subject", we won't display that. We'll pretend
+         no subject string was delivered. -->
+    <string-array name="empty_subject_strings">
+        <item>no subject</item>
+    </string-array>
 </resources>
diff --git a/res/values/strings.xml b/res/values/strings.xml
index 21ece61..7e1c01d 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -22,7 +22,8 @@
     <!-- The name of the SMS/MMS app as it appears to the user in the Home screen, task switcher, etc. -->
     <string name="app_label">Messaging</string>
 
-    <!-- Command name to open a Compose screen; displays in conversation list -->
+    <!-- Command name to open a Compose screen; displays in conversation list.
+         Also used as accessibility text for widget's new message button -->
     <string name="new_message">New message</string>
     <!-- Context menu item on an individual message for dialing the sender's phone number -->
     <string name="menu_call_back">Call <xliff:g id="name">%s</xliff:g></string>
@@ -102,6 +103,8 @@
     <string name="copy_message_text">Copy text</string>
     <!-- Header for context menu on an individual message -->
     <string name="message_options">Message options</string>
+    <!-- Header for context menu on an individual slideshow -->
+    <string name="slideshow_options">Slideshow options</string>
 
     <!-- Button text on edit slide screen indicating the user wants to finish editing that slide -->
     <string name="done">Done</string>
@@ -160,6 +163,8 @@
     <string name="send">Send</string>
     <!-- Text to appear directly below the "Send" text on the SMS/MMS send button. The "MMS" text is on a second line in a smaller font. This is similar to saying "Send (mms)". -->
     <string name="mms">MMS</string>
+    <!-- Content description for the send button when sending an mms (imperative verb) -->
+    <string name="send_mms">Send MMS</string>
 
     <!-- Menu item in conversation screen for returning to the conversation list -->
     <string name="all_threads">All threads</string>
@@ -212,8 +217,6 @@
 
     <!-- Brief message that appears when converting a message from SMS to MMS. -->
     <string name="converting_to_picture_message">Converting to multimedia message\u2026</string>
-    <!-- Brief message that appears when converting a message from MMS to SMS. -->
-    <string name="converting_to_text_message">Converting to text message\u2026</string>
     <!-- Brief message that appears when the maximum number of slides has been reached -->
     <string name="cannot_add_slide_anymore">Can\'t add more slides.</string>
     <!-- Brief message that appears when user tries to add picture to a slide which already has a video. -->
@@ -326,10 +329,14 @@
     <string name="pref_summary_auto_delete">Delete old messages as limits are reached</string>
     <!-- Settings item description for integer auto-delete sms message limit -->
     <string name="pref_summary_delete_limit"><xliff:g id="count">%1$s</xliff:g> messages per conversation</string>
+    <!-- Settings item description for boolean MMS enable group MMS setting -->
+    <string name="pref_summary_mms_group_mms">Use MMS to send a single message when there are multiple recipients</string>
     <!-- Settings item for entering SIM card message screen -->
     <string name="pref_title_manage_sim_messages">Manage SIM card messages</string>
     <!-- Settings item for boolean option to enable/disable MMS delivery reports -->
     <string name="pref_title_mms_delivery_reports">Delivery reports</string>
+    <!-- Settings item for boolean option to enable/disable MMS group messages -->
+    <string name="pref_title_mms_group_mms">Group messaging</string>
     <!-- Settings item for boolean option to enable/disable MMS read reports -->
     <string name="pref_title_mms_read_reports">Read reports</string>
     <!-- Settings item for boolean option to enable/disable SMS delivery reports -->
@@ -342,44 +349,20 @@
     <string name="pref_title_mms_delete">Multimedia message limit</string>
     <!-- Settings item for boolean option to display message notifications -->
     <string name="pref_title_notification_enabled">Notifications</string>
-    <!-- Settings item description for boolean message notification option -->
-    <string name="pref_summary_notification_enabled">Display message notifications in status bar</string>
     <!-- Settings item for boolean option to vibrate during message notification -->
     <string name="pref_title_notification_vibrateWhen">Vibrate</string>
-    <!-- Settings item description for boolean vibrate option -->
-    <string name="pref_summary_notification_vibrateWhen">Also vibrate when notified</string>
     <!-- Settings item for entering ringtone selection screen -->
-    <string name="pref_title_notification_ringtone">Choose ringtone</string>
+    <string name="pref_title_notification_ringtone">Sound</string>
     <!-- Settings item for setting the number of message to save for each conversation -->
     <string name="pref_messages_to_save">Set number of messages to save</string>
+    <!-- Settings screen, what to display for Ringtone when the user chooses "silent" [CHAR LIMIT=100]-->
+    <string name="silent_ringtone">Silent</string>
 
-    <!-- The vibrate notification modes -->
-    <string-array name="prefEntries_vibrateWhen">
-        <!-- Always -->
-        <item>Always</item>
-        <!-- Only when the phone is in Silent mode -->
-        <item>Only when silent</item>
-        <!-- Never -->
-        <item>Never</item>
-    </string-array>
-
-    <!-- The default vibrateWhen value, when none is set -->
-    <string translatable="false" name="prefDefault_vibrateWhen">never</string>
     <!-- The value to use when migrating from old versions for a true vibrate setting -->
     <string translatable="false" name="prefDefault_vibrate_true">always</string>
     <!-- The value to use when migrating from old versions for a false vibrate setting -->
     <string translatable="false" name="prefDefault_vibrate_false">never</string>
 
-    <!-- The vibrateWhen values -->
-    <string-array translatable="false" name="prefValues_vibrateWhen">
-        <item>always</item>
-        <item>silent</item>
-        <item>never</item>
-    </string-array>
-
-    <!-- Dialog title for the Vibrate dialog -->
-    <string name="prefDialogTitle_vibrateWhen">Vibrate</string>
-
     <!-- Settings item for boolean option to auto-retrieve incoming MMS messages -->
     <string name="pref_title_mms_auto_retrieval">Auto-retrieve</string>
     <!-- Settings item description for boolean MMS auto-retrieve option -->
@@ -629,6 +612,8 @@
     <string name="saved_ringtone_fail">Couldn\'t save ringtone.</string>
     <!-- Menu item -->
     <string name="menu_insert_smiley">Insert smiley</string>
+    <!-- Menu item  [CHAR LIMIT=40] -->
+    <string name="menu_group_participants">Group participants</string>
 
     <!-- This is the dialog title for the "Select link" dialog, shown when the user clicks on a
     chat in the chat history view if there are links in the chat message. The dialog displays the
@@ -659,6 +644,9 @@
     <!-- Title of the slideshow editor activity. -->
     <string name="edit_slideshow_activity">Edit slideshow</string>
 
+    <!-- Title of the recipient list activity. [CHAR LIMIT=NONE] -->
+    <string name="recipient_list_activity">Group participants</string>
+
     <!-- Title of the slide editor activity. -->
     <string name="edit_slide_activity">Edit slide</string>
 
@@ -785,5 +773,8 @@
     <!-- An enumeration comma for separating multiple names in notifications. [CHAR LIMIT=2] -->
     <string name="enumeration_comma">,\u0020</string>
 
+    <!-- In message list items, this string builds the timestamp line when the message is in a group [CHAR LIMIT=NONE] -->
+    <string name="message_timestamp_format"><xliff:g id="string" example="Fred Flinstone">%1$s</xliff:g>\u0020-\u0020<xliff:g id="string" example="9:39AM">%2$s</xliff:g></string>
+
 </resources>
 
diff --git a/res/xml/mms_config.xml b/res/xml/mms_config.xml
index 988458b..78567e2 100644
--- a/res/xml/mms_config.xml
+++ b/res/xml/mms_config.xml
@@ -57,15 +57,17 @@
          to indicate no limit. -->
     <int name="recipientLimit">-1</int>
 
-    <!-- Maximum number of SMS message segments in a long text message before converting
-         the SMS message to an MMS message. -->
-    <int name="smsToMmsTextThreshold">4</int>
-
     <!-- If true, The text message over 160 characters will be sent in multi part.
          If false, The text message over 160 characters will be sent
          via multi media message. -->
     <bool name="enableMultipartSMS">true</bool>
 
+    <!-- If enableMultipartSMS is true and smsToMmsTextThreshold > 1, then multi-part SMS messages
+         will be converted into a single mms message. For example, if the mms_config.xml file
+         specifies <int name="smsToMmsTextThreshold">7</int>, then on the 8th sms segment, the
+         message will be converted to an mms. -->
+    <int name="smsToMmsTextThreshold">-1</int>
+
     <!-- If true, The mms support slide duration.
          If false, The mms does not support slide duration and we have to
          set duration value. -->
diff --git a/res/xml/preferences.xml b/res/xml/preferences.xml
index 75a5e7a..54ebb4b 100644
--- a/res/xml/preferences.xml
+++ b/res/xml/preferences.xml
@@ -52,6 +52,10 @@
   </PreferenceCategory>
   <PreferenceCategory android:title="@string/pref_mms_settings_title"
                       android:key="pref_key_mms_settings">
+    <CheckBoxPreference android:defaultValue="true"
+                      android:key="pref_key_mms_group_mms"
+                      android:summary="@string/pref_summary_mms_group_mms"
+                      android:title="@string/pref_title_mms_group_mms" />
     <CheckBoxPreference android:defaultValue="false"
                       android:key="pref_key_mms_delivery_reports"
                       android:summary="@string/pref_summary_mms_delivery_reports"
@@ -74,22 +78,15 @@
   <PreferenceCategory android:title="@string/pref_notification_settings_title">
     <CheckBoxPreference android:key="pref_key_enable_notifications"
                         android:title="@string/pref_title_notification_enabled"
-                        android:summary="@string/pref_summary_notification_enabled"
                         android:defaultValue="true" />
-    <RingtonePreference android:layout="?android:attr/preferenceLayoutChild"
-                        android:dependency="pref_key_enable_notifications"
-                        android:key="pref_key_ringtone"
+    <RingtonePreference android:key="pref_key_ringtone"
                         android:title="@string/pref_title_notification_ringtone"
                         android:ringtoneType="notification"
-                        android:defaultValue="content://settings/system/notification_sound" />
-    <ListPreference     android:layout="?android:attr/preferenceLayoutChild"
                         android:dependency="pref_key_enable_notifications"
-                        android:key="pref_key_vibrateWhen"
-                        android:defaultValue="@string/prefDefault_vibrateWhen"
+                        android:defaultValue="content://settings/system/notification_sound" />
+    <CheckBoxPreference android:key="pref_key_vibrate"
                         android:title="@string/pref_title_notification_vibrateWhen"
-                        android:summary="@string/pref_summary_notification_vibrateWhen"
-                        android:entries="@array/prefEntries_vibrateWhen"
-                        android:entryValues="@array/prefValues_vibrateWhen"
-                        android:dialogTitle="@string/prefDialogTitle_vibrateWhen" />
+                        android:dependency="pref_key_enable_notifications"
+                        android:defaultValue="false" />
   </PreferenceCategory>
 </PreferenceScreen>
diff --git a/res/xml/widget_info.xml b/res/xml/widget_info.xml
index 02dd870..5b4dbe2 100644
--- a/res/xml/widget_info.xml
+++ b/res/xml/widget_info.xml
@@ -6,5 +6,6 @@
     android:minHeight="220dp"
     android:updatePeriodMillis="0"
     android:initialLayout="@layout/widget"
-    android:resizeMode="horizontal|vertical">
+    android:resizeMode="horizontal|vertical"
+    android:widgetCategory="home_screen|keyguard">
 </appwidget-provider>
diff --git a/src/com/android/mms/LogTag.java b/src/com/android/mms/LogTag.java
index cb1534d..c46da57 100644
--- a/src/com/android/mms/LogTag.java
+++ b/src/com/android/mms/LogTag.java
@@ -16,10 +16,6 @@
 
 package com.android.mms;
 
-import com.android.mms.data.Contact;
-import com.android.mms.data.Conversation;
-import com.android.mms.data.RecipientIdCache;
-
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.Context;
@@ -27,6 +23,10 @@ import android.content.DialogInterface;
 import android.content.DialogInterface.OnClickListener;
 import android.util.Log;
 
+import com.android.mms.data.Contact;
+import com.android.mms.data.Conversation;
+import com.android.mms.data.RecipientIdCache;
+
 public class LogTag {
     public static final String TAG = "Mms";
 
@@ -114,7 +114,7 @@ public class LogTag {
             activity.runOnUiThread(new Runnable() {
                 public void run() {
                     new AlertDialog.Builder(activity)
-                        .setIcon(android.R.drawable.ic_dialog_alert)
+                        .setIconAttribute(android.R.attr.alertDialogIcon)
                         .setTitle(R.string.error_state)
                         .setMessage(msg + "\n\n" + activity.getString(R.string.error_state_text))
                         .setPositiveButton(R.string.yes, new OnClickListener() {
diff --git a/src/com/android/mms/MmsApp.java b/src/com/android/mms/MmsApp.java
index 241ae6b..9092a29 100644
--- a/src/com/android/mms/MmsApp.java
+++ b/src/com/android/mms/MmsApp.java
@@ -19,6 +19,7 @@ package com.android.mms;
 
 import android.app.Application;
 import android.content.Context;
+import android.content.Intent;
 import android.content.res.Configuration;
 import android.drm.DrmManagerClient;
 import android.location.Country;
@@ -34,6 +35,9 @@ import com.android.mms.data.Contact;
 import com.android.mms.data.Conversation;
 import com.android.mms.layout.LayoutManager;
 import com.android.mms.transaction.MessagingNotification;
+import com.android.mms.transaction.MmsSystemEventReceiver;
+import com.android.mms.transaction.SmsReceiver;
+import com.android.mms.transaction.SmsReceiverService;
 import com.android.mms.util.DownloadManager;
 import com.android.mms.util.DraftCache;
 import com.android.mms.util.PduLoaderManager;
@@ -80,7 +84,6 @@ public class MmsApp extends Application {
             }
         };
         mCountryDetector.addCountryListener(mCountryListener, getMainLooper());
-        mCountryIso = mCountryDetector.detectCountry().getCountryIso();
 
         Context context = getApplicationContext();
         mPduLoaderManager = new PduLoaderManager(context);
@@ -95,6 +98,23 @@ public class MmsApp extends Application {
         LayoutManager.init(this);
         SmileyParser.init(this);
         MessagingNotification.init(this);
+
+        activePendingMessages();
+    }
+
+    /**
+     * Try to process all pending messages(which were interrupted by user, OOM, Mms crashing,
+     * etc...) when Mms app is (re)launched.
+     */
+    private void activePendingMessages() {
+        // For Mms: try to process all pending transactions if possible
+        MmsSystemEventReceiver.wakeUpService(this);
+
+        // For Sms: retry to send smses in outbox and queued box
+        sendBroadcast(new Intent(SmsReceiverService.ACTION_SEND_INACTIVE_MESSAGE,
+                null,
+                this,
+                SmsReceiver.class));
     }
 
     synchronized public static MmsApp getApplication() {
@@ -152,7 +172,14 @@ public class MmsApp extends Application {
         return mRecentSuggestions;
     }
 
+    // This function CAN return null.
     public String getCurrentCountryIso() {
+        if (mCountryIso == null) {
+            Country country = mCountryDetector.detectCountry();
+            if (country != null) {
+                mCountryIso = country.getCountryIso();
+            }
+        }
         return mCountryIso;
     }
 
diff --git a/src/com/android/mms/MmsConfig.java b/src/com/android/mms/MmsConfig.java
index ee4392b..2c34af8 100755
--- a/src/com/android/mms/MmsConfig.java
+++ b/src/com/android/mms/MmsConfig.java
@@ -21,12 +21,12 @@ import java.io.IOException;
 import org.xmlpull.v1.XmlPullParser;
 import org.xmlpull.v1.XmlPullParserException;
 
-import com.android.internal.telephony.TelephonyProperties;
-
 import android.content.Context;
 import android.content.res.XmlResourceParser;
 import android.util.Log;
 
+import com.android.internal.telephony.TelephonyProperties;
+
 public class MmsConfig {
     private static final String TAG = "MmsConfig";
     private static final boolean DEBUG = true;
@@ -70,6 +70,12 @@ public class MmsConfig {
     // as an mms message. This feature exists for carriers that don't support multi-part sms's.
     private static boolean mEnableMultipartSMS = true;
 
+    // If mEnableMultipartSMS is true and mSmsToMmsTextThreshold > 1, then multi-part SMS messages
+    // will be converted into a single mms message. For example, if the mms_config.xml file
+    // specifies <int name="smsToMmsTextThreshold">4</int>, then on the 5th sms segment, the
+    // message will be converted to an mms.
+    private static int mSmsToMmsTextThreshold = -1;
+
     private static boolean mEnableSlideDuration = true;
     private static boolean mEnableMMSReadReports = true;        // key: "enableMMSReadReports"
     private static boolean mEnableSMSDeliveryReports = true;    // key: "enableSMSDeliveryReports"
@@ -89,6 +95,12 @@ public class MmsConfig {
     private static int mMaxSubjectLength = 40;  // maximum number of characters allowed for mms
                                                 // subject
 
+    // If mEnableGroupMms is true, a message with multiple recipients, regardless of contents,
+    // will be sent as a single MMS message with multiple "TO" fields set for each recipient.
+    // If mEnableGroupMms is false, the group MMS setting/preference will be hidden in the settings
+    // activity.
+    private static boolean mEnableGroupMms = true;
+
     public static void init(Context context) {
         if (LOCAL_LOGV) {
             Log.v(TAG, "MmsConfig.init()");
@@ -100,6 +112,10 @@ public class MmsConfig {
         loadMmsSettings(context);
     }
 
+    public static int getSmsToMmsTextThreshold() {
+        return mSmsToMmsTextThreshold;
+    }
+
     public static boolean getMmsEnabled() {
         return mMmsEnabled == 1 ? true : false;
     }
@@ -232,6 +248,10 @@ public class MmsConfig {
         return mMaxSubjectLength;
     }
 
+    public static boolean getGroupMmsEnabled() {
+        return mEnableGroupMms;
+    }
+
     public static final void beginDocument(XmlPullParser parser, String firstElementName) throws XmlPullParserException, IOException
     {
         int type;
@@ -305,6 +325,8 @@ public class MmsConfig {
                             mEnableSMSDeliveryReports = "true".equalsIgnoreCase(text);
                         } else if ("enableMMSDeliveryReports".equalsIgnoreCase(value)) {
                             mEnableMMSDeliveryReports = "true".equalsIgnoreCase(text);
+                        } else if ("enableGroupMms".equalsIgnoreCase(value)) {
+                            mEnableGroupMms = "true".equalsIgnoreCase(text);
                         }
                     } else if ("int".equals(tag)) {
                         // int config tags go here
@@ -337,6 +359,8 @@ public class MmsConfig {
                             mAliasRuleMinChars = Integer.parseInt(text);
                         } else if ("aliasMaxChars".equalsIgnoreCase(value)) {
                             mAliasRuleMaxChars = Integer.parseInt(text);
+                        } else if ("smsToMmsTextThreshold".equalsIgnoreCase(value)) {
+                            mSmsToMmsTextThreshold = Integer.parseInt(text);
                         } else if ("maxMessageTextSize".equalsIgnoreCase(value)) {
                             mMaxTextLength = Integer.parseInt(text);
                         } else if ("maxSubjectLength".equalsIgnoreCase(value)) {
diff --git a/src/com/android/mms/SuggestionsProvider.java b/src/com/android/mms/SuggestionsProvider.java
index 375851b..358ac06 100644
--- a/src/com/android/mms/SuggestionsProvider.java
+++ b/src/com/android/mms/SuggestionsProvider.java
@@ -17,7 +17,6 @@
 package com.android.mms;
 
 import java.util.ArrayList;
-import java.util.Map;
 
 import android.app.SearchManager;
 import android.content.ContentResolver;
diff --git a/src/com/android/mms/TempFileProvider.java b/src/com/android/mms/TempFileProvider.java
index 2ae0632..016c55d 100644
--- a/src/com/android/mms/TempFileProvider.java
+++ b/src/com/android/mms/TempFileProvider.java
@@ -3,6 +3,9 @@
 
 package com.android.mms;
 
+import java.io.File;
+import java.io.FileNotFoundException;
+
 import android.content.ContentProvider;
 import android.content.ContentValues;
 import android.content.Context;
@@ -12,9 +15,6 @@ import android.net.Uri;
 import android.os.ParcelFileDescriptor;
 import android.util.Log;
 
-import java.io.File;
-import java.io.FileNotFoundException;
-
 /**
  * The TempFileProvider manages a uri, backed by a file, for passing to the camera app for
  * capturing pictures and videos and storing the data in a file in the messaging app.
@@ -60,7 +60,7 @@ public class TempFileProvider extends ContentProvider {
         return 0;
     }
 
-    private ParcelFileDescriptor getTempStoreFd() {
+    private ParcelFileDescriptor getTempStoreFd(String mode) {
         String fileName = getScrapPath(getContext());
         ParcelFileDescriptor pfd = null;
 
@@ -75,9 +75,15 @@ public class TempFileProvider extends ContentProvider {
                 return null;
             }
 
-            pfd = ParcelFileDescriptor.open(file,
-                    ParcelFileDescriptor.MODE_READ_WRITE
-                            | android.os.ParcelFileDescriptor.MODE_CREATE);
+            int modeFlags;
+            if (mode.equals("r")) {
+                modeFlags = ParcelFileDescriptor.MODE_READ_ONLY;
+            } else {
+                modeFlags = ParcelFileDescriptor.MODE_READ_WRITE
+                            | ParcelFileDescriptor.MODE_CREATE
+                            | ParcelFileDescriptor.MODE_TRUNCATE;
+            }
+            pfd = ParcelFileDescriptor.open(file, modeFlags);
         } catch (Exception ex) {
             Log.e(TAG, "getTempStoreFd: error creating pfd for " + fileName, ex);
         }
@@ -104,7 +110,7 @@ public class TempFileProvider extends ContentProvider {
 
         switch (match) {
             case MMS_SCRAP_SPACE:
-                fd = getTempStoreFd();
+                fd = getTempStoreFd(mode);
                 break;
         }
 
diff --git a/src/com/android/mms/data/Contact.java b/src/com/android/mms/data/Contact.java
index d57f8d5..c29b9bd 100644
--- a/src/com/android/mms/data/Contact.java
+++ b/src/com/android/mms/data/Contact.java
@@ -13,6 +13,7 @@ import android.content.ContentUris;
 import android.content.Context;
 import android.database.ContentObserver;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.graphics.Bitmap;
 import android.graphics.BitmapFactory;
 import android.graphics.drawable.BitmapDrawable;
@@ -20,22 +21,21 @@ import android.graphics.drawable.Drawable;
 import android.net.Uri;
 import android.os.Handler;
 import android.os.Parcelable;
+import android.provider.ContactsContract.CommonDataKinds.Email;
+import android.provider.ContactsContract.CommonDataKinds.Phone;
 import android.provider.ContactsContract.Contacts;
 import android.provider.ContactsContract.Data;
 import android.provider.ContactsContract.Presence;
-import android.provider.ContactsContract.CommonDataKinds.Email;
-import android.provider.ContactsContract.CommonDataKinds.Phone;
 import android.provider.ContactsContract.Profile;
 import android.provider.Telephony.Mms;
 import android.telephony.PhoneNumberUtils;
 import android.text.TextUtils;
 import android.util.Log;
 
-import android.database.sqlite.SqliteWrapper;
-import com.android.mms.ui.MessageUtils;
 import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
 import com.android.mms.R;
+import com.android.mms.ui.MessageUtils;
 
 public class Contact {
     public static final int CONTACT_METHOD_TYPE_UNKNOWN = 0;
@@ -134,7 +134,7 @@ public class Contact {
                 mContactMethodId);
     }
 
-    private static void logWithTrace(String msg, Object... format) {
+    public static void logWithTrace(String tag, String msg, Object... format) {
         Thread current = Thread.currentThread();
         StackTraceElement[] stack = current.getStackTrace();
 
@@ -154,7 +154,7 @@ public class Contact {
             }
         }
 
-        Log.d(TAG, sb.toString());
+        Log.d(tag, sb.toString());
     }
 
     public static Contact get(String number, boolean canBlock) {
@@ -542,7 +542,7 @@ public class Contact {
 
         private Contact get(String number, boolean isMe, boolean canBlock) {
             if (Log.isLoggable(LogTag.CONTACT, Log.DEBUG)) {
-                logWithTrace("get(%s, %s, %s)", number, isMe, canBlock);
+                logWithTrace(TAG, "get(%s, %s, %s)", number, isMe, canBlock);
             }
 
             if (TextUtils.isEmpty(number)) {
diff --git a/src/com/android/mms/data/ContactList.java b/src/com/android/mms/data/ContactList.java
index 90a793f..01c2598 100644
--- a/src/com/android/mms/data/ContactList.java
+++ b/src/com/android/mms/data/ContactList.java
@@ -8,7 +8,6 @@ import android.os.Parcelable;
 import android.text.TextUtils;
 import android.util.Log;
 
-import com.android.mms.data.Contact.UpdateListener;
 import com.android.mms.LogTag;
 import com.android.mms.ui.MessageUtils;
 
diff --git a/src/com/android/mms/data/Conversation.java b/src/com/android/mms/data/Conversation.java
index 1d37d12..106cea2 100644
--- a/src/com/android/mms/data/Conversation.java
+++ b/src/com/android/mms/data/Conversation.java
@@ -13,14 +13,15 @@ import android.content.ContentUris;
 import android.content.ContentValues;
 import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.AsyncTask;
 import android.provider.BaseColumns;
 import android.provider.Telephony.Mms;
 import android.provider.Telephony.MmsSms;
 import android.provider.Telephony.Sms;
-import android.provider.Telephony.Threads;
 import android.provider.Telephony.Sms.Conversations;
+import android.provider.Telephony.Threads;
 import android.provider.Telephony.ThreadsColumns;
 import android.telephony.PhoneNumberUtils;
 import android.text.TextUtils;
@@ -30,9 +31,13 @@ import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
 import com.android.mms.R;
 import com.android.mms.transaction.MessagingNotification;
+import com.android.mms.transaction.MmsMessageSender;
+import com.android.mms.ui.ComposeMessageActivity;
 import com.android.mms.ui.MessageUtils;
+import com.android.mms.util.AddressUtils;
 import com.android.mms.util.DraftCache;
-import com.google.android.mms.util.PduCache;
+
+import com.google.android.mms.pdu.PduHeaders;
 
 /**
  * An interface for finding information about conversations and/or creating new ones.
@@ -40,6 +45,7 @@ import com.google.android.mms.util.PduCache;
 public class Conversation {
     private static final String TAG = "Mms/conv";
     private static final boolean DEBUG = false;
+    private static final boolean DELETEDEBUG = false;
 
     public static final Uri sAllThreadsUri =
         Threads.CONTENT_URI.buildUpon().appendQueryParameter("simple", "true").build();
@@ -296,6 +302,42 @@ public class Conversation {
         }
     }
 
+    private void sendReadReport(final Context context,
+            final long threadId,
+            final int status) {
+        String selection = Mms.MESSAGE_TYPE + " = " + PduHeaders.MESSAGE_TYPE_RETRIEVE_CONF
+            + " AND " + Mms.READ + " = 0"
+            + " AND " + Mms.READ_REPORT + " = " + PduHeaders.VALUE_YES;
+
+        if (threadId != -1) {
+            selection = selection + " AND " + Mms.THREAD_ID + " = " + threadId;
+        }
+
+        final Cursor c = SqliteWrapper.query(context, context.getContentResolver(),
+                        Mms.Inbox.CONTENT_URI, new String[] {Mms._ID, Mms.MESSAGE_ID},
+                        selection, null, null);
+
+        try {
+            if (c == null || c.getCount() == 0) {
+                return;
+            }
+
+            while (c.moveToNext()) {
+                Uri uri = ContentUris.withAppendedId(Mms.CONTENT_URI, c.getLong(0));
+                if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+                    LogTag.debug("sendReadReport: uri = " + uri);
+                }
+                MmsMessageSender.sendReadRec(context, AddressUtils.getFrom(context, uri),
+                                             c.getString(1), status);
+            }
+        } finally {
+            if (c != null) {
+                c.close();
+            }
+        }
+    }
+
+
     /**
      * Marks all messages in this conversation as read and updates
      * relevant notifications.  This method returns immediately;
@@ -303,6 +345,10 @@ public class Conversation {
      * always be called from the UI thread.
      */
     public void markAsRead() {
+        if (DELETEDEBUG) {
+            Contact.logWithTrace(TAG, "markAsRead mMarkAsReadWaiting: " + mMarkAsReadWaiting +
+                    " mMarkAsReadBlocked: " + mMarkAsReadBlocked);
+        }
         if (mMarkAsReadWaiting) {
             // We've already been asked to mark everything as read, but we're blocked.
             return;
@@ -317,8 +363,8 @@ public class Conversation {
 
         new AsyncTask<Void, Void, Void>() {
             protected Void doInBackground(Void... none) {
-                if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                    LogTag.debug("markAsRead");
+                if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+                    LogTag.debug("markAsRead.doInBackground");
                 }
                 // If we have no Uri to mark (as in the case of a conversation that
                 // has not yet made its way to disk), there's nothing to do.
@@ -342,6 +388,7 @@ public class Conversation {
                     }
 
                     if (needUpdate) {
+                        sendReadReport(mContext, mThreadId, PduHeaders.READ_STATUS_READ);
                         LogTag.debug("markAsRead: update read/seen for thread uri: " +
                                 threadUri);
                         mContext.getContentResolver().update(threadUri, sReadContentValues,
@@ -349,8 +396,10 @@ public class Conversation {
                     }
                     setHasUnreadMessages(false);
                 }
-                // Always update notifications regardless of the read state.
-                MessagingNotification.blockingUpdateAllNotifications(mContext);
+                // Always update notifications regardless of the read state, which is usually
+                // canceling the notification of the thread that was just marked read.
+                MessagingNotification.blockingUpdateAllNotifications(mContext,
+                        MessagingNotification.THREAD_NONE);
 
                 return null;
             }
@@ -364,7 +413,7 @@ public class Conversation {
      * can mark messages as read. Only call this function on the UI thread.
      */
     public void blockMarkAsRead(boolean block) {
-        if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+        if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             LogTag.debug("blockMarkAsRead: " + block);
         }
 
@@ -415,13 +464,13 @@ public class Conversation {
      * @return The thread ID of this conversation in the database
      */
     public synchronized long ensureThreadId() {
-        if (DEBUG) {
+        if (DEBUG || DELETEDEBUG) {
             LogTag.debug("ensureThreadId before: " + mThreadId);
         }
         if (mThreadId <= 0) {
             mThreadId = getOrCreateThreadId(mContext, mRecipients);
         }
-        if (DEBUG) {
+        if (DEBUG || DELETEDEBUG) {
             LogTag.debug("ensureThreadId after: " + mThreadId);
         }
 
@@ -456,7 +505,7 @@ public class Conversation {
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             Log.d(TAG, "setRecipients after: " + this.toString());
         }
-}
+    }
 
     /**
      * Returns the recipient set of this conversation.
@@ -567,6 +616,10 @@ public class Conversation {
             }
         }
         synchronized(sDeletingThreadsLock) {
+            if (DELETEDEBUG) {
+                ComposeMessageActivity.log("Conversation getOrCreateThreadId for: " +
+                        list.formatNamesAndNumbers(",") + " sDeletingThreads: " + sDeletingThreads);
+            }
             long now = System.currentTimeMillis();
             while (sDeletingThreads) {
                 try {
@@ -583,7 +636,7 @@ public class Conversation {
                 }
             }
             long retVal = Threads.getOrCreateThreadId(context, recipients);
-            if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+            if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
                 LogTag.debug("[Conversation] getOrCreateThreadId for (%s) returned %d",
                         recipients, retVal);
             }
@@ -593,6 +646,10 @@ public class Conversation {
 
     public static long getOrCreateThreadId(Context context, String address) {
         synchronized(sDeletingThreadsLock) {
+            if (DELETEDEBUG) {
+                ComposeMessageActivity.log("Conversation getOrCreateThreadId for: " +
+                        address + " sDeletingThreads: " + sDeletingThreads);
+            }
             long now = System.currentTimeMillis();
             while (sDeletingThreads) {
                 try {
@@ -609,7 +666,7 @@ public class Conversation {
                 }
             }
             long retVal = Threads.getOrCreateThreadId(context, address);
-            if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+            if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
                 LogTag.debug("[Conversation] getOrCreateThreadId for (%s) returned %d",
                         address, retVal);
             }
@@ -697,29 +754,30 @@ public class Conversation {
      *                upon completion of the conversation being deleted
      * @param token   The token that will be passed to onDeleteComplete
      * @param deleteAll Delete the whole thread including locked messages
-     * @param threadId Thread ID of the conversation to be deleted
+     * @param threadIds Collection of thread IDs of the conversations to be deleted
      */
     public static void startDelete(ConversationQueryHandler handler, int token, boolean deleteAll,
-            long threadId) {
+            Collection<Long> threadIds) {
         synchronized(sDeletingThreadsLock) {
+            if (DELETEDEBUG) {
+                Log.v(TAG, "Conversation startDelete sDeletingThreads: " +
+                        sDeletingThreads);
+            }
             if (sDeletingThreads) {
                 Log.e(TAG, "startDeleteAll already in the middle of a delete", new Exception());
             }
+            MmsApp.getApplication().getPduLoaderManager().clear();
             sDeletingThreads = true;
-            Uri uri = ContentUris.withAppendedId(Threads.CONTENT_URI, threadId);
-            String selection = deleteAll ? null : "locked=0";
 
-            MmsApp.getApplication().getPduLoaderManager().clear();
+            for (long threadId : threadIds) {
+                Uri uri = ContentUris.withAppendedId(Threads.CONTENT_URI, threadId);
+                String selection = deleteAll ? null : "locked=0";
 
-            // HACK: the keys to the thumbnail cache are the part uris, such as mms/part/3
-            // Because the part table doesn't have auto-increment ids, the part ids are reused
-            // when a message or thread is deleted. For now, we're clearing the whole thumbnail
-            // cache so we don't retrieve stale images when part ids are reused. This will be
-            // fixed in the next release in the mms provider.
-            MmsApp.getApplication().getThumbnailManager().clear();
+                handler.setDeleteToken(token);
+                handler.startDelete(token, new Long(threadId), uri, selection, null);
 
-            handler.setDeleteToken(token);
-            handler.startDelete(token, new Long(threadId), uri, selection, null);
+                DraftCache.getInstance().setDraftState(threadId, false);
+            }
         }
     }
 
@@ -733,20 +791,19 @@ public class Conversation {
     public static void startDeleteAll(ConversationQueryHandler handler, int token,
             boolean deleteAll) {
         synchronized(sDeletingThreadsLock) {
+            if (DELETEDEBUG) {
+                Log.v(TAG, "Conversation startDeleteAll sDeletingThreads: " +
+                                sDeletingThreads);
+            }
             if (sDeletingThreads) {
                 Log.e(TAG, "startDeleteAll already in the middle of a delete", new Exception());
             }
             sDeletingThreads = true;
             String selection = deleteAll ? null : "locked=0";
 
-            MmsApp.getApplication().getPduLoaderManager().clear();
-
-            // HACK: the keys to the thumbnail cache are the part uris, such as mms/part/3
-            // Because the part table doesn't have auto-increment ids, the part ids are reused
-            // when a message or thread is deleted. For now, we're clearing the whole thumbnail
-            // cache so we don't retrieve stale images when part ids are reused. This will be
-            // fixed in the next release in the mms provider.
-            MmsApp.getApplication().getThumbnailManager().clear();
+            MmsApp app = MmsApp.getApplication();
+            app.getPduLoaderManager().clear();
+            app.getThumbnailManager().clear();
 
             handler.setDeleteToken(token);
             handler.startDelete(token, new Long(-1), Threads.CONTENT_URI, selection, null);
@@ -779,6 +836,10 @@ public class Conversation {
                 // release lock
                 synchronized(sDeletingThreadsLock) {
                     sDeletingThreads = false;
+                    if (DELETEDEBUG) {
+                        Log.v(TAG, "Conversation onDeleteComplete sDeletingThreads: " +
+                                        sDeletingThreads);
+                    }
                     sDeletingThreadsLock.notifyAll();
                 }
             }
@@ -849,7 +910,8 @@ public class Conversation {
             conv.mMessageCount = c.getInt(MESSAGE_COUNT);
 
             // Replace the snippet with a default value if it's empty.
-            String snippet = MessageUtils.extractEncStrFromCursor(c, SNIPPET, SNIPPET_CS);
+            String snippet = MessageUtils.cleanseMmsSubject(context,
+                    MessageUtils.extractEncStrFromCursor(c, SNIPPET, SNIPPET_CS));
             if (TextUtils.isEmpty(snippet)) {
                 snippet = context.getString(R.string.no_subject_view);
             }
@@ -1040,18 +1102,22 @@ public class Conversation {
     }
 
     public static void markAllConversationsAsSeen(final Context context) {
-        if (DEBUG) {
-            LogTag.debug("Conversation.markAllConversationsAsSeen");
+        if (DELETEDEBUG || DEBUG) {
+            Contact.logWithTrace(TAG, "Conversation.markAllConversationsAsSeen");
         }
 
         Thread thread = new Thread(new Runnable() {
             @Override
             public void run() {
+                if (DELETEDEBUG) {
+                    Log.d(TAG, "Conversation.markAllConversationsAsSeen.run");
+                }
                 blockingMarkAllSmsMessagesAsSeen(context);
                 blockingMarkAllMmsMessagesAsSeen(context);
 
                 // Always update notifications regardless of the read state.
-                MessagingNotification.blockingUpdateAllNotifications(context);
+                MessagingNotification.blockingUpdateAllNotifications(context,
+                        MessagingNotification.THREAD_NONE);
             }
         }, "Conversation.markAllConversationsAsSeen");
         thread.setPriority(Thread.MIN_PRIORITY);
@@ -1080,7 +1146,7 @@ public class Conversation {
             return;
         }
 
-        if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+        if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             Log.d(TAG, "mark " + count + " SMS msgs as seen");
         }
 
@@ -1115,7 +1181,7 @@ public class Conversation {
             return;
         }
 
-        if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+        if (DELETEDEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             Log.d(TAG, "mark " + count + " MMS msgs as seen");
         }
 
diff --git a/src/com/android/mms/data/RecipientIdCache.java b/src/com/android/mms/data/RecipientIdCache.java
index 6857e32..34cbf8a 100644
--- a/src/com/android/mms/data/RecipientIdCache.java
+++ b/src/com/android/mms/data/RecipientIdCache.java
@@ -8,18 +8,18 @@ import java.util.Map;
 import javax.annotation.concurrent.GuardedBy;
 import javax.annotation.concurrent.ThreadSafe;
 
-import android.content.Context;
 import android.content.ContentResolver;
-import android.content.ContentValues;
 import android.content.ContentUris;
+import android.content.ContentValues;
+import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
+import android.provider.Telephony;
 import android.text.TextUtils;
 import android.util.Log;
-import android.provider.Telephony;
 
 import com.android.mms.LogTag;
-import android.database.sqlite.SqliteWrapper;
 
 @ThreadSafe
 public class RecipientIdCache {
diff --git a/src/com/android/mms/data/WorkingMessage.java b/src/com/android/mms/data/WorkingMessage.java
index d6bd3b1..250a63a 100755
--- a/src/com/android/mms/data/WorkingMessage.java
+++ b/src/com/android/mms/data/WorkingMessage.java
@@ -16,10 +16,14 @@
 
 package com.android.mms.data;
 
+import java.io.IOException;
+import java.io.InputStream;
 import java.util.ArrayList;
 import java.util.Arrays;
+import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
+import java.util.Set;
 
 import android.app.Activity;
 import android.content.ContentResolver;
@@ -42,6 +46,7 @@ import android.util.Pair;
 
 import com.android.common.contacts.DataUsageStatUpdater;
 import com.android.common.userhappiness.UserHappinessSignals;
+import com.android.mms.ContentRestrictionException;
 import com.android.mms.ExceedMessageSizeException;
 import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
@@ -57,6 +62,7 @@ import com.android.mms.transaction.MmsMessageSender;
 import com.android.mms.transaction.SmsMessageSender;
 import com.android.mms.ui.ComposeMessageActivity;
 import com.android.mms.ui.MessageUtils;
+import com.android.mms.ui.MessagingPreferenceActivity;
 import com.android.mms.ui.SlideshowEditor;
 import com.android.mms.util.DraftCache;
 import com.android.mms.util.Recycler;
@@ -95,6 +101,7 @@ public class WorkingMessage {
     private static final int HAS_ATTACHMENT = (1 << 2);             // 4
     private static final int LENGTH_REQUIRES_MMS = (1 << 3);        // 8
     private static final int FORCE_MMS = (1 << 4);                  // 16
+    private static final int MULTIPLE_RECIPIENTS = (1 << 5);        // 32
 
     // A bitmap of the above indicating different properties of the message;
     // any bit set will require the message to be sent via MMS.
@@ -451,9 +458,9 @@ public class WorkingMessage {
         if (result == OK) {
             mAttachmentType = type;
         }
-        correctAttachmentState();
+        correctAttachmentState();   // this can remove the slideshow if there are no attachments
 
-        if (type == IMAGE) {
+        if (mSlideshow != null && type == IMAGE) {
             // Prime the image's cache; helps A LOT when the image is coming from the network
             // (e.g. Picasa album). See b/5445690.
             int numSlides = mSlideshow.size();
@@ -469,26 +476,23 @@ public class WorkingMessage {
         mStatusListener.onAttachmentChanged();  // have to call whether succeeded or failed,
                                                 // because a replace that fails, removes the slide
 
-        if (!MmsConfig.getMultipartSmsEnabled()) {
-            if (!append && mAttachmentType == TEXT && type == TEXT) {
-                int[] params = SmsMessage.calculateLength(getText(), false);
-                /* SmsMessage.calculateLength returns an int[4] with:
-                *   int[0] being the number of SMS's required,
-                *   int[1] the number of code units used,
-                *   int[2] is the number of code units remaining until the next message.
-                *   int[3] is the encoding type that should be used for the message.
-                */
-                int msgCount = params[0];
-
-                if (msgCount > 1) {
-                    // The provider doesn't support multi-part sms's so as soon as the user types
-                    // an sms longer than one segment, we have to turn the message into an mms.
-                    setLengthRequiresMms(true, false);
-                } else {
-                    updateState(HAS_ATTACHMENT, hasAttachment(), true);
-                }
+        if (!append && mAttachmentType == TEXT && type == TEXT) {
+            int[] params = SmsMessage.calculateLength(getText(), false);
+            /* SmsMessage.calculateLength returns an int[4] with:
+             *   int[0] being the number of SMS's required,
+             *   int[1] the number of code units used,
+             *   int[2] is the number of code units remaining until the next message.
+             *   int[3] is the encoding type that should be used for the message.
+             */
+            int smsSegmentCount = params[0];
+
+            if (!MmsConfig.getMultipartSmsEnabled()) {
+                // The provider doesn't support multi-part sms's so as soon as the user types
+                // an sms longer than one segment, we have to turn the message into an mms.
+                setLengthRequiresMms(smsSegmentCount > 1, false);
             } else {
-                updateState(HAS_ATTACHMENT, hasAttachment(), true);
+                int threshold = MmsConfig.getSmsToMmsTextThreshold();
+                setLengthRequiresMms(threshold > 0 && smsSegmentCount > threshold, false);
             }
         } else {
             // Set HAS_ATTACHMENT if we need it.
@@ -766,7 +770,7 @@ public class WorkingMessage {
         // to first-class Contact objects before we save.
         syncWorkingRecipients();
 
-        if (requiresMms()) {
+        if (hasMmsContentToSave()) {
             ensureSlideshow();
             syncTextToSlideshow();
         }
@@ -779,6 +783,7 @@ public class WorkingMessage {
         if (mWorkingRecipients != null) {
             ContactList recipients = ContactList.getByNumbers(mWorkingRecipients, false);
             mConversation.setRecipients(recipients);    // resets the threadId to zero
+            setHasMultipleRecipients(recipients.size() > 1, true);
             mWorkingRecipients = null;
         }
     }
@@ -836,9 +841,10 @@ public class WorkingMessage {
             // If we don't already have a Uri lying around, make a new one.  If we do
             // have one already, make sure it is synced to disk.
             if (mMessageUri == null) {
-                mMessageUri = createDraftMmsMessage(persister, sendReq, mSlideshow, null);
+                mMessageUri = createDraftMmsMessage(persister, sendReq, mSlideshow, null,
+                        mActivity, null);
             } else {
-                updateDraftMmsMessage(mMessageUri, persister, mSlideshow, sendReq);
+                updateDraftMmsMessage(mMessageUri, persister, mSlideshow, sendReq, null);
             }
             mHasMmsDraft = true;
         } finally {
@@ -872,8 +878,10 @@ public class WorkingMessage {
         prepareForSave(false /* notify */);
 
         if (requiresMms()) {
-            asyncUpdateDraftMmsMessage(mConversation, isStopping);
-            mHasMmsDraft = true;
+            if (hasMmsContentToSave()) {
+                asyncUpdateDraftMmsMessage(mConversation, isStopping);
+                mHasMmsDraft = true;
+            }
         } else {
             String content = mText.toString();
 
@@ -884,7 +892,7 @@ public class WorkingMessage {
             // and takes that thread id (because it's the next thread id to be assigned), the
             // new message will be merged with the draft message thread, causing confusion!
             if (!TextUtils.isEmpty(content)) {
-                asyncUpdateDraftSmsMessage(mConversation, content);
+                asyncUpdateDraftSmsMessage(mConversation, content, isStopping);
                 mHasSmsDraft = true;
             } else {
                 // When there's no associated text message, we have to handle the case where there
@@ -895,9 +903,6 @@ public class WorkingMessage {
                 mMessageUri = null;
             }
         }
-
-        // Update state of the draft cache.
-        mConversation.setDraftState(true);
     }
 
     synchronized public void discard() {
@@ -1030,7 +1035,9 @@ public class WorkingMessage {
         mConversation = conv;
 
         // Convert to MMS if there are any email addresses in the recipient list.
-        setHasEmail(conv.getRecipients().containsEmail(), false);
+        ContactList contactList = conv.getRecipients();
+        setHasEmail(contactList.containsEmail(), false);
+        setHasMultipleRecipients(contactList.size() > 1, false);
     }
 
     public Conversation getConversation() {
@@ -1048,6 +1055,19 @@ public class WorkingMessage {
             updateState(RECIPIENTS_REQUIRE_MMS, hasEmail, notify);
         }
     }
+    /**
+     * Set whether this message will be sent to multiple recipients. This is a hint whether the
+     * message needs to be sent as an mms or not. If MmsConfig.getGroupMmsEnabled is false, then
+     * the fact that the message is sent to multiple recipients is not a factor in determining
+     * whether the message is sent as an mms, but the other factors (such as, "has a picture
+     * attachment") still hold true.
+     */
+    public void setHasMultipleRecipients(boolean hasMultipleRecipients, boolean notify) {
+        updateState(MULTIPLE_RECIPIENTS,
+                hasMultipleRecipients &&
+                    MessagingPreferenceActivity.getIsGroupMmsEnabled(mActivity),
+                notify);
+    }
 
     /**
      * Returns true if this message would require MMS to send.
@@ -1057,6 +1077,22 @@ public class WorkingMessage {
     }
 
     /**
+     * Returns true if this message has been turned into an mms because it has a subject or
+     * an attachment, but not just because it has multiple recipients.
+     */
+    private boolean hasMmsContentToSave() {
+        if (mMmsState == 0) {
+            return false;
+        }
+        if (mMmsState == MULTIPLE_RECIPIENTS && !hasText()) {
+            // If this message is only mms because of multiple recipients and there's no text
+            // to save, don't bother saving.
+            return false;
+        }
+        return true;
+    }
+
+    /**
      * Set whether or not we want to send this message via MMS in order to
      * avoid sending an excessive number of concatenated SMS messages.
      * @param: mmsRequired is the value for the LENGTH_REQUIRES_MMS bit.
@@ -1081,6 +1117,8 @@ public class WorkingMessage {
             sb.append("LENGTH_REQUIRES_MMS | ");
         if ((state & FORCE_MMS) > 0)
             sb.append("FORCE_MMS | ");
+        if ((state & MULTIPLE_RECIPIENTS) > 0)
+            sb.append("MULTIPLE_RECIPIENTS | ");
 
         sb.delete(sb.length() - 3, sb.length());
         return sb.toString();
@@ -1175,6 +1213,7 @@ public class WorkingMessage {
 
             final SlideshowModel slideshow = mSlideshow;
             final CharSequence subject = mSubject;
+            final boolean textOnly = mAttachmentType == TEXT;
 
             if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
                 LogTag.debug("Send mmsUri: " + mmsUri);
@@ -1189,7 +1228,7 @@ public class WorkingMessage {
                     // Make sure the text in slide 0 is no longer holding onto a reference to
                     // the text in the message text box.
                     slideshow.prepareForSend();
-                    sendMmsWorker(conv, mmsUri, persister, slideshow, sendReq);
+                    sendMmsWorker(conv, mmsUri, persister, slideshow, sendReq, textOnly);
 
                     updateSendStats(conv);
                 }
@@ -1304,7 +1343,7 @@ public class WorkingMessage {
     }
 
     private void sendMmsWorker(Conversation conv, Uri mmsUri, PduPersister persister,
-            SlideshowModel slideshow, SendReq sendReq) {
+            SlideshowModel slideshow, SendReq sendReq, boolean textOnly) {
         long threadId = 0;
         Cursor cursor = null;
         boolean newMessage = false;
@@ -1353,6 +1392,9 @@ public class WorkingMessage {
                 values.put(Mms.MESSAGE_BOX, Mms.MESSAGE_BOX_OUTBOX);
                 values.put(Mms.THREAD_ID, threadId);
                 values.put(Mms.MESSAGE_TYPE, PduHeaders.MESSAGE_TYPE_SEND_REQ);
+                if (textOnly) {
+                    values.put(Mms.TEXT_ONLY, 1);
+                }
                 mmsUri = SqliteWrapper.insert(mActivity, mContentResolver, Mms.Outbox.CONTENT_URI,
                         values);
             }
@@ -1388,10 +1430,11 @@ public class WorkingMessage {
         try {
             if (newMessage) {
                 // Create a new MMS message if one hasn't been made yet.
-                mmsUri = createDraftMmsMessage(persister, sendReq, slideshow, mmsUri);
+                mmsUri = createDraftMmsMessage(persister, sendReq, slideshow, mmsUri,
+                        mActivity, null);
             } else {
                 // Otherwise, sync the MMS message in progress to disk.
-                updateDraftMmsMessage(mmsUri, persister, slideshow, sendReq);
+                updateDraftMmsMessage(mmsUri, persister, slideshow, sendReq, null);
             }
 
             // Be paranoid and clean any draft SMS up.
@@ -1522,14 +1565,17 @@ public class WorkingMessage {
     }
 
     private static Uri createDraftMmsMessage(PduPersister persister, SendReq sendReq,
-            SlideshowModel slideshow, Uri preUri) {
+            SlideshowModel slideshow, Uri preUri, Context context,
+            HashMap<Uri, InputStream> preOpenedFiles) {
         if (slideshow == null) {
             return null;
         }
         try {
             PduBody pb = slideshow.toPduBody();
             sendReq.setBody(pb);
-            Uri res = persister.persist(sendReq, preUri == null ? Mms.Draft.CONTENT_URI : preUri);
+            Uri res = persister.persist(sendReq, preUri == null ? Mms.Draft.CONTENT_URI : preUri,
+                    true, MessagingPreferenceActivity.getIsGroupMmsEnabled(context),
+                    preOpenedFiles);
             slideshow.sync(pb);
             return res;
         } catch (MmsException e) {
@@ -1541,6 +1587,8 @@ public class WorkingMessage {
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             LogTag.debug("asyncUpdateDraftMmsMessage conv=%s mMessageUri=%s", conv, mMessageUri);
         }
+        final HashMap<Uri, InputStream> preOpenedFiles =
+                mSlideshow.openPartFiles(mContentResolver);
 
         new Thread(new Runnable() {
             @Override
@@ -1552,24 +1600,13 @@ public class WorkingMessage {
                     final SendReq sendReq = makeSendReq(conv, mSubject);
 
                     if (mMessageUri == null) {
-                        mMessageUri = createDraftMmsMessage(persister, sendReq, mSlideshow, null);
+                        mMessageUri = createDraftMmsMessage(persister, sendReq, mSlideshow, null,
+                                mActivity, preOpenedFiles);
                     } else {
-                        updateDraftMmsMessage(mMessageUri, persister, mSlideshow, sendReq);
-                    }
-                    if (isStopping && conv.getMessageCount() == 0) {
-                        // createDraftMmsMessage can create the new thread in the threads table (the
-                        // call to createDraftMmsDraftMessage calls PduPersister.persist() which
-                        // can call Threads.getOrCreateThreadId()). Meanwhile, when the user goes
-                        // back to ConversationList while we're saving a draft from CMA's.onStop,
-                        // ConversationList will delete all threads from the thread table that
-                        // don't have associated sms or pdu entries. In case our thread got deleted,
-                        // well call clearThreadId() so ensureThreadId will query the db for the new
-                        // thread.
-                        conv.clearThreadId();   // force us to get the updated thread id
-                    }
-                    if (!conv.getRecipients().isEmpty()) {
-                        conv.ensureThreadId();
+                        updateDraftMmsMessage(mMessageUri, persister, mSlideshow, sendReq,
+                                preOpenedFiles);
                     }
+                    ensureThreadIdIfNeeded(conv, isStopping);
                     conv.setDraftState(true);
                     if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
                         LogTag.debug("asyncUpdateDraftMmsMessage conv: " + conv +
@@ -1581,13 +1618,14 @@ public class WorkingMessage {
                     asyncDeleteDraftSmsMessage(conv);
                 } finally {
                     DraftCache.getInstance().setSavingDraft(false);
+                    closePreOpenedFiles(preOpenedFiles);
                 }
             }
         }, "WorkingMessage.asyncUpdateDraftMmsMessage").start();
     }
 
     private static void updateDraftMmsMessage(Uri uri, PduPersister persister,
-            SlideshowModel slideshow, SendReq sendReq) {
+            SlideshowModel slideshow, SendReq sendReq, HashMap<Uri, InputStream> preOpenedFiles) {
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             LogTag.debug("updateDraftMmsMessage uri=%s", uri);
         }
@@ -1600,7 +1638,7 @@ public class WorkingMessage {
         final PduBody pb = slideshow.toPduBody();
 
         try {
-            persister.updateParts(uri, pb);
+            persister.updateParts(uri, pb, preOpenedFiles);
         } catch (MmsException e) {
             Log.e(TAG, "updateDraftMmsMessage: cannot update message " + uri);
         }
@@ -1608,6 +1646,22 @@ public class WorkingMessage {
         slideshow.sync(pb);
     }
 
+    private static void closePreOpenedFiles(HashMap<Uri, InputStream> preOpenedFiles) {
+        if (preOpenedFiles == null) {
+            return;
+        }
+        Set<Uri> uris = preOpenedFiles.keySet();
+        for (Uri uri : uris) {
+            InputStream is = preOpenedFiles.get(uri);
+            if (is != null) {
+                try {
+                    is.close();
+                } catch (IOException e) {
+                }
+            }
+        }
+    }
+
     private static final String SMS_DRAFT_WHERE = Sms.TYPE + "=" + Sms.MESSAGE_TYPE_DRAFT;
     private static final String[] SMS_BODY_PROJECTION = { Sms.BODY };
     private static final int SMS_BODY_INDEX = 0;
@@ -1672,7 +1726,8 @@ public class WorkingMessage {
         conv.setDraftState(false);
     }
 
-    private void asyncUpdateDraftSmsMessage(final Conversation conv, final String contents) {
+    private void asyncUpdateDraftSmsMessage(final Conversation conv, final String contents,
+            final boolean isStopping) {
         new Thread(new Runnable() {
             @Override
             public void run() {
@@ -1684,7 +1739,7 @@ public class WorkingMessage {
                         }
                         return;
                     }
-                    long threadId = conv.ensureThreadId();
+                    ensureThreadIdIfNeeded(conv, isStopping);
                     conv.setDraftState(true);
                     updateDraftSmsMessage(conv, contents);
                 } finally {
@@ -1751,4 +1806,25 @@ public class WorkingMessage {
         final String where = Mms.THREAD_ID +  (threadId > 0 ? " = " + threadId : " IS NULL");
         asyncDelete(Mms.Draft.CONTENT_URI, where, null);
     }
+
+    /**
+     * Ensure the thread id in conversation if needed, when we try to save a draft with a orphaned
+     * one.
+     * @param conv The conversation we are in.
+     * @param isStopping Whether we are saving the draft in CMA'a onStop
+     */
+    private void ensureThreadIdIfNeeded(final Conversation conv, final boolean isStopping) {
+        if (isStopping && conv.getMessageCount() == 0) {
+            // We need to save the drafts in an unorphaned thread id. When the user goes
+            // back to ConversationList while we're saving a draft from CMA's.onStop,
+            // ConversationList will delete all threads from the thread table that
+            // don't have associated sms or pdu entries. In case our thread got deleted,
+            // well call clearThreadId() so ensureThreadId will query the db for the new
+            // thread.
+            conv.clearThreadId();   // force us to get the updated thread id
+        }
+        if (!conv.getRecipients().isEmpty()) {
+            conv.ensureThreadId();
+        }
+    }
 }
diff --git a/src/com/android/mms/dom/smil/SmilLayoutElementImpl.java b/src/com/android/mms/dom/smil/SmilLayoutElementImpl.java
index 99edbb8..aae4be4 100644
--- a/src/com/android/mms/dom/smil/SmilLayoutElementImpl.java
+++ b/src/com/android/mms/dom/smil/SmilLayoutElementImpl.java
@@ -17,12 +17,12 @@
 
 package com.android.mms.dom.smil;
 
-import com.android.mms.layout.LayoutManager;
-
 import org.w3c.dom.NodeList;
 import org.w3c.dom.smil.SMILLayoutElement;
 import org.w3c.dom.smil.SMILRootLayoutElement;
 
+import com.android.mms.layout.LayoutManager;
+
 public class SmilLayoutElementImpl extends SmilElementImpl implements
         SMILLayoutElement {
     SmilLayoutElementImpl(SmilDocumentImpl owner, String tagName) {
diff --git a/src/com/android/mms/dom/smil/SmilMediaElementImpl.java b/src/com/android/mms/dom/smil/SmilMediaElementImpl.java
index 10d885b..324f3a7 100644
--- a/src/com/android/mms/dom/smil/SmilMediaElementImpl.java
+++ b/src/com/android/mms/dom/smil/SmilMediaElementImpl.java
@@ -17,7 +17,6 @@
 
 package com.android.mms.dom.smil;
 
-import com.android.mms.dom.events.EventImpl;
 import org.w3c.dom.DOMException;
 import org.w3c.dom.events.DocumentEvent;
 import org.w3c.dom.events.Event;
@@ -27,6 +26,8 @@ import org.w3c.dom.smil.TimeList;
 
 import android.util.Log;
 
+import com.android.mms.dom.events.EventImpl;
+
 public class SmilMediaElementImpl extends SmilElementImpl implements
         SMILMediaElement {
     public final static String SMIL_MEDIA_START_EVENT = "SmilMediaStart";
diff --git a/src/com/android/mms/dom/smil/SmilPlayer.java b/src/com/android/mms/dom/smil/SmilPlayer.java
index af2c763..a0a9044 100644
--- a/src/com/android/mms/dom/smil/SmilPlayer.java
+++ b/src/com/android/mms/dom/smil/SmilPlayer.java
@@ -17,6 +17,11 @@
 
 package com.android.mms.dom.smil;
 
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.Comparator;
+import java.util.HashSet;
+
 import org.w3c.dom.NodeList;
 import org.w3c.dom.events.DocumentEvent;
 import org.w3c.dom.events.Event;
@@ -29,11 +34,6 @@ import org.w3c.dom.smil.TimeList;
 
 import android.util.Log;
 
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.HashSet;
-
 /**
  * The SmilPlayer is responsible for playing, stopping, pausing and resuming a SMIL tree.
  * <li>It creates a whole timeline before playing.</li>
diff --git a/src/com/android/mms/dom/smil/parser/SmilContentHandler.java b/src/com/android/mms/dom/smil/parser/SmilContentHandler.java
index 12c11e7..1c92f59 100644
--- a/src/com/android/mms/dom/smil/parser/SmilContentHandler.java
+++ b/src/com/android/mms/dom/smil/parser/SmilContentHandler.java
@@ -17,13 +17,13 @@
 
 package com.android.mms.dom.smil.parser;
 
-import android.util.Log;
-
-import org.xml.sax.Attributes;
-import org.xml.sax.helpers.DefaultHandler;
-import org.w3c.dom.smil.SMILDocument;
 import org.w3c.dom.Element;
 import org.w3c.dom.Node;
+import org.w3c.dom.smil.SMILDocument;
+import org.xml.sax.Attributes;
+import org.xml.sax.helpers.DefaultHandler;
+
+import android.util.Log;
 
 import com.android.mms.dom.smil.SmilDocumentImpl;
 
diff --git a/src/com/android/mms/dom/smil/parser/SmilXmlParser.java b/src/com/android/mms/dom/smil/parser/SmilXmlParser.java
index 4af20a3..969113a 100644
--- a/src/com/android/mms/dom/smil/parser/SmilXmlParser.java
+++ b/src/com/android/mms/dom/smil/parser/SmilXmlParser.java
@@ -17,18 +17,16 @@
 
 package com.android.mms.dom.smil.parser;
 
-import com.google.android.mms.MmsException;
-
 import java.io.IOException;
 import java.io.InputStream;
 
+import org.w3c.dom.smil.SMILDocument;
 import org.xml.sax.InputSource;
 import org.xml.sax.SAXException;
 import org.xml.sax.XMLReader;
 import org.xml.sax.helpers.XMLReaderFactory;
-import org.w3c.dom.smil.SMILDocument;
 
-import com.android.mms.dom.smil.parser.SmilContentHandler;
+import com.google.android.mms.MmsException;
 
 public class SmilXmlParser {
     private XMLReader mXmlReader;
diff --git a/src/com/android/mms/drm/DrmUtils.java b/src/com/android/mms/drm/DrmUtils.java
index 019487b..c1a321c 100644
--- a/src/com/android/mms/drm/DrmUtils.java
+++ b/src/com/android/mms/drm/DrmUtils.java
@@ -17,16 +17,11 @@
 
 package com.android.mms.drm;
 
-import android.drm.*;
+import android.drm.DrmManagerClient;
+import android.drm.DrmStore;
 import android.net.Uri;
 import android.util.Log;
 
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.RandomAccessFile;
-
 import com.android.mms.MmsApp;
 
 public class DrmUtils {
diff --git a/src/com/android/mms/layout/LayoutManager.java b/src/com/android/mms/layout/LayoutManager.java
index eae2479..76cb5ae 100644
--- a/src/com/android/mms/layout/LayoutManager.java
+++ b/src/com/android/mms/layout/LayoutManager.java
@@ -20,8 +20,6 @@ package com.android.mms.layout;
 import android.content.Context;
 import android.content.res.Configuration;
 import android.util.Log;
-import android.view.Display;
-import android.view.WindowManager;
 
 /**
  * MMS presentation layout management.
diff --git a/src/com/android/mms/model/AudioModel.java b/src/com/android/mms/model/AudioModel.java
index b1fe051..a6f08a4 100644
--- a/src/com/android/mms/model/AudioModel.java
+++ b/src/com/android/mms/model/AudioModel.java
@@ -17,26 +17,25 @@
 
 package com.android.mms.model;
 
-import com.android.mms.ContentRestrictionException;
-import com.android.mms.dom.events.EventImpl;
-import com.android.mms.dom.smil.SmilMediaElementImpl;
-import com.google.android.mms.MmsException;
-import android.database.sqlite.SqliteWrapper;
+import java.util.HashMap;
+import java.util.Map;
 
 import org.w3c.dom.events.Event;
 
 import android.content.ContentResolver;
 import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.provider.MediaStore.Audio;
 import android.provider.Telephony.Mms.Part;
 import android.text.TextUtils;
 import android.util.Log;
 
-import java.io.IOException;
-import java.util.HashMap;
-import java.util.Map;
+import com.android.mms.ContentRestrictionException;
+import com.android.mms.dom.events.EventImpl;
+import com.android.mms.dom.smil.SmilMediaElementImpl;
+import com.google.android.mms.MmsException;
 
 public class AudioModel extends MediaModel {
     private static final String TAG = MediaModel.TAG;
diff --git a/src/com/android/mms/model/CarrierContentRestriction.java b/src/com/android/mms/model/CarrierContentRestriction.java
index 949c5b4..2d16745 100644
--- a/src/com/android/mms/model/CarrierContentRestriction.java
+++ b/src/com/android/mms/model/CarrierContentRestriction.java
@@ -21,13 +21,13 @@ import java.util.ArrayList;
 import android.content.ContentResolver;
 import android.util.Log;
 
-import com.google.android.mms.ContentType;
 import com.android.mms.ContentRestrictionException;
 import com.android.mms.ExceedMessageSizeException;
 import com.android.mms.LogTag;
 import com.android.mms.MmsConfig;
 import com.android.mms.ResolutionException;
 import com.android.mms.UnsupportContentTypeException;
+import com.google.android.mms.ContentType;
 
 public class CarrierContentRestriction implements ContentRestriction {
     private static final ArrayList<String> sSupportedImageTypes;
diff --git a/src/com/android/mms/model/ImageModel.java b/src/com/android/mms/model/ImageModel.java
index 40810aa..045e7ac 100644
--- a/src/com/android/mms/model/ImageModel.java
+++ b/src/com/android/mms/model/ImageModel.java
@@ -17,6 +17,21 @@
 
 package com.android.mms.model;
 
+import java.lang.ref.SoftReference;
+import java.util.Arrays;
+import java.util.HashSet;
+import java.util.Set;
+
+import org.w3c.dom.events.Event;
+import org.w3c.dom.smil.ElementTime;
+
+import android.content.Context;
+import android.graphics.Bitmap;
+import android.graphics.BitmapFactory;
+import android.net.Uri;
+import android.text.TextUtils;
+import android.util.Log;
+
 import com.android.mms.ContentRestrictionException;
 import com.android.mms.ExceedMessageSizeException;
 import com.android.mms.LogTag;
@@ -27,27 +42,10 @@ import com.android.mms.ui.UriImage;
 import com.android.mms.util.ItemLoadedCallback;
 import com.android.mms.util.ItemLoadedFuture;
 import com.android.mms.util.ThumbnailManager;
-
 import com.google.android.mms.MmsException;
 import com.google.android.mms.pdu.PduPart;
 import com.google.android.mms.pdu.PduPersister;
 
-import org.w3c.dom.events.Event;
-import org.w3c.dom.smil.ElementTime;
-
-import android.content.Context;
-import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
-import android.net.Uri;
-import android.text.TextUtils;
-import android.util.Log;
-
-import java.io.IOException;
-import java.lang.ref.SoftReference;
-import java.util.Arrays;
-import java.util.HashSet;
-import java.util.Set;
-
 
 public class ImageModel extends RegionMediaModel {
     private static final String TAG = "Mms/image";
@@ -145,11 +143,11 @@ public class ImageModel extends RegionMediaModel {
     }
 
     public void cancelThumbnailLoading() {
-        if (mItemLoadedFuture != null) {
+        if (mItemLoadedFuture != null && !mItemLoadedFuture.isDone()) {
             if (Log.isLoggable(LogTag.APP, Log.DEBUG)) {
                 Log.v(TAG, "cancelThumbnailLoading for: " + this);
             }
-            mItemLoadedFuture.cancel();
+            mItemLoadedFuture.cancel(getUri());
             mItemLoadedFuture = null;
         }
     }
@@ -250,7 +248,7 @@ public class ImageModel extends RegionMediaModel {
             Log.v(TAG, "resizeMedia mSize: " + mSize);
         }
 
-        Uri newUri = persister.persistPart(part, messageId);
+        Uri newUri = persister.persistPart(part, messageId, null);
         setUri(newUri);
     }
 }
diff --git a/src/com/android/mms/model/LayoutModel.java b/src/com/android/mms/model/LayoutModel.java
index e52b65c..0280534 100644
--- a/src/com/android/mms/model/LayoutModel.java
+++ b/src/com/android/mms/model/LayoutModel.java
@@ -17,13 +17,13 @@
 
 package com.android.mms.model;
 
-import com.android.mms.layout.LayoutManager;
-import com.android.mms.layout.LayoutParameters;
+import java.util.ArrayList;
 
 import android.util.Config;
 import android.util.Log;
 
-import java.util.ArrayList;
+import com.android.mms.layout.LayoutManager;
+import com.android.mms.layout.LayoutParameters;
 
 public class LayoutModel extends Model {
     private static final String TAG = SlideModel.TAG;
@@ -110,6 +110,11 @@ public class LayoutModel extends Model {
         if (mTextRegion == null) {
             createDefaultTextRegion();
         }
+        // LayoutModel will re-construct when orientation changes, so we need to
+        // initialize mLayoutType here. Otherwise, the mLayoutType is alway default
+        // value (LAYOUT_BOTTOM_TEXT) after LayoutModel re-construct.
+        mLayoutType =
+                (mImageRegion.getTop() == 0) ? LAYOUT_BOTTOM_TEXT : LAYOUT_TOP_TEXT;
     }
 
     public RegionModel getRootLayout() {
diff --git a/src/com/android/mms/model/MediaModel.java b/src/com/android/mms/model/MediaModel.java
index 452d361..8118da2 100644
--- a/src/com/android/mms/model/MediaModel.java
+++ b/src/com/android/mms/model/MediaModel.java
@@ -17,24 +17,25 @@
 
 package com.android.mms.model;
 
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import android.media.MediaMetadataRetriever;        // TODO: remove dependency for SDK build
-import com.google.android.mms.MmsException;
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.ArrayList;
 
 import org.w3c.dom.events.EventListener;
 
 import android.content.ContentResolver;
 import android.content.Context;
 import android.content.Intent;
+import android.media.MediaMetadataRetriever;
 import android.net.Uri;
 import android.util.Log;
 
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.ArrayList;
+import com.android.mms.LogTag;
+import com.android.mms.MmsConfig;
+import com.google.android.mms.MmsException;
+// TODO: remove dependency for SDK build
 
 public abstract class MediaModel extends Model implements EventListener {
     protected static final String TAG = "Mms/media";
@@ -239,6 +240,11 @@ public abstract class MediaModel extends Model implements EventListener {
                 // sometimes mSize will be zero here. It's tempting to count the bytes as the code
                 // does below, but that turns out to be very slow. We'll deal with a zero size
                 // when we resize the media.
+
+                if (isVideo() && mSize > MmsConfig.getMaxMessageSize()) {
+                    Log.w(TAG, "initMediaSize: Video size: f.getChannel().size(): " + mSize +
+                            " larger than max message size: " + MmsConfig.getMaxMessageSize());
+                }
             } else {
                 while (-1 != input.read()) {
                     mSize++;
diff --git a/src/com/android/mms/model/MediaModelFactory.java b/src/com/android/mms/model/MediaModelFactory.java
index 9928395..6ed7a7b 100644
--- a/src/com/android/mms/model/MediaModelFactory.java
+++ b/src/com/android/mms/model/MediaModelFactory.java
@@ -17,14 +17,7 @@
 
 package com.android.mms.model;
 
-import com.android.mms.UnsupportContentTypeException;
-import com.android.mms.LogTag;
-import com.android.mms.MmsConfig;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.CharacterSets;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduPart;
+import java.io.IOException;
 
 import org.w3c.dom.smil.SMILMediaElement;
 import org.w3c.dom.smil.SMILRegionElement;
@@ -35,7 +28,12 @@ import org.w3c.dom.smil.TimeList;
 import android.content.Context;
 import android.util.Log;
 
-import java.io.IOException;
+import com.android.mms.LogTag;
+import com.android.mms.MmsConfig;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduPart;
 
 public class MediaModelFactory {
     private static final String TAG = "Mms:media";
diff --git a/src/com/android/mms/model/Model.java b/src/com/android/mms/model/Model.java
index 55c6b48..bd6abe1 100644
--- a/src/com/android/mms/model/Model.java
+++ b/src/com/android/mms/model/Model.java
@@ -17,11 +17,11 @@
 
 package com.android.mms.model;
 
-import java.util.ArrayList;
+import java.util.concurrent.CopyOnWriteArrayList;
 
 public class Model {
-    protected ArrayList<IModelChangedObserver> mModelChangedObservers =
-            new ArrayList<IModelChangedObserver>();
+    protected CopyOnWriteArrayList<IModelChangedObserver> mModelChangedObservers =
+            new CopyOnWriteArrayList<IModelChangedObserver>();
 
     public void registerModelChangedObserver(IModelChangedObserver observer) {
         if (!mModelChangedObservers.contains(observer)) {
diff --git a/src/com/android/mms/model/RegionMediaModel.java b/src/com/android/mms/model/RegionMediaModel.java
index 8bbb06b..2ea7da3 100644
--- a/src/com/android/mms/model/RegionMediaModel.java
+++ b/src/com/android/mms/model/RegionMediaModel.java
@@ -17,12 +17,10 @@
 
 package com.android.mms.model;
 
-import com.google.android.mms.MmsException;
-
 import android.content.Context;
 import android.net.Uri;
 
-import java.io.IOException;
+import com.google.android.mms.MmsException;
 
 public abstract class RegionMediaModel extends MediaModel {
     protected RegionModel mRegion;
diff --git a/src/com/android/mms/model/SlideModel.java b/src/com/android/mms/model/SlideModel.java
index 3c8d70b..48c9d7c 100644
--- a/src/com/android/mms/model/SlideModel.java
+++ b/src/com/android/mms/model/SlideModel.java
@@ -17,23 +17,23 @@
 
 package com.android.mms.model;
 
-import com.android.mms.ContentRestrictionException;
-import com.android.mms.dom.smil.SmilParElementImpl;
-import com.google.android.mms.ContentType;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Iterator;
+import java.util.List;
+import java.util.ListIterator;
 
 import org.w3c.dom.events.Event;
 import org.w3c.dom.events.EventListener;
 import org.w3c.dom.smil.ElementTime;
 
+import android.text.TextUtils;
 import android.util.Config;
 import android.util.Log;
-import android.text.TextUtils;
 
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Iterator;
-import java.util.List;
-import java.util.ListIterator;
+import com.android.mms.ContentRestrictionException;
+import com.android.mms.dom.smil.SmilParElementImpl;
+import com.google.android.mms.ContentType;
 
 public class SlideModel extends Model implements List<MediaModel>, EventListener {
     public static final String TAG = "Mms/slideshow";
@@ -233,6 +233,9 @@ public class SlideModel extends Model implements List<MediaModel>, EventListener
     public void decreaseSlideSize(int decreaseSize) {
         if (decreaseSize > 0) {
             mSlideSize -= decreaseSize;
+            if (mSlideSize < 0) {
+                mSlideSize = 0;
+            }
         }
     }
 
@@ -252,6 +255,9 @@ public class SlideModel extends Model implements List<MediaModel>, EventListener
         if ((decreaseSize > 0) && (null != mParent)) {
             int size = mParent.getCurrentMessageSize();
             size -= decreaseSize;
+            if (size < 0) {
+                size = 0;
+            }
             mParent.setCurrentMessageSize(size);
         }
     }
diff --git a/src/com/android/mms/model/SlideshowModel.java b/src/com/android/mms/model/SlideshowModel.java
index e2ecb0d..722ee9d 100755
--- a/src/com/android/mms/model/SlideshowModel.java
+++ b/src/com/android/mms/model/SlideshowModel.java
@@ -18,21 +18,16 @@
 package com.android.mms.model;
 
 
-import com.android.mms.ContentRestrictionException;
-import com.android.mms.ExceedMessageSizeException;
-import com.android.mms.LogTag;
-import com.android.mms.MmsConfig;
-import com.android.mms.R;
-import com.android.mms.dom.smil.parser.SmilXmlSerializer;
-import com.android.mms.layout.LayoutManager;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.GenericPdu;
-import com.google.android.mms.pdu.MultimediaMessagePdu;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduPart;
-import com.google.android.mms.pdu.PduPersister;
+import java.io.ByteArrayOutputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.ListIterator;
 
 import org.w3c.dom.NodeList;
 import org.w3c.dom.events.EventTarget;
@@ -44,20 +39,27 @@ import org.w3c.dom.smil.SMILParElement;
 import org.w3c.dom.smil.SMILRegionElement;
 import org.w3c.dom.smil.SMILRootLayoutElement;
 
+import android.content.ContentResolver;
 import android.content.ContentUris;
 import android.content.Context;
 import android.net.Uri;
 import android.text.TextUtils;
 import android.util.Log;
-import android.widget.Toast;
 
-import java.io.ByteArrayOutputStream;
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Iterator;
-import java.util.List;
-import java.util.ListIterator;
+import com.android.mms.ContentRestrictionException;
+import com.android.mms.ExceedMessageSizeException;
+import com.android.mms.LogTag;
+import com.android.mms.MmsConfig;
+import com.android.mms.dom.smil.parser.SmilXmlSerializer;
+import com.android.mms.layout.LayoutManager;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.GenericPdu;
+import com.google.android.mms.pdu.MultimediaMessagePdu;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduPart;
+import com.google.android.mms.pdu.PduPersister;
 
 public class SlideshowModel extends Model
         implements List<SlideModel>, IModelChangedObserver {
@@ -305,6 +307,32 @@ public class SlideshowModel extends Model
         return pb;
     }
 
+    public HashMap<Uri, InputStream> openPartFiles(ContentResolver cr) {
+        HashMap<Uri, InputStream> openedFiles = null;     // Don't create unless we have to
+
+        for (SlideModel slide : mSlides) {
+            for (MediaModel media : slide) {
+                if (media.isText()) {
+                    continue;
+                }
+                Uri uri = media.getUri();
+                InputStream is;
+                try {
+                    is = cr.openInputStream(uri);
+                    if (is != null) {
+                        if (openedFiles == null) {
+                            openedFiles = new HashMap<Uri, InputStream>();
+                        }
+                        openedFiles.put(uri, is);
+                    }
+                } catch (FileNotFoundException e) {
+                    Log.e(TAG, "openPartFiles couldn't open: " + uri, e);
+                }
+            }
+        }
+        return openedFiles;
+    }
+
     public PduBody makeCopy() {
         return makePduBody(SmilHelper.getDocument(this));
     }
@@ -688,7 +716,7 @@ public class SlideshowModel extends Model
             // This will write out all the new parts to:
             //      /data/data/com.android.providers.telephony/app_parts
             // and at the same time delete the old parts.
-            PduPersister.getPduPersister(mContext).updateParts(messageUri, pb);
+            PduPersister.getPduPersister(mContext).updateParts(messageUri, pb, null);
         }
     }
 
diff --git a/src/com/android/mms/model/SmilHelper.java b/src/com/android/mms/model/SmilHelper.java
index 577ba5a..755bcab 100644
--- a/src/com/android/mms/model/SmilHelper.java
+++ b/src/com/android/mms/model/SmilHelper.java
@@ -24,15 +24,11 @@ import static com.android.mms.dom.smil.SmilMediaElementImpl.SMIL_MEDIA_START_EVE
 import static com.android.mms.dom.smil.SmilParElementImpl.SMIL_SLIDE_END_EVENT;
 import static com.android.mms.dom.smil.SmilParElementImpl.SMIL_SLIDE_START_EVENT;
 
-import com.android.mms.MmsApp;
-import com.android.mms.dom.smil.SmilDocumentImpl;
-import com.android.mms.dom.smil.parser.SmilXmlParser;
-import com.android.mms.dom.smil.parser.SmilXmlSerializer;
-import com.android.mms.drm.DrmUtils;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduPart;
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.Arrays;
 
 import org.w3c.dom.events.EventTarget;
 import org.w3c.dom.smil.SMILDocument;
@@ -45,22 +41,19 @@ import org.w3c.dom.smil.SMILRegionMediaElement;
 import org.w3c.dom.smil.SMILRootLayoutElement;
 import org.xml.sax.SAXException;
 
-import android.content.ContentResolver;
-import android.database.Cursor;
-import android.database.sqlite.SQLiteException;
 import android.drm.DrmManagerClient;
-import android.net.Uri;
-import android.provider.MediaStore;
 import android.text.TextUtils;
 import android.util.Config;
 import android.util.Log;
 
-import java.io.ByteArrayInputStream;
-import java.io.ByteArrayOutputStream;
-import java.io.File;
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.Arrays;
+import com.android.mms.MmsApp;
+import com.android.mms.dom.smil.SmilDocumentImpl;
+import com.android.mms.dom.smil.parser.SmilXmlParser;
+import com.android.mms.dom.smil.parser.SmilXmlSerializer;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduPart;
 
 public class SmilHelper {
     private static final String TAG = "Mms/smil";
diff --git a/src/com/android/mms/model/TextModel.java b/src/com/android/mms/model/TextModel.java
index a63be87..15ff5eb 100644
--- a/src/com/android/mms/model/TextModel.java
+++ b/src/com/android/mms/model/TextModel.java
@@ -17,8 +17,7 @@
 
 package com.android.mms.model;
 
-import com.android.mms.dom.smil.SmilMediaElementImpl;
-import com.google.android.mms.pdu.CharacterSets;
+import java.io.UnsupportedEncodingException;
 
 import org.w3c.dom.events.Event;
 import org.w3c.dom.smil.ElementTime;
@@ -26,8 +25,8 @@ import org.w3c.dom.smil.ElementTime;
 import android.content.Context;
 import android.util.Log;
 
-import java.io.IOException;
-import java.io.UnsupportedEncodingException;
+import com.android.mms.dom.smil.SmilMediaElementImpl;
+import com.google.android.mms.pdu.CharacterSets;
 
 public class TextModel extends RegionMediaModel {
     private static final String TAG = "Mms/text";
diff --git a/src/com/android/mms/model/VideoModel.java b/src/com/android/mms/model/VideoModel.java
index 75d5c5d..a71e455 100644
--- a/src/com/android/mms/model/VideoModel.java
+++ b/src/com/android/mms/model/VideoModel.java
@@ -17,31 +17,29 @@
 
 package com.android.mms.model;
 
-import com.android.mms.ContentRestrictionException;
-import com.android.mms.LogTag;
-import com.android.mms.MmsApp;
-import com.android.mms.dom.events.EventImpl;
-import com.android.mms.dom.smil.SmilMediaElementImpl;
-import com.android.mms.util.ItemLoadedCallback;
-import com.android.mms.util.ItemLoadedFuture;
-import com.android.mms.util.ThumbnailManager;
-import com.google.android.mms.MmsException;
-import android.database.sqlite.SqliteWrapper;
-
 import org.w3c.dom.events.Event;
 import org.w3c.dom.smil.ElementTime;
 
 import android.content.ContentResolver;
 import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.provider.MediaStore.Images;
 import android.text.TextUtils;
 import android.util.Log;
 import android.webkit.MimeTypeMap;
 
+import com.android.mms.ContentRestrictionException;
+import com.android.mms.LogTag;
+import com.android.mms.MmsApp;
+import com.android.mms.dom.events.EventImpl;
+import com.android.mms.dom.smil.SmilMediaElementImpl;
+import com.android.mms.util.ItemLoadedCallback;
+import com.android.mms.util.ItemLoadedFuture;
+import com.android.mms.util.ThumbnailManager;
 import com.google.android.mms.ContentType;
-import java.io.IOException;
+import com.google.android.mms.MmsException;
 
 public class VideoModel extends RegionMediaModel {
     private static final String TAG = MediaModel.TAG;
@@ -72,7 +70,8 @@ public class VideoModel extends RegionMediaModel {
     }
 
     private void initFromFile(Uri uri) {
-        mSrc = uri.getPath();
+        String path = uri.getPath();
+        mSrc = path.substring(path.lastIndexOf('/') + 1);
         MimeTypeMap mimeTypeMap = MimeTypeMap.getSingleton();
         String extension = MimeTypeMap.getFileExtensionFromUrl(mSrc);
         if (TextUtils.isEmpty(extension)) {
@@ -204,11 +203,11 @@ public class VideoModel extends RegionMediaModel {
     }
 
     public void cancelThumbnailLoading() {
-        if (mItemLoadedFuture != null) {
+        if (mItemLoadedFuture != null && !mItemLoadedFuture.isDone()) {
             if (Log.isLoggable(LogTag.APP, Log.DEBUG)) {
                 Log.v(TAG, "cancelThumbnailLoading for: " + this);
             }
-            mItemLoadedFuture.cancel();
+            mItemLoadedFuture.cancel(getUri());
             mItemLoadedFuture = null;
         }
     }
diff --git a/src/com/android/mms/transaction/HttpUtils.java b/src/com/android/mms/transaction/HttpUtils.java
index 832f306..b6c878c 100644
--- a/src/com/android/mms/transaction/HttpUtils.java
+++ b/src/com/android/mms/transaction/HttpUtils.java
@@ -17,6 +17,13 @@
 
 package com.android.mms.transaction;
 
+import java.io.DataInputStream;
+import java.io.IOException;
+import java.net.SocketException;
+import java.net.URI;
+import java.net.URISyntaxException;
+import java.util.Locale;
+
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpHost;
 import org.apache.http.HttpRequest;
@@ -25,13 +32,9 @@ import org.apache.http.StatusLine;
 import org.apache.http.client.methods.HttpGet;
 import org.apache.http.client.methods.HttpPost;
 import org.apache.http.conn.params.ConnRouteParams;
+import org.apache.http.params.HttpConnectionParams;
 import org.apache.http.params.HttpParams;
 import org.apache.http.params.HttpProtocolParams;
-import org.apache.http.params.HttpConnectionParams;
-import org.apache.http.Header;
-
-import com.android.mms.MmsConfig;
-import com.android.mms.LogTag;
 
 import android.content.Context;
 import android.net.http.AndroidHttpClient;
@@ -40,14 +43,8 @@ import android.text.TextUtils;
 import android.util.Config;
 import android.util.Log;
 
-import java.io.ByteArrayOutputStream;
-import java.io.DataInputStream;
-import java.io.InputStream;
-import java.io.IOException;
-import java.net.SocketException;
-import java.net.URI;
-import java.net.URISyntaxException;
-import java.util.Locale;
+import com.android.mms.LogTag;
+import com.android.mms.MmsConfig;
 
 public class HttpUtils {
     private static final String TAG = LogTag.TRANSACTION;
diff --git a/src/com/android/mms/transaction/MessageStatusService.java b/src/com/android/mms/transaction/MessageStatusService.java
index 0a07c9b..19dd8c3 100644
--- a/src/com/android/mms/transaction/MessageStatusService.java
+++ b/src/com/android/mms/transaction/MessageStatusService.java
@@ -16,8 +16,6 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.LogTag;
-
 import android.app.IntentService;
 import android.content.ContentUris;
 import android.content.ContentValues;
@@ -31,6 +29,8 @@ import android.provider.Telephony.Sms.Inbox;
 import android.telephony.SmsMessage;
 import android.util.Log;
 
+import com.android.mms.LogTag;
+
 /**
  * Service that gets started by the MessageStatusReceiver when a message status report is
  * received.
diff --git a/src/com/android/mms/transaction/MessagingNotification.java b/src/com/android/mms/transaction/MessagingNotification.java
index 2a886fa..a1d7395 100644
--- a/src/com/android/mms/transaction/MessagingNotification.java
+++ b/src/com/android/mms/transaction/MessagingNotification.java
@@ -20,40 +20,27 @@ package com.android.mms.transaction;
 import static com.google.android.mms.pdu.PduHeaders.MESSAGE_TYPE_NOTIFICATION_IND;
 import static com.google.android.mms.pdu.PduHeaders.MESSAGE_TYPE_RETRIEVE_CONF;
 
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import com.android.mms.data.Contact;
-import com.android.mms.data.Conversation;
-import com.android.mms.data.WorkingMessage;
-import com.android.mms.model.SlideModel;
-import com.android.mms.model.SlideshowModel;
-import com.android.mms.ui.ComposeMessageActivity;
-import com.android.mms.ui.ConversationList;
-import com.android.mms.ui.MessagingPreferenceActivity;
-import com.android.mms.util.AddressUtils;
-import com.android.mms.util.DownloadManager;
-import com.android.mms.widget.MmsWidgetProvider;
-
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.google.android.mms.pdu.GenericPdu;
-import com.google.android.mms.pdu.MultimediaMessagePdu;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduPersister;
-import android.database.sqlite.SqliteWrapper;
+import java.util.ArrayList;
+import java.util.Comparator;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.Set;
+import java.util.SortedSet;
+import java.util.TreeSet;
 
 import android.app.Notification;
 import android.app.NotificationManager;
 import android.app.PendingIntent;
 import android.app.TaskStackBuilder;
+import android.content.BroadcastReceiver;
 import android.content.ContentResolver;
 import android.content.Context;
 import android.content.Intent;
-import android.content.SharedPreferences;
-import android.content.BroadcastReceiver;
 import android.content.IntentFilter;
+import android.content.SharedPreferences;
 import android.content.res.Resources;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.graphics.Bitmap;
 import android.graphics.Typeface;
 import android.graphics.drawable.BitmapDrawable;
@@ -73,13 +60,26 @@ import android.text.style.TextAppearanceSpan;
 import android.util.Log;
 import android.widget.Toast;
 
-import java.util.ArrayList;
-import java.util.Comparator;
-import java.util.HashSet;
-import java.util.Iterator;
-import java.util.Set;
-import java.util.SortedSet;
-import java.util.TreeSet;
+import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.data.Conversation;
+import com.android.mms.data.WorkingMessage;
+import com.android.mms.model.SlideModel;
+import com.android.mms.model.SlideshowModel;
+import com.android.mms.ui.ComposeMessageActivity;
+import com.android.mms.ui.ConversationList;
+import com.android.mms.ui.MessageUtils;
+import com.android.mms.ui.MessagingPreferenceActivity;
+import com.android.mms.util.AddressUtils;
+import com.android.mms.util.DownloadManager;
+import com.android.mms.widget.MmsWidgetProvider;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.GenericPdu;
+import com.google.android.mms.pdu.MultimediaMessagePdu;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduPersister;
 
 /**
  * This class is used to update the notification indicator. It will check whether
@@ -89,7 +89,7 @@ import java.util.TreeSet;
 public class MessagingNotification {
 
     private static final String TAG = LogTag.APP;
-    private static final boolean DEBUG = false;  // TODO turn off before ship
+    private static final boolean DEBUG = false;
 
     private static final int NOTIFICATION_ID = 123;
     public static final int MESSAGE_FAILED_NOTIFICATION_ID = 789;
@@ -165,18 +165,11 @@ public class MessagingNotification {
 
     private static OnDeletedReceiver sNotificationDeletedReceiver = new OnDeletedReceiver();
     private static Intent sNotificationOnDeleteIntent;
-    private static Handler sToastHandler = new Handler();
+    private static Handler sHandler = new Handler();
     private static PduPersister sPduPersister;
     private static final int MAX_BITMAP_DIMEN_DP = 360;
     private static float sScreenDensity;
 
-    /**
-     * mNotificationSet is kept sorted by the incoming message delivery time, with the
-     * most recent message first.
-     */
-    private static SortedSet<NotificationInfo> sNotificationSet =
-            new TreeSet<NotificationInfo>(INFO_COMPARATOR);
-
     private static final int MAX_MESSAGES_TO_SHOW = 8;  // the maximum number of new messages to
                                                         // show in a single notification.
 
@@ -211,6 +204,9 @@ public class MessagingNotification {
     public static void setCurrentlyDisplayedThreadId(long threadId) {
         synchronized (sCurrentlyDisplayedThreadLock) {
             sCurrentlyDisplayedThreadId = threadId;
+            if (DEBUG) {
+                Log.d(TAG, "setCurrentlyDisplayedThreadId: " + sCurrentlyDisplayedThreadId);
+            }
         }
     }
 
@@ -224,6 +220,11 @@ public class MessagingNotification {
     public static void nonBlockingUpdateNewMessageIndicator(final Context context,
             final long newMsgThreadId,
             final boolean isStatusMessage) {
+        if (DEBUG) {
+            Log.d(TAG, "nonBlockingUpdateNewMessageIndicator: newMsgThreadId: " +
+                    newMsgThreadId +
+                    " sCurrentlyDisplayedThreadId: " + sCurrentlyDisplayedThreadId);
+        }
         new Thread(new Runnable() {
             @Override
             public void run() {
@@ -244,38 +245,50 @@ public class MessagingNotification {
      */
     public static void blockingUpdateNewMessageIndicator(Context context, long newMsgThreadId,
             boolean isStatusMessage) {
-        synchronized (sCurrentlyDisplayedThreadLock) {
-            if (newMsgThreadId > 0 && newMsgThreadId == sCurrentlyDisplayedThreadId) {
-                if (DEBUG) {
-                    Log.d(TAG, "blockingUpdateNewMessageIndicator: newMsgThreadId == " +
-                            "sCurrentlyDisplayedThreadId so NOT showing notification," +
-                            " but playing soft sound. threadId: " + newMsgThreadId);
-                }
-                playInConversationNotificationSound(context);
-                return;
-            }
+        if (DEBUG) {
+            Contact.logWithTrace(TAG, "blockingUpdateNewMessageIndicator: newMsgThreadId: " +
+                    newMsgThreadId);
         }
-        sNotificationSet.clear();
+        // notificationSet is kept sorted by the incoming message delivery time, with the
+        // most recent message first.
+        SortedSet<NotificationInfo> notificationSet =
+                new TreeSet<NotificationInfo>(INFO_COMPARATOR);
 
-        MmsSmsDeliveryInfo delivery = null;
         Set<Long> threads = new HashSet<Long>(4);
 
-        int count = 0;
-        addMmsNotificationInfos(context, threads);
-        addSmsNotificationInfos(context, threads);
+        addMmsNotificationInfos(context, threads, notificationSet);
+        addSmsNotificationInfos(context, threads, notificationSet);
 
-        cancelNotification(context, NOTIFICATION_ID);
-        if (!sNotificationSet.isEmpty()) {
-            if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                Log.d(TAG, "blockingUpdateNewMessageIndicator: count=" + count +
+        if (notificationSet.isEmpty()) {
+            if (DEBUG) {
+                Log.d(TAG, "blockingUpdateNewMessageIndicator: notificationSet is empty, " +
+                        "canceling existing notifications");
+            }
+            cancelNotification(context, NOTIFICATION_ID);
+        } else {
+            if (DEBUG || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+                Log.d(TAG, "blockingUpdateNewMessageIndicator: count=" + notificationSet.size() +
                         ", newMsgThreadId=" + newMsgThreadId);
             }
-            updateNotification(context, newMsgThreadId != THREAD_NONE, threads.size());
+            synchronized (sCurrentlyDisplayedThreadLock) {
+                if (newMsgThreadId > 0 && newMsgThreadId == sCurrentlyDisplayedThreadId &&
+                        threads.contains(newMsgThreadId)) {
+                    if (DEBUG) {
+                        Log.d(TAG, "blockingUpdateNewMessageIndicator: newMsgThreadId == " +
+                                "sCurrentlyDisplayedThreadId so NOT showing notification," +
+                                " but playing soft sound. threadId: " + newMsgThreadId);
+                    }
+                    playInConversationNotificationSound(context);
+                    return;
+                }
+            }
+            updateNotification(context, newMsgThreadId != THREAD_NONE, threads.size(),
+                    notificationSet);
         }
 
         // And deals with delivery reports (which use Toasts). It's safe to call in a worker
         // thread because the toast will eventually get posted to a handler.
-        delivery = getSmsNewDeliveryInfo(context);
+        MmsSmsDeliveryInfo delivery = getSmsNewDeliveryInfo(context);
         if (delivery != null) {
             delivery.deliver(context, isStatusMessage);
         }
@@ -294,17 +307,29 @@ public class MessagingNotification {
             return;
         }
         Uri ringtoneUri = Uri.parse(ringtoneStr);
-        NotificationPlayer player = new NotificationPlayer(LogTag.APP);
+        final NotificationPlayer player = new NotificationPlayer(LogTag.APP);
         player.play(context, ringtoneUri, false, AudioManager.STREAM_NOTIFICATION,
                 IN_CONVERSATION_NOTIFICATION_VOLUME);
+
+        // Stop the sound after five seconds to handle continuous ringtones
+        sHandler.postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                player.stop();
+            }
+        }, 5000);
     }
 
     /**
      * Updates all pending notifications, clearing or updating them as
      * necessary.
      */
-    public static void blockingUpdateAllNotifications(final Context context) {
-        nonBlockingUpdateNewMessageIndicator(context, THREAD_NONE, false);
+    public static void blockingUpdateAllNotifications(final Context context, long threadId) {
+        if (DEBUG) {
+            Contact.logWithTrace(TAG, "blockingUpdateAllNotifications: newMsgThreadId: " +
+                    threadId);
+        }
+        nonBlockingUpdateNewMessageIndicator(context, threadId, false);
         nonBlockingUpdateSendFailedNotification(context);
         updateDownloadFailedNotification(context);
         MmsWidgetProvider.notifyDatasetChanged(context);
@@ -530,7 +555,7 @@ public class MessagingNotification {
     }
 
     private static final void addMmsNotificationInfos(
-            Context context, Set<Long> threads) {
+            Context context, Set<Long> threads, SortedSet<NotificationInfo> notificationSet) {
         ContentResolver resolver = context.getContentResolver();
 
         // This query looks like this when logged:
@@ -562,6 +587,8 @@ public class MessagingNotification {
 
                 String subject = getMmsSubject(
                         cursor.getString(COLUMN_SUBJECT), cursor.getInt(COLUMN_SUBJECT_CS));
+                subject = MessageUtils.cleanseMmsSubject(context, subject);
+
                 long threadId = cursor.getLong(COLUMN_THREAD_ID);
                 long timeMillis = cursor.getLong(COLUMN_DATE) * 1000;
 
@@ -593,6 +620,7 @@ public class MessagingNotification {
                     }
                 } catch (final MmsException e) {
                     Log.e(TAG, "MmsException loading uri: " + msgUri, e);
+                    continue;   // skip this bad boy -- don't generate an empty notification
                 }
 
                 NotificationInfo info = getNewMessageNotificationInfo(context,
@@ -605,7 +633,7 @@ public class MessagingNotification {
                         contact,
                         attachmentType);
 
-                sNotificationSet.add(info);
+                notificationSet.add(info);
 
                 threads.add(threadId);
             }
@@ -669,7 +697,7 @@ public class MessagingNotification {
     }
 
     private static final void addSmsNotificationInfos(
-            Context context, Set<Long> threads) {
+            Context context, Set<Long> threads, SortedSet<NotificationInfo> notificationSet) {
         ContentResolver resolver = context.getContentResolver();
         Cursor cursor = SqliteWrapper.query(context, resolver, Sms.CONTENT_URI,
                             SMS_STATUS_PROJECTION, NEW_INCOMING_SM_CONSTRAINT,
@@ -705,7 +733,7 @@ public class MessagingNotification {
                         threadId, timeMillis, null /* attachmentBitmap */,
                         contact, WorkingMessage.TEXT);
 
-                sNotificationSet.add(info);
+                notificationSet.add(info);
 
                 threads.add(threadId);
                 threads.add(cursor.getLong(COLUMN_THREAD_ID));
@@ -747,6 +775,7 @@ public class MessagingNotification {
         NotificationManager nm = (NotificationManager) context.getSystemService(
                 Context.NOTIFICATION_SERVICE);
 
+        Log.d(TAG, "cancelNotification");
         nm.cancel(notificationId);
     }
 
@@ -763,7 +792,7 @@ public class MessagingNotification {
             return;
         }
 
-        sToastHandler.post(new Runnable() {
+        sHandler.post(new Runnable() {
             @Override
             public void run() {
                 Toast.makeText(context, message, (int)timeMillis).show();
@@ -777,11 +806,13 @@ public class MessagingNotification {
      * @param context
      * @param isNew if we've got a new message, show the ticker
      * @param uniqueThreadCount
+     * @param notificationSet the set of notifications to display
      */
     private static void updateNotification(
             Context context,
             boolean isNew,
-            int uniqueThreadCount) {
+            int uniqueThreadCount,
+            SortedSet<NotificationInfo> notificationSet) {
         // If the user has turned off notifications in settings, don't do any notifying.
         if (!MessagingPreferenceActivity.getNotificationEnabled(context)) {
             if (DEBUG) {
@@ -791,8 +822,8 @@ public class MessagingNotification {
         }
 
         // Figure out what we've got -- whether all sms's, mms's, or a mixture of both.
-        int messageCount = sNotificationSet.size();
-        NotificationInfo mostRecentNotification = sNotificationSet.first();
+        final int messageCount = notificationSet.size();
+        NotificationInfo mostRecentNotification = notificationSet.first();
 
         final Notification.Builder noti = new Notification.Builder(context)
                 .setWhen(mostRecentNotification.mTimeMillis);
@@ -870,36 +901,31 @@ public class MessagingNotification {
 
         if (isNew) {
             SharedPreferences sp = PreferenceManager.getDefaultSharedPreferences(context);
-            String vibrateWhen;
-            if (sp.contains(MessagingPreferenceActivity.NOTIFICATION_VIBRATE_WHEN)) {
-                vibrateWhen =
-                    sp.getString(MessagingPreferenceActivity.NOTIFICATION_VIBRATE_WHEN, null);
-            } else if (sp.contains(MessagingPreferenceActivity.NOTIFICATION_VIBRATE)) {
-                vibrateWhen =
-                        sp.getBoolean(MessagingPreferenceActivity.NOTIFICATION_VIBRATE, false) ?
-                    context.getString(R.string.prefDefault_vibrate_true) :
-                    context.getString(R.string.prefDefault_vibrate_false);
-            } else {
-                vibrateWhen = context.getString(R.string.prefDefault_vibrateWhen);
-            }
-
-            boolean vibrateAlways = vibrateWhen.equals("always");
-            boolean vibrateSilent = vibrateWhen.equals("silent");
-            AudioManager audioManager =
-                (AudioManager)context.getSystemService(Context.AUDIO_SERVICE);
-            boolean nowSilent =
-                audioManager.getRingerMode() == AudioManager.RINGER_MODE_VIBRATE;
 
-            if (vibrateAlways || vibrateSilent && nowSilent) {
+            boolean vibrate = false;
+            if (sp.contains(MessagingPreferenceActivity.NOTIFICATION_VIBRATE)) {
+                // The most recent change to the vibrate preference is to store a boolean
+                // value in NOTIFICATION_VIBRATE. If prefs contain that preference, use that
+                // first.
+                vibrate = sp.getBoolean(MessagingPreferenceActivity.NOTIFICATION_VIBRATE,
+                        false);
+            } else if (sp.contains(MessagingPreferenceActivity.NOTIFICATION_VIBRATE_WHEN)) {
+                // This is to support the pre-JellyBean MR1.1 version of vibrate preferences
+                // when vibrate was a tri-state setting. As soon as the user opens the Messaging
+                // app's settings, it will migrate this setting from NOTIFICATION_VIBRATE_WHEN
+                // to the boolean value stored in NOTIFICATION_VIBRATE.
+                String vibrateWhen =
+                        sp.getString(MessagingPreferenceActivity.NOTIFICATION_VIBRATE_WHEN, null);
+                vibrate = "always".equals(vibrateWhen);
+            }
+            if (vibrate) {
                 defaults |= Notification.DEFAULT_VIBRATE;
             }
 
             String ringtoneStr = sp.getString(MessagingPreferenceActivity.NOTIFICATION_RINGTONE,
                     null);
             noti.setSound(TextUtils.isEmpty(ringtoneStr) ? null : Uri.parse(ringtoneStr));
-            if (DEBUG) {
-                Log.d(TAG, "updateNotification: new message, adding sound to the notification");
-            }
+            Log.d(TAG, "updateNotification: new message, adding sound to the notification");
         }
 
         defaults |= Notification.DEFAULT_LIGHTS;
@@ -932,6 +958,9 @@ public class MessagingNotification {
                     .bigText(mostRecentNotification.formatBigMessage(context))
                     .build();
             }
+            if (DEBUG) {
+                Log.d(TAG, "updateNotification: single message notification");
+            }
         } else {
             // We've got multiple messages
             if (uniqueThreadCount == 1) {
@@ -940,7 +969,7 @@ public class MessagingNotification {
                 // Begin a line for each subsequent message.
                 SpannableStringBuilder buf = new SpannableStringBuilder();
                 NotificationInfo infos[] =
-                        sNotificationSet.toArray(new NotificationInfo[sNotificationSet.size()]);
+                        notificationSet.toArray(new NotificationInfo[messageCount]);
                 int len = infos.length;
                 for (int i = len - 1; i >= 0; i--) {
                     NotificationInfo info = infos[i];
@@ -958,16 +987,19 @@ public class MessagingNotification {
                 // Show a single notification -- big style with the text of all the messages
                 notification = new Notification.BigTextStyle(noti)
                     .bigText(buf)
-                    // Forcibly show the last line, with the app's smallIcon in it, if we 
+                    // Forcibly show the last line, with the app's smallIcon in it, if we
                     // kicked the smallIcon out with an avatar bitmap
                     .setSummaryText((avatar == null) ? null : " ")
                     .build();
+                if (DEBUG) {
+                    Log.d(TAG, "updateNotification: multi messages for single thread");
+                }
             } else {
                 // Build a set of the most recent notification per threadId.
-                HashSet<Long> uniqueThreads = new HashSet<Long>(sNotificationSet.size());
+                HashSet<Long> uniqueThreads = new HashSet<Long>(messageCount);
                 ArrayList<NotificationInfo> mostRecentNotifPerThread =
                         new ArrayList<NotificationInfo>();
-                Iterator<NotificationInfo> notifications = sNotificationSet.iterator();
+                Iterator<NotificationInfo> notifications = notificationSet.iterator();
                 while (notifications.hasNext()) {
                     NotificationInfo notificationInfo = notifications.next();
                     if (!uniqueThreads.contains(notificationInfo.mThreadId)) {
@@ -1258,13 +1290,25 @@ public class MessagingNotification {
             null);
 
         if (cursor == null) {
+            if (DEBUG) {
+                Log.d(TAG, "getSmsThreadId uri: " + uri + " NULL cursor! returning THREAD_NONE");
+            }
             return THREAD_NONE;
         }
 
         try {
             if (cursor.moveToFirst()) {
-                return cursor.getLong(cursor.getColumnIndex(Sms.THREAD_ID));
+                long threadId = cursor.getLong(cursor.getColumnIndex(Sms.THREAD_ID));
+                if (DEBUG) {
+                    Log.d(TAG, "getSmsThreadId uri: " + uri +
+                            " returning threadId: " + threadId);
+                }
+                return threadId;
             } else {
+                if (DEBUG) {
+                    Log.d(TAG, "getSmsThreadId uri: " + uri +
+                            " NULL cursor! returning THREAD_NONE");
+                }
                 return THREAD_NONE;
             }
         } finally {
@@ -1289,13 +1333,25 @@ public class MessagingNotification {
                 null);
 
         if (cursor == null) {
+            if (DEBUG) {
+                Log.d(TAG, "getThreadId uri: " + uri + " NULL cursor! returning THREAD_NONE");
+            }
             return THREAD_NONE;
         }
 
         try {
             if (cursor.moveToFirst()) {
-                return cursor.getLong(cursor.getColumnIndex(Mms.THREAD_ID));
+                long threadId = cursor.getLong(cursor.getColumnIndex(Mms.THREAD_ID));
+                if (DEBUG) {
+                    Log.d(TAG, "getThreadId uri: " + uri +
+                            " returning threadId: " + threadId);
+                }
+                return threadId;
             } else {
+                if (DEBUG) {
+                    Log.d(TAG, "getThreadId uri: " + uri +
+                            " NULL cursor! returning THREAD_NONE");
+                }
                 return THREAD_NONE;
             }
         } finally {
diff --git a/src/com/android/mms/transaction/MmsMessageSender.java b/src/com/android/mms/transaction/MmsMessageSender.java
index ccd9ef0..971068c 100644
--- a/src/com/android/mms/transaction/MmsMessageSender.java
+++ b/src/com/android/mms/transaction/MmsMessageSender.java
@@ -17,7 +17,20 @@
 
 package com.android.mms.transaction;
 
+import android.content.ContentUris;
+import android.content.ContentValues;
+import android.content.Context;
+import android.content.Intent;
+import android.content.SharedPreferences;
+import android.net.Uri;
+import android.preference.PreferenceManager;
+import android.provider.Telephony.Mms;
+import android.provider.Telephony.MmsSms;
+import android.provider.Telephony.MmsSms.PendingMessages;
+import android.util.Log;
+
 import com.android.mms.LogTag;
+import com.android.mms.ui.ComposeMessageActivity;
 import com.android.mms.ui.MessagingPreferenceActivity;
 import com.android.mms.util.SendingProgressTokenManager;
 import com.google.android.mms.InvalidHeaderValueException;
@@ -30,20 +43,6 @@ import com.google.android.mms.pdu.ReadRecInd;
 import com.google.android.mms.pdu.SendReq;
 import com.google.android.mms.util.SqliteWrapper;
 
-import android.content.ContentUris;
-import android.content.ContentValues;
-import android.content.Context;
-import android.content.Intent;
-import android.content.SharedPreferences;
-import android.net.Uri;
-import android.preference.PreferenceManager;
-import android.provider.Telephony.Mms;
-import android.provider.Telephony.MmsSms;
-import android.provider.Telephony.Sms;
-import android.provider.Telephony.Mms.Addr;
-import android.provider.Telephony.MmsSms.PendingMessages;
-import android.util.Log;
-
 public class MmsMessageSender implements MessageSender {
     private static final String TAG = "MmsMessageSender";
 
@@ -163,7 +162,8 @@ public class MmsMessageSender implements MessageSender {
 
             readRec.setDate(System.currentTimeMillis() / 1000);
 
-            PduPersister.getPduPersister(context).persist(readRec, Mms.Outbox.CONTENT_URI);
+            PduPersister.getPduPersister(context).persist(readRec, Mms.Outbox.CONTENT_URI, true,
+                    MessagingPreferenceActivity.getIsGroupMmsEnabled(context), null);
             context.startService(new Intent(context, TransactionService.class));
         } catch (InvalidHeaderValueException e) {
             Log.e(TAG, "Invalide header value", e);
diff --git a/src/com/android/mms/transaction/MmsSystemEventReceiver.java b/src/com/android/mms/transaction/MmsSystemEventReceiver.java
index 34a2dcb..9b78ea0 100644
--- a/src/com/android/mms/transaction/MmsSystemEventReceiver.java
+++ b/src/com/android/mms/transaction/MmsSystemEventReceiver.java
@@ -20,16 +20,14 @@ package com.android.mms.transaction;
 import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
-import android.content.IntentFilter;
+import android.net.ConnectivityManager;
+import android.net.NetworkInfo;
 import android.net.Uri;
 import android.provider.Telephony.Mms;
 import android.util.Log;
 
-import com.android.internal.telephony.Phone;
-import com.android.internal.telephony.TelephonyIntents;
 import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
-import com.google.android.mms.util.PduCache;
 
 /**
  * MmsSystemEventReceiver receives the
@@ -44,9 +42,9 @@ import com.google.android.mms.util.PduCache;
  */
 public class MmsSystemEventReceiver extends BroadcastReceiver {
     private static final String TAG = "MmsSystemEventReceiver";
-    private static MmsSystemEventReceiver sMmsSystemEventReceiver;
+    private static ConnectivityManager mConnMgr = null;
 
-    private static void wakeUpService(Context context) {
+    public static void wakeUpService(Context context) {
         if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
             Log.v(TAG, "wakeUpService: start transaction service ...");
         }
@@ -64,14 +62,23 @@ public class MmsSystemEventReceiver extends BroadcastReceiver {
         if (action.equals(Mms.Intents.CONTENT_CHANGED_ACTION)) {
             Uri changed = (Uri) intent.getParcelableExtra(Mms.Intents.DELETED_CONTENTS);
             MmsApp.getApplication().getPduLoaderManager().removePdu(changed);
-        } else if (action.equals(TelephonyIntents.ACTION_ANY_DATA_CONNECTION_STATE_CHANGED)) {
-            String state = intent.getStringExtra(Phone.STATE_KEY);
+        } else if (action.equals(ConnectivityManager.CONNECTIVITY_ACTION)) {
+            if (mConnMgr == null) {
+                mConnMgr = (ConnectivityManager) context
+                        .getSystemService(Context.CONNECTIVITY_SERVICE);
+            }
+            NetworkInfo mmsNetworkInfo = mConnMgr
+                    .getNetworkInfo(ConnectivityManager.TYPE_MOBILE_MMS);
+            boolean available = mmsNetworkInfo.isAvailable();
+            boolean isConnected = mmsNetworkInfo.isConnected();
 
             if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                Log.v(TAG, "ANY_DATA_STATE event received: " + state);
+                Log.v(TAG, "TYPE_MOBILE_MMS available = " + available +
+                           ", isConnected = " + isConnected);
             }
 
-            if (state.equals("CONNECTED")) {
+            // Wake up transact service when MMS data is available and isn't connected.
+            if (available && !isConnected) {
                 wakeUpService(context);
             }
         } else if (action.equals(Intent.ACTION_BOOT_COMPLETED)) {
@@ -80,34 +87,10 @@ public class MmsSystemEventReceiver extends BroadcastReceiver {
             // Called on the UI thread so don't block.
             MessagingNotification.nonBlockingUpdateNewMessageIndicator(
                     context, MessagingNotification.THREAD_NONE, false);
-        }
-    }
-
-    public static void registerForConnectionStateChanges(Context context) {
-        unRegisterForConnectionStateChanges(context);
 
-        IntentFilter intentFilter = new IntentFilter();
-        intentFilter.addAction(TelephonyIntents.ACTION_ANY_DATA_CONNECTION_STATE_CHANGED);
-        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-            Log.v(TAG, "registerForConnectionStateChanges");
-        }
-        if (sMmsSystemEventReceiver == null) {
-            sMmsSystemEventReceiver = new MmsSystemEventReceiver();
-        }
-
-        context.registerReceiver(sMmsSystemEventReceiver, intentFilter);
-    }
-
-    public static void unRegisterForConnectionStateChanges(Context context) {
-        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-            Log.v(TAG, "unRegisterForConnectionStateChanges");
-        }
-        if (sMmsSystemEventReceiver != null) {
-            try {
-                context.unregisterReceiver(sMmsSystemEventReceiver);
-            } catch (IllegalArgumentException e) {
-                // Allow un-matched register-unregister calls
-            }
+            // Scan and send pending Mms once after boot completed since
+            // ACTION_ANY_DATA_CONNECTION_STATE_CHANGED wasn't registered in a whole life cycle
+            wakeUpService(context);
         }
     }
 }
diff --git a/src/com/android/mms/transaction/NotificationPlayer.java b/src/com/android/mms/transaction/NotificationPlayer.java
index fe10ac0..1b0fcfc 100644
--- a/src/com/android/mms/transaction/NotificationPlayer.java
+++ b/src/com/android/mms/transaction/NotificationPlayer.java
@@ -21,6 +21,8 @@
 
 package com.android.mms.transaction;
 
+import java.util.LinkedList;
+
 import android.content.Context;
 import android.media.AudioManager;
 import android.media.MediaPlayer;
@@ -31,9 +33,6 @@ import android.os.PowerManager;
 import android.os.SystemClock;
 import android.util.Log;
 
-import java.lang.Thread;
-import java.util.LinkedList;
-
 /**
  * @hide
  * This class is provides the same interface and functionality as android.media.AsyncPlayer
diff --git a/src/com/android/mms/transaction/NotificationTransaction.java b/src/com/android/mms/transaction/NotificationTransaction.java
index 3077a6c..647f6e2 100644
--- a/src/com/android/mms/transaction/NotificationTransaction.java
+++ b/src/com/android/mms/transaction/NotificationTransaction.java
@@ -25,8 +25,21 @@ import static com.google.android.mms.pdu.PduHeaders.STATUS_DEFERRED;
 import static com.google.android.mms.pdu.PduHeaders.STATUS_RETRIEVED;
 import static com.google.android.mms.pdu.PduHeaders.STATUS_UNRECOGNIZED;
 
+import java.io.IOException;
+
+import android.content.ContentValues;
+import android.content.Context;
+import android.database.sqlite.SqliteWrapper;
+import android.net.Uri;
+import android.provider.Telephony.Mms;
+import android.provider.Telephony.Threads;
+import android.provider.Telephony.Mms.Inbox;
+import android.telephony.TelephonyManager;
+import android.util.Log;
+
 import com.android.mms.MmsApp;
 import com.android.mms.MmsConfig;
+import com.android.mms.ui.MessagingPreferenceActivity;
 import com.android.mms.util.DownloadManager;
 import com.android.mms.util.Recycler;
 import com.android.mms.widget.MmsWidgetProvider;
@@ -38,18 +51,6 @@ import com.google.android.mms.pdu.PduComposer;
 import com.google.android.mms.pdu.PduHeaders;
 import com.google.android.mms.pdu.PduParser;
 import com.google.android.mms.pdu.PduPersister;
-import android.database.sqlite.SqliteWrapper;
-
-import android.content.ContentValues;
-import android.content.Context;
-import android.database.Cursor;
-import android.net.Uri;
-import android.provider.Telephony.Mms;
-import android.provider.Telephony.Mms.Inbox;
-import android.telephony.TelephonyManager;
-import android.util.Log;
-
-import java.io.IOException;
 
 /**
  * The NotificationTransaction is responsible for handling multimedia
@@ -107,8 +108,11 @@ public class NotificationTransaction extends Transaction implements Runnable {
         super(context, serviceId, connectionSettings);
 
         try {
+            // Save the pdu. If we can start downloading the real pdu immediately, don't allow
+            // persist() to create a thread for the notificationInd because it causes UI jank.
             mUri = PduPersister.getPduPersister(context).persist(
-                        ind, Inbox.CONTENT_URI);
+                        ind, Inbox.CONTENT_URI, !allowAutoDownload(),
+                        MessagingPreferenceActivity.getIsGroupMmsEnabled(context), null);
         } catch (MmsException e) {
             Log.e(TAG, "Failed to save NotificationInd in constructor.", e);
             throw new IllegalArgumentException();
@@ -127,11 +131,17 @@ public class NotificationTransaction extends Transaction implements Runnable {
         new Thread(this, "NotificationTransaction").start();
     }
 
-    public void run() {
+    public static boolean allowAutoDownload() {
         DownloadManager downloadManager = DownloadManager.getInstance();
         boolean autoDownload = downloadManager.isAuto();
         boolean dataSuspended = (MmsApp.getApplication().getTelephonyManager().getDataState() ==
                 TelephonyManager.DATA_SUSPENDED);
+        return autoDownload && !dataSuspended;
+    }
+
+    public void run() {
+        DownloadManager downloadManager = DownloadManager.getInstance();
+        boolean autoDownload = allowAutoDownload();
         try {
             if (LOCAL_LOGV) {
                 Log.v(TAG, "Notification transaction launched: " + this);
@@ -142,7 +152,7 @@ public class NotificationTransaction extends Transaction implements Runnable {
             // download a MM immediately.
             int status = STATUS_DEFERRED;
             // Don't try to download when data is suspended, as it will fail, so defer download
-            if (!autoDownload || dataSuspended) {
+            if (!autoDownload) {
                 downloadManager.markState(mUri, DownloadManager.STATE_UNSTARTED);
                 sendNotifyRespInd(status);
                 return;
@@ -173,7 +183,8 @@ public class NotificationTransaction extends Transaction implements Runnable {
                 } else {
                     // Save the received PDU (must be a M-RETRIEVE.CONF).
                     PduPersister p = PduPersister.getPduPersister(mContext);
-                    Uri uri = p.persist(pdu, Inbox.CONTENT_URI);
+                    Uri uri = p.persist(pdu, Inbox.CONTENT_URI, true,
+                            MessagingPreferenceActivity.getIsGroupMmsEnabled(mContext), null);
 
                     // Use local time instead of PDU time
                     ContentValues values = new ContentValues(1);
@@ -185,6 +196,11 @@ public class NotificationTransaction extends Transaction implements Runnable {
                     // M-NotifyResp.ind from Inbox.
                     SqliteWrapper.delete(mContext, mContext.getContentResolver(),
                                          mUri, null, null);
+                    Log.v(TAG, "NotificationTransaction received new mms message: " + uri);
+                    // Delete obsolete threads
+                    SqliteWrapper.delete(mContext, mContext.getContentResolver(),
+                            Threads.OBSOLETE_THREADS_URI, null, null);
+
                     // Notify observers with newly received MM.
                     mUri = uri;
                     status = STATUS_RETRIEVED;
@@ -217,7 +233,7 @@ public class NotificationTransaction extends Transaction implements Runnable {
             Log.e(TAG, Log.getStackTraceString(t));
         } finally {
             mTransactionState.setContentUri(mUri);
-            if (!autoDownload || dataSuspended) {
+            if (!autoDownload) {
                 // Always mark the transaction successful for deferred
                 // download since any error here doesn't make sense.
                 mTransactionState.setState(SUCCESS);
diff --git a/src/com/android/mms/transaction/PrivilegedSmsReceiver.java b/src/com/android/mms/transaction/PrivilegedSmsReceiver.java
index c2d0dca..f1e21a8 100644
--- a/src/com/android/mms/transaction/PrivilegedSmsReceiver.java
+++ b/src/com/android/mms/transaction/PrivilegedSmsReceiver.java
@@ -16,7 +16,6 @@
 
 package com.android.mms.transaction;
 
-import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
 
diff --git a/src/com/android/mms/transaction/ProgressCallbackEntity.java b/src/com/android/mms/transaction/ProgressCallbackEntity.java
index 8ff72f9..629dc02 100644
--- a/src/com/android/mms/transaction/ProgressCallbackEntity.java
+++ b/src/com/android/mms/transaction/ProgressCallbackEntity.java
@@ -17,14 +17,14 @@
 
 package com.android.mms.transaction;
 
+import java.io.IOException;
+import java.io.OutputStream;
+
 import org.apache.http.entity.ByteArrayEntity;
 
 import android.content.Context;
 import android.content.Intent;
 
-import java.io.IOException;
-import java.io.OutputStream;
-
 public class ProgressCallbackEntity extends ByteArrayEntity {
     private static final int DEFAULT_PIECE_SIZE = 4096;
 
diff --git a/src/com/android/mms/transaction/PushReceiver.java b/src/com/android/mms/transaction/PushReceiver.java
index 5da16fd..b0d083c 100644
--- a/src/com/android/mms/transaction/PushReceiver.java
+++ b/src/com/android/mms/transaction/PushReceiver.java
@@ -21,19 +21,6 @@ import static android.provider.Telephony.Sms.Intents.WAP_PUSH_RECEIVED_ACTION;
 import static com.google.android.mms.pdu.PduHeaders.MESSAGE_TYPE_DELIVERY_IND;
 import static com.google.android.mms.pdu.PduHeaders.MESSAGE_TYPE_NOTIFICATION_IND;
 import static com.google.android.mms.pdu.PduHeaders.MESSAGE_TYPE_READ_ORIG_IND;
-
-import com.android.mms.MmsConfig;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.DeliveryInd;
-import com.google.android.mms.pdu.GenericPdu;
-import com.google.android.mms.pdu.NotificationInd;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduParser;
-import com.google.android.mms.pdu.PduPersister;
-import com.google.android.mms.pdu.ReadOrigInd;
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.BroadcastReceiver;
 import android.content.ContentResolver;
 import android.content.ContentValues;
@@ -41,6 +28,7 @@ import android.content.Context;
 import android.content.Intent;
 import android.database.Cursor;
 import android.database.DatabaseUtils;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.AsyncTask;
 import android.os.PowerManager;
@@ -48,6 +36,18 @@ import android.provider.Telephony.Mms;
 import android.provider.Telephony.Mms.Inbox;
 import android.util.Log;
 
+import com.android.mms.MmsConfig;
+import com.android.mms.ui.MessagingPreferenceActivity;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.DeliveryInd;
+import com.google.android.mms.pdu.GenericPdu;
+import com.google.android.mms.pdu.NotificationInd;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduParser;
+import com.google.android.mms.pdu.PduPersister;
+import com.google.android.mms.pdu.ReadOrigInd;
+
 /**
  * Receives Intent.WAP_PUSH_RECEIVED_ACTION intents and starts the
  * TransactionService by passing the push-data to it.
@@ -93,7 +93,8 @@ public class PushReceiver extends BroadcastReceiver {
                             break;
                         }
 
-                        Uri uri = p.persist(pdu, Inbox.CONTENT_URI);
+                        Uri uri = p.persist(pdu, Inbox.CONTENT_URI, true,
+                                MessagingPreferenceActivity.getIsGroupMmsEnabled(mContext), null);
                         // Update thread ID for ReadOrigInd & DeliveryInd.
                         ContentValues values = new ContentValues(1);
                         values.put(Mms.THREAD_ID, threadId);
@@ -118,7 +119,14 @@ public class PushReceiver extends BroadcastReceiver {
                         }
 
                         if (!isDuplicateNotification(mContext, nInd)) {
-                            Uri uri = p.persist(pdu, Inbox.CONTENT_URI);
+                            // Save the pdu. If we can start downloading the real pdu immediately,
+                            // don't allow persist() to create a thread for the notificationInd
+                            // because it causes UI jank.
+                            Uri uri = p.persist(pdu, Inbox.CONTENT_URI,
+                                    !NotificationTransaction.allowAutoDownload(),
+                                    MessagingPreferenceActivity.getIsGroupMmsEnabled(mContext),
+                                    null);
+
                             // Start service to finish the notification transaction.
                             Intent svc = new Intent(mContext, TransactionService.class);
                             svc.putExtra(TransactionBundle.URI, uri.toString());
diff --git a/src/com/android/mms/transaction/ReadRecTransaction.java b/src/com/android/mms/transaction/ReadRecTransaction.java
index 31993c0..bcbfa62 100644
--- a/src/com/android/mms/transaction/ReadRecTransaction.java
+++ b/src/com/android/mms/transaction/ReadRecTransaction.java
@@ -17,19 +17,19 @@
 
 package com.android.mms.transaction;
 
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.PduComposer;
-import com.google.android.mms.pdu.PduPersister;
-import com.google.android.mms.pdu.ReadRecInd;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.android.mms.ui.MessageUtils;
+import java.io.IOException;
 
 import android.content.Context;
 import android.net.Uri;
 import android.provider.Telephony.Mms.Sent;
 import android.util.Log;
 
-import java.io.IOException;
+import com.android.mms.ui.MessageUtils;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.PduComposer;
+import com.google.android.mms.pdu.PduPersister;
+import com.google.android.mms.pdu.ReadRecInd;
 
 /**
  * The ReadRecTransaction is responsible for sending read report
@@ -42,11 +42,12 @@ import java.io.IOException;
  * <li>Notifies the TransactionService about succesful completion.
  * </ul>
  */
-public class ReadRecTransaction extends Transaction {
+public class ReadRecTransaction extends Transaction implements Runnable{
     private static final String TAG = "ReadRecTransaction";
     private static final boolean DEBUG = false;
     private static final boolean LOCAL_LOGV = false;
 
+    private Thread mThread;
     private final Uri mReadReportURI;
 
     public ReadRecTransaction(Context context,
@@ -67,6 +68,11 @@ public class ReadRecTransaction extends Transaction {
      */
     @Override
     public void process() {
+        mThread = new Thread(this, "ReadRecTransaction");
+        mThread.start();
+    }
+
+    public void run() {
         PduPersister persister = PduPersister.getPduPersister(mContext);
 
         try {
diff --git a/src/com/android/mms/transaction/RetrieveTransaction.java b/src/com/android/mms/transaction/RetrieveTransaction.java
index 6952187..236b2e9 100644
--- a/src/com/android/mms/transaction/RetrieveTransaction.java
+++ b/src/com/android/mms/transaction/RetrieveTransaction.java
@@ -17,8 +17,21 @@
 
 package com.android.mms.transaction;
 
+import java.io.IOException;
+
+import android.content.ContentValues;
+import android.content.Context;
+import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
+import android.net.Uri;
+import android.provider.Telephony.Mms;
+import android.provider.Telephony.Mms.Inbox;
+import android.text.TextUtils;
+import android.util.Log;
+
 import com.android.mms.MmsConfig;
 import com.android.mms.ui.MessageUtils;
+import com.android.mms.ui.MessagingPreferenceActivity;
 import com.android.mms.util.DownloadManager;
 import com.android.mms.util.Recycler;
 import com.android.mms.widget.MmsWidgetProvider;
@@ -30,19 +43,6 @@ import com.google.android.mms.pdu.PduHeaders;
 import com.google.android.mms.pdu.PduParser;
 import com.google.android.mms.pdu.PduPersister;
 import com.google.android.mms.pdu.RetrieveConf;
-import com.google.android.mms.pdu.EncodedStringValue;
-import android.database.sqlite.SqliteWrapper;
-
-import android.content.ContentValues;
-import android.content.Context;
-import android.database.Cursor;
-import android.net.Uri;
-import android.provider.Telephony.Mms;
-import android.provider.Telephony.Mms.Inbox;
-import android.text.TextUtils;
-import android.util.Log;
-
-import java.io.IOException;
 
 /**
  * The RetrieveTransaction is responsible for retrieving multimedia
@@ -150,7 +150,8 @@ public class RetrieveTransaction extends Transaction implements Runnable {
             } else {
                 // Store M-Retrieve.conf into Inbox
                 PduPersister persister = PduPersister.getPduPersister(mContext);
-                msgUri = persister.persist(retrieveConf, Inbox.CONTENT_URI);
+                msgUri = persister.persist(retrieveConf, Inbox.CONTENT_URI, true,
+                        MessagingPreferenceActivity.getIsGroupMmsEnabled(mContext), null);
 
                 // Use local time instead of PDU time
                 ContentValues values = new ContentValues(1);
diff --git a/src/com/android/mms/transaction/RetryScheduler.java b/src/com/android/mms/transaction/RetryScheduler.java
index 5c5cc5c..4788a58 100644
--- a/src/com/android/mms/transaction/RetryScheduler.java
+++ b/src/com/android/mms/transaction/RetryScheduler.java
@@ -17,13 +17,6 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import com.android.mms.util.DownloadManager;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduPersister;
-import android.database.sqlite.SqliteWrapper;
-
 import android.app.AlarmManager;
 import android.app.PendingIntent;
 import android.content.ContentResolver;
@@ -32,16 +25,21 @@ import android.content.ContentValues;
 import android.content.Context;
 import android.content.Intent;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.ConnectivityManager;
 import android.net.NetworkInfo;
 import android.net.Uri;
 import android.provider.Telephony.Mms;
 import android.provider.Telephony.MmsSms;
-import android.provider.Telephony.Sms;
 import android.provider.Telephony.MmsSms.PendingMessages;
-import android.text.format.DateFormat;
 import android.util.Log;
 
+import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.util.DownloadManager;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduPersister;
+
 public class RetryScheduler implements Observer {
     private static final String TAG = "RetryScheduler";
     private static final boolean DEBUG = false;
diff --git a/src/com/android/mms/transaction/SendTransaction.java b/src/com/android/mms/transaction/SendTransaction.java
index d26589e..a94307f 100644
--- a/src/com/android/mms/transaction/SendTransaction.java
+++ b/src/com/android/mms/transaction/SendTransaction.java
@@ -17,31 +17,29 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.util.RateController;
-import com.android.mms.util.SendingProgressTokenManager;
-import com.android.mms.LogTag;
-import com.android.mms.ui.MessageUtils;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.PduComposer;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduParser;
-import com.google.android.mms.pdu.PduPersister;
-import com.google.android.mms.pdu.SendConf;
-import com.google.android.mms.pdu.SendReq;
-import com.google.android.mms.pdu.EncodedStringValue;
-import android.database.sqlite.SqliteWrapper;
+import java.util.Arrays;
 
 import android.content.ContentUris;
 import android.content.ContentValues;
 import android.content.Context;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.provider.Telephony.Mms;
 import android.provider.Telephony.Mms.Sent;
 import android.text.TextUtils;
 import android.util.Log;
 
-import java.io.IOException;
-import java.util.Arrays;
+import com.android.mms.LogTag;
+import com.android.mms.ui.MessageUtils;
+import com.android.mms.util.RateController;
+import com.android.mms.util.SendingProgressTokenManager;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.PduComposer;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduParser;
+import com.google.android.mms.pdu.PduPersister;
+import com.google.android.mms.pdu.SendConf;
+import com.google.android.mms.pdu.SendReq;
 
 /**
  * The SendTransaction is responsible for sending multimedia messages
diff --git a/src/com/android/mms/transaction/SimFullReceiver.java b/src/com/android/mms/transaction/SimFullReceiver.java
index 6c715b4..59ae6e4 100644
--- a/src/com/android/mms/transaction/SimFullReceiver.java
+++ b/src/com/android/mms/transaction/SimFullReceiver.java
@@ -17,9 +17,6 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.R;
-import com.android.mms.ui.ManageSimMessages;
-
 import android.app.Notification;
 import android.app.NotificationManager;
 import android.app.PendingIntent;
@@ -29,6 +26,9 @@ import android.content.Intent;
 import android.provider.Settings;
 import android.provider.Telephony;
 
+import com.android.mms.R;
+import com.android.mms.ui.ManageSimMessages;
+
 /**
  * Receive Intent.SIM_FULL_ACTION.  Handle notification that SIM is full.
  */
@@ -36,8 +36,8 @@ public class SimFullReceiver extends BroadcastReceiver {
 
     @Override
     public void onReceive(Context context, Intent intent) {
-        if (Settings.Secure.getInt(context.getContentResolver(),
-            Settings.Secure.DEVICE_PROVISIONED, 0) == 1 &&
+        if (Settings.Global.getInt(context.getContentResolver(),
+            Settings.Global.DEVICE_PROVISIONED, 0) == 1 &&
             Telephony.Sms.Intents.SIM_FULL_ACTION.equals(intent.getAction())) {
 
             NotificationManager nm = (NotificationManager)
diff --git a/src/com/android/mms/transaction/SmsMessageSender.java b/src/com/android/mms/transaction/SmsMessageSender.java
index b2b7585..552b466 100644
--- a/src/com/android/mms/transaction/SmsMessageSender.java
+++ b/src/com/android/mms/transaction/SmsMessageSender.java
@@ -17,21 +17,22 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.LogTag;
-import com.android.mms.ui.MessagingPreferenceActivity;
-import com.google.android.mms.MmsException;
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.Context;
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.database.Cursor;
 import android.database.sqlite.SQLiteException;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.preference.PreferenceManager;
 import android.provider.Telephony.Sms;
+import android.provider.Telephony.Sms.Inbox;
 import android.util.Log;
 
+import com.android.mms.LogTag;
+import com.android.mms.ui.MessagingPreferenceActivity;
+import com.google.android.mms.MmsException;
+
 public class SmsMessageSender implements MessageSender {
     protected final Context mContext;
     protected final int mNumberOfDests;
@@ -130,7 +131,7 @@ public class SmsMessageSender implements MessageSender {
 
         try {
             cursor = SqliteWrapper.query(mContext, mContext.getContentResolver(),
-                            Sms.CONTENT_URI, SERVICE_CENTER_PROJECTION,
+                            Inbox.CONTENT_URI, SERVICE_CENTER_PROJECTION,
                             "thread_id = " + threadId, null, "date DESC");
 
             if ((cursor == null) || !cursor.moveToFirst()) {
diff --git a/src/com/android/mms/transaction/SmsReceiver.java b/src/com/android/mms/transaction/SmsReceiver.java
index 8c70dff..22eb4e6 100644
--- a/src/com/android/mms/transaction/SmsReceiver.java
+++ b/src/com/android/mms/transaction/SmsReceiver.java
@@ -19,11 +19,10 @@ package com.android.mms.transaction;
 
 import android.app.Service;
 import android.content.BroadcastReceiver;
-import android.content.ComponentName;
 import android.content.Context;
 import android.content.Intent;
-import android.provider.Telephony.Sms.Intents;
 import android.os.PowerManager;
+import android.provider.Telephony.Sms.Intents;
 
 /**
  * Handle incoming SMSes.  Just dispatches the work off to a Service.
diff --git a/src/com/android/mms/transaction/SmsReceiverService.java b/src/com/android/mms/transaction/SmsReceiverService.java
index 099e41d..4985edf 100755
--- a/src/com/android/mms/transaction/SmsReceiverService.java
+++ b/src/com/android/mms/transaction/SmsReceiverService.java
@@ -23,15 +23,6 @@ import static android.provider.Telephony.Sms.Intents.SMS_RECEIVED_ACTION;
 import java.util.Calendar;
 import java.util.GregorianCalendar;
 
-import com.android.mms.data.Contact;
-import com.android.mms.data.Conversation;
-import com.android.mms.ui.ClassZeroActivity;
-import com.android.mms.util.Recycler;
-import com.android.mms.util.SendingProgressTokenManager;
-import com.android.mms.widget.MmsWidgetProvider;
-import com.google.android.mms.MmsException;
-import android.database.sqlite.SqliteWrapper;
-
 import android.app.Activity;
 import android.app.Service;
 import android.content.ContentResolver;
@@ -41,6 +32,7 @@ import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.Handler;
 import android.os.HandlerThread;
@@ -49,7 +41,6 @@ import android.os.Looper;
 import android.os.Message;
 import android.os.Process;
 import android.provider.Telephony.Sms;
-import android.provider.Telephony.Threads;
 import android.provider.Telephony.Sms.Inbox;
 import android.provider.Telephony.Sms.Intents;
 import android.provider.Telephony.Sms.Outbox;
@@ -61,8 +52,15 @@ import android.util.Log;
 import android.widget.Toast;
 
 import com.android.internal.telephony.TelephonyIntents;
-import com.android.mms.R;
 import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.data.Conversation;
+import com.android.mms.ui.ClassZeroActivity;
+import com.android.mms.util.Recycler;
+import com.android.mms.util.SendingProgressTokenManager;
+import com.android.mms.widget.MmsWidgetProvider;
+import com.google.android.mms.MmsException;
 
 /**
  * This service essentially plays the role of a "worker thread", allowing us to store
@@ -83,7 +81,9 @@ public class SmsReceiverService extends Service {
     public static final String EXTRA_MESSAGE_SENT_SEND_NEXT ="SendNextMsg";
 
     public static final String ACTION_SEND_MESSAGE =
-        "com.android.mms.transaction.SEND_MESSAGE";
+            "com.android.mms.transaction.SEND_MESSAGE";
+    public static final String ACTION_SEND_INACTIVE_MESSAGE =
+            "com.android.mms.transaction.SEND_INACTIVE_MESSAGE";
 
     // This must match the column IDs below.
     private static final String[] SEND_PROJECTION = new String[] {
@@ -211,6 +211,8 @@ public class SmsReceiverService extends Service {
                     handleServiceStateChanged(intent);
                 } else if (ACTION_SEND_MESSAGE.endsWith(action)) {
                     handleSendMessage();
+                } else if (ACTION_SEND_INACTIVE_MESSAGE.equals(action)) {
+                    handleSendInactiveMessage();
                 }
             }
             // NOTE: We MUST not call stopSelf() directly, since we need to
@@ -233,6 +235,12 @@ public class SmsReceiverService extends Service {
         }
     }
 
+    private void handleSendInactiveMessage() {
+        // Inactive messages includes all messages in outbox and queued box.
+        moveOutboxMessagesToQueuedBox();
+        sendFirstQueuedMessage();
+    }
+
     public synchronized void sendFirstQueuedMessage() {
         boolean success = true;
         // get all the queued messages from the database
@@ -274,6 +282,12 @@ public class SmsReceiverService extends Service {
                         mSending = false;
                         messageFailedToSend(msgUri, SmsManager.RESULT_ERROR_GENERIC_FAILURE);
                         success = false;
+                        // Sending current message fails. Try to send more pending messages
+                        // if there is any.
+                        sendBroadcast(new Intent(SmsReceiverService.ACTION_SEND_MESSAGE,
+                                null,
+                                this,
+                                SmsReceiver.class));
                     }
                 }
             } finally {
@@ -367,6 +381,7 @@ public class SmsReceiverService extends Service {
         if (messageUri != null) {
             long threadId = MessagingNotification.getSmsThreadId(this, messageUri);
             // Called off of the UI thread so ok to block.
+            Log.d(TAG, "handleSmsReceived messageUri: " + messageUri + " threadId: " + threadId);
             MessagingNotification.blockingUpdateNewMessageIndicator(this, threadId, false);
         }
     }
@@ -389,6 +404,24 @@ public class SmsReceiverService extends Service {
     }
 
     /**
+     * Move all messages that are in the outbox to the queued state
+     * @return The number of messages that were actually moved
+     */
+    private int moveOutboxMessagesToQueuedBox() {
+        ContentValues values = new ContentValues(1);
+
+        values.put(Sms.TYPE, Sms.MESSAGE_TYPE_QUEUED);
+
+        int messageCount = SqliteWrapper.update(
+                getApplicationContext(), getContentResolver(), Outbox.CONTENT_URI,
+                values, "type = " + Sms.MESSAGE_TYPE_OUTBOX, null);
+        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE) || LogTag.DEBUG_SEND) {
+            Log.v(TAG, "moveOutboxMessagesToQueuedBox messageCount: " + messageCount);
+        }
+        return messageCount;
+    }
+
+    /**
      * Move all messages that are in the outbox to the failed state and set them to unread.
      * @return The number of messages that were actually moved
      */
@@ -504,7 +537,7 @@ public class SmsReceiverService extends Service {
 
     public static String replaceFormFeeds(String s) {
         // Some providers send formfeeds in their messages. Convert those formfeeds to newlines.
-        return s.replace('\f', '\n');
+        return s == null ? "" : s.replace('\f', '\n');
     }
 
 //    private static int count = 0;
diff --git a/src/com/android/mms/transaction/SmsRejectedReceiver.java b/src/com/android/mms/transaction/SmsRejectedReceiver.java
index b433693..a2306b8 100644
--- a/src/com/android/mms/transaction/SmsRejectedReceiver.java
+++ b/src/com/android/mms/transaction/SmsRejectedReceiver.java
@@ -16,8 +16,6 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.R;
-
 import android.app.Notification;
 import android.app.NotificationManager;
 import android.app.PendingIntent;
@@ -26,6 +24,8 @@ import android.content.Context;
 import android.content.Intent;
 import android.provider.Settings;
 import android.provider.Telephony;
+
+import com.android.mms.R;
 import com.android.mms.ui.ConversationList;
 
 
@@ -39,8 +39,8 @@ public class SmsRejectedReceiver extends BroadcastReceiver {
 
     @Override
     public void onReceive(Context context, Intent intent) {
-        if (Settings.Secure.getInt(context.getContentResolver(),
-                Settings.Secure.DEVICE_PROVISIONED, 0) == 1 &&
+        if (Settings.Global.getInt(context.getContentResolver(),
+                Settings.Global.DEVICE_PROVISIONED, 0) == 1 &&
                 Telephony.Sms.Intents.SMS_REJECTED_ACTION.equals(intent.getAction())) {
 
             int reason = intent.getIntExtra("result", -1);
diff --git a/src/com/android/mms/transaction/SmsSingleRecipientSender.java b/src/com/android/mms/transaction/SmsSingleRecipientSender.java
index 286cffc..df267aa 100644
--- a/src/com/android/mms/transaction/SmsSingleRecipientSender.java
+++ b/src/com/android/mms/transaction/SmsSingleRecipientSender.java
@@ -7,17 +7,16 @@ import android.content.Context;
 import android.content.Intent;
 import android.net.Uri;
 import android.provider.Telephony.Mms;
+import android.provider.Telephony.Sms;
 import android.telephony.PhoneNumberUtils;
 import android.telephony.SmsManager;
 import android.util.Log;
 
 import com.android.mms.LogTag;
 import com.android.mms.MmsConfig;
-import com.google.android.mms.MmsException;
-import android.provider.Telephony.Sms;
-
 import com.android.mms.data.Conversation;
 import com.android.mms.ui.MessageUtils;
+import com.google.android.mms.MmsException;
 
 public class SmsSingleRecipientSender extends SmsMessageSender {
 
diff --git a/src/com/android/mms/transaction/Transaction.java b/src/com/android/mms/transaction/Transaction.java
index f3225e3..ddfe8df 100644
--- a/src/com/android/mms/transaction/Transaction.java
+++ b/src/com/android/mms/transaction/Transaction.java
@@ -17,17 +17,16 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.util.SendingProgressTokenManager;
-import com.google.android.mms.MmsException;
+import java.io.IOException;
+import java.net.InetAddress;
+import java.net.UnknownHostException;
 
 import android.content.Context;
-import android.net.Uri;
 import android.net.ConnectivityManager;
-import android.util.Log;
+import android.net.Uri;
 
-import java.io.IOException;
-import java.net.InetAddress;
-import java.net.UnknownHostException;
+import com.android.mms.util.SendingProgressTokenManager;
+import com.google.android.mms.MmsException;
 
 /**
  * Transaction is an abstract class for notification transaction, send transaction
@@ -212,57 +211,31 @@ public abstract class Transaction extends Observable {
         ConnectivityManager connMgr =
                 (ConnectivityManager) mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
 
-        int inetAddr;
+        InetAddress inetAddr;
         if (settings.isProxySet()) {
             String proxyAddr = settings.getProxyAddress();
-            inetAddr = lookupHost(proxyAddr);
-            if (inetAddr == -1) {
-                throw new IOException("Cannot establish route for " + url + ": Unknown host");
-            } else {
-                if (!connMgr.requestRouteToHost(
-                        ConnectivityManager.TYPE_MOBILE_MMS, inetAddr)) {
-                    throw new IOException("Cannot establish route to proxy " + inetAddr);
-                }
+            try {
+              inetAddr = InetAddress.getByName(proxyAddr);
+            } catch (UnknownHostException e) {
+                throw new IOException("Cannot establish route for " + url +
+                                      ": Unknown proxy " + proxyAddr);
+            }
+            if (!connMgr.requestRouteToHostAddress(ConnectivityManager.TYPE_MOBILE_MMS, inetAddr)) {
+                throw new IOException("Cannot establish route to proxy " + inetAddr);
             }
         } else {
             Uri uri = Uri.parse(url);
-            inetAddr = lookupHost(uri.getHost());
-            if (inetAddr == -1) {
+            try {
+                inetAddr = InetAddress.getByName(uri.getHost());
+            } catch (UnknownHostException e) {
                 throw new IOException("Cannot establish route for " + url + ": Unknown host");
-            } else {
-                if (!connMgr.requestRouteToHost(
-                        ConnectivityManager.TYPE_MOBILE_MMS, inetAddr)) {
-                    throw new IOException("Cannot establish route to " + inetAddr + " for " + url);
-                }
+            }
+            if (!connMgr.requestRouteToHostAddress(ConnectivityManager.TYPE_MOBILE_MMS, inetAddr)) {
+                throw new IOException("Cannot establish route to " + inetAddr + " for " + url);
             }
         }
     }
 
-    /**
-     * Look up a host name and return the result as an int. Works if the argument
-     * is an IP address in dot notation. Obviously, this can only be used for IPv4
-     * addresses.
-     * @param hostname the name of the host (or the IP address)
-     * @return the IP address as an {@code int} in network byte order
-     */
-    // TODO: move this to android-common
-    public static int lookupHost(String hostname) {
-        InetAddress inetAddress;
-        try {
-            inetAddress = InetAddress.getByName(hostname);
-        } catch (UnknownHostException e) {
-            return -1;
-        }
-        byte[] addrBytes;
-        int addr;
-        addrBytes = inetAddress.getAddress();
-        addr = ((addrBytes[3] & 0xff) << 24)
-                | ((addrBytes[2] & 0xff) << 16)
-                | ((addrBytes[1] & 0xff) << 8)
-                |  (addrBytes[0] & 0xff);
-        return addr;
-    }
-
     @Override
     public String toString() {
         return getClass().getName() + ": serviceId=" + mServiceId;
diff --git a/src/com/android/mms/transaction/TransactionBundle.java b/src/com/android/mms/transaction/TransactionBundle.java
index 4a3c94c..ea3edc0 100644
--- a/src/com/android/mms/transaction/TransactionBundle.java
+++ b/src/com/android/mms/transaction/TransactionBundle.java
@@ -19,6 +19,8 @@ package com.android.mms.transaction;
 
 import android.os.Bundle;
 
+import com.android.internal.telephony.uicc.IccUtils;
+
 /**
  * A wrapper around the Bundle instances used to start the TransactionService.
  * It provides high-level APIs to set the information required for the latter to
@@ -148,7 +150,7 @@ public class TransactionBundle {
     public String toString() {
         return "transactionType: " + getTransactionType() +
             " uri: " + getUri() +
-            " pushData: " + getPushData() +
+            " pushData: " + IccUtils.bytesToHexString(getPushData()) +
             " mmscUrl: " + getMmscUrl() +
             " proxyAddress: " + getProxyAddress() +
             " proxyPort: " + getProxyPort();
diff --git a/src/com/android/mms/transaction/TransactionService.java b/src/com/android/mms/transaction/TransactionService.java
index 079b1a9..f869920 100644
--- a/src/com/android/mms/transaction/TransactionService.java
+++ b/src/com/android/mms/transaction/TransactionService.java
@@ -17,20 +17,8 @@
 
 package com.android.mms.transaction;
 
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import com.android.mms.util.RateController;
-import com.google.android.mms.pdu.GenericPdu;
-import com.google.android.mms.pdu.NotificationInd;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduParser;
-import com.google.android.mms.pdu.PduPersister;
-import com.android.internal.telephony.Phone;
-import com.android.internal.telephony.TelephonyIntents;
-
-import android.provider.Telephony.Mms;
-import android.provider.Telephony.MmsSms;
-import android.provider.Telephony.MmsSms.PendingMessages;
+import java.io.IOException;
+import java.util.ArrayList;
 
 import android.app.Service;
 import android.content.BroadcastReceiver;
@@ -39,7 +27,6 @@ import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
 import android.database.Cursor;
-import android.database.sqlite.SqliteWrapper;
 import android.net.ConnectivityManager;
 import android.net.NetworkInfo;
 import android.net.Uri;
@@ -49,12 +36,24 @@ import android.os.IBinder;
 import android.os.Looper;
 import android.os.Message;
 import android.os.PowerManager;
+import android.provider.Telephony.Mms;
+import android.provider.Telephony.MmsSms;
+import android.provider.Telephony.MmsSms.PendingMessages;
 import android.text.TextUtils;
 import android.util.Log;
 import android.widget.Toast;
 
-import java.io.IOException;
-import java.util.ArrayList;
+import com.android.internal.telephony.Phone;
+import com.android.internal.telephony.PhoneConstants;
+import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.util.DownloadManager;
+import com.android.mms.util.RateController;
+import com.google.android.mms.pdu.GenericPdu;
+import com.google.android.mms.pdu.NotificationInd;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduParser;
+import com.google.android.mms.pdu.PduPersister;
 
 /**
  * The TransactionService of the MMS Client is responsible for handling requests
@@ -100,6 +99,13 @@ public class TransactionService extends Service implements Observer {
     public static final String ACTION_ONALARM = "android.intent.action.ACTION_ONALARM";
 
     /**
+     * Action for the Intent which is sent when the user turns on the auto-retrieve setting.
+     * This service gets started to auto-retrieve any undownloaded messages.
+     */
+    public static final String ACTION_ENABLE_AUTO_RETRIEVE
+            = "android.intent.action.ACTION_ENABLE_AUTO_RETRIEVE";
+
+    /**
      * Used as extra key in notification intents broadcasted by the TransactionService
      * when a Transaction is completed (TRANSACTION_COMPLETED_ACTION intents).
      * Allowed values for this key are: TransactionState.INITIALIZED,
@@ -197,7 +203,9 @@ public class TransactionService extends Service implements Observer {
             Log.v(TAG, "    networkAvailable=" + !noNetwork);
         }
 
-        if (ACTION_ONALARM.equals(intent.getAction()) || (intent.getExtras() == null)) {
+        String action = intent.getAction();
+        if (ACTION_ONALARM.equals(action) || ACTION_ENABLE_AUTO_RETRIEVE.equals(action) ||
+                (intent.getExtras() == null)) {
             // Scan database to find all pending operations.
             Cursor cursor = PduPersister.getPduPersister(this).getPendingMessages(
                     System.currentTimeMillis());
@@ -206,7 +214,7 @@ public class TransactionService extends Service implements Observer {
                     int count = cursor.getCount();
 
                     if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                        Log.v(TAG, "onNewIntent: cursor.count=" + count);
+                        Log.v(TAG, "onNewIntent: cursor.count=" + count + " action=" + action);
                     }
 
                     if (count == 0) {
@@ -222,18 +230,13 @@ public class TransactionService extends Service implements Observer {
                     int columnIndexOfMsgType = cursor.getColumnIndexOrThrow(
                             PendingMessages.MSG_TYPE);
 
-                    if (noNetwork) {
-                        // Make sure we register for connection state changes.
-                        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                            Log.v(TAG, "onNewIntent: registerForConnectionStateChanges");
-                        }
-                        MmsSystemEventReceiver.registerForConnectionStateChanges(
-                                getApplicationContext());
-                    }
-
                     while (cursor.moveToNext()) {
                         int msgType = cursor.getInt(columnIndexOfMsgType);
                         int transactionType = getTransactionType(msgType);
+                        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                            Log.v(TAG, "onNewIntent: msgType=" + msgType + " transactionType=" +
+                                    transactionType);
+                        }
                         if (noNetwork) {
                             onNetworkUnavailable(serviceId, transactionType);
                             return;
@@ -244,14 +247,41 @@ public class TransactionService extends Service implements Observer {
                             case Transaction.RETRIEVE_TRANSACTION:
                                 // If it's a transiently failed transaction,
                                 // we should retry it in spite of current
-                                // downloading mode.
+                                // downloading mode. If the user just turned on the auto-retrieve
+                                // option, we also retry those messages that don't have any errors.
                                 int failureType = cursor.getInt(
                                         cursor.getColumnIndexOrThrow(
                                                 PendingMessages.ERROR_TYPE));
-                                if (!isTransientFailure(failureType)) {
+                                DownloadManager downloadManager = DownloadManager.getInstance();
+                                boolean autoDownload = downloadManager.isAuto();
+                                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                                    Log.v(TAG, "onNewIntent: failureType=" + failureType +
+                                            " action=" + action + " isTransientFailure:" +
+                                            isTransientFailure(failureType) + " autoDownload=" +
+                                            autoDownload);
+                                }
+                                if (!autoDownload) {
+                                    // If autodownload is turned off, don't process the
+                                    // transaction.
+                                    if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                                        Log.v(TAG, "onNewIntent: skipping - autodownload off");
+                                    }
                                     break;
                                 }
-                                // fall-through
+                                // Logic is twisty. If there's no failure or the failure
+                                // is a non-permanent failure, we want to process the transaction.
+                                // Otherwise, break out and skip processing this transaction.
+                                if (!(failureType == MmsSms.NO_ERROR ||
+                                        isTransientFailure(failureType))) {
+                                    if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                                        Log.v(TAG, "onNewIntent: skipping - permanent error");
+                                    }
+                                    break;
+                                }
+                                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                                    Log.v(TAG, "onNewIntent: falling through and processing");
+                                }
+                               // fall-through
                             default:
                                 Uri uri = ContentUris.withAppendedId(
                                         Mms.CONTENT_URI,
@@ -259,6 +289,9 @@ public class TransactionService extends Service implements Observer {
                                 TransactionBundle args = new TransactionBundle(
                                         transactionType, uri.toString());
                                 // FIXME: We use the same startId for all MMs.
+                                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                                    Log.v(TAG, "onNewIntent: launchTransaction uri=" + uri);
+                                }
                                 launchTransaction(serviceId, args, false);
                                 break;
                         }
@@ -289,11 +322,6 @@ public class TransactionService extends Service implements Observer {
                 if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
                     Log.v(TAG, "stopSelfIfIdle: STOP!");
                 }
-                // Make sure we're no longer listening for connection state changes.
-                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                    Log.v(TAG, "stopSelfIfIdle: unRegisterForConnectionStateChanges");
-                }
-                MmsSystemEventReceiver.unRegisterForConnectionStateChanges(getApplicationContext());
 
                 stopSelf(startId);
             }
@@ -301,12 +329,16 @@ public class TransactionService extends Service implements Observer {
     }
 
     private static boolean isTransientFailure(int type) {
-        return (type < MmsSms.ERR_TYPE_GENERIC_PERMANENT) && (type > MmsSms.NO_ERROR);
+        return type > MmsSms.NO_ERROR && type < MmsSms.ERR_TYPE_GENERIC_PERMANENT;
     }
 
     private boolean isNetworkAvailable() {
-        NetworkInfo ni = mConnMgr.getNetworkInfo(ConnectivityManager.TYPE_MOBILE_MMS);
-        return (ni == null ? false : ni.isAvailable());
+        if (mConnMgr == null) {
+            return false;
+        } else {
+            NetworkInfo ni = mConnMgr.getNetworkInfo(ConnectivityManager.TYPE_MOBILE_MMS);
+            return (ni == null ? false : ni.isAvailable());
+        }
     }
 
     private int getTransactionType(int msgType) {
@@ -459,7 +491,6 @@ public class TransactionService extends Service implements Observer {
             sendBroadcast(intent);
         } finally {
             transaction.detach(this);
-            MmsSystemEventReceiver.unRegisterForConnectionStateChanges(getApplicationContext());
             stopSelf(serviceId);
         }
     }
@@ -498,8 +529,8 @@ public class TransactionService extends Service implements Observer {
         }
 
         switch (result) {
-            case Phone.APN_ALREADY_ACTIVE:
-            case Phone.APN_REQUEST_STARTED:
+            case PhoneConstants.APN_ALREADY_ACTIVE:
+            case PhoneConstants.APN_REQUEST_STARTED:
                 acquireWakeLock();
                 return result;
         }
@@ -593,7 +624,7 @@ public class TransactionService extends Service implements Observer {
 
                     try {
                         int result = beginMmsConnectivity();
-                        if (result != Phone.APN_ALREADY_ACTIVE) {
+                        if (result != PhoneConstants.APN_ALREADY_ACTIVE) {
                             Log.v(TAG, "Extending MMS connectivity returned " + result +
                                     " instead of APN_ALREADY_ACTIVE");
                             // Just wait for connectivity startup without
@@ -822,7 +853,7 @@ public class TransactionService extends Service implements Observer {
                     Log.v(TAG, "processTransaction: call beginMmsConnectivity...");
                 }
                 int connectivityResult = beginMmsConnectivity();
-                if (connectivityResult == Phone.APN_REQUEST_STARTED) {
+                if (connectivityResult == PhoneConstants.APN_REQUEST_STARTED) {
                     mPending.add(transaction);
                     if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
                         Log.v(TAG, "processTransaction: connResult=APN_REQUEST_STARTED, " +
@@ -871,11 +902,15 @@ public class TransactionService extends Service implements Observer {
                 return;
             }
 
-            boolean noConnectivity =
-                intent.getBooleanExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY, false);
+            NetworkInfo mmsNetworkInfo = null;
 
-            NetworkInfo networkInfo = (NetworkInfo)
-                intent.getParcelableExtra(ConnectivityManager.EXTRA_NETWORK_INFO);
+            if (mConnMgr != null) {
+                mmsNetworkInfo = mConnMgr.getNetworkInfo(ConnectivityManager.TYPE_MOBILE_MMS);
+            } else {
+                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                    Log.v(TAG, "mConnMgr is null, bail");
+                }
+            }
 
             /*
              * If we are being informed that connectivity has been established
@@ -884,47 +919,50 @@ public class TransactionService extends Service implements Observer {
              */
 
             if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                Log.v(TAG, "Handle ConnectivityBroadcastReceiver.onReceive(): " + networkInfo);
+                Log.v(TAG, "Handle ConnectivityBroadcastReceiver.onReceive(): " + mmsNetworkInfo);
             }
 
             // Check availability of the mobile network.
-            if ((networkInfo == null) || (networkInfo.getType() !=
-                    ConnectivityManager.TYPE_MOBILE_MMS)) {
+            if ((mmsNetworkInfo == null)) {
                 if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                    Log.v(TAG, "   type is not TYPE_MOBILE_MMS, bail");
+                    Log.v(TAG, "mms type is null, bail");
                 }
+            } else {
                 // This is a very specific fix to handle the case where the phone receives an
                 // incoming call during the time we're trying to setup the mms connection.
                 // When the call ends, restart the process of mms connectivity.
-                if (networkInfo != null &&
-                        Phone.REASON_VOICE_CALL_ENDED.equals(networkInfo.getReason())) {
+                if (Phone.REASON_VOICE_CALL_ENDED.equals(mmsNetworkInfo.getReason())) {
                     if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
                         Log.v(TAG, "   reason is " + Phone.REASON_VOICE_CALL_ENDED +
                                 ", retrying mms connectivity");
                     }
                     renewMmsConnectivity();
+                    return;
                 }
-                return;
-            }
-
-            if (!networkInfo.isConnected()) {
-                if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
-                    Log.v(TAG, "   TYPE_MOBILE_MMS not connected, bail");
-                }
-                return;
-            }
 
-            TransactionSettings settings = new TransactionSettings(
-                    TransactionService.this, networkInfo.getExtraInfo());
+                if (mmsNetworkInfo.isConnected()) {
+                    TransactionSettings settings = new TransactionSettings(
+                            TransactionService.this, mmsNetworkInfo.getExtraInfo());
+                    // If this APN doesn't have an MMSC, wait for one that does.
+                    if (TextUtils.isEmpty(settings.getMmscUrl())) {
+                        Log.v(TAG, "   empty MMSC url, bail");
+                        return;
+                    }
+                    mServiceHandler.processPendingTransaction(null, settings);
+                } else {
+                    if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                        Log.v(TAG, "   TYPE_MOBILE_MMS not connected, bail");
+                    }
 
-            // If this APN doesn't have an MMSC, wait for one that does.
-            if (TextUtils.isEmpty(settings.getMmscUrl())) {
-                Log.v(TAG, "   empty MMSC url, bail");
-                return;
+                    // Retry mms connectivity once it's possible to connect
+                    if (mmsNetworkInfo.isAvailable()) {
+                        if (Log.isLoggable(LogTag.TRANSACTION, Log.VERBOSE)) {
+                            Log.v(TAG, "   retrying mms connectivity for it's available");
+                        }
+                        renewMmsConnectivity();
+                    }
+                }
             }
-
-            renewMmsConnectivity();
-            mServiceHandler.processPendingTransaction(null, settings);
         }
     };
 }
diff --git a/src/com/android/mms/transaction/TransactionSettings.java b/src/com/android/mms/transaction/TransactionSettings.java
index 348f539..728f03a 100644
--- a/src/com/android/mms/transaction/TransactionSettings.java
+++ b/src/com/android/mms/transaction/TransactionSettings.java
@@ -17,19 +17,17 @@
 
 package com.android.mms.transaction;
 
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.Context;
 import android.database.Cursor;
-import android.net.Uri;
-import com.android.internal.telephony.Phone;
-import com.android.mms.LogTag;
-
+import android.database.sqlite.SqliteWrapper;
 import android.net.NetworkUtils;
 import android.provider.Telephony;
 import android.text.TextUtils;
 import android.util.Log;
 
+import com.android.internal.telephony.PhoneConstants;
+import com.android.mms.LogTag;
+
 /**
  * Container of transaction settings. Instances of this class are contained
  * within Transaction instances to allow overriding of the default APN
@@ -89,7 +87,7 @@ public class TransactionSettings {
         try {
             while (cursor.moveToNext() && TextUtils.isEmpty(mServiceCenter)) {
                 // Read values from APN settings
-                if (isValidApnType(cursor.getString(COLUMN_TYPE), Phone.APN_TYPE_MMS)) {
+                if (isValidApnType(cursor.getString(COLUMN_TYPE), PhoneConstants.APN_TYPE_MMS)) {
                     sawValidApn = true;
                     mServiceCenter = NetworkUtils.trimV4AddrZeros(
                             cursor.getString(COLUMN_MMSC).trim());
@@ -164,7 +162,7 @@ public class TransactionSettings {
         }
 
         for (String t : types.split(",")) {
-            if (t.equals(requestType) || t.equals(Phone.APN_TYPE_ALL)) {
+            if (t.equals(requestType) || t.equals(PhoneConstants.APN_TYPE_ALL)) {
                 return true;
             }
         }
diff --git a/src/com/android/mms/ui/AsyncDialog.java b/src/com/android/mms/ui/AsyncDialog.java
index e3569a2..d0b1e59 100644
--- a/src/com/android/mms/ui/AsyncDialog.java
+++ b/src/com/android/mms/ui/AsyncDialog.java
@@ -16,12 +16,8 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.layout.LayoutManager;
-
 import android.app.Activity;
 import android.app.ProgressDialog;
-import android.content.Context;
 import android.os.AsyncTask;
 import android.os.Handler;
 
@@ -152,6 +148,9 @@ public class AsyncDialog {
          */
         @Override
         protected void onPostExecute(Void result) {
+            if (mActivity.isFinishing()) {
+                return;
+            }
             if (mProgressDialog != null && mProgressDialog.isShowing()) {
                 mProgressDialog.dismiss();
             }
diff --git a/src/com/android/mms/ui/AttachmentEditor.java b/src/com/android/mms/ui/AttachmentEditor.java
index 93ef17e..8854c4c 100644
--- a/src/com/android/mms/ui/AttachmentEditor.java
+++ b/src/com/android/mms/ui/AttachmentEditor.java
@@ -17,24 +17,22 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.data.WorkingMessage;
-import com.android.mms.model.SlideModel;
-import com.android.mms.model.SlideshowModel;
-import com.android.mms.util.ItemLoadedCallback;
-
 import android.content.Context;
 import android.content.res.Configuration;
 import android.os.Handler;
 import android.os.Message;
 import android.util.AttributeSet;
-import android.util.Log;
 import android.view.View;
 import android.view.ViewStub;
 import android.widget.Button;
 import android.widget.ImageButton;
 import android.widget.LinearLayout;
 
+import com.android.mms.R;
+import com.android.mms.data.WorkingMessage;
+import com.android.mms.model.SlideModel;
+import com.android.mms.model.SlideshowModel;
+
 /**
  * This is an embedded editor/view to add photos and sound/video clips
  * into a multimedia message.
diff --git a/src/com/android/mms/ui/AttachmentTypeSelectorAdapter.java b/src/com/android/mms/ui/AttachmentTypeSelectorAdapter.java
index 14e801b..5831d6f 100644
--- a/src/com/android/mms/ui/AttachmentTypeSelectorAdapter.java
+++ b/src/com/android/mms/ui/AttachmentTypeSelectorAdapter.java
@@ -17,13 +17,13 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.MmsConfig;
-import com.android.mms.R;
+import java.util.ArrayList;
+import java.util.List;
 
 import android.content.Context;
 
-import java.util.ArrayList;
-import java.util.List;
+import com.android.mms.MmsConfig;
+import com.android.mms.R;
 
 /**
  * An adapter to store icons and strings for attachment type list.
diff --git a/src/com/android/mms/ui/AudioAttachmentView.java b/src/com/android/mms/ui/AudioAttachmentView.java
index d859fb8..0fd3d41 100644
--- a/src/com/android/mms/ui/AudioAttachmentView.java
+++ b/src/com/android/mms/ui/AudioAttachmentView.java
@@ -17,7 +17,7 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.util.Map;
 
 import android.content.Context;
 import android.content.res.Resources;
@@ -32,7 +32,7 @@ import android.util.Log;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import java.util.Map;
+import com.android.mms.R;
 
 /**
  * This class provides an embedded editor/viewer of audio attachment.
diff --git a/src/com/android/mms/ui/BasicSlideEditorView.java b/src/com/android/mms/ui/BasicSlideEditorView.java
index dbcdd72..9b22562 100644
--- a/src/com/android/mms/ui/BasicSlideEditorView.java
+++ b/src/com/android/mms/ui/BasicSlideEditorView.java
@@ -17,12 +17,11 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.util.Map;
 
 import android.content.Context;
 import android.graphics.Bitmap;
 import android.graphics.BitmapFactory;
-import android.media.MediaPlayer;
 import android.net.Uri;
 import android.text.Editable;
 import android.text.TextWatcher;
@@ -34,8 +33,7 @@ import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import java.io.IOException;
-import java.util.Map;
+import com.android.mms.R;
 
 /**
  * This is a basic view to show and edit a slide.
diff --git a/src/com/android/mms/ui/ChipsRecipientAdapter.java b/src/com/android/mms/ui/ChipsRecipientAdapter.java
index aa1b53f..fe4cc90 100644
--- a/src/com/android/mms/ui/ChipsRecipientAdapter.java
+++ b/src/com/android/mms/ui/ChipsRecipientAdapter.java
@@ -16,11 +16,11 @@
 
 package com.android.mms.ui;
 
+import android.content.Context;
+
 import com.android.ex.chips.BaseRecipientAdapter;
 import com.android.mms.R;
 
-import android.content.Context;
-
 public class ChipsRecipientAdapter extends BaseRecipientAdapter {
     private static final int DEFAULT_PREFERRED_MAX_RESULT_COUNT = 10;
 
diff --git a/src/com/android/mms/ui/ClassZeroActivity.java b/src/com/android/mms/ui/ClassZeroActivity.java
index 891a911..0abcdda 100644
--- a/src/com/android/mms/ui/ClassZeroActivity.java
+++ b/src/com/android/mms/ui/ClassZeroActivity.java
@@ -25,6 +25,7 @@ import android.content.ContentValues;
 import android.content.DialogInterface;
 import android.content.DialogInterface.OnClickListener;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.Bundle;
 import android.os.Handler;
@@ -40,8 +41,6 @@ import android.view.Window;
 import com.android.mms.R;
 import com.android.mms.transaction.MessagingNotification;
 
-import android.database.sqlite.SqliteWrapper;
-
 /**
  * Display a class-zero SMS message to the user. Wait for the user to dismiss
  * it.
diff --git a/src/com/android/mms/ui/ComposeMessageActivity.java b/src/com/android/mms/ui/ComposeMessageActivity.java
index 2ba2ef2..3b55a59 100644
--- a/src/com/android/mms/ui/ComposeMessageActivity.java
+++ b/src/com/android/mms/ui/ComposeMessageActivity.java
@@ -47,14 +47,15 @@ import android.app.ProgressDialog;
 import android.content.ActivityNotFoundException;
 import android.content.BroadcastReceiver;
 import android.content.ClipData;
+import android.content.ClipboardManager;
 import android.content.ContentResolver;
 import android.content.ContentUris;
 import android.content.ContentValues;
 import android.content.Context;
 import android.content.DialogInterface;
+import android.content.DialogInterface.OnClickListener;
 import android.content.Intent;
 import android.content.IntentFilter;
-import android.content.DialogInterface.OnClickListener;
 import android.content.res.Configuration;
 import android.content.res.Resources;
 import android.database.Cursor;
@@ -72,20 +73,22 @@ import android.os.Message;
 import android.os.Parcelable;
 import android.os.SystemProperties;
 import android.provider.ContactsContract;
+import android.provider.ContactsContract.QuickContact;
+import android.provider.Telephony;
 import android.provider.ContactsContract.CommonDataKinds.Email;
+import android.provider.ContactsContract.CommonDataKinds.Phone;
 import android.provider.ContactsContract.Contacts;
-import android.provider.Settings;
 import android.provider.ContactsContract.Intents;
 import android.provider.MediaStore.Images;
 import android.provider.MediaStore.Video;
+import android.provider.Settings;
 import android.provider.Telephony.Mms;
 import android.provider.Telephony.Sms;
-import android.provider.ContactsContract.CommonDataKinds.Phone;
 import android.telephony.PhoneNumberUtils;
 import android.telephony.SmsMessage;
-import android.content.ClipboardManager;
 import android.text.Editable;
 import android.text.InputFilter;
+import android.text.InputFilter.LengthFilter;
 import android.text.SpannableString;
 import android.text.Spanned;
 import android.text.TextUtils;
@@ -95,15 +98,15 @@ import android.text.style.URLSpan;
 import android.text.util.Linkify;
 import android.util.Log;
 import android.view.ContextMenu;
+import android.view.ContextMenu.ContextMenuInfo;
 import android.view.KeyEvent;
 import android.view.Menu;
 import android.view.MenuItem;
 import android.view.View;
-import android.view.ViewStub;
-import android.view.WindowManager;
-import android.view.ContextMenu.ContextMenuInfo;
 import android.view.View.OnCreateContextMenuListener;
 import android.view.View.OnKeyListener;
+import android.view.ViewStub;
+import android.view.WindowManager;
 import android.view.inputmethod.InputMethodManager;
 import android.webkit.MimeTypeMap;
 import android.widget.AdapterView;
@@ -129,25 +132,24 @@ import com.android.mms.data.Conversation.ConversationQueryHandler;
 import com.android.mms.data.WorkingMessage;
 import com.android.mms.data.WorkingMessage.MessageStatusListener;
 import com.android.mms.drm.DrmUtils;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduPart;
-import com.google.android.mms.pdu.PduPersister;
-import com.google.android.mms.pdu.SendReq;
 import com.android.mms.model.SlideModel;
 import com.android.mms.model.SlideshowModel;
 import com.android.mms.transaction.MessagingNotification;
 import com.android.mms.ui.MessageListView.OnSizeChangedListener;
 import com.android.mms.ui.MessageUtils.ResizeImageResultCallback;
 import com.android.mms.ui.RecipientsEditor.RecipientContextMenuInfo;
-import com.android.mms.util.AddressUtils;
+import com.android.mms.util.DraftCache;
 import com.android.mms.util.PhoneNumberFormatter;
 import com.android.mms.util.SendingProgressTokenManager;
 import com.android.mms.util.SmileyParser;
-
-import android.text.InputFilter.LengthFilter;
+import com.android.mms.widget.MmsWidgetProvider;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduPart;
+import com.google.android.mms.pdu.PduPersister;
+import com.google.android.mms.pdu.SendReq;
 
 /**
  * This is the main UI for:
@@ -213,6 +215,7 @@ public class ComposeMessageActivity extends Activity
     private static final int MENU_UNLOCK_MESSAGE        = 29;
     private static final int MENU_SAVE_RINGTONE         = 30;
     private static final int MENU_PREFERENCES           = 31;
+    private static final int MENU_GROUP_PARTICIPANTS    = 32;
 
     private static final int RECIPIENTS_MAX_LENGTH = 312;
 
@@ -225,6 +228,9 @@ public class ComposeMessageActivity extends Activity
 
     private static final long NO_DATE_FOR_DIALOG = -1L;
 
+    private static final String KEY_EXIT_ON_SENT = "exit_on_sent";
+    private static final String KEY_FORWARDED_MESSAGE = "forwarded_message";
+
     private static final String EXIT_ECM_RESULT = "exit_ecm_result";
 
     // When the conversation has a lot of messages and a new message is sent, the list is scrolled
@@ -236,6 +242,16 @@ public class ComposeMessageActivity extends Activity
     // cause a smooth scroll. Instead, we jump the list directly to the desired position.
     private static final int SMOOTH_SCROLL_THRESHOLD = 200;
 
+    // To reduce janky interaction when message history + draft loads and keyboard opening
+    // query the messages + draft after the keyboard opens. This controls that behavior.
+    private static final boolean DEFER_LOADING_MESSAGES_AND_DRAFT = true;
+
+    // The max amount of delay before we force load messages and draft.
+    // 500ms is determined empirically. We want keyboard to have a chance to be shown before
+    // we force loading. However, there is at least one use case where the keyboard never shows
+    // even if we tell it to (turning off and on the screen). So we need to force load the
+    // messages+draft after the max delay.
+    private static final int LOADING_MESSAGES_AND_DRAFT_MAX_DELAY_MS = 500;
 
     private ContentResolver mContentResolver;
 
@@ -243,8 +259,10 @@ public class ComposeMessageActivity extends Activity
 
     private Conversation mConversation;     // Conversation we are working in
 
-    private boolean mExitOnSent;            // Should we finish() after sending a message?
-                                            // TODO: mExitOnSent is obsolete -- remove
+    // When mSendDiscreetMode is true, this activity only allows a user to type in and send
+    // a single sms, send the message, and then exits. The message history and menus are hidden.
+    private boolean mSendDiscreetMode;
+    private boolean mForwardMessageMode;
 
     private View mTopPanel;                 // View containing the recipient and subject editors
     private View mBottomPanel;              // View containing the text editor, send button, ec.
@@ -263,12 +281,11 @@ public class ComposeMessageActivity extends Activity
     private RecipientsEditor mRecipientsEditor;  // UI control for editing recipients
     private ImageButton mRecipientsPicker;       // UI control for recipients picker
 
-    private boolean mIsKeyboardOpen;             // Whether the hardware keyboard is visible
+    // For HW keyboard, 'mIsKeyboardOpen' indicates if the HW keyboard is open.
+    // For SW keyboard, 'mIsKeyboardOpen' should always be true.
+    private boolean mIsKeyboardOpen;
     private boolean mIsLandscape;                // Whether we're in landscape mode
 
-    private boolean mPossiblePendingNotification;   // If the message list has changed, we may have
-                                                    // a pending notification to deal with.
-
     private boolean mToastForDraftSave;   // Whether to notify the user that a draft is being saved
 
     private boolean mSentMessage;       // true if the user has sent a message while in this
@@ -304,12 +321,29 @@ public class ComposeMessageActivity extends Activity
                                             // so we can remember it after re-entering the activity.
                                             // If the value >= 0, then we jump to that line. If the
                                             // value is maxint, then we jump to the end.
+    private long mLastMessageId;
 
     /**
      * Whether this activity is currently running (i.e. not paused)
      */
     private boolean mIsRunning;
 
+    // we may call loadMessageAndDraft() from a few different places. This is used to make
+    // sure we only load message+draft once.
+    private boolean mMessagesAndDraftLoaded;
+
+    // whether we should load the draft. For example, after attaching a photo and coming back
+    // in onActivityResult(), we should not load the draft because that will mess up the draft
+    // state of mWorkingMessage. Also, if we are handling a Send or Forward Message Intent,
+    // we should not load the draft.
+    private boolean mShouldLoadDraft;
+
+    private Handler mHandler = new Handler();
+
+    // keys for extras and icicles
+    public final static String THREAD_ID = "thread_id";
+    private final static String RECIPIENTS = "recipients";
+
     @SuppressWarnings("unused")
     public static void log(String logMsg) {
         Thread current = Thread.currentThread();
@@ -552,6 +586,9 @@ public class ComposeMessageActivity extends Activity
             // The provider doesn't support multi-part sms's so as soon as the user types
             // an sms longer than one segment, we have to turn the message into an mms.
             mWorkingMessage.setLengthRequiresMms(msgCount > 1, true);
+        } else {
+            int threshold = MmsConfig.getSmsToMmsTextThreshold();
+            mWorkingMessage.setLengthRequiresMms(threshold > 0 && msgCount > threshold, true);
         }
 
         // Show the counter only if:
@@ -584,17 +621,18 @@ public class ComposeMessageActivity extends Activity
         if (requestCode >= 0) {
             mWaitingForSubActivity = true;
         }
-        if (mIsKeyboardOpen) {
-            hideKeyboard();     // camera and other activities take a long time to hide the keyboard
+        // The camera and other activities take a long time to hide the keyboard so we pre-hide
+        // it here. However, if we're opening up the quick contact window while typing, don't
+        // mess with the keyboard.
+        if (mIsKeyboardOpen && !QuickContact.ACTION_QUICK_CONTACT.equals(intent.getAction())) {
+            hideKeyboard();
         }
 
         super.startActivityForResult(intent, requestCode);
     }
 
-    private void toastConvertInfo(boolean toMms) {
-        final int resId = toMms ? R.string.converting_to_picture_message
-                : R.string.converting_to_text_message;
-        Toast.makeText(this, resId, Toast.LENGTH_SHORT).show();
+    private void showConvertToMmsToast() {
+        Toast.makeText(this, R.string.converting_to_picture_message, Toast.LENGTH_SHORT).show();
     }
 
     private class DeleteMessageListener implements OnClickListener {
@@ -618,8 +656,15 @@ public class ComposeMessageActivity extends Activity
                         // Delete the message *after* we've removed the thumbnails because we
                         // need the pdu and slideshow for removeThumbnailsFromCache to work.
                     }
+                    Boolean deletingLastItem = false;
+                    Cursor cursor = mMsgListAdapter != null ? mMsgListAdapter.getCursor() : null;
+                    if (cursor != null) {
+                        cursor.moveToLast();
+                        long msgId = cursor.getLong(COLUMN_ID);
+                        deletingLastItem = msgId == mMessageItem.mMsgId;
+                    }
                     mBackgroundQueryHandler.startDelete(DELETE_MESSAGE_TOKEN,
-                            null, mMessageItem.mMessageUri,
+                            deletingLastItem, mMessageItem.mMessageUri,
                             mMessageItem.mLocked ? null : "locked=0", null);
                     return null;
                 }
@@ -680,6 +725,10 @@ public class ComposeMessageActivity extends Activity
                     .show();
             }
         } else {
+            // The recipients editor is still open. Make sure we use what's showing there
+            // as the destination.
+            ContactList contacts = mRecipientsEditor.constructContactsFromInput(false);
+            mDebugRecipients = contacts.serialize();
             sendMessage(true);
         }
     }
@@ -718,7 +767,11 @@ public class ComposeMessageActivity extends Activity
                 return;
             }
 
-            mWorkingMessage.setWorkingRecipients(mRecipientsEditor.getNumbers());
+            List<String> numbers = mRecipientsEditor.getNumbers();
+            mWorkingMessage.setWorkingRecipients(numbers);
+            boolean multiRecipients = numbers != null && numbers.size() > 1;
+            mMsgListAdapter.setIsGroupConversation(multiRecipients);
+            mWorkingMessage.setHasMultipleRecipients(multiRecipients, true);
             mWorkingMessage.setHasEmail(mRecipientsEditor.containsEmail(), true);
 
             checkForTooManyRecipients();
@@ -832,7 +885,7 @@ public class ComposeMessageActivity extends Activity
             }
         }
         if (!(Mms.isEmailAddress(name) ||
-                AddressUtils.isPossiblePhoneNumber(name) ||
+                Telephony.Mms.isPhoneNumber(name) ||
                 contact.isMe())) {
             return false;
         }
@@ -1139,7 +1192,6 @@ public class ComposeMessageActivity extends Activity
 
         mWorkingMessage = newWorkingMessage;
         mWorkingMessage.setConversation(mConversation);
-        invalidateOptionsMenu();
 
         drawTopPanel(false);
 
@@ -1183,7 +1235,9 @@ public class ComposeMessageActivity extends Activity
                         PduPersister persister =
                                 PduPersister.getPduPersister(ComposeMessageActivity.this);
                         // Copy the parts of the message here.
-                        mTempMmsUri = persister.persist(sendReq, Mms.Draft.CONTENT_URI);
+                        mTempMmsUri = persister.persist(sendReq, Mms.Draft.CONTENT_URI, true,
+                                MessagingPreferenceActivity
+                                    .getIsGroupMmsEnabled(ComposeMessageActivity.this), null);
                         mTempThreadId = MessagingNotification.getThreadId(
                                 ComposeMessageActivity.this, mTempMmsUri);
                     } catch (MmsException e) {
@@ -1201,10 +1255,10 @@ public class ComposeMessageActivity extends Activity
                 // on the UI thread.
                 Intent intent = createIntent(ComposeMessageActivity.this, 0);
 
-                intent.putExtra("exit_on_sent", true);
-                intent.putExtra("forwarded_message", true);
+                intent.putExtra(KEY_EXIT_ON_SENT, true);
+                intent.putExtra(KEY_FORWARDED_MESSAGE, true);
                 if (mTempThreadId > 0) {
-                    intent.putExtra("thread_id", mTempThreadId);
+                    intent.putExtra(THREAD_ID, mTempThreadId);
                 }
 
                 if (msgItem.mType.equals("sms")) {
@@ -1810,9 +1864,6 @@ public class ComposeMessageActivity extends Activity
         setContentView(R.layout.compose_message_activity);
         setProgressBarVisibility(false);
 
-        getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE |
-                WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN);
-
         // Initialize members for UI elements.
         initResourceRefs();
 
@@ -1888,16 +1939,16 @@ public class ComposeMessageActivity extends Activity
         // Set up the message history ListAdapter
         initMessageList();
 
+        mShouldLoadDraft = true;
+
         // Load the draft for this thread, if we aren't already handling
         // existing data, such as a shared picture or forwarded message.
         boolean isForwardedMessage = false;
         // We don't attempt to handle the Intent.ACTION_SEND when saveInstanceState is non-null.
         // saveInstanceState is non-null when this activity is killed. In that case, we already
         // handled the attachment or the send, so we don't try and parse the intent again.
-        boolean intentHandled = savedInstanceState == null &&
-            (handleSendIntent() || handleForwardedMessage());
-        if (!intentHandled) {
-            loadDraft();
+        if (savedInstanceState == null && (handleSendIntent() || handleForwardedMessage())) {
+            mShouldLoadDraft = false;
         }
 
         // Let the working message know what conversation it belongs to
@@ -1909,23 +1960,14 @@ public class ComposeMessageActivity extends Activity
             // short-circuited.
             hideRecipientEditor();
             initRecipientsEditor();
-
-            // Bring up the softkeyboard so the user can immediately enter recipients. This
-            // call won't do anything on devices with a hard keyboard.
-            getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE |
-                    WindowManager.LayoutParams.SOFT_INPUT_STATE_VISIBLE);
         } else {
             hideRecipientEditor();
         }
-        invalidateOptionsMenu();    // do after show/hide of recipients editor because the options
-                                    // menu depends on the recipients, which depending upon the
-                                    // visibility of the recipients editor, returns a different
-                                    // value (see getRecipients()).
 
         updateSendButtonState();
 
         drawTopPanel(false);
-        if (intentHandled) {
+        if (!mShouldLoadDraft) {
             // We're not loading a draft, so we can draw the bottom panel immediately.
             drawBottomPanel();
         }
@@ -1943,6 +1985,8 @@ public class ComposeMessageActivity extends Activity
             // recipient editor rather than in the message editor.
             mRecipientsEditor.requestFocus();
         }
+
+        mMsgListAdapter.setIsGroupConversation(mConversation.getRecipients().size() > 1);
     }
 
     @Override
@@ -1961,7 +2005,7 @@ public class ComposeMessageActivity extends Activity
         // draft, ensureThreadId gets called async from WorkingMessage.asyncUpdateDraftSmsMessage
         // the thread will get a threadId behind the UI thread's back.
         long originalThreadId = mConversation.getThreadId();
-        long threadId = intent.getLongExtra("thread_id", 0);
+        long threadId = intent.getLongExtra(THREAD_ID, 0);
         Uri intentUri = intent.getData();
 
         boolean sameThread = false;
@@ -2017,7 +2061,7 @@ public class ComposeMessageActivity extends Activity
 
             initialize(null, originalThreadId);
         }
-        loadMessageContent();
+        loadMessagesAndDraft(0);
     }
 
     private void sanityCheckConversation() {
@@ -2033,6 +2077,11 @@ public class ComposeMessageActivity extends Activity
     protected void onRestart() {
         super.onRestart();
 
+        // hide the compose panel to reduce jank when re-entering this activity.
+        // if we don't hide it here, the compose panel will flash before the keyboard shows
+        // (when keyboard is suppose to be shown).
+        hideBottomPanel();
+
         if (mWorkingMessage.isDiscarded()) {
             // If the message isn't worth saving, don't resurrect it. Doing so can lead to
             // a situation where a new incoming message gets the old thread id of the discarded
@@ -2046,19 +2095,11 @@ public class ComposeMessageActivity extends Activity
                 mWorkingMessage.unDiscard();    // it was discarded in onStop().
 
                 sanityCheckConversation();
-            } else if (isRecipientsEditorVisible()) {
+            } else if (isRecipientsEditorVisible() && recipientCount() > 0) {
                 if (LogTag.VERBOSE) {
                     log("onRestart: goToConversationList");
                 }
                 goToConversationList();
-            } else {
-                if (LogTag.VERBOSE) {
-                    log("onRestart: loadDraft");
-                }
-                loadDraft();
-                mWorkingMessage.setConversation(mConversation);
-                mAttachmentEditor.update(mWorkingMessage);
-                invalidateOptionsMenu();
             }
         }
     }
@@ -2072,7 +2113,42 @@ public class ComposeMessageActivity extends Activity
         // Register a BroadcastReceiver to listen on HTTP I/O process.
         registerReceiver(mHttpProgressReceiver, mHttpProgressFilter);
 
-        loadMessageContent();
+        // figure out whether we need to show the keyboard or not.
+        // if there is draft to be loaded for 'mConversation', we'll show the keyboard;
+        // otherwise we hide the keyboard. In any event, delay loading
+        // message history and draft (controlled by DEFER_LOADING_MESSAGES_AND_DRAFT).
+        int mode = WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE;
+
+        if (DraftCache.getInstance().hasDraft(mConversation.getThreadId())) {
+            mode |= WindowManager.LayoutParams.SOFT_INPUT_STATE_VISIBLE;
+        } else if (mConversation.getThreadId() <= 0) {
+            // For composing a new message, bring up the softkeyboard so the user can
+            // immediately enter recipients. This call won't do anything on devices with
+            // a hard keyboard.
+            mode |= WindowManager.LayoutParams.SOFT_INPUT_STATE_VISIBLE;
+        } else {
+            mode |= WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN;
+        }
+
+        getWindow().setSoftInputMode(mode);
+
+        // reset mMessagesAndDraftLoaded
+        mMessagesAndDraftLoaded = false;
+
+        if (!DEFER_LOADING_MESSAGES_AND_DRAFT) {
+            loadMessagesAndDraft(1);
+        } else {
+            // HACK: force load messages+draft after max delay, if it's not already loaded.
+            // this is to work around when coming out of sleep mode. WindowManager behaves
+            // strangely and hides the keyboard when it should be shown, or sometimes initially
+            // shows it when we want to hide it. In that case, we never get the onSizeChanged()
+            // callback w/ keyboard shown, so we wouldn't know to load the messages+draft.
+            mHandler.postDelayed(new Runnable() {
+                public void run() {
+                    loadMessagesAndDraft(2);
+                }
+            }, LOADING_MESSAGES_AND_DRAFT_MAX_DELAY_MS);
+        }
 
         // Update the fasttrack info in case any of the recipients' contact info changed
         // while we were paused. This can happen, for example, if a user changes or adds
@@ -2097,7 +2173,29 @@ public class ComposeMessageActivity extends Activity
         mConversation.markAsRead();         // dismiss any notifications for this convo
         startMsgListQuery();
         updateSendFailedNotification();
-        drawBottomPanel();
+    }
+
+    /**
+     * Load message history and draft. This method should be called from main thread.
+     * @param debugFlag shows where this is being called from
+     */
+    private void loadMessagesAndDraft(int debugFlag) {
+        if (!mSendDiscreetMode && !mMessagesAndDraftLoaded) {
+            if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+                Log.v(TAG, "### CMA.loadMessagesAndDraft: flag=" + debugFlag);
+            }
+            loadMessageContent();
+            boolean drawBottomPanel = true;
+            if (mShouldLoadDraft) {
+                if (loadDraft()) {
+                    drawBottomPanel = false;
+                }
+            }
+            if (drawBottomPanel) {
+                drawBottomPanel();
+            }
+            mMessagesAndDraftLoaded = true;
+        }
     }
 
     private void updateSendFailedNotification() {
@@ -2120,12 +2218,15 @@ public class ComposeMessageActivity extends Activity
     public void onSaveInstanceState(Bundle outState) {
         super.onSaveInstanceState(outState);
 
-        outState.putString("recipients", getRecipients().serialize());
+        outState.putString(RECIPIENTS, getRecipients().serialize());
 
         mWorkingMessage.writeStateToBundle(outState);
 
-        if (mExitOnSent) {
-            outState.putBoolean("exit_on_sent", mExitOnSent);
+        if (mSendDiscreetMode) {
+            outState.putBoolean(KEY_EXIT_ON_SENT, mSendDiscreetMode);
+        }
+        if (mForwardMessageMode) {
+            outState.putBoolean(KEY_FORWARDED_MESSAGE, mForwardMessageMode);
         }
     }
 
@@ -2158,12 +2259,19 @@ public class ComposeMessageActivity extends Activity
 
         mIsRunning = true;
         updateThreadIdIfRunning();
+        mConversation.markAsRead();
     }
 
     @Override
     protected void onPause() {
         super.onPause();
 
+        if (DEBUG) {
+            Log.v(TAG, "onPause: setCurrentlyDisplayedThreadId: " +
+                        MessagingNotification.THREAD_NONE);
+        }
+        MessagingNotification.setCurrentlyDisplayedThreadId(MessagingNotification.THREAD_NONE);
+
         // OLD: stop getting notified of presence updates to update the titlebar.
         // NEW: we are using ContactHeaderWidget which displays presence, but updating presence
         //      there is out of our control.
@@ -2176,8 +2284,6 @@ public class ComposeMessageActivity extends Activity
             mAsyncDialog.clearPendingProgressDialog();
         }
 
-        MessagingNotification.setCurrentlyDisplayedThreadId(MessagingNotification.THREAD_NONE);
-
         // Remember whether the list is scrolled to the end when we're paused so we can rescroll
         // to the end when resumed.
         if (mMsgListAdapter != null &&
@@ -2190,6 +2296,7 @@ public class ComposeMessageActivity extends Activity
             Log.v(TAG, "onPause: mSavedScrollPosition=" + mSavedScrollPosition);
         }
 
+        mConversation.markAsRead();
         mIsRunning = false;
     }
 
@@ -2197,10 +2304,20 @@ public class ComposeMessageActivity extends Activity
     protected void onStop() {
         super.onStop();
 
+        // No need to do the querying when finished this activity
+        mBackgroundQueryHandler.cancelOperation(MESSAGE_LIST_QUERY_TOKEN);
+
         // Allow any blocked calls to update the thread's read status.
         mConversation.blockMarkAsRead(false);
 
         if (mMsgListAdapter != null) {
+            // Close the cursor in the ListAdapter if the activity stopped.
+            Cursor cursor = mMsgListAdapter.getCursor();
+
+            if (cursor != null && !cursor.isClosed()) {
+                cursor.close();
+            }
+
             mMsgListAdapter.changeCursor(null);
             mMsgListAdapter.cancelBackgroundLoading();
         }
@@ -2210,6 +2327,11 @@ public class ComposeMessageActivity extends Activity
         }
         saveDraft(true);
 
+        // set 'mShouldLoadDraft' to true, so when coming back to ComposeMessageActivity, we would
+        // load the draft, unless we are coming back to the activity after attaching a photo, etc,
+        // in which case we should set 'mShouldLoadDraft' to false.
+        mShouldLoadDraft = true;
+
         // Cleanup the BroadcastReceiver.
         unregisterReceiver(mHttpProgressReceiver);
     }
@@ -2226,15 +2348,16 @@ public class ComposeMessageActivity extends Activity
     @Override
     public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
-        if (LOCAL_LOGV) {
-            Log.v(TAG, "onConfigurationChanged: " + newConfig);
-        }
 
         if (resetConfiguration(newConfig)) {
             // Have to re-layout the attachment editor because we have different layouts
             // depending on whether we're portrait or landscape.
             drawTopPanel(isSubjectEditorVisible());
         }
+        if (LOCAL_LOGV) {
+            Log.v(TAG, "CMA.onConfigurationChanged: " + newConfig +
+                    ", mIsKeyboardOpen=" + mIsKeyboardOpen);
+        }
         onKeyboardStateChanged(mIsKeyboardOpen);
     }
 
@@ -2274,11 +2397,6 @@ public class ComposeMessageActivity extends Activity
     }
 
     @Override
-    public void onUserInteraction() {
-        checkPendingNotification();
-    }
-
-    @Override
     public boolean onKeyDown(int keyCode, KeyEvent event) {
         switch (keyCode) {
             case KeyEvent.KEYCODE_DEL:
@@ -2380,20 +2498,21 @@ public class ComposeMessageActivity extends Activity
     }
 
     @Override
-    public void onProtocolChanged(final boolean mms) {
+    public void onProtocolChanged(final boolean convertToMms) {
         // Have to make sure we're on the UI thread. This function can be called off of the UI
         // thread when we're adding multi-attachments
         runOnUiThread(new Runnable() {
             @Override
             public void run() {
-                toastConvertInfo(mms);
-                showSmsOrMmsSendButton(mms);
+                showSmsOrMmsSendButton(convertToMms);
 
-                if (mms) {
+                if (convertToMms) {
                     // In the case we went from a long sms with a counter to an mms because
                     // the user added an attachment or a subject, hide the counter --
                     // it doesn't apply to mms.
                     mTextCounter.setVisibility(View.GONE);
+
+                    showConvertToMmsToast();
                 }
             }
         });
@@ -2499,6 +2618,12 @@ public class ComposeMessageActivity extends Activity
 
         menu.clear();
 
+        if (mSendDiscreetMode && !mForwardMessageMode) {
+            // When we're in send-a-single-message mode from the lock screen, don't show
+            // any menus.
+            return true;
+        }
+
         if (isRecipientCallable()) {
             MenuItem item = menu.add(0, MENU_CALL_RECIPIENT, 0, R.string.menu_call)
                 .setIcon(R.drawable.ic_menu_call)
@@ -2514,10 +2639,12 @@ public class ComposeMessageActivity extends Activity
                 menu.add(0, MENU_ADD_SUBJECT, 0, R.string.add_subject).setIcon(
                         R.drawable.ic_menu_edit);
             }
-            menu.add(0, MENU_ADD_ATTACHMENT, 0, R.string.add_attachment)
-                .setIcon(R.drawable.ic_menu_attachment)
-                .setTitle(R.string.add_attachment)
-                .setShowAsAction(MenuItem.SHOW_AS_ACTION_ALWAYS);    // add to actionbar
+            if (!mWorkingMessage.hasAttachment()) {
+                menu.add(0, MENU_ADD_ATTACHMENT, 0, R.string.add_attachment)
+                        .setIcon(R.drawable.ic_menu_attachment)
+                    .setTitle(R.string.add_attachment)
+                        .setShowAsAction(MenuItem.SHOW_AS_ACTION_ALWAYS);    // add to actionbar
+            }
         }
 
         if (isPreparedForSending()) {
@@ -2529,6 +2656,10 @@ public class ComposeMessageActivity extends Activity
                     R.drawable.ic_menu_emoticons);
         }
 
+        if (getRecipients().size() > 1) {
+            menu.add(0, MENU_GROUP_PARTICIPANTS, 0, R.string.menu_group_participants);
+        }
+
         if (mMsgListAdapter.getCount() > 0) {
             // Removed search as part of b/1205708
             //menu.add(0, MENU_SEARCH, 0, R.string.menu_search).setIcon(
@@ -2555,16 +2686,22 @@ public class ComposeMessageActivity extends Activity
     }
 
     private void buildAddAddressToContactMenuItem(Menu menu) {
-        // Look for the first recipient we don't have a contact for and create a menu item to
-        // add the number to contacts.
-        for (Contact c : getRecipients()) {
-            if (!c.existsInDatabase() && canAddToContacts(c)) {
-                Intent intent = ConversationList.createAddContactIntent(c.getNumber());
-                menu.add(0, MENU_ADD_ADDRESS_TO_CONTACTS, 0, R.string.menu_add_to_contacts)
-                    .setIcon(android.R.drawable.ic_menu_add)
-                    .setIntent(intent);
-                break;
-            }
+        // bug #7087793: for group of recipients, remove "Add to People" action. Rely on
+        // individually creating contacts for unknown phone numbers by touching the individual
+        // sender's avatars, one at a time
+        ContactList contacts = getRecipients();
+        if (contacts.size() != 1) {
+            return;
+        }
+
+        // if we don't have a contact for the recipient, create a menu item to add the number
+        // to contacts.
+        Contact c = contacts.get(0);
+        if (!c.existsInDatabase() && canAddToContacts(c)) {
+            Intent intent = ConversationList.createAddContactIntent(c.getNumber());
+            menu.add(0, MENU_ADD_ADDRESS_TO_CONTACTS, 0, R.string.menu_add_to_contacts)
+                .setIcon(android.R.drawable.ic_menu_add)
+                .setIntent(intent);
         }
     }
 
@@ -2612,6 +2749,13 @@ public class ComposeMessageActivity extends Activity
             case MENU_INSERT_SMILEY:
                 showSmileyDialog();
                 break;
+            case MENU_GROUP_PARTICIPANTS:
+            {
+                Intent intent = new Intent(this, RecipientListActivity.class);
+                intent.putExtra(THREAD_ID, mConversation.getThreadId());
+                startActivity(intent);
+                break;
+            }
             case MENU_VIEW_CONTACT: {
                 // View the contact for the first (and only) recipient.
                 ContactList list = getRecipients();
@@ -2746,9 +2890,11 @@ public class ComposeMessageActivity extends Activity
     @Override
     protected void onActivityResult(int requestCode, int resultCode, Intent data) {
         if (LogTag.VERBOSE) {
-            log("requestCode=" + requestCode + ", resultCode=" + resultCode + ", data=" + data);
+            log("onActivityResult: requestCode=" + requestCode + ", resultCode=" + resultCode +
+                    ", data=" + data);
         }
         mWaitingForSubActivity = false;          // We're back!
+        mShouldLoadDraft = false;
         if (mWorkingMessage.isFakeMmsForDraft()) {
             // We no longer have to fake the fact we're an Mms. At this point we are or we aren't,
             // based on attachments and other Mms attrs.
@@ -2798,7 +2944,6 @@ public class ComposeMessageActivity extends Activity
                         updateThreadIdIfRunning();
                         drawTopPanel(false);
                         updateSendButtonState();
-                        invalidateOptionsMenu();
                     }
                 }
                 break;
@@ -2948,7 +3093,8 @@ public class ComposeMessageActivity extends Activity
                 result = WorkingMessage.UNKNOWN_ERROR;
             } else {
                 try {
-                    Uri dataUri = persister.persistPart(part, ContentUris.parseId(messageUri));
+                    Uri dataUri = persister.persistPart(part,
+                            ContentUris.parseId(messageUri), null);
                     result = mWorkingMessage.setAttachment(WorkingMessage.IMAGE, dataUri, append);
                     if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
                         log("ResizeImageResultCallback: dataUri=" + dataUri);
@@ -3012,7 +3158,7 @@ public class ComposeMessageActivity extends Activity
 
     private void addImage(Uri uri, boolean append) {
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-            log("append=" + append + ", uri=" + uri);
+            log("addImage: append=" + append + ", uri=" + uri);
         }
 
         int result = mWorkingMessage.setAttachment(WorkingMessage.IMAGE, uri, append);
@@ -3062,7 +3208,7 @@ public class ComposeMessageActivity extends Activity
 
         // If this is a forwarded message, it will have an Intent extra
         // indicating so.  If not, bail out.
-        if (intent.getBooleanExtra("forwarded_message", false) == false) {
+        if (!mForwardMessageMode) {
             return false;
         }
 
@@ -3169,6 +3315,9 @@ public class ComposeMessageActivity extends Activity
         return r.getString(id, mediaName);
     }
 
+    /**
+     * draw the compose view at the bottom of the screen.
+     */
     private void drawBottomPanel() {
         // Reset the counter for text editor.
         resetCounter();
@@ -3179,6 +3328,9 @@ public class ComposeMessageActivity extends Activity
             return;
         }
 
+        if (LOCAL_LOGV) {
+            Log.v(TAG, "CMA.drawBottomPanel");
+        }
         mBottomPanel.setVisibility(View.VISIBLE);
 
         CharSequence text = mWorkingMessage.getText();
@@ -3186,15 +3338,27 @@ public class ComposeMessageActivity extends Activity
         // TextView.setTextKeepState() doesn't like null input.
         if (text != null) {
             mTextEditor.setTextKeepState(text);
+
+            // Set the edit caret to the end of the text.
+            mTextEditor.setSelection(mTextEditor.length());
         } else {
             mTextEditor.setText("");
         }
     }
 
+    private void hideBottomPanel() {
+        if (LOCAL_LOGV) {
+            Log.v(TAG, "CMA.hideBottomPanel");
+        }
+        mBottomPanel.setVisibility(View.INVISIBLE);
+    }
+
     private void drawTopPanel(boolean showSubjectEditor) {
         boolean showingAttachment = mAttachmentEditor.update(mWorkingMessage);
         mAttachmentEditorScrollView.setVisibility(showingAttachment ? View.VISIBLE : View.GONE);
         showSubjectEditor(showSubjectEditor || mWorkingMessage.hasSubject());
+
+        invalidateOptionsMenu();
     }
 
     //==========================================================
@@ -3235,7 +3399,7 @@ public class ComposeMessageActivity extends Activity
         if (event != null) {
             // if shift key is down, then we want to insert the '\n' char in the TextView;
             // otherwise, the default action is to send the message.
-            if (!event.isShiftPressed()) {
+            if (!event.isShiftPressed() && event.getAction() == KeyEvent.ACTION_DOWN) {
                 if (isPreparedForSending()) {
                     confirmSendMessageIfNeeded();
                 }
@@ -3327,6 +3491,17 @@ public class ComposeMessageActivity extends Activity
 
         mMsgListView.setOnSizeChangedListener(new OnSizeChangedListener() {
             public void onSizeChanged(int width, int height, int oldWidth, int oldHeight) {
+                if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
+                    Log.v(TAG, "onSizeChanged: w=" + width + " h=" + height +
+                            " oldw=" + oldWidth + " oldh=" + oldHeight);
+                }
+
+                if (!mMessagesAndDraftLoaded && (oldHeight-height > SMOOTH_SCROLL_THRESHOLD)) {
+                    // perform the delayed loading now, after keyboard opens
+                    loadMessagesAndDraft(3);
+                }
+
+
                 // The message list view changed size, most likely because the keyboard
                 // appeared or disappeared or the user typed/deleted chars in the message
                 // box causing it to change its height when expanding/collapsing to hold more
@@ -3382,6 +3557,9 @@ public class ComposeMessageActivity extends Activity
     }
 
     private void startMsgListQuery(int token) {
+        if (mSendDiscreetMode) {
+            return;
+        }
         Uri conversationUri = mConversation.getUri();
 
         if (conversationUri == null) {
@@ -3426,7 +3604,7 @@ public class ComposeMessageActivity extends Activity
         mMsgListAdapter.setMsgListItemHandler(mMessageListItemHandler);
         mMsgListView.setAdapter(mMsgListAdapter);
         mMsgListView.setItemsCanFocus(false);
-        mMsgListView.setVisibility(View.VISIBLE);
+        mMsgListView.setVisibility(mSendDiscreetMode ? View.INVISIBLE : View.VISIBLE);
         mMsgListView.setOnCreateContextMenuListener(mMsgListMenuCreateListener);
         mMsgListView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
             @Override
@@ -3438,14 +3616,20 @@ public class ComposeMessageActivity extends Activity
         });
     }
 
-    private void loadDraft() {
+    /**
+     * Load the draft
+     *
+     * If mWorkingMessage has content in memory that's worth saving, return false.
+     * Otherwise, call the async operation to load draft and return true.
+     */
+    private boolean loadDraft() {
         if (mWorkingMessage.isWorthSaving()) {
-            Log.w(TAG, "called with non-empty working message");
-            return;
+            Log.w(TAG, "CMA.loadDraft: called with non-empty working message, bail");
+            return false;
         }
 
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-            log("call WorkingMessage.loadDraft");
+            log("CMA.loadDraft");
         }
 
         mWorkingMessage = WorkingMessage.loadDraft(this, mConversation,
@@ -3454,8 +3638,15 @@ public class ComposeMessageActivity extends Activity
                     public void run() {
                         drawTopPanel(false);
                         drawBottomPanel();
+                        updateSendButtonState();
                     }
                 });
+
+        // WorkingMessage.loadDraft() can return a new WorkingMessage object that doesn't
+        // have its conversation set. Make sure it is set.
+        mWorkingMessage.setConversation(mConversation);
+
+        return true;
     }
 
     private void saveDraft(boolean isStopping) {
@@ -3557,14 +3748,14 @@ public class ComposeMessageActivity extends Activity
             mScrollOnSend = true;   // in the next onQueryComplete, scroll the list to the end.
         }
         // But bail out if we are supposed to exit after the message is sent.
-        if (mExitOnSent) {
+        if (mSendDiscreetMode) {
             finish();
         }
     }
 
     private void resetMessage() {
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-            log("");
+            log("resetMessage");
         }
 
         // Make the attachment editor hide its view.
@@ -3658,19 +3849,25 @@ public class ComposeMessageActivity extends Activity
         Intent intent = getIntent();
         if (bundle != null) {
             setIntent(getIntent().setAction(Intent.ACTION_VIEW));
-            String recipients = bundle.getString("recipients");
+            String recipients = bundle.getString(RECIPIENTS);
             if (LogTag.VERBOSE) log("get mConversation by recipients " + recipients);
             mConversation = Conversation.get(this,
                     ContactList.getByNumbers(recipients,
                             false /* don't block */, true /* replace number */), false);
             addRecipientsListeners();
-            mExitOnSent = bundle.getBoolean("exit_on_sent", false);
+            mSendDiscreetMode = bundle.getBoolean(KEY_EXIT_ON_SENT, false);
+            mForwardMessageMode = bundle.getBoolean(KEY_FORWARDED_MESSAGE, false);
+
+            if (mSendDiscreetMode) {
+                mMsgListView.setVisibility(View.INVISIBLE);
+            }
             mWorkingMessage.readStateFromBundle(bundle);
+
             return;
         }
 
         // If we have been passed a thread_id, use that to find our conversation.
-        long threadId = intent.getLongExtra("thread_id", 0);
+        long threadId = intent.getLongExtra(THREAD_ID, 0);
         if (threadId > 0) {
             if (LogTag.VERBOSE) log("get mConversation by threadId " + threadId);
             mConversation = Conversation.get(this, threadId, false);
@@ -3697,7 +3894,11 @@ public class ComposeMessageActivity extends Activity
         addRecipientsListeners();
         updateThreadIdIfRunning();
 
-        mExitOnSent = intent.getBooleanExtra("exit_on_sent", false);
+        mSendDiscreetMode = intent.getBooleanExtra(KEY_EXIT_ON_SENT, false);
+        mForwardMessageMode = intent.getBooleanExtra(KEY_FORWARDED_MESSAGE, false);
+        if (mSendDiscreetMode) {
+            mMsgListView.setVisibility(View.INVISIBLE);
+        }
         if (intent.hasExtra("sms_body")) {
             mWorkingMessage.setText(intent.getStringExtra("sms_body"));
         }
@@ -3727,7 +3928,6 @@ public class ComposeMessageActivity extends Activity
                     mDataSetChangedListener = new MessageListAdapter.OnDataSetChangedListener() {
         @Override
         public void onDataSetChanged(MessageListAdapter adapter) {
-            mPossiblePendingNotification = true;
         }
 
         @Override
@@ -3736,13 +3936,6 @@ public class ComposeMessageActivity extends Activity
         }
     };
 
-    private void checkPendingNotification() {
-        if (mPossiblePendingNotification && hasWindowFocus()) {
-            mConversation.markAsRead();
-            mPossiblePendingNotification = false;
-        }
-    }
-
     /**
      * smoothScrollToEnd will scroll the message list to the bottom if the list is already near
      * the bottom. Typically this is called to smooth scroll a newly received message into view.
@@ -3754,28 +3947,34 @@ public class ComposeMessageActivity extends Activity
      * @param listSizeChange the amount the message list view size has vertically changed
      */
     private void smoothScrollToEnd(boolean force, int listSizeChange) {
-        int last = mMsgListView.getLastVisiblePosition();
-        if (last <= 0) {
+        int lastItemVisible = mMsgListView.getLastVisiblePosition();
+        int lastItemInList = mMsgListAdapter.getCount() - 1;
+        if (lastItemVisible < 0 || lastItemInList < 0) {
             if (LogTag.VERBOSE || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                Log.v(TAG, "smoothScrollToEnd: last=" + last + ", mMsgListView not ready");
+                Log.v(TAG, "smoothScrollToEnd: lastItemVisible=" + lastItemVisible +
+                        ", lastItemInList=" + lastItemInList +
+                        ", mMsgListView not ready");
             }
             return;
         }
 
-        View lastChild = mMsgListView.getChildAt(last - mMsgListView.getFirstVisiblePosition());
-        int bottom = 0;
-        if (lastChild != null) {
-            bottom = lastChild.getBottom();
+        View lastChildVisible =
+                mMsgListView.getChildAt(lastItemVisible - mMsgListView.getFirstVisiblePosition());
+        int lastVisibleItemBottom = 0;
+        int lastVisibleItemHeight = 0;
+        if (lastChildVisible != null) {
+            lastVisibleItemBottom = lastChildVisible.getBottom();
+            lastVisibleItemHeight = lastChildVisible.getHeight();
         }
 
-        int newPosition = mMsgListAdapter.getCount() - 1;
         if (LogTag.VERBOSE || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-            Log.v(TAG, "smoothScrollToEnd newPosition: " + newPosition +
+            Log.v(TAG, "smoothScrollToEnd newPosition: " + lastItemInList +
                     " mLastSmoothScrollPosition: " + mLastSmoothScrollPosition +
                     " first: " + mMsgListView.getFirstVisiblePosition() +
-                    " last: " + last +
-                    " bottom: " + bottom +
-                    " bottom + listSizeChange: " + (bottom + listSizeChange) +
+                    " lastItemVisible: " + lastItemVisible +
+                    " lastVisibleItemBottom: " + lastVisibleItemBottom +
+                    " lastVisibleItemBottom + listSizeChange: " +
+                    (lastVisibleItemBottom + listSizeChange) +
                     " mMsgListView.getHeight() - mMsgListView.getPaddingBottom(): " +
                     (mMsgListView.getHeight() - mMsgListView.getPaddingBottom()) +
                     " listSizeChange: " + listSizeChange);
@@ -3789,29 +3988,55 @@ public class ComposeMessageActivity extends Activity
         // like -524. The lastChild listitem's bottom value will be the old value before the
         // keyboard became visible but the size of the list will have changed. The test below
         // add listSizeChange to bottom to figure out if the old position was already scrolled
-        // to the bottom.
-        if (force || ((listSizeChange != 0 || newPosition != mLastSmoothScrollPosition) &&
-                bottom + listSizeChange <=
-                    mMsgListView.getHeight() - mMsgListView.getPaddingBottom())) {
+        // to the bottom. We also scroll the list if the last item is taller than the size of the
+        // list. This happens when the keyboard is up and the last item is an mms with an
+        // attachment thumbnail, such as picture. In this situation, we want to scroll the list so
+        // the bottom of the thumbnail is visible and the top of the item is scroll off the screen.
+        int listHeight = mMsgListView.getHeight();
+        boolean lastItemTooTall = lastVisibleItemHeight > listHeight;
+        boolean willScroll = force ||
+                ((listSizeChange != 0 || lastItemInList != mLastSmoothScrollPosition) &&
+                lastVisibleItemBottom + listSizeChange <=
+                    listHeight - mMsgListView.getPaddingBottom());
+        if (willScroll || (lastItemTooTall && lastItemInList == lastItemVisible)) {
             if (Math.abs(listSizeChange) > SMOOTH_SCROLL_THRESHOLD) {
                 // When the keyboard comes up, the window manager initiates a cross fade
                 // animation that conflicts with smooth scroll. Handle that case by jumping the
                 // list directly to the end.
                 if (LogTag.VERBOSE || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                    Log.v(TAG, "keyboard state changed. setSelection=" + newPosition);
+                    Log.v(TAG, "keyboard state changed. setSelection=" + lastItemInList);
+                }
+                if (lastItemTooTall) {
+                    // If the height of the last item is taller than the whole height of the list,
+                    // we need to scroll that item so that its top is negative or above the top of
+                    // the list. That way, the bottom of the last item will be exposed above the
+                    // keyboard.
+                    mMsgListView.setSelectionFromTop(lastItemInList,
+                            listHeight - lastVisibleItemHeight);
+                } else {
+                    mMsgListView.setSelection(lastItemInList);
                 }
-                mMsgListView.setSelection(newPosition);
-            } else if (newPosition - last > MAX_ITEMS_TO_INVOKE_SCROLL_SHORTCUT) {
+            } else if (lastItemInList - lastItemVisible > MAX_ITEMS_TO_INVOKE_SCROLL_SHORTCUT) {
                 if (LogTag.VERBOSE || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                    Log.v(TAG, "too many to scroll, setSelection=" + newPosition);
+                    Log.v(TAG, "too many to scroll, setSelection=" + lastItemInList);
                 }
-                mMsgListView.setSelection(newPosition);
+                mMsgListView.setSelection(lastItemInList);
             } else {
                 if (LogTag.VERBOSE || Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                    Log.v(TAG, "smooth scroll to " + newPosition);
+                    Log.v(TAG, "smooth scroll to " + lastItemInList);
                 }
-                mMsgListView.smoothScrollToPosition(newPosition);
-                mLastSmoothScrollPosition = newPosition;
+                if (lastItemTooTall) {
+                    // If the height of the last item is taller than the whole height of the list,
+                    // we need to scroll that item so that its top is negative or above the top of
+                    // the list. That way, the bottom of the last item will be exposed above the
+                    // keyboard. We should use smoothScrollToPositionFromTop here, but it doesn't
+                    // seem to work -- the list ends up scrolling to a random position.
+                    mMsgListView.setSelectionFromTop(lastItemInList,
+                            listHeight - lastVisibleItemHeight);
+                } else {
+                    mMsgListView.smoothScrollToPosition(lastItemInList);
+                }
+                mLastSmoothScrollPosition = lastItemInList;
             }
         }
     }
@@ -3885,10 +4110,18 @@ public class ComposeMessageActivity extends Activity
                     if (newSelectionPos != -1) {
                         mMsgListView.setSelection(newSelectionPos);     // jump the list to the pos
                     } else {
+                        int count = mMsgListAdapter.getCount();
+                        long lastMsgId = 0;
+                        if (count > 0) {
+                            cursor.moveToLast();
+                            lastMsgId = cursor.getLong(COLUMN_ID);
+                        }
                         // mScrollOnSend is set when we send a message. We always want to scroll
                         // the message list to the end when we send a message, but have to wait
-                        // until the DB has changed.
-                        smoothScrollToEnd(mScrollOnSend, 0);
+                        // until the DB has changed. We also want to scroll the list when a
+                        // new message has arrived.
+                        smoothScrollToEnd(mScrollOnSend || lastMsgId != mLastMessageId, 0);
+                        mLastMessageId = lastMsgId;
                         mScrollOnSend = false;
                     }
                     // Adjust the conversation's message count to match reality. The
@@ -3951,6 +4184,14 @@ public class ComposeMessageActivity extends Activity
                             conv.clearThreadId();
                             conv.setDraftState(false);
                         }
+                        // The last message in this converation was just deleted. Send the user
+                        // to the conversation list.
+                        exitComposeMessageActivity(new Runnable() {
+                            @Override
+                            public void run() {
+                                goToConversationList();
+                            }
+                        });
                     }
                     cursor.close();
             }
@@ -3964,6 +4205,10 @@ public class ComposeMessageActivity extends Activity
                     mConversation.setMessageCount(0);
                     // fall through
                 case DELETE_MESSAGE_TOKEN:
+                    if (cookie instanceof Boolean && ((Boolean)cookie).booleanValue()) {
+                        // If we just deleted the last message, reset the saved id.
+                        mLastMessageId = 0;
+                    }
                     // Update the notification for new messages since they
                     // may be deleted.
                     MessagingNotification.nonBlockingUpdateNewMessageIndicator(
@@ -3996,6 +4241,8 @@ public class ComposeMessageActivity extends Activity
                 // Check to see if we just deleted the last message
                 startMsgListQuery(MESSAGE_LIST_QUERY_AFTER_DELETE_TOKEN);
             }
+
+            MmsWidgetProvider.notifyDatasetChanged(getApplicationContext());
         }
     }
 
@@ -4145,7 +4392,16 @@ public class ComposeMessageActivity extends Activity
 
     private void updateThreadIdIfRunning() {
         if (mIsRunning && mConversation != null) {
+            if (DEBUG) {
+                Log.v(TAG, "updateThreadIdIfRunning: threadId: " +
+                        mConversation.getThreadId());
+            }
             MessagingNotification.setCurrentlyDisplayedThreadId(mConversation.getThreadId());
+        } else {
+            if (DEBUG) {
+                Log.v(TAG, "updateThreadIdIfRunning: mIsRunning: " + mIsRunning +
+                        " mConversation: " + mConversation);
+            }
         }
         // If we're not running, but resume later, the current thread ID will be set in onResume()
     }
diff --git a/src/com/android/mms/ui/ConfirmRateLimitActivity.java b/src/com/android/mms/ui/ConfirmRateLimitActivity.java
index 74b971a..35230d0 100644
--- a/src/com/android/mms/ui/ConfirmRateLimitActivity.java
+++ b/src/com/android/mms/ui/ConfirmRateLimitActivity.java
@@ -18,10 +18,6 @@
 package com.android.mms.ui;
 
 import static com.android.mms.util.RateController.RATE_LIMIT_CONFIRMED_ACTION;
-
-import com.android.mms.R;
-import com.android.mms.util.RateController;
-
 import android.app.Activity;
 import android.content.Intent;
 import android.os.Bundle;
@@ -29,10 +25,13 @@ import android.os.Handler;
 import android.util.Log;
 import android.view.KeyEvent;
 import android.view.View;
-import android.view.Window;
 import android.view.View.OnClickListener;
+import android.view.Window;
 import android.widget.Button;
 
+import com.android.mms.R;
+import com.android.mms.util.RateController;
+
 public class ConfirmRateLimitActivity extends Activity {
     private static final String TAG = "ConfirmRateLimitActivity";
     private static final boolean DEBUG = false;
diff --git a/src/com/android/mms/ui/ConversationList.java b/src/com/android/mms/ui/ConversationList.java
index b491d4d..884f484 100644
--- a/src/com/android/mms/ui/ConversationList.java
+++ b/src/com/android/mms/ui/ConversationList.java
@@ -21,38 +21,25 @@ import java.util.ArrayList;
 import java.util.Collection;
 import java.util.HashSet;
 
-import com.android.mms.LogTag;
-import com.android.mms.R;
-import com.android.mms.data.Contact;
-import com.android.mms.data.ContactList;
-import com.android.mms.data.Conversation;
-import com.android.mms.data.Conversation.ConversationQueryHandler;
-import com.android.mms.transaction.MessagingNotification;
-import com.android.mms.transaction.SmsRejectedReceiver;
-import com.android.mms.util.DraftCache;
-import com.android.mms.util.Recycler;
-import com.google.android.mms.pdu.PduHeaders;
-
-import android.content.ActivityNotFoundException;
-import android.content.pm.PackageManager;
-import android.database.sqlite.SqliteWrapper;
-
 import android.app.ActionBar;
 import android.app.AlertDialog;
 import android.app.ListActivity;
 import android.app.SearchManager;
 import android.app.SearchableInfo;
+import android.content.ActivityNotFoundException;
 import android.content.AsyncQueryHandler;
 import android.content.ComponentName;
 import android.content.ContentResolver;
 import android.content.Context;
 import android.content.DialogInterface;
+import android.content.DialogInterface.OnClickListener;
 import android.content.Intent;
 import android.content.SharedPreferences;
-import android.content.DialogInterface.OnClickListener;
+import android.content.pm.PackageManager;
 import android.content.res.Configuration;
 import android.database.Cursor;
 import android.database.sqlite.SQLiteException;
+import android.database.sqlite.SqliteWrapper;
 import android.os.Bundle;
 import android.os.Handler;
 import android.preference.PreferenceManager;
@@ -63,6 +50,7 @@ import android.provider.Telephony.Threads;
 import android.util.Log;
 import android.view.ActionMode;
 import android.view.ContextMenu;
+import android.view.ContextMenu.ContextMenuInfo;
 import android.view.Gravity;
 import android.view.KeyEvent;
 import android.view.LayoutInflater;
@@ -70,22 +58,35 @@ import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;
 import android.view.View;
-import android.view.ViewGroup;
-import android.view.ContextMenu.ContextMenuInfo;
 import android.view.View.OnCreateContextMenuListener;
 import android.view.View.OnKeyListener;
+import android.view.ViewGroup;
 import android.widget.AdapterView;
 import android.widget.CheckBox;
 import android.widget.ListView;
 import android.widget.SearchView;
 import android.widget.TextView;
 
+import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.data.ContactList;
+import com.android.mms.data.Conversation;
+import com.android.mms.data.Conversation.ConversationQueryHandler;
+import com.android.mms.transaction.MessagingNotification;
+import com.android.mms.transaction.SmsRejectedReceiver;
+import com.android.mms.util.DraftCache;
+import com.android.mms.util.Recycler;
+import com.android.mms.widget.MmsWidgetProvider;
+import com.google.android.mms.pdu.PduHeaders;
+
 /**
  * This activity provides a list view of existing conversations.
  */
 public class ConversationList extends ListActivity implements DraftCache.OnDraftChangedListener {
     private static final String TAG = "ConversationList";
     private static final boolean DEBUG = false;
+    private static final boolean DEBUGCLEANUP = true;
     private static final boolean LOCAL_LOGV = DEBUG;
 
     private static final int THREAD_LIST_QUERY_TOKEN       = 1701;
@@ -104,10 +105,16 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
     private ConversationListAdapter mListAdapter;
     private SharedPreferences mPrefs;
     private Handler mHandler;
-    private boolean mNeedToMarkAsSeen;
+    private boolean mDoOnceAfterFirstQuery;
     private TextView mUnreadConvCount;
     private MenuItem mSearchItem;
     private SearchView mSearchView;
+    private int mSavedFirstVisiblePosition = AdapterView.INVALID_POSITION;
+    private int mSavedFirstItemOffset;
+
+    // keys for extras and icicles
+    private final static String LAST_LIST_POS = "last_list_pos";
+    private final static String LAST_LIST_OFFSET = "last_list_offset";
 
     static private final String CHECKED_MESSAGE_LIMITS = "checked_message_limits";
 
@@ -141,6 +148,46 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
         if (!checkedMessageLimits || DEBUG) {
             runOneTimeStorageLimitCheckForLegacyMessages();
         }
+
+        if (savedInstanceState != null) {
+            mSavedFirstVisiblePosition = savedInstanceState.getInt(LAST_LIST_POS,
+                    AdapterView.INVALID_POSITION);
+            mSavedFirstItemOffset = savedInstanceState.getInt(LAST_LIST_OFFSET, 0);
+        } else {
+            mSavedFirstVisiblePosition = AdapterView.INVALID_POSITION;
+            mSavedFirstItemOffset = 0;
+        }
+    }
+
+    @Override
+    public void onSaveInstanceState(Bundle outState) {
+        super.onSaveInstanceState(outState);
+
+        outState.putInt(LAST_LIST_POS, mSavedFirstVisiblePosition);
+        outState.putInt(LAST_LIST_OFFSET, mSavedFirstItemOffset);
+    }
+
+    @Override
+    public void onPause() {
+        super.onPause();
+
+        // Don't listen for changes while we're paused.
+        mListAdapter.setOnContentChangedListener(null);
+
+        // Remember where the list is scrolled to so we can restore the scroll position
+        // when we come back to this activity and *after* we complete querying for the
+        // conversations.
+        ListView listView = getListView();
+        mSavedFirstVisiblePosition = listView.getFirstVisiblePosition();
+        View firstChild = listView.getChildAt(0);
+        mSavedFirstItemOffset = (firstChild == null) ? 0 : firstChild.getTop();
+    }
+
+    @Override
+    protected void onResume() {
+        super.onResume();
+
+        mListAdapter.setOnContentChangedListener(mContentChangedListener);
     }
 
     private void setupActionBar() {
@@ -252,7 +299,7 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
 
         DraftCache.getInstance().addOnDraftChangedListener(this);
 
-        mNeedToMarkAsSeen = true;
+        mDoOnceAfterFirstQuery = true;
 
         startAsyncQuery();
 
@@ -284,6 +331,13 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
         // multi-select mode (if we're in it) and remove all the selections.
         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);
 
+        // Close the cursor in the ListAdapter if the activity stopped.
+        Cursor cursor = mListAdapter.getCursor();
+
+        if (cursor != null && !cursor.isClosed()) {
+            cursor.close();
+        }
+
         mListAdapter.changeCursor(null);
     }
 
@@ -672,11 +726,8 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
                         Conversation.startDeleteAll(mHandler, token, mDeleteLockedMessages);
                         DraftCache.getInstance().refresh();
                     } else {
-                        for (long threadId : mThreadIds) {
-                            Conversation.startDelete(mHandler, token, mDeleteLockedMessages,
-                                    threadId);
-                            DraftCache.getInstance().setDraftState(threadId, false);
-                        }
+                        Conversation.startDelete(mHandler, token, mDeleteLockedMessages,
+                                mThreadIds);
                     }
                 }
             });
@@ -694,8 +745,15 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
             if (DraftCache.getInstance().getSavingDraft()) {
                 // We're still saving a draft. Try again in a second. We don't want to delete
                 // any threads out from under the draft.
+                if (DEBUGCLEANUP) {
+                    LogTag.debug("mDeleteObsoleteThreadsRunnable saving draft, trying again");
+                }
                 mHandler.postDelayed(mDeleteObsoleteThreadsRunnable, 1000);
             } else {
+                if (DEBUGCLEANUP) {
+                    LogTag.debug("mDeleteObsoleteThreadsRunnable calling " +
+                            "asyncDeleteObsoleteThreads");
+                }
                 Conversation.asyncDeleteObsoleteThreads(mQueryHandler,
                         DELETE_OBSOLETE_THREADS_TOKEN);
             }
@@ -731,14 +789,24 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
                     ((TextView)(getListView().getEmptyView())).setText(R.string.no_conversations);
                 }
 
-                if (mNeedToMarkAsSeen) {
-                    mNeedToMarkAsSeen = false;
-                    Conversation.markAllConversationsAsSeen(getApplicationContext());
+                if (mDoOnceAfterFirstQuery) {
+                    mDoOnceAfterFirstQuery = false;
+                    // Delay doing a couple of DB operations until we've initially queried the DB
+                    // for the list of conversations to display. We don't want to slow down showing
+                    // the initial UI.
 
-                    // Delete any obsolete threads. Obsolete threads are threads that aren't
-                    // referenced by at least one message in the pdu or sms tables. We only call
-                    // this on the first query (because of mNeedToMarkAsSeen).
+                    // 1. Delete any obsolete threads. Obsolete threads are threads that aren't
+                    // referenced by at least one message in the pdu or sms tables.
                     mHandler.post(mDeleteObsoleteThreadsRunnable);
+
+                    // 2. Mark all the conversations as seen.
+                    Conversation.markAllConversationsAsSeen(getApplicationContext());
+                }
+                if (mSavedFirstVisiblePosition != AdapterView.INVALID_POSITION) {
+                    // Restore the list to its previous position.
+                    getListView().setSelectionFromTop(mSavedFirstVisiblePosition,
+                            mSavedFirstItemOffset);
+                    mSavedFirstVisiblePosition = AdapterView.INVALID_POSITION;
                 }
                 break;
 
@@ -805,10 +873,14 @@ public class ConversationList extends ListActivity implements DraftCache.OnDraft
 
                 // Make sure the list reflects the delete
                 startAsyncQuery();
+
+                MmsWidgetProvider.notifyDatasetChanged(getApplicationContext());
                 break;
 
             case DELETE_OBSOLETE_THREADS_TOKEN:
-                // Nothing to do here.
+                if (DEBUGCLEANUP) {
+                    LogTag.debug("onQueryComplete finished DELETE_OBSOLETE_THREADS_TOKEN");
+                }
                 break;
             }
         }
diff --git a/src/com/android/mms/ui/ConversationListAdapter.java b/src/com/android/mms/ui/ConversationListAdapter.java
index a6492f8..40d0eaf 100644
--- a/src/com/android/mms/ui/ConversationListAdapter.java
+++ b/src/com/android/mms/ui/ConversationListAdapter.java
@@ -17,10 +17,6 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import com.android.mms.data.Conversation;
-
 import android.content.Context;
 import android.database.Cursor;
 import android.util.Log;
@@ -30,6 +26,9 @@ import android.view.ViewGroup;
 import android.widget.AbsListView;
 import android.widget.CursorAdapter;
 
+import com.android.mms.R;
+import com.android.mms.data.Conversation;
+
 /**
  * The back-end data adapter for ConversationList.
  */
diff --git a/src/com/android/mms/ui/ConversationListItem.java b/src/com/android/mms/ui/ConversationListItem.java
index 16c76a9..730a39b 100644
--- a/src/com/android/mms/ui/ConversationListItem.java
+++ b/src/com/android/mms/ui/ConversationListItem.java
@@ -17,17 +17,9 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.LogTag;
-import com.android.mms.R;
-import com.android.mms.data.Contact;
-import com.android.mms.data.ContactList;
-import com.android.mms.data.Conversation;
-import com.android.mms.util.SmileyParser;
-
 import android.content.Context;
 import android.graphics.Typeface;
 import android.graphics.drawable.Drawable;
-
 import android.os.Handler;
 import android.text.Spannable;
 import android.text.SpannableStringBuilder;
@@ -42,6 +34,13 @@ import android.widget.QuickContactBadge;
 import android.widget.RelativeLayout;
 import android.widget.TextView;
 
+import com.android.mms.LogTag;
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.data.ContactList;
+import com.android.mms.data.Conversation;
+import com.android.mms.util.SmileyParser;
+
 /**
  * This class manages the view for given conversation.
  */
diff --git a/src/com/android/mms/ui/DeliveryReportActivity.java b/src/com/android/mms/ui/DeliveryReportActivity.java
index c22042a..e81de83 100644
--- a/src/com/android/mms/ui/DeliveryReportActivity.java
+++ b/src/com/android/mms/ui/DeliveryReportActivity.java
@@ -17,13 +17,17 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.google.android.mms.pdu.PduHeaders;
-import android.database.sqlite.SqliteWrapper;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
 
 import android.app.ListActivity;
 import android.content.Intent;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.Bundle;
 import android.provider.Telephony.Mms;
@@ -36,12 +40,8 @@ import android.view.View;
 import android.view.Window;
 import android.widget.ListView;
 
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
+import com.android.mms.R;
+import com.google.android.mms.pdu.PduHeaders;
 
 /**
  * This is the UI for displaying a delivery report:
diff --git a/src/com/android/mms/ui/DeliveryReportAdapter.java b/src/com/android/mms/ui/DeliveryReportAdapter.java
index 9463a58..f3a63b9 100644
--- a/src/com/android/mms/ui/DeliveryReportAdapter.java
+++ b/src/com/android/mms/ui/DeliveryReportAdapter.java
@@ -16,7 +16,7 @@
  */
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.util.List;
 
 import android.content.Context;
 import android.view.LayoutInflater;
@@ -24,7 +24,7 @@ import android.view.View;
 import android.view.ViewGroup;
 import android.widget.ArrayAdapter;
 
-import java.util.List;
+import com.android.mms.R;
 
 /**
  * The back-end data adapter for DeliveryReportActivity.
diff --git a/src/com/android/mms/ui/DeliveryReportListItem.java b/src/com/android/mms/ui/DeliveryReportListItem.java
index 12361b7..46a9fd9 100644
--- a/src/com/android/mms/ui/DeliveryReportListItem.java
+++ b/src/com/android/mms/ui/DeliveryReportListItem.java
@@ -17,9 +17,6 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.data.Contact;
-
 import android.content.Context;
 import android.text.TextUtils;
 import android.util.AttributeSet;
@@ -28,6 +25,9 @@ import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+
 /**
  * This class displays the status for a single recipient of a message.  It is used in
  * the ListView of DeliveryReportActivity.
diff --git a/src/com/android/mms/ui/EditSlideDurationActivity.java b/src/com/android/mms/ui/EditSlideDurationActivity.java
index ee317ff..222875c 100644
--- a/src/com/android/mms/ui/EditSlideDurationActivity.java
+++ b/src/com/android/mms/ui/EditSlideDurationActivity.java
@@ -20,15 +20,11 @@ package com.android.mms.ui;
 import android.app.Activity;
 import android.content.Intent;
 import android.os.Bundle;
-import android.text.InputFilter;
-import android.text.method.NumberKeyListener;
-import android.util.Log;
 import android.view.KeyEvent;
 import android.view.View;
-import android.view.Window;
 import android.view.View.OnClickListener;
 import android.view.View.OnKeyListener;
-import android.view.inputmethod.EditorInfo;
+import android.view.Window;
 import android.widget.Button;
 import android.widget.EditText;
 import android.widget.TextView;
diff --git a/src/com/android/mms/ui/IconListAdapter.java b/src/com/android/mms/ui/IconListAdapter.java
index f99b956..288be7e 100644
--- a/src/com/android/mms/ui/IconListAdapter.java
+++ b/src/com/android/mms/ui/IconListAdapter.java
@@ -17,6 +17,8 @@
 
 package com.android.mms.ui;
 
+import java.util.List;
+
 import android.content.Context;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -25,8 +27,6 @@ import android.widget.ArrayAdapter;
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import java.util.List;
-
 import com.android.mms.R;
 
 /**
@@ -35,7 +35,33 @@ import com.android.mms.R;
 public class IconListAdapter extends ArrayAdapter<IconListAdapter.IconListItem> {
     protected LayoutInflater mInflater;
     private static final int mResource = R.layout.icon_list_item;
+    private ViewHolder mViewHolder;
+
+    static class ViewHolder {
+        private View mView;
+        private TextView mTextView;
+        private ImageView mImageView;
+
+        public ViewHolder(View view) {
+            mView = view;
+        }
 
+        public TextView getTextView() {
+            if (mTextView == null) {
+                mTextView = (TextView) mView.findViewById(R.id.text1);
+            }
+
+            return mTextView;
+        }
+
+        public ImageView getImageView() {
+            if (mImageView == null) {
+                mImageView = (ImageView) mView.findViewById(R.id.icon);
+            }
+
+            return mImageView;
+        }
+    }
     public IconListAdapter(Context context,
             List<IconListItem> items) {
         super(context, mResource, items);
@@ -44,22 +70,22 @@ public class IconListAdapter extends ArrayAdapter<IconListAdapter.IconListItem>
 
     @Override
     public View getView(int position, View convertView, ViewGroup parent) {
-        TextView text;
-        ImageView image;
-
         View view;
         if (convertView == null) {
             view = mInflater.inflate(mResource, parent, false);
+            mViewHolder = new ViewHolder(view);
+            view.setTag(mViewHolder);
         } else {
             view = convertView;
+            mViewHolder = (ViewHolder) view.getTag();
         }
 
         // Set text field
-        text = (TextView) view.findViewById(R.id.text1);
+        TextView text = mViewHolder.getTextView();
         text.setText(getItem(position).getTitle());
 
         // Set resource icon
-        image = (ImageView) view.findViewById(R.id.icon);
+        ImageView image = mViewHolder.getImageView();
         image.setImageResource(getItem(position).getResource());
 
         return view;
diff --git a/src/com/android/mms/ui/ImageAttachmentView.java b/src/com/android/mms/ui/ImageAttachmentView.java
index 5ae282b..3ec0c40 100644
--- a/src/com/android/mms/ui/ImageAttachmentView.java
+++ b/src/com/android/mms/ui/ImageAttachmentView.java
@@ -17,7 +17,7 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.util.Map;
 
 import android.content.Context;
 import android.graphics.Bitmap;
@@ -29,7 +29,7 @@ import android.view.View;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
 
-import java.util.Map;
+import com.android.mms.R;
 
 /**
  * This class provides an embedded editor/viewer of picture attachment.
diff --git a/src/com/android/mms/ui/LayoutSelectorAdapter.java b/src/com/android/mms/ui/LayoutSelectorAdapter.java
index 2d8878c..4912e9a 100644
--- a/src/com/android/mms/ui/LayoutSelectorAdapter.java
+++ b/src/com/android/mms/ui/LayoutSelectorAdapter.java
@@ -17,11 +17,11 @@
 
 package com.android.mms.ui;
 
-import android.content.Context;
-
 import java.util.ArrayList;
 import java.util.List;
 
+import android.content.Context;
+
 import com.android.mms.R;
 
 /**
diff --git a/src/com/android/mms/ui/ManageSimMessages.java b/src/com/android/mms/ui/ManageSimMessages.java
index 2e187ad..e783294 100644
--- a/src/com/android/mms/ui/ManageSimMessages.java
+++ b/src/com/android/mms/ui/ManageSimMessages.java
@@ -17,22 +17,18 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import android.database.sqlite.SqliteWrapper;
-import com.android.mms.transaction.MessagingNotification;
-
 import android.app.ActionBar;
 import android.app.Activity;
 import android.app.AlertDialog;
-
 import android.content.AsyncQueryHandler;
 import android.content.ContentResolver;
 import android.content.DialogInterface;
-import android.content.Intent;
 import android.content.DialogInterface.OnClickListener;
+import android.content.Intent;
 import android.database.ContentObserver;
 import android.database.Cursor;
 import android.database.sqlite.SQLiteException;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.Bundle;
 import android.os.Handler;
@@ -48,6 +44,9 @@ import android.widget.AdapterView;
 import android.widget.ListView;
 import android.widget.TextView;
 
+import com.android.mms.R;
+import com.android.mms.transaction.MessagingNotification;
+
 /**
  * Displays a list of the SMS messages stored on the ICC.
  */
@@ -151,6 +150,8 @@ public class ManageSimMessages extends Activity
                 // Let user know the SIM is empty
                 updateState(SHOW_EMPTY);
             }
+            // Show option menu when query complete.
+            invalidateOptionsMenu();
         }
     }
 
@@ -284,7 +285,7 @@ public class ManageSimMessages extends Activity
     public boolean onPrepareOptionsMenu(Menu menu) {
         menu.clear();
 
-        if ((null != mCursor) && (mCursor.getCount() > 0) && mState == SHOW_LIST) {
+        if (mState == SHOW_LIST && (null != mCursor) && (mCursor.getCount() > 0)) {
             menu.add(0, OPTION_MENU_DELETE_ALL, 0, R.string.menu_delete_messages).setIcon(
                     android.R.drawable.ic_menu_delete);
         }
@@ -318,7 +319,7 @@ public class ManageSimMessages extends Activity
     private void confirmDeleteDialog(OnClickListener listener, int messageId) {
         AlertDialog.Builder builder = new AlertDialog.Builder(this);
         builder.setTitle(R.string.confirm_dialog_title);
-        builder.setIcon(android.R.drawable.ic_dialog_alert);
+        builder.setIconAttribute(android.R.attr.alertDialogIcon);
         builder.setCancelable(true);
         builder.setPositiveButton(R.string.yes, listener);
         builder.setNegativeButton(R.string.no, null);
diff --git a/src/com/android/mms/ui/MessageItem.java b/src/com/android/mms/ui/MessageItem.java
index d21014b..f01804d 100644
--- a/src/com/android/mms/ui/MessageItem.java
+++ b/src/com/android/mms/ui/MessageItem.java
@@ -33,6 +33,7 @@ import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
 import com.android.mms.R;
 import com.android.mms.data.Contact;
+import com.android.mms.data.WorkingMessage;
 import com.android.mms.model.SlideModel;
 import com.android.mms.model.SlideshowModel;
 import com.android.mms.model.TextModel;
@@ -168,18 +169,20 @@ public class MessageItem {
                 EncodedStringValue v = new EncodedStringValue(
                         cursor.getInt(columnsMap.mColumnMmsSubjectCharset),
                         PduPersister.getBytes(subject));
-                mSubject = v.getString();
+                mSubject = MessageUtils.cleanseMmsSubject(context, v.getString());
             }
             mLocked = cursor.getInt(columnsMap.mColumnMmsLocked) != 0;
             mSlideshow = null;
-            mAttachmentType = ATTACHMENT_TYPE_NOT_LOADED;
             mDeliveryStatus = DeliveryStatus.NONE;
             mReadReport = false;
             mBody = null;
             mMessageSize = 0;
             mTextContentType = null;
-            mTimestamp = null;
+            // Initialize the time stamp to "" instead of null
+            mTimestamp = "";
             mMmsStatus = cursor.getInt(columnsMap.mColumnMmsStatus);
+            mAttachmentType = cursor.getInt(columnsMap.mColumnMmsTextOnly) != 0 ?
+                    WorkingMessage.TEXT : ATTACHMENT_TYPE_NOT_LOADED;
 
             // Start an async load of the pdu. If the pdu is already loaded, the callback
             // will get called immediately
@@ -219,6 +222,19 @@ public class MessageItem {
         return (mMessageType != PduHeaders.MESSAGE_TYPE_NOTIFICATION_IND);
     }
 
+    public boolean isMe() {
+        // Logic matches MessageListAdapter.getItemViewType which is used to decide which
+        // type of MessageListItem to create: a left or right justified item depending on whether
+        // the message is incoming or outgoing.
+        boolean isIncomingMms = isMms()
+                                    && (mBoxId == Mms.MESSAGE_BOX_INBOX
+                                            || mBoxId == Mms.MESSAGE_BOX_ALL);
+        boolean isIncomingSms = isSms()
+                                    && (mBoxId == Sms.MESSAGE_TYPE_INBOX
+                                            || mBoxId == Sms.MESSAGE_TYPE_ALL);
+        return !(isIncomingMms || isIncomingSms);
+    }
+
     public boolean isOutgoingMessage() {
         boolean isOutgoingMms = isMms() && (mBoxId == Mms.MESSAGE_BOX_OUTBOX);
         boolean isOutgoingSms = isSms()
@@ -288,6 +304,11 @@ public class MessageItem {
                 Log.e(TAG, "PduLoadedMessageItemCallback PDU couldn't be loaded: ", exception);
                 return;
             }
+            if (mItemLoadedFuture != null) {
+                synchronized(mItemLoadedFuture) {
+                    mItemLoadedFuture.setIsDone(true);
+                }
+            }
             PduLoaderManager.PduLoaded pduLoaded = (PduLoaderManager.PduLoaded)result;
             long timestamp = 0L;
             if (PduHeaders.MESSAGE_TYPE_NOTIFICATION_IND == mMessageType) {
@@ -383,11 +404,11 @@ public class MessageItem {
     }
 
     public void cancelPduLoading() {
-        if (mItemLoadedFuture != null) {
+        if (mItemLoadedFuture != null && !mItemLoadedFuture.isDone()) {
             if (Log.isLoggable(LogTag.APP, Log.DEBUG)) {
                 Log.v(TAG, "cancelPduLoading for: " + this);
             }
-            mItemLoadedFuture.cancel();
+            mItemLoadedFuture.cancel(mMessageUri);
             mItemLoadedFuture = null;
         }
     }
diff --git a/src/com/android/mms/ui/MessageListAdapter.java b/src/com/android/mms/ui/MessageListAdapter.java
index 04f965e..7969e6b 100644
--- a/src/com/android/mms/ui/MessageListAdapter.java
+++ b/src/com/android/mms/ui/MessageListAdapter.java
@@ -17,6 +17,8 @@
 
 package com.android.mms.ui;
 
+import java.util.regex.Pattern;
+
 import android.content.Context;
 import android.database.Cursor;
 import android.os.Handler;
@@ -35,11 +37,10 @@ import android.view.ViewGroup;
 import android.widget.AbsListView;
 import android.widget.CursorAdapter;
 import android.widget.ListView;
+
 import com.android.mms.R;
 import com.google.android.mms.MmsException;
 
-import java.util.regex.Pattern;
-
 /**
  * The back-end data adapter of a message list.
  */
@@ -74,7 +75,8 @@ public class MessageListAdapter extends CursorAdapter {
         Mms.READ_REPORT,
         PendingMessages.ERROR_TYPE,
         Mms.LOCKED,
-        Mms.STATUS
+        Mms.STATUS,
+        Mms.TEXT_ONLY
     };
 
     // The indexes of the default columns which must be consistent
@@ -103,6 +105,7 @@ public class MessageListAdapter extends CursorAdapter {
     static final int COLUMN_MMS_ERROR_TYPE      = 21;
     static final int COLUMN_MMS_LOCKED          = 22;
     static final int COLUMN_MMS_STATUS          = 23;
+    static final int COLUMN_MMS_TEXT_ONLY       = 24;
 
     private static final int CACHE_SIZE         = 50;
 
@@ -118,6 +121,7 @@ public class MessageListAdapter extends CursorAdapter {
     private Handler mMsgListItemHandler;
     private Pattern mHighlight;
     private Context mContext;
+    private boolean mIsGroupConversation;
 
     public MessageListAdapter(
             Context context, Cursor c, ListView listView,
@@ -158,7 +162,7 @@ public class MessageListAdapter extends CursorAdapter {
             if (msgItem != null) {
                 MessageListItem mli = (MessageListItem) view;
                 int position = cursor.getPosition();
-                mli.bind(msgItem, position == cursor.getCount() - 1, position);
+                mli.bind(msgItem, mIsGroupConversation, position);
                 mli.setMsgListItemHandler(mMsgListItemHandler);
             }
         }
@@ -177,6 +181,10 @@ public class MessageListAdapter extends CursorAdapter {
         mMsgListItemHandler = handler;
     }
 
+    public void setIsGroupConversation(boolean isGroup) {
+        mIsGroupConversation = isGroup;
+    }
+
     public void cancelBackgroundLoading() {
         mMessageItemCache.evictAll();   // causes entryRemoved to be called for each MessageItem
                                         // in the cache which causes us to cancel loading of
@@ -235,7 +243,7 @@ public class MessageListAdapter extends CursorAdapter {
 
     private boolean isCursorValid(Cursor cursor) {
         // Check whether the cursor is valid or not.
-        if (cursor.isClosed() || cursor.isBeforeFirst() || cursor.isAfterLast()) {
+        if (cursor == null || cursor.isClosed() || cursor.isBeforeFirst() || cursor.isAfterLast()) {
             return false;
         }
         return true;
@@ -330,6 +338,7 @@ public class MessageListAdapter extends CursorAdapter {
         public int mColumnMmsErrorType;
         public int mColumnMmsLocked;
         public int mColumnMmsStatus;
+        public int mColumnMmsTextOnly;
 
         public ColumnsMap() {
             mColumnMsgType            = COLUMN_MSG_TYPE;
@@ -351,6 +360,7 @@ public class MessageListAdapter extends CursorAdapter {
             mColumnMmsErrorType       = COLUMN_MMS_ERROR_TYPE;
             mColumnMmsLocked          = COLUMN_MMS_LOCKED;
             mColumnMmsStatus          = COLUMN_MMS_STATUS;
+            mColumnMmsTextOnly        = COLUMN_MMS_TEXT_ONLY;
         }
 
         public ColumnsMap(Cursor cursor) {
@@ -470,6 +480,12 @@ public class MessageListAdapter extends CursorAdapter {
             } catch (IllegalArgumentException e) {
                 Log.w("colsMap", e.getMessage());
             }
+
+            try {
+                mColumnMmsTextOnly = cursor.getColumnIndexOrThrow(Mms.TEXT_ONLY);
+            } catch (IllegalArgumentException e) {
+                Log.w("colsMap", e.getMessage());
+            }
         }
     }
 
diff --git a/src/com/android/mms/ui/MessageListItem.java b/src/com/android/mms/ui/MessageListItem.java
index c14bdb8..ffe06fb 100644
--- a/src/com/android/mms/ui/MessageListItem.java
+++ b/src/com/android/mms/ui/MessageListItem.java
@@ -26,11 +26,7 @@ import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
-import android.graphics.Canvas;
-import android.graphics.Paint;
 import android.graphics.Paint.FontMetricsInt;
-import android.graphics.Path;
 import android.graphics.Typeface;
 import android.graphics.drawable.Drawable;
 import android.net.Uri;
@@ -61,7 +57,6 @@ import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import com.android.mms.LogTag;
 import com.android.mms.MmsApp;
 import com.android.mms.R;
 import com.android.mms.data.Contact;
@@ -107,15 +102,12 @@ public class MessageListItem extends LinearLayout implements
     private String mDefaultCountryIso;
     private TextView mDateView;
     public View mMessageBlock;
-    private Path mPathRight;
-    private Path mPathLeft;
-    private Paint mPaint;
     private QuickContactDivot mAvatar;
-    private boolean mIsLastItemInList;
     static private Drawable sDefaultContactImage;
     private Presenter mPresenter;
     private int mPosition;      // for debugging
     private ImageLoadedCallback mImageLoadedCallback;
+    private boolean mMultiRecipients;
 
     public MessageListItem(Context context) {
         super(context);
@@ -151,10 +143,17 @@ public class MessageListItem extends LinearLayout implements
         mMessageBlock = findViewById(R.id.message_block);
     }
 
-    public void bind(MessageItem msgItem, boolean isLastItem, int position) {
+    public void bind(MessageItem msgItem, boolean convHasMultiRecipients, int position) {
+        if (DEBUG) {
+            Log.v(TAG, "bind for item: " + position + " old: " +
+                   (mMessageItem != null ? mMessageItem.toString() : "NULL" ) +
+                    " new " + msgItem.toString());
+        }
+        boolean sameItem = mMessageItem != null && mMessageItem.mMsgId == msgItem.mMsgId;
         mMessageItem = msgItem;
-        mIsLastItemInList = isLastItem;
+
         mPosition = position;
+        mMultiRecipients = convHasMultiRecipients;
 
         setLongClickable(false);
         setClickable(false);    // let the list view handle clicks on the item normally. When
@@ -167,7 +166,7 @@ public class MessageListItem extends LinearLayout implements
                 bindNotifInd();
                 break;
             default:
-                bindCommonMessage();
+                bindCommonMessage(sameItem);
                 break;
         }
     }
@@ -175,7 +174,6 @@ public class MessageListItem extends LinearLayout implements
     public void unbind() {
         // Clear all references to the message item, which can contain attachments and other
         // memory-intensive objects
-        mMessageItem = null;
         if (mImageView != null) {
             // Because #setOnClickListener may have set the listener to an object that has the
             // message item in its closure.
@@ -206,14 +204,15 @@ public class MessageListItem extends LinearLayout implements
                                 + String.valueOf((mMessageItem.mMessageSize + 1023) / 1024)
                                 + mContext.getString(R.string.kilobyte);
 
-        mBodyTextView.setText(formatMessage(mMessageItem, mMessageItem.mContact, null,
+        mBodyTextView.setText(formatMessage(mMessageItem, null,
                                             mMessageItem.mSubject,
                                             mMessageItem.mHighlight,
                                             mMessageItem.mTextContentType));
 
-        mDateView.setText(msgSizeText + " " + mMessageItem.mTimestamp);
+        mDateView.setText(buildTimestampLine(msgSizeText + " " + mMessageItem.mTimestamp));
 
         switch (mMessageItem.getMmsDownloadStatus()) {
+            case DownloadManager.STATE_PRE_DOWNLOADING:
             case DownloadManager.STATE_DOWNLOADING:
                 showDownloadingAttachment();
                 break;
@@ -248,6 +247,9 @@ public class MessageListItem extends LinearLayout implements
                         intent.putExtra(TransactionBundle.TRANSACTION_TYPE,
                                 Transaction.RETRIEVE_TRANSACTION);
                         mContext.startService(intent);
+
+                        DownloadManager.getInstance().markState(
+                                    mMessageItem.mMessageUri, DownloadManager.STATE_PRE_DOWNLOADING);
                     }
                 });
                 break;
@@ -260,6 +262,16 @@ public class MessageListItem extends LinearLayout implements
         updateAvatarView(mMessageItem.mAddress, false);
     }
 
+    private String buildTimestampLine(String timestamp) {
+        if (!mMultiRecipients || mMessageItem.isMe() || TextUtils.isEmpty(mMessageItem.mContact)) {
+            // Never show "Me" for messages I sent.
+            return timestamp;
+        }
+        // This is a group conversation, show the sender's name on the same line as the timestamp.
+        return mContext.getString(R.string.message_timestamp_format, mMessageItem.mContact,
+                timestamp);
+    }
+
     private void showDownloadingAttachment() {
         inflateDownloadControls();
         mDownloadingLabel.setVisibility(View.VISIBLE);
@@ -287,7 +299,7 @@ public class MessageListItem extends LinearLayout implements
         mAvatar.setImageDrawable(avatarDrawable);
     }
 
-    private void bindCommonMessage() {
+    private void bindCommonMessage(final boolean sameItem) {
         if (mDownloadButton != null) {
             mDownloadButton.setVisibility(View.GONE);
             mDownloadingLabel.setVisibility(View.GONE);
@@ -297,9 +309,20 @@ public class MessageListItem extends LinearLayout implements
         // displaying it by the Presenter.
         mBodyTextView.setTransformationMethod(HideReturnsTransformationMethod.getInstance());
 
-        boolean isSelf = Sms.isOutgoingFolder(mMessageItem.mBoxId);
-        String addr = isSelf ? null : mMessageItem.mAddress;
-        updateAvatarView(addr, isSelf);
+        boolean haveLoadedPdu = mMessageItem.isSms() || mMessageItem.mSlideshow != null;
+        // Here we're avoiding reseting the avatar to the empty avatar when we're rebinding
+        // to the same item. This happens when there's a DB change which causes the message item
+        // cache in the MessageListAdapter to get cleared. When an mms MessageItem is newly
+        // created, it has no info in it except the message id. The info is eventually loaded
+        // and bindCommonMessage is called again (see onPduLoaded below). When we haven't loaded
+        // the pdu, we don't want to call updateAvatarView because it
+        // will set the avatar to the generic avatar then when this method is called again
+        // from onPduLoaded, it will reset to the real avatar. This test is to avoid that flash.
+        if (!sameItem || haveLoadedPdu) {
+            boolean isSelf = Sms.isOutgoingFolder(mMessageItem.mBoxId);
+            String addr = isSelf ? null : mMessageItem.mAddress;
+            updateAvatarView(addr, isSelf);
+        }
 
         // Get and/or lazily set the formatted message from/on the
         // MessageItem.  Because the MessageItem instances come from a
@@ -307,14 +330,16 @@ public class MessageListItem extends LinearLayout implements
         // expensive formatMessage() call is very high.
         CharSequence formattedMessage = mMessageItem.getCachedFormattedMessage();
         if (formattedMessage == null) {
-            formattedMessage = formatMessage(mMessageItem, mMessageItem.mContact,
+            formattedMessage = formatMessage(mMessageItem,
                                              mMessageItem.mBody,
                                              mMessageItem.mSubject,
                                              mMessageItem.mHighlight,
                                              mMessageItem.mTextContentType);
             mMessageItem.setCachedFormattedMessage(formattedMessage);
         }
-        mBodyTextView.setText(formattedMessage);
+        if (!sameItem || haveLoadedPdu) {
+            mBodyTextView.setText(formattedMessage);
+        }
 
         // Debugging code to put the URI of the image attachment in the body of the list item.
         if (DEBUG) {
@@ -336,10 +361,11 @@ public class MessageListItem extends LinearLayout implements
 
         // If we're in the process of sending a message (i.e. pending), then we show a "SENDING..."
         // string in place of the timestamp.
-        mDateView.setText(mMessageItem.isSending() ?
-                mContext.getResources().getString(R.string.sending_message) :
-                    mMessageItem.mTimestamp);
-
+        if (!sameItem || haveLoadedPdu) {
+            mDateView.setText(buildTimestampLine(mMessageItem.isSending() ?
+                    mContext.getResources().getString(R.string.sending_message) :
+                        mMessageItem.mTimestamp));
+        }
         if (mMessageItem.isSms()) {
             showMmsView(false);
             mMessageItem.setOnPduLoaded(null);
@@ -347,10 +373,13 @@ public class MessageListItem extends LinearLayout implements
             if (DEBUG) {
                 Log.v(TAG, "bindCommonMessage for item: " + mPosition + " " +
                         mMessageItem.toString() +
-                        " mMessageItem.mAttachmentType: " + mMessageItem.mAttachmentType);
+                        " mMessageItem.mAttachmentType: " + mMessageItem.mAttachmentType +
+                        " sameItem: " + sameItem);
             }
             if (mMessageItem.mAttachmentType != WorkingMessage.TEXT) {
-                setImage(null, null);
+                if (!sameItem) {
+                    setImage(null, null);
+                }
                 setOnClickListener(mMessageItem);
                 drawPlaybackButton(mMessageItem);
             } else {
@@ -368,7 +397,7 @@ public class MessageListItem extends LinearLayout implements
                         if (messageItem != null && mMessageItem != null &&
                                 messageItem.getMessageId() == mMessageItem.getMessageId()) {
                             mMessageItem.setCachedFormattedMessage(null);
-                            bindCommonMessage();
+                            bindCommonMessage(true);
                         }
                     }
                 });
@@ -498,7 +527,7 @@ public class MessageListItem extends LinearLayout implements
 
     ForegroundColorSpan mColorSpan = null;  // set in ctor
 
-    private CharSequence formatMessage(MessageItem msgItem, String contact, String body,
+    private CharSequence formatMessage(MessageItem msgItem, String body,
                                        String subject, Pattern highlight,
                                        String contentType) {
         SpannableStringBuilder buf = new SpannableStringBuilder();
@@ -620,8 +649,13 @@ public class MessageListItem extends LinearLayout implements
                         }
                         final String telPrefix = "tel:";
                         if (url.startsWith(telPrefix)) {
-                            url = PhoneNumberUtils.formatNumber(
-                                            url.substring(telPrefix.length()), mDefaultCountryIso);
+                            if ((mDefaultCountryIso == null) || mDefaultCountryIso.isEmpty()) {
+                                url = url.substring(telPrefix.length());
+                            }
+                            else {
+                                url = PhoneNumberUtils.formatNumber(
+                                        url.substring(telPrefix.length()), mDefaultCountryIso);
+                            }
                         }
                         tv.setText(url);
                     } catch (android.content.pm.PackageManager.NameNotFoundException ex) {
@@ -806,61 +840,4 @@ public class MessageListItem extends LinearLayout implements
         // TODO Auto-generated method stub
 
     }
-
-    /**
-     * Override dispatchDraw so that we can put our own background and border in.
-     * This is all complexity to support a shared border from one item to the next.
-     */
-    @Override
-    public void dispatchDraw(Canvas c) {
-        super.dispatchDraw(c);
-
-        // This custom border is causing our scrolling fps to drop from 60+ to the mid 40's.
-        // Commenting out for now until we come up with a new UI design that doesn't require
-        // the border.
-        return;
-
-//        View v = mMessageBlock;
-//        if (v != null) {
-//            Path path = null;
-//            if (mAvatar.getPosition() == Divot.RIGHT_UPPER) {
-//                if (mPathRight == null) {
-//                    float r = v.getWidth() - 1;
-//                    float b = v.getHeight();
-//
-//                    mPathRight = new Path();
-//                    mPathRight.moveTo(0, mAvatar.getCloseOffset());
-//                    mPathRight.lineTo(0, 0);
-//                    mPathRight.lineTo(r, 0);
-//                    mPathRight.lineTo(r, b);
-//                    mPathRight.lineTo(0, b);
-//                    mPathRight.lineTo(0, mAvatar.getFarOffset());
-//                }
-//                path = mPathRight;
-//            } else if (mAvatar.getPosition() == Divot.LEFT_UPPER) {
-//                if (mPathLeft == null) {
-//                    float r = v.getWidth() - 1;
-//                    float b = v.getHeight();
-//
-//                    mPathLeft = new Path();
-//                    mPathLeft.moveTo(r, mAvatar.getCloseOffset());
-//                    mPathLeft.lineTo(r, 0);
-//                    mPathLeft.lineTo(0, 0);
-//                    mPathLeft.lineTo(0, b);
-//                    mPathLeft.lineTo(r, b);
-//                    mPathLeft.lineTo(r, mAvatar.getFarOffset());
-//                }
-//                path = mPathLeft;
-//            }
-//            if (mPaint == null) {
-//                mPaint = new Paint();
-//                mPaint.setColor(0xffcccccc);
-//                mPaint.setStrokeWidth(1F);
-//                mPaint.setStyle(Paint.Style.STROKE);
-//                mPaint.setColor(0xff00ff00);  // turn on for debugging, draws lines in green
-//            }
-//            c.translate(v.getX(), v.getY());
-//            c.drawPath(path, mPaint);
-//        }
-    }
 }
diff --git a/src/com/android/mms/ui/MessageUtils.java b/src/com/android/mms/ui/MessageUtils.java
index a8ef605..502bfde 100644
--- a/src/com/android/mms/ui/MessageUtils.java
+++ b/src/com/android/mms/ui/MessageUtils.java
@@ -17,41 +17,24 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.MmsApp;
-import com.android.mms.MmsConfig;
-import com.android.mms.R;
-import com.android.mms.LogTag;
-import com.android.mms.TempFileProvider;
-import com.android.mms.data.WorkingMessage;
-import com.android.mms.model.MediaModel;
-import com.android.mms.model.SlideModel;
-import com.android.mms.model.SlideshowModel;
-import com.android.mms.transaction.MmsMessageSender;
-import com.android.mms.util.AddressUtils;
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.CharacterSets;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.google.android.mms.pdu.MultimediaMessagePdu;
-import com.google.android.mms.pdu.NotificationInd;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduPart;
-import com.google.android.mms.pdu.PduPersister;
-import com.google.android.mms.pdu.RetrieveConf;
-import com.google.android.mms.pdu.SendReq;
-import android.database.sqlite.SqliteWrapper;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
 
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.ContentUris;
 import android.content.Context;
 import android.content.DialogInterface;
-import android.content.Intent;
 import android.content.DialogInterface.OnCancelListener;
 import android.content.DialogInterface.OnClickListener;
+import android.content.Intent;
 import android.content.res.Resources;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.media.CamcorderProfile;
 import android.media.RingtoneManager;
 import android.net.Uri;
@@ -68,12 +51,29 @@ import android.text.style.URLSpan;
 import android.util.Log;
 import android.widget.Toast;
 
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.Map;
-import java.util.concurrent.ConcurrentHashMap;
+import com.android.mms.LogTag;
+import com.android.mms.MmsApp;
+import com.android.mms.MmsConfig;
+import com.android.mms.R;
+import com.android.mms.TempFileProvider;
+import com.android.mms.data.WorkingMessage;
+import com.android.mms.model.MediaModel;
+import com.android.mms.model.SlideModel;
+import com.android.mms.model.SlideshowModel;
+import com.android.mms.transaction.MmsMessageSender;
+import com.android.mms.util.AddressUtils;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.CharacterSets;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.MultimediaMessagePdu;
+import com.google.android.mms.pdu.NotificationInd;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduPart;
+import com.google.android.mms.pdu.PduPersister;
+import com.google.android.mms.pdu.RetrieveConf;
+import com.google.android.mms.pdu.SendReq;
 
 /**
  * An utility class for managing messages.
@@ -85,6 +85,7 @@ public class MessageUtils {
 
     private static final String TAG = LogTag.TAG;
     private static String sLocalNumber;
+    private static String[] sNoSubjectStrings;
 
     // Cache of both groups of space-separated ids to their full
     // comma-separated display names, as well as individual ids to
@@ -96,6 +97,9 @@ public class MessageUtils {
     private static final Map<String, String> sRecipientAddress =
             new ConcurrentHashMap<String, String>(20 /* initial capacity */);
 
+    // When we pass a video record duration to the video recorder, use one of these values.
+    private static final int[] sVideoDuration =
+            new int[] {0, 5, 10, 15, 20, 30, 40, 50, 60, 90, 120};
 
     /**
      * MMS address parsing data structures
@@ -118,6 +122,31 @@ public class MessageUtils {
         // Forbidden being instantiated.
     }
 
+    /**
+     * cleanseMmsSubject will take a subject that's says, "<Subject: no subject>", and return
+     * a null string. Otherwise it will return the original subject string.
+     * @param context a regular context so the function can grab string resources
+     * @param subject the raw subject
+     * @return
+     */
+    public static String cleanseMmsSubject(Context context, String subject) {
+        if (TextUtils.isEmpty(subject)) {
+            return subject;
+        }
+        if (sNoSubjectStrings == null) {
+            sNoSubjectStrings =
+                    context.getResources().getStringArray(R.array.empty_subject_strings);
+
+        }
+        final int len = sNoSubjectStrings.length;
+        for (int i = 0; i < len; i++) {
+            if (subject.equalsIgnoreCase(sNoSubjectStrings[i])) {
+                return null;
+            }
+        }
+        return subject;
+    }
+
     public static String getMessageDetails(Context context, Cursor cursor, int size) {
         if (cursor == null) {
             return null;
@@ -468,7 +497,7 @@ public class MessageUtils {
         // say we can handle. Try to handle that overshoot by specifying an 85% limit.
         sizeLimit *= .85F;
 
-        int durationLimit = getVideoCaptureDurationLimit();
+        int durationLimit = getVideoCaptureDurationLimit(sizeLimit);
 
         if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
             log("recordVideo: durationLimit: " + durationLimit +
@@ -489,9 +518,22 @@ public class MessageUtils {
         activity.startActivityForResult(intent, requestCode);
     }
 
-    private static int getVideoCaptureDurationLimit() {
+    // Public for until tests
+    public static int getVideoCaptureDurationLimit(long bytesAvailable) {
         CamcorderProfile camcorder = CamcorderProfile.get(CamcorderProfile.QUALITY_LOW);
-        return camcorder == null ? 0 : camcorder.duration;
+        if (camcorder == null) {
+            return 0;
+        }
+        bytesAvailable *= 8;        // convert to bits
+        long seconds = bytesAvailable / (camcorder.audioBitRate + camcorder.videoBitRate);
+
+        // Find the best match for one of the fixed durations
+        for (int i = sVideoDuration.length - 1; i >= 0; i--) {
+            if (seconds >= sVideoDuration[i]) {
+                return sVideoDuration[i];
+            }
+        }
+        return 0;
     }
 
     public static void selectVideo(Context context, int requestCode) {
@@ -839,7 +881,7 @@ public class MessageUtils {
                         PduPersister persister = PduPersister.getPduPersister(activity);
                         try {
                             PduBody pb = slideshow.toPduBody();
-                            persister.updateParts(msgUri, pb);
+                            persister.updateParts(msgUri, pb, null);
                             slideshow.sync(pb);
                         } catch (MmsException e) {
                             Log.e(TAG, "Unable to save message for preview");
@@ -862,6 +904,7 @@ public class MessageUtils {
         // Launch the slideshow activity to play/view.
         Intent intent = new Intent(context, SlideshowActivity.class);
         intent.setData(msgUri);
+        intent.setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
         if (requestCode > 0 && context instanceof Activity) {
             ((Activity)context).startActivityForResult(intent, requestCode);
         } else {
diff --git a/src/com/android/mms/ui/MessagingPreferenceActivity.java b/src/com/android/mms/ui/MessagingPreferenceActivity.java
index a2f31b6..d1deb57 100755
--- a/src/com/android/mms/ui/MessagingPreferenceActivity.java
+++ b/src/com/android/mms/ui/MessagingPreferenceActivity.java
@@ -17,30 +17,36 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.MmsApp;
-import com.android.mms.MmsConfig;
-import com.android.mms.R;
-
 import android.app.ActionBar;
+import android.app.Activity;
 import android.app.AlertDialog;
 import android.app.Dialog;
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.content.SharedPreferences;
+import android.media.Ringtone;
+import android.media.RingtoneManager;
+import android.net.Uri;
 import android.os.Bundle;
 import android.preference.CheckBoxPreference;
 import android.preference.ListPreference;
 import android.preference.Preference;
+import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.PreferenceActivity;
 import android.preference.PreferenceCategory;
 import android.preference.PreferenceManager;
 import android.preference.PreferenceScreen;
-import android.preference.Preference.OnPreferenceChangeListener;
+import android.preference.RingtonePreference;
 import android.provider.SearchRecentSuggestions;
+import android.text.TextUtils;
 import android.view.Menu;
 import android.view.MenuItem;
 
+import com.android.mms.MmsApp;
+import com.android.mms.MmsConfig;
+import com.android.mms.R;
+import com.android.mms.transaction.TransactionService;
 import com.android.mms.util.Recycler;
 
 /**
@@ -62,6 +68,7 @@ public class MessagingPreferenceActivity extends PreferenceActivity
     public static final String AUTO_RETRIEVAL           = "pref_key_mms_auto_retrieval";
     public static final String RETRIEVAL_DURING_ROAMING = "pref_key_mms_retrieval_during_roaming";
     public static final String AUTO_DELETE              = "pref_key_auto_delete";
+    public static final String GROUP_MMS_MODE           = "pref_key_mms_group_mms";
 
     // Menu entries
     private static final int MENU_RESTORE_DEFAULTS    = 1;
@@ -70,16 +77,17 @@ public class MessagingPreferenceActivity extends PreferenceActivity
     private Preference mSmsDeliveryReportPref;
     private Preference mMmsLimitPref;
     private Preference mMmsDeliveryReportPref;
+    private Preference mMmsGroupMmsPref;
     private Preference mMmsReadReportPref;
     private Preference mManageSimPref;
     private Preference mClearHistoryPref;
-    private ListPreference mVibrateWhenPref;
+    private CheckBoxPreference mVibratePref;
     private CheckBoxPreference mEnableNotificationsPref;
+    private CheckBoxPreference mMmsAutoRetrievialPref;
+    private RingtonePreference mRingtonePref;
     private Recycler mSmsRecycler;
     private Recycler mMmsRecycler;
     private static final int CONFIRM_CLEAR_SEARCH_HISTORY_DIALOG = 3;
-    private CharSequence[] mVibrateEntries;
-    private CharSequence[] mVibrateValues;
 
     @Override
     protected void onCreate(Bundle icicle) {
@@ -108,14 +116,14 @@ public class MessagingPreferenceActivity extends PreferenceActivity
         mSmsLimitPref = findPreference("pref_key_sms_delete_limit");
         mSmsDeliveryReportPref = findPreference("pref_key_sms_delivery_reports");
         mMmsDeliveryReportPref = findPreference("pref_key_mms_delivery_reports");
+        mMmsGroupMmsPref = findPreference("pref_key_mms_group_mms");
         mMmsReadReportPref = findPreference("pref_key_mms_read_reports");
         mMmsLimitPref = findPreference("pref_key_mms_delete_limit");
         mClearHistoryPref = findPreference("pref_key_mms_clear_history");
         mEnableNotificationsPref = (CheckBoxPreference) findPreference(NOTIFICATION_ENABLED);
-        mVibrateWhenPref = (ListPreference) findPreference(NOTIFICATION_VIBRATE_WHEN);
-
-        mVibrateEntries = getResources().getTextArray(R.array.prefEntries_vibrateWhen);
-        mVibrateValues = getResources().getTextArray(R.array.prefValues_vibrateWhen);
+        mMmsAutoRetrievialPref = (CheckBoxPreference) findPreference(AUTO_RETRIEVAL);
+        mVibratePref = (CheckBoxPreference) findPreference(NOTIFICATION_VIBRATE);
+        mRingtonePref = (RingtonePreference) findPreference(NOTIFICATION_RINGTONE);
 
         setMessagePreferences();
     }
@@ -161,28 +169,35 @@ public class MessagingPreferenceActivity extends PreferenceActivity
                 (PreferenceCategory)findPreference("pref_key_storage_settings");
             storageOptions.removePreference(findPreference("pref_key_mms_delete_limit"));
         } else {
-            if (!MmsConfig.getMMSDeliveryReportsEnabled()) {
-                PreferenceCategory mmsOptions =
+            PreferenceCategory mmsOptions =
                     (PreferenceCategory)findPreference("pref_key_mms_settings");
+            if (!MmsConfig.getMMSDeliveryReportsEnabled()) {
                 mmsOptions.removePreference(mMmsDeliveryReportPref);
             }
             if (!MmsConfig.getMMSReadReportsEnabled()) {
-                PreferenceCategory mmsOptions =
-                    (PreferenceCategory)findPreference("pref_key_mms_settings");
                 mmsOptions.removePreference(mMmsReadReportPref);
             }
+            // If the phone's SIM doesn't know it's own number, disable group mms.
+            if (!MmsConfig.getGroupMmsEnabled() ||
+                    TextUtils.isEmpty(MessageUtils.getLocalNumber())) {
+                mmsOptions.removePreference(mMmsGroupMmsPref);
+            }
         }
 
         setEnabledNotificationsPref();
 
-        // If needed, migrate vibration setting from a previous version
+        // If needed, migrate vibration setting from the previous tri-state setting stored in
+        // NOTIFICATION_VIBRATE_WHEN to the boolean setting stored in NOTIFICATION_VIBRATE.
         SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);
-        if (!sharedPreferences.contains(NOTIFICATION_VIBRATE_WHEN) &&
-                sharedPreferences.contains(NOTIFICATION_VIBRATE)) {
-            int stringId = sharedPreferences.getBoolean(NOTIFICATION_VIBRATE, false) ?
-                    R.string.prefDefault_vibrate_true :
-                    R.string.prefDefault_vibrate_false;
-            mVibrateWhenPref.setValue(getString(stringId));
+        if (sharedPreferences.contains(NOTIFICATION_VIBRATE_WHEN)) {
+            String vibrateWhen = sharedPreferences.
+                    getString(MessagingPreferenceActivity.NOTIFICATION_VIBRATE_WHEN, null);
+            boolean vibrate = "always".equals(vibrateWhen);
+            SharedPreferences.Editor prefsEditor = sharedPreferences.edit();
+            prefsEditor.putBoolean(NOTIFICATION_VIBRATE, vibrate);
+            prefsEditor.remove(NOTIFICATION_VIBRATE_WHEN);  // remove obsolete setting
+            prefsEditor.apply();
+            mVibratePref.setChecked(vibrate);
         }
 
         mSmsRecycler = Recycler.getSmsRecycler();
@@ -192,7 +207,15 @@ public class MessagingPreferenceActivity extends PreferenceActivity
         setSmsDisplayLimit();
         setMmsDisplayLimit();
 
-        adjustVibrateSummary(mVibrateWhenPref.getValue());
+        String soundValue = sharedPreferences.getString(NOTIFICATION_RINGTONE, null);
+        setRingtoneSummary(soundValue);
+    }
+
+    private void setRingtoneSummary(String soundValue) {
+        Uri soundUri = TextUtils.isEmpty(soundValue) ? null : Uri.parse(soundValue);
+        Ringtone tone = soundUri != null ? RingtoneManager.getRingtone(this, soundUri) : null;
+        mRingtonePref.setSummary(tone != null ? tone.getTitle(this)
+                : getResources().getString(R.string.silent_ringtone));
     }
 
     private void setEnabledNotificationsPref() {
@@ -261,11 +284,22 @@ public class MessagingPreferenceActivity extends PreferenceActivity
         } else if (preference == mEnableNotificationsPref) {
             // Update the actual "enable notifications" value that is stored in secure settings.
             enableNotifications(mEnableNotificationsPref.isChecked(), this);
+        } else if (preference == mMmsAutoRetrievialPref) {
+            if (mMmsAutoRetrievialPref.isChecked()) {
+                startMmsDownload();
+            }
         }
 
         return super.onPreferenceTreeClick(preferenceScreen, preference);
     }
 
+    /**
+     * Trigger the TransactionService to download any outstanding messages.
+     */
+    private void startMmsDownload() {
+        startService(new Intent(TransactionService.ACTION_ENABLE_AUTO_RETRIEVE, null, this,
+                TransactionService.class));
+    }
 
     NumberPickerDialog.OnNumberSetListener mSmsLimitListener =
         new NumberPickerDialog.OnNumberSetListener() {
@@ -301,7 +335,7 @@ public class MessagingPreferenceActivity extends PreferenceActivity
                         }
                     })
                     .setNegativeButton(android.R.string.cancel, null)
-                    .setIcon(android.R.drawable.ic_dialog_alert)
+                    .setIconAttribute(android.R.attr.alertDialogIcon)
                     .create();
         }
         return super.onCreateDialog(id);
@@ -325,26 +359,28 @@ public class MessagingPreferenceActivity extends PreferenceActivity
     }
 
     private void registerListeners() {
-        mVibrateWhenPref.setOnPreferenceChangeListener(this);
+        mRingtonePref.setOnPreferenceChangeListener(this);
     }
 
     public boolean onPreferenceChange(Preference preference, Object newValue) {
         boolean result = false;
-        if (preference == mVibrateWhenPref) {
-            adjustVibrateSummary((String)newValue);
+        if (preference == mRingtonePref) {
+            setRingtoneSummary((String)newValue);
             result = true;
         }
         return result;
     }
 
-    private void adjustVibrateSummary(String value) {
-        int len = mVibrateValues.length;
-        for (int i = 0; i < len; i++) {
-            if (mVibrateValues[i].equals(value)) {
-                mVibrateWhenPref.setSummary(mVibrateEntries[i]);
-                return;
-            }
-        }
-        mVibrateWhenPref.setSummary(null);
+    // For the group mms feature to be enabled, the following must be true:
+    //  1. the feature is enabled in mms_config.xml (currently on by default)
+    //  2. the feature is enabled in the mms settings page
+    //  3. the SIM knows its own phone number
+    public static boolean getIsGroupMmsEnabled(Context context) {
+        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(context);
+        boolean groupMmsPrefOn = prefs.getBoolean(
+                MessagingPreferenceActivity.GROUP_MMS_MODE, true);
+        return MmsConfig.getGroupMmsEnabled() &&
+                groupMmsPrefOn &&
+                !TextUtils.isEmpty(MessageUtils.getLocalNumber());
     }
 }
diff --git a/src/com/android/mms/ui/MiniPreferenceActivity.java b/src/com/android/mms/ui/MiniPreferenceActivity.java
index a78c5e4..e3e071c 100644
--- a/src/com/android/mms/ui/MiniPreferenceActivity.java
+++ b/src/com/android/mms/ui/MiniPreferenceActivity.java
@@ -5,15 +5,12 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.DialogInterface;
-import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.preference.PreferenceManager;
-import android.view.View;
+
+import com.android.mms.R;
 
 /**
  * This activity is used by 3rd party apps to allow the user to turn on/off notifications in
diff --git a/src/com/android/mms/ui/MmsThumbnailPresenter.java b/src/com/android/mms/ui/MmsThumbnailPresenter.java
index e283012..45b10c6 100644
--- a/src/com/android/mms/ui/MmsThumbnailPresenter.java
+++ b/src/com/android/mms/ui/MmsThumbnailPresenter.java
@@ -18,11 +18,7 @@
 package com.android.mms.ui;
 
 import android.content.Context;
-import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
-import android.util.Log;
 
-import com.android.mms.R;
 import com.android.mms.model.AudioModel;
 import com.android.mms.model.ImageModel;
 import com.android.mms.model.Model;
@@ -36,6 +32,7 @@ import com.android.mms.util.ThumbnailManager.ImageLoaded;
 public class MmsThumbnailPresenter extends Presenter {
     private static final String TAG = "MmsThumbnailPresenter";
     private ItemLoadedCallback mOnLoadedCallback;
+    private ItemLoadedFuture mItemLoadedFuture;
 
     public MmsThumbnailPresenter(Context context, ViewInterface view, Model model) {
         super(context, view, model);
@@ -66,6 +63,11 @@ public class MmsThumbnailPresenter extends Presenter {
             new ItemLoadedCallback<ImageLoaded>() {
         public void onItemLoaded(ImageLoaded imageLoaded, Throwable exception) {
             if (exception == null) {
+                if (mItemLoadedFuture != null) {
+                    synchronized(mItemLoadedFuture) {
+                        mItemLoadedFuture.setIsDone(true);
+                    }
+                }
                 if (mOnLoadedCallback != null) {
                     mOnLoadedCallback.onItemLoaded(imageLoaded, exception);
                 } else {
@@ -85,11 +87,11 @@ public class MmsThumbnailPresenter extends Presenter {
     };
 
     private void presentVideoThumbnail(SlideViewInterface view, VideoModel video) {
-        video.loadThumbnailBitmap(mImageLoadedCallback);
+        mItemLoadedFuture = video.loadThumbnailBitmap(mImageLoadedCallback);
     }
 
     private void presentImageThumbnail(SlideViewInterface view, ImageModel image) {
-        image.loadThumbnailBitmap(mImageLoadedCallback);
+        mItemLoadedFuture = image.loadThumbnailBitmap(mImageLoadedCallback);
     }
 
     protected void presentAudioThumbnail(SlideViewInterface view, AudioModel audio) {
diff --git a/src/com/android/mms/ui/NoConfirmationSendService.java b/src/com/android/mms/ui/NoConfirmationSendService.java
index f1ae0fa..bbd6519 100644
--- a/src/com/android/mms/ui/NoConfirmationSendService.java
+++ b/src/com/android/mms/ui/NoConfirmationSendService.java
@@ -20,6 +20,7 @@ import android.app.IntentService;
 import android.content.Intent;
 import android.net.Uri;
 import android.os.Bundle;
+import android.telephony.TelephonyManager;
 import android.text.TextUtils;
 import android.util.Log;
 
@@ -38,8 +39,6 @@ public class NoConfirmationSendService extends IntentService {
         setIntentRedelivery(true);
     }
 
-    public static final String SEND_NO_CONFIRM_INTENT_ACTION =
-        "com.android.mms.intent.action.SENDTO_NO_CONFIRMATION";
     private static final String TAG = "Mms/NoConfirmationSendService";
 
     @Override
@@ -47,7 +46,7 @@ public class NoConfirmationSendService extends IntentService {
         ComposeMessageActivity.log("NoConfirmationSendService onHandleIntent");
 
         String action = intent.getAction();
-        if (!SEND_NO_CONFIRM_INTENT_ACTION.equals(action)) {
+        if (!TelephonyManager.ACTION_RESPOND_VIA_MESSAGE.equals(action)) {
             ComposeMessageActivity.log("NoConfirmationSendService onHandleIntent wrong action: " +
                     action);
             return;
diff --git a/src/com/android/mms/ui/NumberPickerDialog.java b/src/com/android/mms/ui/NumberPickerDialog.java
index ed2012d..22118d2 100644
--- a/src/com/android/mms/ui/NumberPickerDialog.java
+++ b/src/com/android/mms/ui/NumberPickerDialog.java
@@ -21,7 +21,6 @@ import android.content.Context;
 import android.content.DialogInterface;
 import android.content.DialogInterface.OnClickListener;
 import android.os.Bundle;
-import android.util.AttributeSet;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.NumberPicker;
diff --git a/src/com/android/mms/ui/PresenterFactory.java b/src/com/android/mms/ui/PresenterFactory.java
index dcd3c5c..3a7832b 100644
--- a/src/com/android/mms/ui/PresenterFactory.java
+++ b/src/com/android/mms/ui/PresenterFactory.java
@@ -17,12 +17,12 @@
 
 package com.android.mms.ui;
 
-import android.content.Context;
-import android.util.Log;
-
 import java.lang.reflect.Constructor;
 import java.lang.reflect.InvocationTargetException;
 
+import android.content.Context;
+import android.util.Log;
+
 import com.android.mms.model.Model;
 
 /**
diff --git a/src/com/android/mms/ui/RecipientListActivity.java b/src/com/android/mms/ui/RecipientListActivity.java
new file mode 100644
index 0000000..9baf660
--- /dev/null
+++ b/src/com/android/mms/ui/RecipientListActivity.java
@@ -0,0 +1,158 @@
+/*
+ * Copyright (C) 2012 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.mms.ui;
+
+import android.app.ActionBar;
+import android.app.ListActivity;
+import android.content.Context;
+import android.content.Intent;
+import android.graphics.drawable.Drawable;
+import android.os.Bundle;
+import android.provider.ContactsContract.Profile;
+import android.text.TextUtils;
+import android.util.Log;
+import android.view.ContextMenu;
+import android.view.ContextMenu.ContextMenuInfo;
+import android.view.LayoutInflater;
+import android.view.Menu;
+import android.view.MenuItem;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ArrayAdapter;
+import android.widget.ListView;
+import android.widget.QuickContactBadge;
+import android.widget.TextView;
+
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.data.ContactList;
+import com.android.mms.data.Conversation;
+
+/**
+ * Display a list of recipients for a group conversation. This activity expects to receive a
+ * threadId in the intent's extras.
+ */
+public class RecipientListActivity extends ListActivity {
+    private final static String TAG = "RecipientListActivity";
+
+    private long mThreadId;
+
+    @Override
+    protected void onCreate(Bundle icicle) {
+        super.onCreate(icicle);
+
+        if (icicle != null) {
+            // Retrieve previously saved state of this activity.
+            mThreadId = icicle.getLong(ComposeMessageActivity.THREAD_ID);
+        } else {
+            mThreadId = getIntent().getLongExtra(ComposeMessageActivity.THREAD_ID, 0);
+        }
+        if (mThreadId == 0) {
+            Log.w(TAG, "No thread_id specified in extras or icicle. Finishing...");
+            finish();
+            return;
+        }
+
+        Conversation conv = Conversation.get(this, mThreadId, true);
+        if (conv == null) {
+            Log.w(TAG, "No conversation found for threadId: " + mThreadId + ". Finishing...");
+            finish();
+            return;
+        }
+        final ContactList contacts = conv.getRecipients();
+        getListView().setAdapter(new RecipientListAdapter(this, R.layout.recipient_list_item,
+                contacts));
+
+        ActionBar actionBar = getActionBar();
+        actionBar.setDisplayHomeAsUpEnabled(true);
+        int cnt = contacts.size();
+        actionBar.setSubtitle(getResources().getQuantityString(R.plurals.recipient_count,
+                cnt, cnt));
+    }
+
+    @Override
+    protected void onSaveInstanceState(Bundle outState) {
+        outState.putLong(ComposeMessageActivity.THREAD_ID, mThreadId);
+        super.onSaveInstanceState(outState);
+    }
+
+    @Override
+    public boolean onOptionsItemSelected(MenuItem item) {
+        switch (item.getItemId()) {
+            case android.R.id.home:
+                finish();
+                break;
+            case R.id.action_settings:
+                Intent intent = new Intent(this, MessagingPreferenceActivity.class);
+                startActivity(intent);
+                break;
+        }
+        return true;
+    }
+
+    @Override
+    public boolean onCreateOptionsMenu(Menu menu) {
+        getMenuInflater().inflate(R.menu.recipient_list_menu, menu);
+        return true;
+    }
+
+    private static class RecipientListAdapter extends ArrayAdapter<Contact> {
+        private final int mResourceId;
+        private final LayoutInflater mInflater;
+        private final Drawable mDefaultContactImage;
+
+        public RecipientListAdapter(Context context, int resource,
+                ContactList recipients) {
+            super(context, resource, recipients);
+
+            mResourceId = resource;
+            mInflater = LayoutInflater.from(context);
+            mDefaultContactImage =
+                    context.getResources().getDrawable(R.drawable.ic_contact_picture);
+        }
+
+        @Override
+        public View getView(int position, View convertView, ViewGroup parent) {
+            final View listItemView =  mInflater.inflate(mResourceId, null);
+
+            final TextView nameView = (TextView)listItemView.findViewById(R.id.name);
+            final TextView numberView = (TextView)listItemView.findViewById(R.id.number);
+
+            final Contact contact = getItem(position);
+            final String name = contact.getName();
+            final String number = contact.getNumber();
+            if (!name.equals(number)) {
+                nameView.setText(name);
+                numberView.setText(number);
+            } else {
+                nameView.setText(number);
+                numberView.setText(null);
+            }
+
+            QuickContactBadge badge = (QuickContactBadge)listItemView.findViewById(R.id.avatar);
+            if (contact.existsInDatabase()) {
+                badge.assignContactUri(contact.getUri());
+            } else {
+                badge.assignContactFromPhone(contact.getNumber(), true);
+            }
+            final Drawable avatarDrawable = contact.getAvatar(getContext(), mDefaultContactImage);
+            badge.setImageDrawable(avatarDrawable);
+
+            return listItemView;
+        }
+    }
+}
diff --git a/src/com/android/mms/ui/RecipientsAdapter.java b/src/com/android/mms/ui/RecipientsAdapter.java
deleted file mode 100644
index 1950452..0000000
--- a/src/com/android/mms/ui/RecipientsAdapter.java
+++ /dev/null
@@ -1,254 +0,0 @@
-/*
- * Copyright (C) 2008 Esmertec AG.
- * Copyright (C) 2008 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.mms.ui;
-
-import com.android.mms.MmsApp;
-import com.android.mms.R;
-import com.android.mms.data.Contact;
-
-import android.content.ContentResolver;
-import android.content.Context;
-import android.database.Cursor;
-import android.database.MatrixCursor;
-import android.database.MergeCursor;
-import android.net.Uri;
-import android.provider.ContactsContract.Contacts;
-import android.provider.ContactsContract.CommonDataKinds.Phone;
-import android.provider.ContactsContract.DataUsageFeedback;
-import android.telephony.PhoneNumberUtils;
-import android.text.Annotation;
-import android.text.Spannable;
-import android.text.SpannableString;
-import android.text.TextUtils;
-import android.view.View;
-import android.widget.ResourceCursorAdapter;
-import android.widget.TextView;
-
-/**
- * This adapter is used to filter contacts on both name and number.
- */
-public class RecipientsAdapter extends ResourceCursorAdapter {
-
-    public static final int CONTACT_ID_INDEX = 1;
-    public static final int TYPE_INDEX       = 2;
-    public static final int NUMBER_INDEX     = 3;
-    public static final int LABEL_INDEX      = 4;
-    public static final int NAME_INDEX       = 5;
-    public static final int NORMALIZED_NUMBER = 6;
-
-    private static final String[] PROJECTION_PHONE = {
-        Phone._ID,                  // 0
-        Phone.CONTACT_ID,           // 1
-        Phone.TYPE,                 // 2
-        Phone.NUMBER,               // 3
-        Phone.LABEL,                // 4
-        Phone.DISPLAY_NAME,         // 5
-        Phone.NORMALIZED_NUMBER,    // 6
-    };
-
-    private static final String SORT_ORDER = Contacts.TIMES_CONTACTED + " DESC,"
-            + Contacts.DISPLAY_NAME + "," + Phone.TYPE;
-
-    private final Context mContext;
-    private final ContentResolver mContentResolver;
-    private final String mDefaultCountryIso;
-
-    public RecipientsAdapter(Context context) {
-        // Note that the RecipientsAdapter doesn't support auto-requeries. If we
-        // want to respond to changes in the contacts we're displaying in the drop-down,
-        // code using this adapter would have to add a line such as:
-        //   mRecipientsAdapter.setOnDataSetChangedListener(mDataSetChangedListener);
-        // See ComposeMessageActivity for an example.
-        super(context, R.layout.recipient_filter_item, null, false /* no auto-requery */);
-        mContext = context;
-        mContentResolver = context.getContentResolver();
-        mDefaultCountryIso = MmsApp.getApplication().getCurrentCountryIso();
-    }
-
-    @Override
-    public final CharSequence convertToString(Cursor cursor) {
-        String number = cursor.getString(RecipientsAdapter.NUMBER_INDEX);
-        if (number == null) {
-            return "";
-        }
-        number = number.trim();
-
-        String name = cursor.getString(RecipientsAdapter.NAME_INDEX);
-        int type = cursor.getInt(RecipientsAdapter.TYPE_INDEX);
-
-        String label = cursor.getString(RecipientsAdapter.LABEL_INDEX);
-        CharSequence displayLabel = Phone.getDisplayLabel(mContext, type, label);
-
-        if (name == null) {
-            name = "";
-        } else {
-            // Names with commas are the bane of the recipient editor's existence.
-            // We've worked around them by using spans, but there are edge cases
-            // where the spans get deleted. Furthermore, having commas in names
-            // can be confusing to the user since commas are used as separators
-            // between recipients. The best solution is to simply remove commas
-            // from names.
-            name = name.replace(", ", " ")
-                       .replace(",", " ");  // Make sure we leave a space between parts of names.
-        }
-
-        String nameAndNumber = Contact.formatNameAndNumber( name, number,
-                cursor.getString(NORMALIZED_NUMBER));
-
-        SpannableString out = new SpannableString(nameAndNumber);
-        int len = out.length();
-
-        if (!TextUtils.isEmpty(name)) {
-            out.setSpan(new Annotation("name", name), 0, len,
-                        Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
-        } else {
-            out.setSpan(new Annotation("name", number), 0, len,
-                        Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
-        }
-
-        String person_id = cursor.getString(RecipientsAdapter.CONTACT_ID_INDEX);
-        out.setSpan(new Annotation("person_id", person_id), 0, len,
-                    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
-        out.setSpan(new Annotation("label", displayLabel.toString()), 0, len,
-                    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
-        out.setSpan(new Annotation("number", number), 0, len,
-                    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
-
-        return out;
-    }
-
-    @Override
-    public final void bindView(View view, Context context, Cursor cursor) {
-        TextView name = (TextView) view.findViewById(R.id.name);
-        name.setText(cursor.getString(NAME_INDEX));
-
-        TextView label = (TextView) view.findViewById(R.id.label);
-        int type = cursor.getInt(TYPE_INDEX);
-        CharSequence labelText = Phone.getDisplayLabel(mContext, type,
-                cursor.getString(LABEL_INDEX));
-        // When there's no label, getDisplayLabel() returns a CharSequence of length==1 containing
-        // a unicode non-breaking space. Need to check for that and consider that as "no label".
-        if (labelText.length() == 0 ||
-                (labelText.length() == 1 && labelText.charAt(0) == '\u00A0')) {
-            label.setVisibility(View.GONE);
-        } else {
-            label.setText(labelText);
-            label.setVisibility(View.VISIBLE);
-        }
-
-        TextView number = (TextView) view.findViewById(R.id.number);
-        number.setText(
-                PhoneNumberUtils.formatNumber(cursor.getString(NUMBER_INDEX),
-                        cursor.getString(NORMALIZED_NUMBER), mDefaultCountryIso));
-    }
-
-    @Override
-    public Cursor runQueryOnBackgroundThread(CharSequence constraint) {
-        String phone = "";
-        String cons = null;
-
-        if (constraint != null) {
-            cons = constraint.toString();
-
-            if (usefulAsDigits(cons)) {
-                phone = PhoneNumberUtils.convertKeypadLettersToDigits(cons);
-                if (phone.equals(cons)) {
-                    phone = "";
-                } else {
-                    phone = phone.trim();
-                }
-            }
-        }
-
-        Uri uri = Phone.CONTENT_FILTER_URI.buildUpon()
-                .appendPath(cons)
-                .appendQueryParameter(DataUsageFeedback.USAGE_TYPE,
-                        DataUsageFeedback.USAGE_TYPE_SHORT_TEXT)
-                .build();
-        /*
-         * if we decide to filter based on phone types use a selection
-         * like this.
-        String selection = String.format("%s=%s OR %s=%s OR %s=%s",
-                Phone.TYPE,
-                Phone.TYPE_MOBILE,
-                Phone.TYPE,
-                Phone.TYPE_WORK_MOBILE,
-                Phone.TYPE,
-                Phone.TYPE_MMS);
-         */
-        Cursor phoneCursor =
-            mContentResolver.query(uri,
-                    PROJECTION_PHONE,
-                    null, //selection,
-                    null,
-                    null);
-
-        if (phone.length() > 0) {
-            Object[] result = new Object[7];
-            result[0] = Integer.valueOf(-1);                    // ID
-            result[1] = Long.valueOf(-1);                       // CONTACT_ID
-            result[2] = Integer.valueOf(Phone.TYPE_CUSTOM);     // TYPE
-            result[3] = phone;                                  // NUMBER
-
-            /*
-             * The "\u00A0" keeps Phone.getDisplayLabel() from deciding
-             * to display the default label ("Home") next to the transformation
-             * of the letters into numbers.
-             */
-            result[4] = "\u00A0";                               // LABEL
-            result[5] = cons;                                   // NAME
-            result[6] = phone;                                  // NORMALIZED_NUMBER
-
-            MatrixCursor translated = new MatrixCursor(PROJECTION_PHONE, 1);
-            translated.addRow(result);
-            return new MergeCursor(new Cursor[] { translated, phoneCursor });
-        } else {
-            return phoneCursor;
-        }
-    }
-
-    /**
-     * Returns true if all the characters are meaningful as digits
-     * in a phone number -- letters, digits, and a few punctuation marks.
-     */
-    private boolean usefulAsDigits(CharSequence cons) {
-        int len = cons.length();
-
-        for (int i = 0; i < len; i++) {
-            char c = cons.charAt(i);
-
-            if ((c >= '0') && (c <= '9')) {
-                continue;
-            }
-            if ((c == ' ') || (c == '-') || (c == '(') || (c == ')') || (c == '.') || (c == '+')
-                    || (c == '#') || (c == '*')) {
-                continue;
-            }
-            if ((c >= 'A') && (c <= 'Z')) {
-                continue;
-            }
-            if ((c >= 'a') && (c <= 'z')) {
-                continue;
-            }
-
-            return false;
-        }
-
-        return true;
-    }
-}
diff --git a/src/com/android/mms/ui/RecipientsEditor.java b/src/com/android/mms/ui/RecipientsEditor.java
index b1e748b..4de2118 100644
--- a/src/com/android/mms/ui/RecipientsEditor.java
+++ b/src/com/android/mms/ui/RecipientsEditor.java
@@ -17,10 +17,8 @@
 
 package com.android.mms.ui;
 
-import com.android.ex.chips.RecipientEditTextView;
-import com.android.mms.MmsConfig;
-import com.android.mms.data.Contact;
-import com.android.mms.data.ContactList;
+import java.util.ArrayList;
+import java.util.List;
 
 import android.content.Context;
 import android.provider.Telephony.Mms;
@@ -30,23 +28,23 @@ import android.text.Editable;
 import android.text.Layout;
 import android.text.Spannable;
 import android.text.SpannableString;
-import android.text.SpannableStringBuilder;
 import android.text.Spanned;
 import android.text.TextUtils;
 import android.text.TextWatcher;
 import android.text.util.Rfc822Token;
 import android.text.util.Rfc822Tokenizer;
 import android.util.AttributeSet;
-import android.view.inputmethod.EditorInfo;
+import android.view.ContextMenu.ContextMenuInfo;
 import android.view.MotionEvent;
 import android.view.View;
-import android.view.ContextMenu.ContextMenuInfo;
+import android.view.inputmethod.EditorInfo;
 import android.widget.AdapterView;
 import android.widget.MultiAutoCompleteTextView;
-import android.widget.AutoCompleteTextView.Validator;
 
-import java.util.ArrayList;
-import java.util.List;
+import com.android.ex.chips.RecipientEditTextView;
+import com.android.mms.MmsConfig;
+import com.android.mms.data.Contact;
+import com.android.mms.data.ContactList;
 
 /**
  * Provide UI for editing the recipients of multi-media messages.
@@ -276,12 +274,19 @@ public class RecipientsEditor extends RecipientEditTextView {
             for (Contact c : list) {
                 // Calling setText to set the recipients won't create chips,
                 // but calling append() will.
-                append(contactToToken(c) + ", ");
+                append(contactToToken(c) + ",");
             }
         }
     }
 
     private int pointToPosition(int x, int y) {
+        // Check layout before getExtendedPaddingTop().
+        // mLayout is used in getExtendedPaddingTop().
+        Layout layout = getLayout();
+        if (layout == null) {
+            return -1;
+        }
+
         x -= getCompoundPaddingLeft();
         y -= getExtendedPaddingTop();
 
@@ -289,11 +294,6 @@ public class RecipientsEditor extends RecipientEditTextView {
         x += getScrollX();
         y += getScrollY();
 
-        Layout layout = getLayout();
-        if (layout == null) {
-            return -1;
-        }
-
         int line = layout.getLineForVertical(y);
         int off = layout.getOffsetForHorizontal(line, x);
 
diff --git a/src/com/android/mms/ui/SearchActivity.java b/src/com/android/mms/ui/SearchActivity.java
index 49f93ad..e7fe0dd 100644
--- a/src/com/android/mms/ui/SearchActivity.java
+++ b/src/com/android/mms/ui/SearchActivity.java
@@ -20,9 +20,6 @@ import java.util.HashMap;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
-import com.android.mms.MmsApp;
-import com.android.mms.R;
-
 import android.app.ActionBar;
 import android.app.ListActivity;
 import android.app.SearchManager;
@@ -35,7 +32,6 @@ import android.graphics.Typeface;
 import android.net.Uri;
 import android.os.Bundle;
 import android.provider.SearchRecentSuggestions;
-
 import android.provider.Telephony;
 import android.text.SpannableString;
 import android.text.TextPaint;
@@ -49,8 +45,9 @@ import android.widget.CursorAdapter;
 import android.widget.ListView;
 import android.widget.TextView;
 
+import com.android.mms.MmsApp;
+import com.android.mms.R;
 import com.android.mms.data.Contact;
-import com.android.mms.ui.ComposeMessageActivity;
 
 /***
  * Presents a List of search results.  Each item in the list represents a thread which
@@ -117,12 +114,13 @@ public class SearchActivity extends ListActivity
             float searchStringWidth = tp.measureText(mTargetString);
             float textFieldWidth = getWidth();
 
+            float ellipsisWidth = tp.measureText(sEllipsis);
+            textFieldWidth -= (2F * ellipsisWidth); // assume we'll need one on both ends
+
             String snippetString = null;
             if (searchStringWidth > textFieldWidth) {
                 snippetString = mFullText.substring(startPos, startPos + searchStringLength);
             } else {
-                float ellipsisWidth = tp.measureText(sEllipsis);
-                textFieldWidth -= (2F * ellipsisWidth); // assume we'll need one on both ends
 
                 int offset = -1;
                 int start = -1;
@@ -288,6 +286,11 @@ public class SearchActivity extends ListActivity
         mQueryHandler = new AsyncQueryHandler(cr) {
             protected void onQueryComplete(int token, Object cookie, Cursor c) {
                 if (c == null) {
+                    setTitle(getResources().getQuantityString(
+                        R.plurals.search_results_title,
+                        0,
+                        0,
+                        searchString));
                     return;
                 }
                 final int threadIdPos = c.getColumnIndex("thread_id");
diff --git a/src/com/android/mms/ui/SlideEditorActivity.java b/src/com/android/mms/ui/SlideEditorActivity.java
index d431fd8..6615204 100644
--- a/src/com/android/mms/ui/SlideEditorActivity.java
+++ b/src/com/android/mms/ui/SlideEditorActivity.java
@@ -17,28 +17,6 @@
 
 package com.android.mms.ui;
 
-import java.io.File;
-
-import com.google.android.mms.ContentType;
-import com.android.mms.ExceedMessageSizeException;
-import com.google.android.mms.MmsException;
-import com.android.mms.MmsApp;
-import com.android.mms.MmsConfig;
-import com.android.mms.R;
-import com.android.mms.ResolutionException;
-import com.android.mms.TempFileProvider;
-import com.android.mms.UnsupportContentTypeException;
-import com.android.mms.model.IModelChangedObserver;
-import com.android.mms.model.LayoutModel;
-import com.android.mms.model.Model;
-import com.android.mms.model.SlideModel;
-import com.android.mms.model.SlideshowModel;
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduPart;
-import com.google.android.mms.pdu.PduPersister;
-import com.android.mms.ui.BasicSlideEditorView.OnTextChangedListener;
-import com.android.mms.ui.MessageUtils.ResizeImageResultCallback;
-
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.ContentUris;
@@ -50,9 +28,9 @@ import android.media.RingtoneManager;
 import android.net.Uri;
 import android.os.Bundle;
 import android.os.Handler;
-import android.provider.MediaStore;
 import android.provider.Settings;
-import android.provider.Telephony.Mms;
+import android.text.InputFilter;
+import android.text.InputFilter.LengthFilter;
 import android.text.TextUtils;
 import android.util.Log;
 import android.view.Menu;
@@ -61,11 +39,29 @@ import android.view.SubMenu;
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.widget.Button;
+import android.widget.EditText;
 import android.widget.ImageButton;
 import android.widget.Toast;
-import android.text.InputFilter.LengthFilter;
-import android.widget.EditText;
-import android.text.InputFilter;
+
+import com.android.mms.ExceedMessageSizeException;
+import com.android.mms.MmsApp;
+import com.android.mms.MmsConfig;
+import com.android.mms.R;
+import com.android.mms.ResolutionException;
+import com.android.mms.TempFileProvider;
+import com.android.mms.UnsupportContentTypeException;
+import com.android.mms.model.IModelChangedObserver;
+import com.android.mms.model.LayoutModel;
+import com.android.mms.model.Model;
+import com.android.mms.model.SlideModel;
+import com.android.mms.model.SlideshowModel;
+import com.android.mms.ui.BasicSlideEditorView.OnTextChangedListener;
+import com.android.mms.ui.MessageUtils.ResizeImageResultCallback;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduPart;
+import com.google.android.mms.pdu.PduPersister;
 
 /**
  * This activity allows user to edit the contents of a slide.
@@ -221,7 +217,7 @@ public class SlideEditorActivity extends Activity {
             if (mDirty) {
                 try {
                     PduBody pb = mSlideshowModel.toPduBody();
-                    PduPersister.getPduPersister(this).updateParts(mUri, pb);
+                    PduPersister.getPduPersister(this).updateParts(mUri, pb, null);
                     mSlideshowModel.sync(pb);
                 }  catch (MmsException e) {
                     Log.e(TAG, "Cannot update the message: " + mUri, e);
@@ -743,7 +739,7 @@ public class SlideEditorActivity extends Activity {
             try {
                 long messageId = ContentUris.parseId(mUri);
                 PduPersister persister = PduPersister.getPduPersister(context);
-                Uri newUri = persister.persistPart(part, messageId);
+                Uri newUri = persister.persistPart(part, messageId, null);
                 mSlideshowEditor.changeImage(mPosition, newUri);
 
                 setReplaceButtonText(R.string.replace_image);
diff --git a/src/com/android/mms/ui/SlideListItemView.java b/src/com/android/mms/ui/SlideListItemView.java
index bebb5d7..ae6b921 100644
--- a/src/com/android/mms/ui/SlideListItemView.java
+++ b/src/com/android/mms/ui/SlideListItemView.java
@@ -17,7 +17,8 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.io.IOException;
+import java.util.Map;
 
 import android.content.Context;
 import android.graphics.Bitmap;
@@ -33,8 +34,7 @@ import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import java.io.IOException;
-import java.util.Map;
+import com.android.mms.R;
 
 /**
  * A simplified view of slide in the slides list.
diff --git a/src/com/android/mms/ui/SlideView.java b/src/com/android/mms/ui/SlideView.java
index 6e293db..ec4e339 100644
--- a/src/com/android/mms/ui/SlideView.java
+++ b/src/com/android/mms/ui/SlideView.java
@@ -17,8 +17,10 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.layout.LayoutManager;
+import java.io.IOException;
+import java.util.Comparator;
+import java.util.Map;
+import java.util.TreeMap;
 
 import android.content.Context;
 import android.graphics.Bitmap;
@@ -40,10 +42,8 @@ import android.widget.ScrollView;
 import android.widget.TextView;
 import android.widget.VideoView;
 
-import java.io.IOException;
-import java.util.Comparator;
-import java.util.Map;
-import java.util.TreeMap;
+import com.android.mms.R;
+import com.android.mms.layout.LayoutManager;
 
 /**
  * A basic view to show the contents of a slide.
@@ -245,6 +245,8 @@ public class SlideView extends AbsoluteLayout implements
         }
         mTextView.setVisibility(View.VISIBLE);
         mTextView.setText(text);
+        // Let the text in Mms can be selected.
+        mTextView.setTextIsSelectable(true);
     }
 
     public void setTextRegion(int left, int top, int width, int height) {
@@ -472,7 +474,8 @@ public class SlideView extends AbsoluteLayout implements
                 protected void onScrollChanged(int l, int t, int oldl, int oldt) {
                     // Shows MediaController when the view is scrolled to the top/bottom of itself.
                     if (t == 0 || t >= mBottomY){
-                        if (mMediaController != null) {
+                        if (mMediaController != null
+                                && !((SlideshowActivity) mContext).isFinishing()) {
                             mMediaController.show();
                         }
                     }
diff --git a/src/com/android/mms/ui/SlideViewInterface.java b/src/com/android/mms/ui/SlideViewInterface.java
index c8e8df8..8ce9925 100644
--- a/src/com/android/mms/ui/SlideViewInterface.java
+++ b/src/com/android/mms/ui/SlideViewInterface.java
@@ -17,11 +17,11 @@
 
 package com.android.mms.ui;
 
+import java.util.Map;
+
 import android.graphics.Bitmap;
 import android.net.Uri;
 
-import java.util.Map;
-
 /**
  * Defines the interfaces of the view to show contents of a slide.
  */
diff --git a/src/com/android/mms/ui/SlideshowActivity.java b/src/com/android/mms/ui/SlideshowActivity.java
index c8e5180..f85e573 100644
--- a/src/com/android/mms/ui/SlideshowActivity.java
+++ b/src/com/android/mms/ui/SlideshowActivity.java
@@ -17,16 +17,7 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import com.android.mms.dom.AttrImpl;
-import com.android.mms.dom.smil.SmilDocumentImpl;
-import com.android.mms.dom.smil.SmilPlayer;
-import com.android.mms.dom.smil.parser.SmilXmlSerializer;
-import com.android.mms.model.LayoutModel;
-import com.android.mms.model.RegionModel;
-import com.android.mms.model.SlideshowModel;
-import com.android.mms.model.SmilHelper;
-import com.google.android.mms.MmsException;
+import java.io.ByteArrayOutputStream;
 
 import org.w3c.dom.NamedNodeMap;
 import org.w3c.dom.Node;
@@ -47,12 +38,21 @@ import android.util.Log;
 import android.view.KeyEvent;
 import android.view.MotionEvent;
 import android.view.View;
-import android.view.Window;
 import android.view.View.OnClickListener;
+import android.view.Window;
 import android.widget.MediaController;
 import android.widget.MediaController.MediaPlayerControl;
 
-import java.io.ByteArrayOutputStream;
+import com.android.mms.R;
+import com.android.mms.dom.AttrImpl;
+import com.android.mms.dom.smil.SmilDocumentImpl;
+import com.android.mms.dom.smil.SmilPlayer;
+import com.android.mms.dom.smil.parser.SmilXmlSerializer;
+import com.android.mms.model.LayoutModel;
+import com.android.mms.model.RegionModel;
+import com.android.mms.model.SlideshowModel;
+import com.android.mms.model.SmilHelper;
+import com.google.android.mms.MmsException;
 
 /**
  * Plays the given slideshow in full-screen mode with a common controller.
@@ -377,6 +377,11 @@ public class SlideshowActivity extends Activity implements EventListener {
         public boolean canSeekForward() {
             return true;
         }
+
+        @Override
+        public int getAudioSessionId() {
+            return 0;
+        }
     }
 
     public void handleEvent(Event evt) {
diff --git a/src/com/android/mms/ui/SlideshowAttachmentView.java b/src/com/android/mms/ui/SlideshowAttachmentView.java
index 3394fd9..03d50e5 100644
--- a/src/com/android/mms/ui/SlideshowAttachmentView.java
+++ b/src/com/android/mms/ui/SlideshowAttachmentView.java
@@ -17,7 +17,8 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
+import java.io.IOException;
+import java.util.Map;
 
 import android.content.Context;
 import android.graphics.Bitmap;
@@ -31,8 +32,7 @@ import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import java.io.IOException;
-import java.util.Map;
+import com.android.mms.R;
 
 /**
  * This class provides an embedded editor/viewer of slide-show attachment.
@@ -125,7 +125,7 @@ public class SlideshowAttachmentView extends LinearLayout implements
     }
 
     public void reset() {
-        mImageView.setImageURI(null);
+        mImageView.setImageBitmap(null);
         mTextView.setText("");
     }
 
diff --git a/src/com/android/mms/ui/SlideshowEditActivity.java b/src/com/android/mms/ui/SlideshowEditActivity.java
index 77e35b1..de21e72 100644
--- a/src/com/android/mms/ui/SlideshowEditActivity.java
+++ b/src/com/android/mms/ui/SlideshowEditActivity.java
@@ -17,33 +17,36 @@
 
 package com.android.mms.ui;
 
-import com.google.android.mms.MmsException;
-import com.android.mms.R;
-import com.android.mms.model.IModelChangedObserver;
-import com.android.mms.model.Model;
-import com.android.mms.model.SlideModel;
-import com.android.mms.model.SlideshowModel;
-
-import com.google.android.mms.pdu.PduBody;
-import com.google.android.mms.pdu.PduPersister;
-
 import android.app.ListActivity;
 import android.content.Context;
 import android.content.Intent;
 import android.net.Uri;
 import android.os.Bundle;
 import android.util.Log;
+import android.view.ContextMenu;
+import android.view.ContextMenu.ContextMenuInfo;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuItem;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.AdapterView;
+import android.widget.AdapterView.AdapterContextMenuInfo;
 import android.widget.ArrayAdapter;
 import android.widget.ImageView;
 import android.widget.ListView;
 import android.widget.TextView;
 import android.widget.Toast;
 
+import com.android.mms.R;
+import com.android.mms.model.IModelChangedObserver;
+import com.android.mms.model.Model;
+import com.android.mms.model.SlideModel;
+import com.android.mms.model.SlideshowModel;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.PduBody;
+import com.google.android.mms.pdu.PduPersister;
+
 /**
  * A list of slides which allows user to edit each item in it.
  */
@@ -115,6 +118,8 @@ public class SlideshowEditActivity extends ListActivity {
             Log.e(TAG, "Failed to initialize the slide-list.", e);
             finish();
         }
+
+        registerForContextMenu(mList);
     }
 
     private View createAddSlideItem() {
@@ -184,7 +189,7 @@ public class SlideshowEditActivity extends ListActivity {
             if (mDirty) {
                 try {
                     PduBody pb = mSlideshowModel.toPduBody();
-                    PduPersister.getPduPersister(this).updateParts(mUri, pb);
+                    PduPersister.getPduPersister(this).updateParts(mUri, pb, null);
                     mSlideshowModel.sync(pb);
                 }  catch (MmsException e) {
                     Log.e(TAG, "Cannot update the message: " + mUri, e);
@@ -336,6 +341,7 @@ public class SlideshowEditActivity extends ListActivity {
 
                 try {
                     initSlideList();
+                    adjustAddSlideVisibility();
                 } catch (MmsException e) {
                     Log.e(TAG, "Failed to initialize the slide-list.", e);
                     finish();
@@ -401,4 +407,66 @@ public class SlideshowEditActivity extends ListActivity {
                 adjustAddSlideVisibility();
             }
         };
+
+    @Override
+    public void onCreateContextMenu(ContextMenu menu, View v,
+            ContextMenuInfo menuInfo) {
+        menu.setHeaderTitle(R.string.slideshow_options);
+
+        AdapterView.AdapterContextMenuInfo info = (AdapterView.AdapterContextMenuInfo) menuInfo;
+        int position = info.position;
+
+        if ((position >= 0) && (position != (mList.getCount() - 1))) {
+            // Selected one slide.
+            if (position > 0) {
+                menu.add(0, MENU_MOVE_UP, 0, R.string.move_up).setIcon(R.drawable.ic_menu_move_up);
+            }
+            if (position < (mSlideListAdapter.getCount() - 1)) {
+                menu.add(0, MENU_MOVE_DOWN, 0, R.string.move_down).setIcon(
+                        R.drawable.ic_menu_move_down);
+            }
+
+            menu.add(0, MENU_ADD_SLIDE, 0, R.string.add_slide).setIcon(
+                    R.drawable.ic_menu_add_slide);
+
+            menu.add(0, MENU_REMOVE_SLIDE, 0, R.string.remove_slide).setIcon(
+                    android.R.drawable.ic_menu_delete);
+        }
+    }
+
+    @Override
+    public boolean onContextItemSelected(MenuItem item) {
+        AdapterContextMenuInfo info = (AdapterView.AdapterContextMenuInfo) item.getMenuInfo();
+        int position = info.position;
+
+        switch(item.getItemId()) {
+            case MENU_MOVE_UP:
+                if ((position > 0) && (position < mSlideshowModel.size())) {
+                    mSlideshowEditor.moveSlideUp(position);
+                    mSlideListAdapter.notifyDataSetChanged();
+                    mList.setSelection(position - 1);
+                }
+                break;
+            case MENU_MOVE_DOWN:
+                if ((position >= 0) && (position < mSlideshowModel.size() - 1)) {
+                    mSlideshowEditor.moveSlideDown(position);
+                    mSlideListAdapter.notifyDataSetChanged();
+                    mList.setSelection(position + 1);
+                }
+                break;
+            case MENU_REMOVE_SLIDE:
+                if ((position >= 0) && (position < mSlideshowModel.size())) {
+                    mSlideshowEditor.removeSlide(position);
+                    mSlideListAdapter.notifyDataSetChanged();
+                }
+                break;
+            case MENU_ADD_SLIDE:
+                addNewSlide();
+                break;
+            default:
+                break;
+        }
+
+        return true;
+    }
 }
diff --git a/src/com/android/mms/ui/SlideshowEditor.java b/src/com/android/mms/ui/SlideshowEditor.java
index b17da18..3a18129 100644
--- a/src/com/android/mms/ui/SlideshowEditor.java
+++ b/src/com/android/mms/ui/SlideshowEditor.java
@@ -17,8 +17,10 @@
 
 package com.android.mms.ui;
 
-import com.google.android.mms.ContentType;
-import com.google.android.mms.MmsException;
+import android.content.Context;
+import android.net.Uri;
+import android.util.Log;
+
 import com.android.mms.model.AudioModel;
 import com.android.mms.model.ImageModel;
 import com.android.mms.model.RegionModel;
@@ -26,10 +28,8 @@ import com.android.mms.model.SlideModel;
 import com.android.mms.model.SlideshowModel;
 import com.android.mms.model.TextModel;
 import com.android.mms.model.VideoModel;
-
-import android.content.Context;
-import android.net.Uri;
-import android.util.Log;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.MmsException;
 
 /**
  * An utility to edit contents of a slide.
diff --git a/src/com/android/mms/ui/SlideshowPresenter.java b/src/com/android/mms/ui/SlideshowPresenter.java
index b0a4d56..acb7a01 100644
--- a/src/com/android/mms/ui/SlideshowPresenter.java
+++ b/src/com/android/mms/ui/SlideshowPresenter.java
@@ -17,12 +17,15 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import android.drm.mobile1.DrmException;
+import android.content.Context;
+import android.os.Handler;
+import android.util.Log;
+
 import com.android.mms.model.AudioModel;
 import com.android.mms.model.ImageModel;
 import com.android.mms.model.LayoutModel;
 import com.android.mms.model.MediaModel;
+import com.android.mms.model.MediaModel.MediaAction;
 import com.android.mms.model.Model;
 import com.android.mms.model.RegionMediaModel;
 import com.android.mms.model.RegionModel;
@@ -30,15 +33,9 @@ import com.android.mms.model.SlideModel;
 import com.android.mms.model.SlideshowModel;
 import com.android.mms.model.TextModel;
 import com.android.mms.model.VideoModel;
-import com.android.mms.model.MediaModel.MediaAction;
 import com.android.mms.ui.AdaptableSlideViewInterface.OnSizeChangedListener;
 import com.android.mms.util.ItemLoadedCallback;
 
-import android.content.Context;
-import android.os.Handler;
-import android.util.Log;
-import android.widget.Toast;
-
 /**
  * A basic presenter of slides.
  */
@@ -203,7 +200,7 @@ public class SlideshowPresenter extends Presenter {
         }
 
         if (dataChanged) {
-            view.setImage(image.getSrc(), image.getBitmap(r.getWidth(), r.getHeight()));
+            view.setImage(image.getSrc(), image.getBitmap(transformedWidth, transformedHeight));
         }
 
         if (view instanceof AdaptableSlideViewInterface) {
diff --git a/src/com/android/mms/ui/UriImage.java b/src/com/android/mms/ui/UriImage.java
index d9f158a..c74764b 100644
--- a/src/com/android/mms/ui/UriImage.java
+++ b/src/com/android/mms/ui/UriImage.java
@@ -17,18 +17,18 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.model.ImageModel;
-import com.android.mms.LogTag;
-
-import com.google.android.mms.ContentType;
-import com.google.android.mms.pdu.PduPart;
-import android.database.sqlite.SqliteWrapper;
+import java.io.ByteArrayOutputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.io.InputStream;
 
+import android.content.ContentResolver;
 import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
 import android.graphics.Bitmap.CompressFormat;
+import android.graphics.BitmapFactory;
 import android.net.Uri;
 import android.provider.MediaStore.Images;
 import android.provider.Telephony.Mms.Part;
@@ -36,11 +36,10 @@ import android.text.TextUtils;
 import android.util.Log;
 import android.webkit.MimeTypeMap;
 
-import java.io.ByteArrayOutputStream;
-import java.io.FileNotFoundException;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
+import com.android.mms.LogTag;
+import com.android.mms.model.ImageModel;
+import com.google.android.mms.ContentType;
+import com.google.android.mms.pdu.PduPart;
 
 public class UriImage {
     private static final String TAG = "Mms/image";
@@ -112,7 +111,8 @@ public class UriImage {
     }
 
     private void initFromContentUri(Context context, Uri uri) {
-        Cursor c = SqliteWrapper.query(context, context.getContentResolver(),
+        ContentResolver resolver = context.getContentResolver();
+        Cursor c = SqliteWrapper.query(context, resolver,
                             uri, null, null, null, null);
 
         mSrc = null;
@@ -142,7 +142,12 @@ public class UriImage {
                     mContentType = c.getString(
                             c.getColumnIndexOrThrow(Images.Media.MIME_TYPE)); // mime_type
                 } catch (IllegalArgumentException e) {
-                    mContentType = c.getString(c.getColumnIndexOrThrow("mimetype"));
+                    try {
+                        mContentType = c.getString(c.getColumnIndexOrThrow("mimetype"));
+                    } catch (IllegalArgumentException ex) {
+                        mContentType = resolver.getType(uri);
+                        Log.v(TAG, "initFromContentUri: " + uri + ", getType => " + mContentType);
+                    }
                 }
 
                 // use the original filename if possible
diff --git a/src/com/android/mms/ui/VideoAttachmentView.java b/src/com/android/mms/ui/VideoAttachmentView.java
index befa1fe..1b16cf1 100644
--- a/src/com/android/mms/ui/VideoAttachmentView.java
+++ b/src/com/android/mms/ui/VideoAttachmentView.java
@@ -17,20 +17,20 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-import android.media.MediaMetadataRetriever;        // TODO: remove dependency for SDK build
+import java.util.Map;
 
 import android.content.Context;
 import android.graphics.Bitmap;
 import android.graphics.BitmapFactory;
+import android.media.MediaMetadataRetriever;
 import android.net.Uri;
 import android.util.AttributeSet;
 import android.util.Log;
-import android.view.View;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
 
-import java.util.Map;
+import com.android.mms.R;
+// TODO: remove dependency for SDK build
 
 /**
  * This class provides an embedded editor/viewer of video attachment.
diff --git a/src/com/android/mms/ui/WarnOfStorageLimitsActivity.java b/src/com/android/mms/ui/WarnOfStorageLimitsActivity.java
index 3e688be..9fd4993 100644
--- a/src/com/android/mms/ui/WarnOfStorageLimitsActivity.java
+++ b/src/com/android/mms/ui/WarnOfStorageLimitsActivity.java
@@ -17,10 +17,6 @@
 
 package com.android.mms.ui;
 
-import com.android.mms.R;
-
-import com.android.internal.app.AlertController;
-
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.DialogInterface;
@@ -28,6 +24,9 @@ import android.content.Intent;
 import android.os.Bundle;
 import android.view.KeyEvent;
 
+import com.android.internal.app.AlertController;
+import com.android.mms.R;
+
 /**
  * This is the UI for telling the user about the storage limit setting.
  */
diff --git a/src/com/android/mms/util/AddressUtils.java b/src/com/android/mms/util/AddressUtils.java
index 8d05467..87fd08d 100644
--- a/src/com/android/mms/util/AddressUtils.java
+++ b/src/com/android/mms/util/AddressUtils.java
@@ -16,22 +16,20 @@
  */
 package com.android.mms.util;
 
-import com.android.mms.MmsApp;
-import com.android.mms.R;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.google.android.mms.pdu.PduHeaders;
-import com.google.android.mms.pdu.PduPersister;
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.Context;
 import android.database.Cursor;
-import android.location.Country;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.provider.Telephony.Mms;
 import android.provider.Telephony.Mms.Addr;
 import android.text.TextUtils;
-import android.telephony.PhoneNumberUtils;
+
 import com.android.i18n.phonenumbers.PhoneNumberUtil;
+import com.android.mms.MmsApp;
+import com.android.mms.R;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.PduHeaders;
+import com.google.android.mms.pdu.PduPersister;
 
 public class AddressUtils {
     private static final String TAG = "AddressUtils";
@@ -70,12 +68,18 @@ public class AddressUtils {
         return context.getString(R.string.hidden_sender_address);
     }
 
-    public static boolean isPossiblePhoneNumber(String query) {
+    /**
+     * isPossiblePhoneNumberCanDoFileAccess does a more accurate test if the input is a
+     * phone number, but it can do file access to load country prefixes and other info, so
+     * it's not safe to call from the UI thread.
+     * @param query the phone number to test
+     * @return true if query looks like a valid phone number
+     */
+    public static boolean isPossiblePhoneNumberCanDoFileAccess(String query) {
         String currentCountry = MmsApp.getApplication().getCurrentCountryIso().toUpperCase();
         if (mPhoneNumberUtil == null) {
             mPhoneNumberUtil = PhoneNumberUtil.getInstance();
         }
         return mPhoneNumberUtil.isPossibleNumber(query, currentCountry);
     }
-
 }
diff --git a/src/com/android/mms/util/BlobCache.java b/src/com/android/mms/util/BlobCache.java
index f37bb37..cd89749 100644
--- a/src/com/android/mms/util/BlobCache.java
+++ b/src/com/android/mms/util/BlobCache.java
@@ -65,8 +65,6 @@
 //
 package com.android.mms.util;
 
-import android.util.Log;
-
 import java.io.Closeable;
 import java.io.File;
 import java.io.IOException;
@@ -76,6 +74,8 @@ import java.nio.MappedByteBuffer;
 import java.nio.channels.FileChannel;
 import java.util.zip.Adler32;
 
+import android.util.Log;
+
 public class BlobCache implements Closeable {
     private static final String TAG = "BlobCache";
 
diff --git a/src/com/android/mms/util/CacheManager.java b/src/com/android/mms/util/CacheManager.java
index 9198505..dd02b66 100644
--- a/src/com/android/mms/util/CacheManager.java
+++ b/src/com/android/mms/util/CacheManager.java
@@ -16,15 +16,15 @@
 
 package com.android.mms.util;
 
+import java.io.File;
+import java.io.IOException;
+import java.util.HashMap;
+
 import android.content.Context;
 import android.content.SharedPreferences;
 import android.preference.PreferenceManager;
 import android.util.Log;
 
-import java.io.File;
-import java.io.IOException;
-import java.util.HashMap;
-
 public class CacheManager {
     private static final String TAG = "CacheManager";
     private static final String KEY_CACHE_UP_TO_DATE = "cache-up-to-date";
diff --git a/src/com/android/mms/util/DownloadManager.java b/src/com/android/mms/util/DownloadManager.java
index 0811af0..3e061e3 100644
--- a/src/com/android/mms/util/DownloadManager.java
+++ b/src/com/android/mms/util/DownloadManager.java
@@ -17,17 +17,6 @@
 
 package com.android.mms.util;
 
-import com.android.mms.R;
-import com.android.mms.data.Contact;
-import com.android.mms.ui.MessagingPreferenceActivity;
-import com.google.android.mms.MmsException;
-import com.google.android.mms.pdu.EncodedStringValue;
-import com.google.android.mms.pdu.NotificationInd;
-import com.google.android.mms.pdu.PduPersister;
-import android.database.sqlite.SqliteWrapper;
-import com.android.internal.telephony.TelephonyIntents;
-import com.android.internal.telephony.TelephonyProperties;
-
 import android.content.BroadcastReceiver;
 import android.content.ContentValues;
 import android.content.Context;
@@ -36,15 +25,25 @@ import android.content.IntentFilter;
 import android.content.SharedPreferences;
 import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.os.Handler;
+import android.os.SystemProperties;
 import android.preference.PreferenceManager;
 import android.provider.Telephony.Mms;
 import android.telephony.ServiceState;
 import android.util.Log;
 import android.widget.Toast;
 
-import android.os.SystemProperties;
+import com.android.internal.telephony.TelephonyIntents;
+import com.android.internal.telephony.TelephonyProperties;
+import com.android.mms.R;
+import com.android.mms.data.Contact;
+import com.android.mms.ui.MessagingPreferenceActivity;
+import com.google.android.mms.MmsException;
+import com.google.android.mms.pdu.EncodedStringValue;
+import com.google.android.mms.pdu.NotificationInd;
+import com.google.android.mms.pdu.PduPersister;
 
 public class DownloadManager {
     private static final String TAG = "DownloadManager";
@@ -58,6 +57,7 @@ public class DownloadManager {
     public static final int STATE_DOWNLOADING       = 0x81;
     public static final int STATE_TRANSIENT_FAILURE = 0x82;
     public static final int STATE_PERMANENT_FAILURE = 0x87;
+    public static final int STATE_PRE_DOWNLOADING   = 0x88;
 
     private final Context mContext;
     private final Handler mHandler;
diff --git a/src/com/android/mms/util/DraftCache.java b/src/com/android/mms/util/DraftCache.java
index 71d9ae0..bf36cd8 100644
--- a/src/com/android/mms/util/DraftCache.java
+++ b/src/com/android/mms/util/DraftCache.java
@@ -16,18 +16,18 @@
 
 package com.android.mms.util;
 
-import android.database.sqlite.SqliteWrapper;
-import com.android.mms.LogTag;
-
 import java.util.HashSet;
 import java.util.Set;
 
 import android.content.Context;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.provider.Telephony.MmsSms;
 import android.provider.Telephony.Sms.Conversations;
 import android.util.Log;
 
+import com.android.mms.LogTag;
+
 /**
  * Cache for information about draft messages on conversations.
  */
diff --git a/src/com/android/mms/util/ImageCacheService.java b/src/com/android/mms/util/ImageCacheService.java
index c589c49..9cd82f9 100644
--- a/src/com/android/mms/util/ImageCacheService.java
+++ b/src/com/android/mms/util/ImageCacheService.java
@@ -16,11 +16,11 @@
 
 package com.android.mms.util;
 
-import android.content.Context;
-
 import java.io.IOException;
 import java.nio.ByteBuffer;
 
+import android.content.Context;
+
 public class ImageCacheService {
     @SuppressWarnings("unused")
     private static final String TAG = "ImageCacheService";
diff --git a/src/com/android/mms/util/ItemLoadedFuture.java b/src/com/android/mms/util/ItemLoadedFuture.java
index 1076d6d..509c5c6 100644
--- a/src/com/android/mms/util/ItemLoadedFuture.java
+++ b/src/com/android/mms/util/ItemLoadedFuture.java
@@ -16,6 +16,8 @@
 
 package com.android.mms.util;
 
+import android.net.Uri;
+
 /**
  * Interface for querying the state of a pending item loading request.
  *
@@ -29,5 +31,7 @@ public interface ItemLoadedFuture {
      */
     boolean isDone();
 
-    void cancel();
+    void setIsDone(boolean done);
+
+    void cancel(Uri uri);
 }
diff --git a/src/com/android/mms/util/NullItemLoadedFuture.java b/src/com/android/mms/util/NullItemLoadedFuture.java
index 87ae9f6..6f33185 100644
--- a/src/com/android/mms/util/NullItemLoadedFuture.java
+++ b/src/com/android/mms/util/NullItemLoadedFuture.java
@@ -16,6 +16,8 @@
 
 package com.android.mms.util;
 
+import android.net.Uri;
+
 /**
  * {@link PduFuture} for a pdu that is available now.
  *
@@ -23,7 +25,7 @@ package com.android.mms.util;
 public class NullItemLoadedFuture implements ItemLoadedFuture {
 
     /** {@inheritDoc} */
-    public void cancel() {
+    public void cancel(Uri uri) {
         // The callback has already been made, so there's nothing to cancel.
     }
 
@@ -31,4 +33,8 @@ public class NullItemLoadedFuture implements ItemLoadedFuture {
     public boolean isDone() {
         return true;
     }
+
+    @Override
+    public void setIsDone(boolean done) {
+    }
 }
diff --git a/src/com/android/mms/util/PduLoaderManager.java b/src/com/android/mms/util/PduLoaderManager.java
index f24af22..6ebcd30 100644
--- a/src/com/android/mms/util/PduLoaderManager.java
+++ b/src/com/android/mms/util/PduLoaderManager.java
@@ -110,11 +110,20 @@ public class PduLoaderManager extends BackgroundLoaderManager {
             mExecutor.execute(task);
         }
         return new ItemLoadedFuture() {
-            public void cancel() {
+            private boolean mIsDone;
+
+            public void cancel(Uri uri) {
                 cancelCallback(callback);
+                removePdu(uri);     // the pdu and/or slideshow might be half loaded. Make sure
+                                    // we load fresh the next time this uri is requested.
+            }
+
+            public void setIsDone(boolean done) {
+                mIsDone = done;
             }
+
             public boolean isDone() {
-                return false;
+                return mIsDone;
             }
         };
     }
@@ -133,10 +142,12 @@ public class PduLoaderManager extends BackgroundLoaderManager {
         if (Log.isLoggable(TAG, Log.DEBUG)) {
             Log.d(TAG, "removePdu: " + uri);
         }
-        synchronized(mPduCache) {
-            mPduCache.purge(uri);
+        if (uri != null) {
+            synchronized(mPduCache) {
+                mPduCache.purge(uri);
+            }
+            mSlideshowCache.remove(uri);
         }
-        mSlideshowCache.remove(uri);
     }
 
     public String getTag() {
diff --git a/src/com/android/mms/util/PhoneNumberFormatter.java b/src/com/android/mms/util/PhoneNumberFormatter.java
index 3f981c5..ad52528 100644
--- a/src/com/android/mms/util/PhoneNumberFormatter.java
+++ b/src/com/android/mms/util/PhoneNumberFormatter.java
@@ -16,13 +16,13 @@
 
 package com.android.mms.util;
 
-import com.android.mms.MmsApp;
-
 import android.content.Context;
 import android.os.AsyncTask;
 import android.telephony.PhoneNumberFormattingTextWatcher;
 import android.widget.TextView;
 
+import com.android.mms.MmsApp;
+
 public final class PhoneNumberFormatter {
     private PhoneNumberFormatter() {}
 
diff --git a/src/com/android/mms/util/RateController.java b/src/com/android/mms/util/RateController.java
index a91ae98..13e90de 100644
--- a/src/com/android/mms/util/RateController.java
+++ b/src/com/android/mms/util/RateController.java
@@ -17,14 +17,13 @@
 
 package com.android.mms.util;
 
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.BroadcastReceiver;
 import android.content.ContentValues;
 import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.provider.Telephony.Mms.Rate;
 import android.util.Log;
 
diff --git a/src/com/android/mms/util/Recycler.java b/src/com/android/mms/util/Recycler.java
index 3066aab..b44d2eb 100644
--- a/src/com/android/mms/util/Recycler.java
+++ b/src/com/android/mms/util/Recycler.java
@@ -16,16 +16,12 @@
 
 package com.android.mms.util;
 
-import com.android.mms.MmsConfig;
-import com.android.mms.ui.MessageUtils;
-import com.android.mms.ui.MessagingPreferenceActivity;
-import android.database.sqlite.SqliteWrapper;
-
 import android.content.ContentResolver;
 import android.content.ContentUris;
 import android.content.Context;
 import android.content.SharedPreferences;
 import android.database.Cursor;
+import android.database.sqlite.SqliteWrapper;
 import android.net.Uri;
 import android.preference.PreferenceManager;
 import android.provider.BaseColumns;
@@ -35,6 +31,10 @@ import android.provider.Telephony.Sms;
 import android.provider.Telephony.Sms.Conversations;
 import android.util.Log;
 
+import com.android.mms.MmsConfig;
+import com.android.mms.ui.MessageUtils;
+import com.android.mms.ui.MessagingPreferenceActivity;
+
 /**
  * The recycler is responsible for deleting old messages.
  */
diff --git a/src/com/android/mms/util/SendingProgressTokenManager.java b/src/com/android/mms/util/SendingProgressTokenManager.java
index 1709ae6..a10cf3f 100644
--- a/src/com/android/mms/util/SendingProgressTokenManager.java
+++ b/src/com/android/mms/util/SendingProgressTokenManager.java
@@ -17,10 +17,10 @@
 
 package com.android.mms.util;
 
-import android.util.Log;
-
 import java.util.HashMap;
 
+import android.util.Log;
+
 public class SendingProgressTokenManager {
     private static final String TAG = "SendingProgressTokenManager";
     private static final boolean DEBUG = false;
diff --git a/src/com/android/mms/util/SmileyParser.java b/src/com/android/mms/util/SmileyParser.java
index 836fbb5..7a663d1 100644
--- a/src/com/android/mms/util/SmileyParser.java
+++ b/src/com/android/mms/util/SmileyParser.java
@@ -16,6 +16,10 @@
 
 package com.android.mms.util;
 
+import java.util.HashMap;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
+
 import android.content.Context;
 import android.text.Spannable;
 import android.text.SpannableStringBuilder;
@@ -23,10 +27,6 @@ import android.text.style.ImageSpan;
 
 import com.android.mms.R;
 
-import java.util.HashMap;
-import java.util.regex.Matcher;
-import java.util.regex.Pattern;
-
 /**
  * A class for annotating a CharSequence with spans to convert textual emoticons
  * to graphical ones.
diff --git a/src/com/android/mms/util/ThumbnailManager.java b/src/com/android/mms/util/ThumbnailManager.java
index 3352296..681ba46 100644
--- a/src/com/android/mms/util/ThumbnailManager.java
+++ b/src/com/android/mms/util/ThumbnailManager.java
@@ -24,11 +24,11 @@ import java.util.Set;
 
 import android.content.Context;
 import android.graphics.Bitmap;
+import android.graphics.Bitmap.Config;
 import android.graphics.BitmapFactory;
+import android.graphics.BitmapFactory.Options;
 import android.graphics.Canvas;
 import android.graphics.Paint;
-import android.graphics.Bitmap.Config;
-import android.graphics.BitmapFactory.Options;
 import android.media.MediaMetadataRetriever;
 import android.net.Uri;
 import android.util.Log;
@@ -36,7 +36,6 @@ import android.util.Log;
 import com.android.mms.LogTag;
 import com.android.mms.R;
 import com.android.mms.TempFileProvider;
-import com.android.mms.ui.MessageItem;
 import com.android.mms.ui.UriImage;
 import com.android.mms.util.ImageCacheService.ImageData;
 
@@ -160,13 +159,22 @@ public class ThumbnailManager extends BackgroundLoaderManager {
             mExecutor.execute(task);
         }
         return new ItemLoadedFuture() {
+            private boolean mIsDone;
+
             @Override
-            public void cancel() {
+            public void cancel(Uri uri) {
                 cancelCallback(callback);
+                removeThumbnail(uri);   // if the thumbnail is half loaded, force a reload next time
+            }
+
+            @Override
+            public void setIsDone(boolean done) {
+                mIsDone = done;
             }
+
             @Override
             public boolean isDone() {
-                return false;
+                return mIsDone;
             }
         };
     }
@@ -181,12 +189,25 @@ public class ThumbnailManager extends BackgroundLoaderManager {
 
     // Delete the on-disk cache, but leave the in-memory cache intact
     public synchronized void clearBackingStore() {
-        getImageCacheService().clear();
-        mImageCacheService = null;  // force a re-init the next time getImageCacheService requested
+        if (mImageCacheService == null) {
+            // No need to call getImageCacheService() to renew the instance if it's null.
+            // It's enough to only delete the image cache files for the sake of safety.
+            CacheManager.clear(mContext);
+        } else {
+            getImageCacheService().clear();
+
+            // force a re-init the next time getImageCacheService requested
+            mImageCacheService = null;
+        }
     }
 
     public void removeThumbnail(Uri uri) {
-        mThumbnailCache.remove(uri);
+        if (Log.isLoggable(TAG, Log.DEBUG)) {
+            Log.d(TAG, "removeThumbnail: " + uri);
+        }
+        if (uri != null) {
+            mThumbnailCache.remove(uri);
+        }
     }
 
     @Override
@@ -231,6 +252,8 @@ public class ThumbnailManager extends BackgroundLoaderManager {
                 bitmap = getBitmap(mIsVideo);
             } catch (IllegalArgumentException e) {
                 Log.e(TAG, "Couldn't load bitmap for " + mUri, e);
+            } catch (OutOfMemoryError e) {
+                Log.e(TAG, "Couldn't load bitmap for " + mUri, e);
             }
             final Bitmap resultBitmap = bitmap;
 
diff --git a/src/com/android/mms/widget/MmsWidgetProvider.java b/src/com/android/mms/widget/MmsWidgetProvider.java
index 68ad4ea..99b7903 100644
--- a/src/com/android/mms/widget/MmsWidgetProvider.java
+++ b/src/com/android/mms/widget/MmsWidgetProvider.java
@@ -65,10 +65,10 @@ public class MmsWidgetProvider extends AppWidgetProvider {
             AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);
             int[] appWidgetIds = appWidgetManager.getAppWidgetIds(new ComponentName(context,
                     MmsWidgetProvider.class));
-            if (appWidgetIds.length > 0) {
-                appWidgetManager.notifyAppWidgetViewDataChanged(appWidgetIds[0],
-                        R.id.conversation_list);
-            }
+
+            // We need to update all Mms appwidgets on the home screen.
+            appWidgetManager.notifyAppWidgetViewDataChanged(appWidgetIds,
+                    R.id.conversation_list);
         } else {
             super.onReceive(context, intent);
         }
diff --git a/src/com/android/mms/widget/MmsWidgetService.java b/src/com/android/mms/widget/MmsWidgetService.java
index cd922f8..a0644a8 100644
--- a/src/com/android/mms/widget/MmsWidgetService.java
+++ b/src/com/android/mms/widget/MmsWidgetService.java
@@ -16,48 +16,31 @@
 
 package com.android.mms.widget;
 
+import android.app.PendingIntent;
 import android.appwidget.AppWidgetManager;
-import android.content.AsyncQueryHandler;
-import android.content.ContentResolver;
-import android.content.ContentUris;
 import android.content.Context;
-import android.content.CursorLoader;
 import android.content.Intent;
 import android.content.res.Resources;
 import android.database.Cursor;
-import android.database.sqlite.SQLiteException;
-import android.database.sqlite.SqliteWrapper;
-import android.net.Uri;
 import android.provider.Telephony.Threads;
 import android.text.Spannable;
 import android.text.SpannableStringBuilder;
-import android.text.TextUtils;
-import android.text.format.DateUtils;
-import android.text.style.AbsoluteSizeSpan;
 import android.text.style.ForegroundColorSpan;
 import android.text.style.TextAppearanceSpan;
 import android.util.Log;
 import android.view.View;
 import android.widget.RemoteViews;
 import android.widget.RemoteViewsService;
-import android.widget.TextView;
-import android.widget.RelativeLayout.LayoutParams;
 
 import com.android.mms.LogTag;
 import com.android.mms.R;
 import com.android.mms.data.Contact;
-import com.android.mms.data.ContactList;
 import com.android.mms.data.Conversation;
-import com.android.mms.transaction.MessagingNotification;
-import com.android.mms.ui.ComposeMessageActivity;
 import com.android.mms.ui.ConversationList;
 import com.android.mms.ui.ConversationListItem;
 import com.android.mms.ui.MessageUtils;
 import com.android.mms.util.SmileyParser;
 
-import java.util.Collection;
-import java.util.Map;
-
 public class MmsWidgetService extends RemoteViewsService {
     private static final String TAG = "MmsWidgetService";
 
@@ -201,9 +184,8 @@ public class MmsWidgetService extends RemoteViewsService {
             if (Log.isLoggable(LogTag.WIDGET, Log.VERBOSE)) {
                 Log.v(TAG, "getConversationCount");
             }
-            synchronized (sWidgetLock) {
-                return Math.min(mConversationCursor.getCount(), MAX_CONVERSATIONS_COUNT);
-            }
+
+            return Math.min(mConversationCursor.getCount(), MAX_CONVERSATIONS_COUNT);
         }
 
         /*
@@ -319,8 +301,11 @@ public class MmsWidgetService extends RemoteViewsService {
             RemoteViews view = new RemoteViews(mContext.getPackageName(), R.layout.widget_loading);
             view.setTextViewText(
                     R.id.loading_text, mContext.getText(R.string.view_more_conversations));
-            view.setOnClickFillInIntent(R.id.widget_loading,
-                   new Intent(mContext, ConversationList.class));
+            PendingIntent pendingIntent =
+                    PendingIntent.getActivity(mContext, 0, new Intent(mContext,
+                            ConversationList.class),
+                            PendingIntent.FLAG_UPDATE_CURRENT);
+            view.setOnClickPendingIntent(R.id.widget_loading, pendingIntent);
             return view;
         }
 
@@ -334,7 +319,7 @@ public class MmsWidgetService extends RemoteViewsService {
 
         @Override
         public int getViewTypeCount() {
-            return 1;
+            return 2;
         }
 
         @Override
diff --git a/tests/Android.mk b/tests/Android.mk
index 80768ef..b79da11 100644
--- a/tests/Android.mk
+++ b/tests/Android.mk
@@ -18,7 +18,7 @@ include $(CLEAR_VARS)
 # We only want this apk build for tests.
 LOCAL_MODULE_TAGS := tests
 
-LOCAL_JAVA_LIBRARIES := android.test.runner
+LOCAL_JAVA_LIBRARIES := android.test.runner telephony-common mms-common
 
 # Include all test java files.
 LOCAL_SRC_FILES := $(call all-java-files-under, src)
diff --git a/tests/src/com/android/mms/InterceptSendSms.java b/tests/src/com/android/mms/InterceptSendSms.java
index 7983c97..23c044a 100644
--- a/tests/src/com/android/mms/InterceptSendSms.java
+++ b/tests/src/com/android/mms/InterceptSendSms.java
@@ -15,7 +15,7 @@
  */
 
 
-package src.com.android.mms;
+package com.android.mms;
 
 import com.android.mms.LogTag;
 import com.android.mms.R;
diff --git a/tests/src/com/android/mms/util/VideoCaptureTests.java b/tests/src/com/android/mms/util/VideoCaptureTests.java
new file mode 100644
index 0000000..dc0d981
--- /dev/null
+++ b/tests/src/com/android/mms/util/VideoCaptureTests.java
@@ -0,0 +1,47 @@
+/*
+ * Copyright (C) 2012 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.mms.util;
+
+import android.test.AndroidTestCase;
+import android.test.suitebuilder.annotation.SmallTest;
+import com.android.mms.ui.MessageUtils;
+
+/**
+ * Unit tests for Video Capture utilities.
+ *
+ * To run the test:
+ *    runtest --test-class=com.android.mms.util.VideoCaptureTests mms
+ */
+@SmallTest
+public class VideoCaptureTests extends AndroidTestCase {
+
+    @Override
+    protected void setUp() throws Exception {
+        super.setUp();
+    }
+
+    /**
+     * Test the function that computes rounded video record times.
+     */
+    public void testVideoCaptureDurationLimit() {
+        assertEquals(MessageUtils.getVideoCaptureDurationLimit(0), 0);          // 0 -> 0 secs
+        assertEquals(MessageUtils.getVideoCaptureDurationLimit(100), 0);        // 0 -> 0 secs
+        assertEquals(MessageUtils.getVideoCaptureDurationLimit(500000), 20);    // 28 -> 20 secs
+        assertEquals(MessageUtils.getVideoCaptureDurationLimit(1000000), 50);   // 57 -> 50 secs
+        assertEquals(MessageUtils.getVideoCaptureDurationLimit(10000000), 120); // 570 -> 120 secs
+    }
+}
